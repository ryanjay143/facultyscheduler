import{c as Je,r as i,j as e,e as ce,B as A,X as _s,f as de,C as we,t as u,a as Re}from"./index-jewFnda3.js";import{L as N}from"./label-DxA-s2ol.js";import{S,a as w,b as I,c as C,d as j}from"./select-D4GS9LRo.js";import{D as Ye,a as He,b as Oe,c as Ve,e as Be,f as Ue}from"./dialog-CQlO8c5u.js";import{I as Ts}from"./input-FCWlxxaT.js";import $s from"./html2canvas.esm-BfxBtG_O.js";import{E as Ps}from"./jspdf.es.min-nToRZ2zG.js";import{B as me}from"./badge-Ci_bdU4p.js";import{C as Ms,b as ks}from"./card-BlnVAMST.js";import{F as Es}from"./funnel-CwtRiCHc.js";import{L as Ie}from"./loader-circle-CALl4o6w.js";import{C as Fs}from"./check-C4K5SOAd.js";import{P as ze}from"./plus-PL2mRHb3.js";import{C as Ge}from"./chevron-right-9ZnRADX_.js";import{M as We}from"./map-pin-B1QSt18C.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Ds=Je("download",As);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],Rs=Je("tag",Ls),Ys=["Mon","Tues","Wed","Thurs","Fri","Sat"],Ce=7,Hs=22,ue=Hs-Ce,qe=[1,2,3,4],K=3.5,U=4.5,Xe=[{bg:"bg-blue-50 hover:bg-blue-100",border:"border-blue-500",text:"text-blue-700",badge:"bg-blue-100 text-blue-800"},{bg:"bg-emerald-50 hover:bg-emerald-100",border:"border-emerald-500",text:"text-emerald-700",badge:"bg-emerald-100 text-emerald-800"},{bg:"bg-violet-50 hover:bg-violet-100",border:"border-violet-500",text:"text-violet-700",badge:"bg-violet-100 text-violet-800"},{bg:"bg-amber-50 hover:bg-amber-100",border:"border-amber-500",text:"text-amber-700",badge:"bg-amber-100 text-amber-800"},{bg:"bg-rose-50 hover:bg-rose-100",border:"border-rose-500",text:"text-rose-700",badge:"bg-rose-100 text-rose-800"},{bg:"bg-cyan-50 hover:bg-cyan-100",border:"border-cyan-500",text:"text-cyan-700",badge:"bg-cyan-100 text-cyan-800"}],Os={Mon:"bg-blue-100/70 text-blue-800",Tues:"bg-emerald-100/70 text-emerald-800",Wed:"bg-violet-100/70 text-violet-800",Thurs:"bg-amber-100/70 text-amber-800",Fri:"bg-rose-100/70 text-rose-800",Sat:"bg-cyan-100/70 text-cyan-800"},Vs=c=>Xe[c%Xe.length],Bs=c=>({Monday:"Mon",Tuesday:"Tues",Wednesday:"Wed",Thursday:"Thurs",Friday:"Fri",Saturday:"Sat"})[c]||c,z=c=>{if(!c)return"";const f=c.length>5?c.substring(0,5):c,[h,q]=f.split(":");let Y=parseInt(h,10);const D=parseInt(q,10),xe=Y>=12?"PM":"AM";Y=Y%12||12;const Q=D<10?`0${D}`:D;return`${Y}:${Q} ${xe}`},G=c=>{if(!c)return 0;const[f,h]=c.split(":").map(Number);return f*60+h},W=c=>{switch(c){case 1:return"1st Year";case 2:return"2nd Year";case 3:return"3rd Year";case 4:return"4th Year";default:return`${c}th Year`}},nt=({scheduleData:c=[],subjectsData:f=[],facultyLoadingData:h=[],savedSections:q=[],onAddSchedule:Y,onFilterApply:D,isInitialLoading:xe=!1,authToken:Q})=>{const[Z,_e]=i.useState([]),[H,Te]=i.useState(!1),[P,pe]=i.useState(null),[M,ge]=i.useState(null),[k,fe]=i.useState(null),[be,$e]=i.useState(!1),[g,Ke]=i.useState(""),[ee,je]=i.useState(""),[x,Qe]=i.useState(""),[X,se]=i.useState(null),[Ze,ye]=i.useState(!1),[_,te]=i.useState(""),[ae,E]=i.useState(""),[y,ve]=i.useState(""),[es,J]=i.useState(!1),[Pe,Me]=i.useState(!1),[n,L]=i.useState({subjectId:"",loadId:"",roomId:"",day:"",startTime:"",endTime:"",type:""}),[ss,ke]=i.useState(!1),[Ne,Ee]=i.useState(null),Fe=i.useRef(null);i.useEffect(()=>{(async()=>{const r=localStorage.getItem("accessToken")||Q;if(!r){u.error("Authentication token not found. Cannot load programs.");return}Te(!0);try{const a=await Re.get("program",{headers:{Authorization:`Bearer ${r}`,Accept:"applichn/json"}});_e(a.data.programs)}catch(a){console.error("Failed to fetch programs:",a);const l=Re.isAxiosError(a)?a.response?.data?.message||a.message:"An unknown error occurred.";u.error(`Failed to load program list: ${l}`),_e([])}finally{Te(!1)}})()},[Q]);const ts=i.useMemo(()=>new Map(Z.map(s=>[s.id,s.abbreviation])),[Z]),le=s=>ts.get(s)||"N/A",{getSubjectDisplayInfo:as}=i.useMemo(()=>{const s=new Map;h.forEach(a=>{const l=a.subject_id,o=a.faculty.user?.name;o&&(s.has(l)||s.set(l,[]),s.get(l).push(o))});const t=new Map;return f.forEach(a=>{const l=Array.from(new Set(s.get(a.id)||[]));t.set(a.id,{displayName:`${a.subject_code} - ${a.des_title}`,facultyNames:l})}),{getSubjectDisplayInfo:a=>t.get(a)}},[h,f]),Ae=(s,t)=>{if(!s||!t)return[];if(X&&X.length>0)return X.slice().sort();const r=c.filter(l=>l.year_level===s&&l.program_id===t).map(l=>l.section),a=q.filter(l=>l.yearLevel===s).map(l=>l.section);return[...new Set([...r,...a])].sort()},ls=i.useMemo(()=>{const s=g?parseInt(g):null,t=x?parseInt(x):null;return s&&t?Ae(s,t):[]},[g,x,c,q,X]),rs=i.useMemo(()=>{const s=_?parseInt(_):null,t=y?parseInt(y):null;return s&&t?Ae(s,t):[]},[_,y,c,q,X]);i.useEffect(()=>{const s=g?parseInt(g):null,t=x?parseInt(x):null;if(!s||!t){se(null);return}let r=!1;return(async()=>{try{const a=await D(s,"",t);if(r)return;if(a&&a.success&&Array.isArray(a.data)){const l=Array.from(new Set(a.data.map(o=>o.section))).sort();se(l)}else se([])}catch{r||se([])}})(),()=>{r=!0}},[g,x,D]);const re=i.useMemo(()=>{const s=new Set;return h.forEach(t=>{typeof t.subject_id=="number"?s.add(t.subject_id):t.subject&&typeof t.subject.id=="number"&&s.add(t.subject.id)}),f.filter(t=>s.has(t.id))},[f,h]),O=i.useMemo(()=>{if(!n.subjectId)return[];if(n.loadId){const s=n.loadId.split(",").map(t=>t.trim()).filter(Boolean);if(s.length>0)return h.filter(t=>{const r=t.id?String(t.id):"";return s.includes(r)})}return h.filter(s=>String(s.subject_id)===n.subjectId||s.subject&&String(s.subject.id)===n.subjectId)},[n.subjectId,n.loadId,h]),ns=i.useMemo(()=>{const s=new Map;return O.forEach(t=>{s.has(t.room_id)||s.set(t.room_id,{id:t.room.id,roomNumber:t.room.roomNumber,type:t.room.type,capacity:0,status:0,created_at:"",updated_at:""})}),Array.from(s.values())},[O]),is=i.useMemo(()=>{if(!n.roomId)return[];const s=O.filter(r=>r.room_id.toString()===n.roomId),t=new Set(s.map(r=>r.day));return Array.from(t)},[O,n.roomId]),os=i.useMemo(()=>!n.roomId||!n.day?[]:O.filter(t=>t.room_id.toString()===n.roomId&&t.day===n.day).map(t=>{const r=t.start_time.substring(0,5),a=t.end_time.substring(0,5);return{value:`${r}|${a}|${t.type}`,display:`${z(t.start_time)} - ${z(t.end_time)} (${t.type})`,type:t.type}}),[O,n.roomId,n.day]),De=async(s,t,r)=>{if(s===null||t===null||r===null)return u.error("Please select Program, Year Level, and Section."),{success:!1};$e(!0);try{const a=await D(s,t,r);if(a.success){if(pe(s),ge(t),fe(r),a.data.length===0&&a.message)u.info(a.message);else if(a.data.length>0){const l=le(r);u.success(`Schedule loaded for ${l}, ${W(s)} - ${t}`)}return{success:!0,data:a.data}}else return u.error(a.message||"Failed to load schedule. Please try again."),pe(null),ge(null),fe(null),{success:!1}}catch(a){return console.error("Error applying filter:",a),pe(null),ge(null),fe(null),{success:!1}}finally{$e(!1)}},cs=async()=>{const s=g?parseInt(g):null,t=ee.trim()||null,r=x?parseInt(x):null;await De(s,t,r)},ds=()=>{te(""),E(""),ve(""),J(!1),L({subjectId:"",loadId:"",roomId:"",day:"",startTime:"",endTime:"",type:""}),ye(!0)},ms=s=>{Ke(s),je("")},us=s=>{Qe(s),je("")},hs=s=>{if(!s){L({subjectId:"",loadId:"",roomId:"",day:"",startTime:"",endTime:"",type:""});return}const t=s.split("|"),r=t[0]||"",a=t[1]||"";L({subjectId:r,loadId:a,roomId:"",day:"",startTime:"",endTime:"",type:""})},xs=s=>{L(t=>({...t,roomId:s,day:"",startTime:"",endTime:"",type:""}))},ps=s=>{L(t=>({...t,day:s,startTime:"",endTime:"",type:""}))},gs=s=>{if(!s)return;const[t,r,a]=s.split("|");L(l=>({...l,startTime:t,endTime:r,type:a}))},fs=n.startTime&&n.endTime&&n.type?`${n.startTime}|${n.endTime}|${n.type}`:void 0,bs=async()=>{if(!_||!ae||!y||!n.subjectId||!n.roomId||!n.day||!n.startTime||!n.type){u.error("Please fill in all fields.");return}const s=parseInt(_),t=ae.trim(),r=parseInt(y);if(isNaN(r)){u.error("Invalid Program selection. Please choose a Program.");return}const a=parseInt(n.roomId),l=parseInt(n.subjectId),o=G(n.startTime),m=G(n.endTime),T=n.type;let b=!1;for(const d of c)if(d.faculty_loading.day===n.day){const p=G(d.faculty_loading.start_time),$=G(d.faculty_loading.end_time);if(o<$&&m>p){if(d.faculty_loading.room.id===a){const V=d.faculty_loading.room.roomNumber;u.error(`Room Conflict: ${V} is occupied by Section ${d.section} at this time.`),b=!0;break}if(d.year_level===s&&d.section===t){u.error(`Section Conflict: ${t} already has a class at this time.`),b=!0;break}}}if(!b){Me(!0);try{if(await Y({roomId:a,subjectId:l,section:t,day:n.day,startTime:n.startTime,endTime:n.endTime,yearLevel:s,type:T,programId:r})){const p=g?parseInt(g):s,$=ee||t,F=x?parseInt(x):r;await De(p,$,F),te(""),E(""),ve(""),L({subjectId:"",loadId:"",roomId:"",day:"",startTime:"",endTime:"",type:""}),ye(!1)}}finally{Me(!1)}}},js=s=>{Ee(s),ke(!0)},ys=()=>{ke(!1),Ee(null)},vs=s=>{if(!s)return null;const t=s.faculty_loading,r=t.faculty.user?.name??"Faculty Not Assigned",a=t.subject.subject_code,l=t.subject.des_title,o=t.room.roomNumber,m=t.type;return{faculty:r,subjectCode:a,subjectTitle:l,roomNumber:o,type:m,day:t.day,startTime:z(t.start_time),endTime:z(t.end_time),section:s.section}},Ns=async()=>{if(!P||!M||!k){u.error("Please apply a filter before downloading the schedule.");return}const s=Fe.current;if(!s){u.error("Schedule content not found for PDF export.");return}u.info("Generating PDF... this may take a moment.");let t=null;try{const r=s.cloneNode(!0);r.querySelectorAll('[class*="line-clamp"], .overflow-hidden, .truncate').forEach(v=>{Array.from(v.classList).forEach(oe=>{(oe.startsWith("line-clamp")||oe==="overflow-hidden"||oe==="truncate")&&v.classList.remove(oe)}),v.style.whiteSpace="normal",v.style.overflow="visible",v.style.maxHeight="none"});const l=r.querySelector("h2.text-2xl");if(l){const v=l.closest("div");v&&v.parentNode&&v.parentNode.removeChild(v)}t=document.createElement("div"),t.style.position="absolute",t.style.left="-9999px",t.style.top="0",t.style.background="#ffffff",t.style.padding="16px",t.style.boxSizing="border-box",t.style.width=`${s.offsetWidth}px`,r.style.width="100%",r.style.boxSizing="border-box";const o=document.createElement("div");o.className="flex items-center gap-2 text-slate-800 px-1 mb-4";const m=le(k),T=document.createElement("div");T.className="text-sm py-1 px-3 bg-indigo-100 text-indigo-800 font-medium rounded-md shadow-sm",T.textContent=m;const b=document.createElement("div");b.className="text-slate-400",b.textContent="›";const d=document.createElement("div");d.className="text-sm py-1 px-3 bg-white border-slate-300 font-medium rounded-md shadow-sm border",d.textContent=W(P);const p=document.createElement("div");p.className="text-slate-400",p.textContent="›";const $=document.createElement("h2");$.className="text-2xl font-bold tracking-tight",$.textContent=String(M),o.appendChild(T),o.appendChild(b),o.appendChild(d),o.appendChild(p),o.appendChild($),t.appendChild(o),t.appendChild(r),document.body.appendChild(t);const F=await $s(t,{scale:2,useCORS:!0,logging:!1}),V=F.toDataURL("image/png"),B=new Ps({orientation:"portrait",unit:"mm",format:"a4"}),R=210,Le=297,ne=F.height*R/F.width;let ie=ne,Se=0;for(B.addImage(V,"PNG",0,Se,R,ne),ie-=Le;ie>=-1;)Se=ie-ne,B.addPage(),B.addImage(V,"PNG",0,Se,R,ne),ie-=Le;const ws=W(P).replace(/\s+/g,"_"),Is=String(M).replace(/\s+/g,"_"),Cs=`Class_Schedule_${m.replace(/\s+/g,"_")}_${ws}_${Is}_${new Date().toISOString().substring(0,10)}.pdf`;B.save(Cs),u.success("PDF Downloaded successfully!")}catch(r){console.error("PDF Generation Error:",r),u.error("Failed to generate PDF. Make sure you have html2canvas and jspdf installed.")}finally{try{t&&t.parentNode&&t.parentNode.removeChild(t)}catch{}}},Ss=()=>{if(P===null||M===null||k===null)return xe?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[500px] border border-dashed border-slate-200 rounded-xl bg-slate-50/50 mt-4",children:[e.jsx("div",{className:"bg-white p-6 rounded-full shadow-sm mb-4",children:e.jsx(ce,{className:"w-10 h-10 text-slate-300 animate-pulse"})}),e.jsx("h3",{className:"text-xl font-semibold text-slate-800",children:"Loading Schedule"}),e.jsx("p",{className:"text-slate-500 text-center max-w-sm mt-2",children:"Loading initial scheduling data — please wait."}),e.jsx("div",{className:"mt-4",children:e.jsx(Ie,{className:"w-5 h-5 text-slate-400 animate-spin"})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-[500px] border border-dashed border-slate-200 rounded-xl bg-slate-50/50 mt-4",children:[e.jsx("div",{className:"bg-white p-6 rounded-full shadow-sm mb-4",children:e.jsx(ce,{className:"w-10 h-10 text-slate-300"})}),e.jsx("h3",{className:"text-xl font-semibold text-slate-800",children:"No Schedule Selected"}),e.jsx("p",{className:"text-slate-500 text-center max-w-sm mt-2",children:"Select a Program, Year Level and Section above and click 'Apply Filter' to view the class schedule, or create a new one."})]});const s=c.filter(t=>t.year_level===P&&t.section===M);return e.jsx("div",{className:"border border-slate-200 rounded-xl overflow-hidden bg-white shadow-sm mt-6 relative select-none",children:e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"w-20 flex-shrink-0 relative bg-slate-50/80 border-r border-slate-200",style:{height:`${K+ue*U}rem`},children:[e.jsx("div",{className:"h-[3.5rem] border-b border-slate-200 bg-slate-100/50"}),Array.from({length:ue+1}).map((t,r)=>{const a=Ce+r,l=a>12?a-12:a===0?12:a,o=a>=12?"PM":"AM",m=K+r*U;return e.jsxs("div",{className:"absolute right-3 text-[11px] font-semibold text-slate-400 translate-y-1.5",style:{top:`${m}rem`},children:[l,":00 ",o]},a)})]}),e.jsx("div",{className:"flex-1 grid grid-cols-6 divide-x divide-slate-300",children:Ys.map(t=>{const r=Os[t]||"bg-slate-50/50 text-slate-600";return e.jsxs("div",{className:"relative bg-white",style:{height:`${K+ue*U}rem`},children:[e.jsx("div",{className:`h-[3.5rem] flex items-center justify-center font-bold text-sm border-b border-slate-200 uppercase tracking-wider ${r}`,children:t}),Array.from({length:ue}).map((a,l)=>e.jsx("div",{className:"absolute w-full border-b border-slate-300",style:{top:`${K+(l+1)*U}rem`}},l)),s.filter(a=>Bs(a.faculty_loading.day)===t).map(a=>{const l=a.faculty_loading,o=l.subject,m=l.room;if(!o)return null;const T=l.faculty.user?.name??"Unassigned",b=l.type,d=G(l.start_time),p=G(l.end_time),$=d-Ce*60,F=p-d,V=K+$/60*U,B=F/60*U,R=Vs(l.subject.id);return e.jsx("div",{className:"absolute w-full px-1.5 z-10",style:{top:`${V}rem`,height:`${B}rem`},onClick:()=>js(a),children:e.jsxs("div",{className:`rounded-lg p-2.5 h-full flex flex-col justify-between overflow-hidden ${R.bg} ${R.border} border-l-[3px] shadow-sm hover:shadow-md transition-all duration-200 group cursor-pointer`,children:[e.jsxs("div",{children:[e.jsx("div",{className:`font-bold text-xs leading-tight mb-0.5 ${R.text}`,children:o.subject_code}),e.jsx("div",{className:"text-[10px] text-slate-600 line-clamp-2 leading-tight",children:o.des_title})]}),e.jsxs("div",{className:"mt-1 pt-1.5 border-t border-black/5 flex flex-col justify-end items-start text-[9px] font-semibold text-slate-500 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(de,{className:"w-3 h-3 text-slate-400"}),e.jsx("span",{className:"text-slate-700 line-clamp-1",children:T})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(We,{className:"w-3 h-3 text-slate-400"}),e.jsx("span",{className:"text-slate-700",children:m.roomNumber}),e.jsx("span",{className:"bg-white/50 px-1 rounded text-xs font-bold text-slate-700 uppercase",children:b})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(we,{className:"w-3 h-3 text-slate-400"}),e.jsxs("span",{children:[z(l.start_time)," - ",z(l.end_time)]})]})]})]})},a.id)})]},t)})})]})})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ms,{className:"border-none shadow-sm bg-slate-50/50",children:e.jsxs(ks,{className:"p-4 flex flex-col md:flex-row gap-6 items-end md:items-center justify-between",children:[e.jsxs("div",{className:"w-full md:w-auto flex items-end justify-start gap-4 flex-wrap",children:[e.jsxs("div",{className:"w-44 sm:w-48 space-y-1.5",children:[e.jsxs(N,{className:"text-xs font-semibold text-slate-500 uppercase tracking-wide flex items-center gap-1.5",children:[e.jsx(Es,{className:"w-3 h-3"})," Filter Program"]}),e.jsxs(S,{onValueChange:us,value:x,disabled:H,children:[e.jsx(w,{className:"h-10 bg-white border-slate-200 focus:ring-slate-200 transition-shadow",children:e.jsx(I,{placeholder:H?"Loading Programs...":"Select Program"})}),e.jsx(C,{children:Z.map(s=>e.jsxs(j,{value:s.id.toString(),children:[s.program_name," (",s.abbreviation,")"]},s.id))})]})]}),e.jsxs("div",{className:"w-44 sm:w-48 space-y-1.5",children:[e.jsxs(N,{className:"text-xs font-semibold text-slate-500 uppercase tracking-wide flex items-center gap-1.5",children:[e.jsx(ce,{className:"w-3 h-3"})," Filter Year"]}),e.jsxs(S,{onValueChange:ms,value:g,disabled:!x,children:[e.jsx(w,{className:"h-10 bg-white border-slate-200 focus:ring-slate-200 transition-shadow",children:e.jsx(I,{placeholder:"Select Year"})}),e.jsx(C,{children:qe.map(s=>e.jsx(j,{value:s.toString(),children:W(s)},s))})]})]}),e.jsxs("div",{className:"w-44 sm:w-48 space-y-1.5",children:[e.jsx(N,{className:"text-xs font-semibold text-slate-500 uppercase tracking-wide",children:"Filter Section"}),e.jsxs(S,{onValueChange:je,value:ee,disabled:!g||!x,children:[e.jsx(w,{className:"h-10 bg-white border-slate-200 focus:ring-slate-200 transition-shadow",children:e.jsx(I,{placeholder:"Select Section"})}),e.jsx(C,{children:ls.map(s=>e.jsx(j,{value:s,children:s},s))})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(A,{onClick:cs,disabled:!g||!ee||!x||be||H,className:"h-10 shadow-md transition-all px-4",title:"Apply selected filters to the schedule grid",children:[be?e.jsx(Ie,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Fs,{className:"h-4 w-4 mr-2"}),be?"Loading...":"Apply Filter"]})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(A,{onClick:Ns,disabled:!P||!M||!k,className:"h-10 shadow-md transition-all",variant:"outline",children:[e.jsx(Ds,{className:"mr-2 h-4 w-4"})," Download PDF"]}),e.jsxs(A,{onClick:ds,className:"shadow-md hover:shadow-lg transition-all",disabled:H,children:[e.jsx(ze,{className:"mr-2 h-4 w-4"})," Add Class Schedule"]})]})]})}),e.jsxs("div",{ref:Fe,className:"w-full",children:[P&&M&&k&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-800 px-1",children:[e.jsx(me,{variant:"secondary",className:"text-sm py-1 px-3 bg-indigo-100 text-indigo-800 font-medium rounded-md shadow-sm",children:le(k)}),e.jsx(Ge,{className:"w-4 h-4 text-slate-400"}),e.jsx(me,{variant:"outline",className:"text-sm py-1 px-3 bg-white border-slate-300 font-medium rounded-md shadow-sm",children:W(P)}),e.jsx(Ge,{className:"w-4 h-4 text-slate-400"}),e.jsxs("h2",{className:"text-2xl font-bold tracking-tight",children:[" ",M]})]}),Ss()]}),e.jsx(Ye,{open:Ze,onOpenChange:ye,children:e.jsxs(He,{className:"sm:max-w-[550px]",children:[e.jsx(Oe,{children:e.jsx(Ve,{children:"Add Class Schedule"})}),e.jsxs("div",{className:"grid gap-5 py-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2 col-span-1",children:[e.jsxs(N,{children:["Program ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(S,{onValueChange:s=>{ve(s),te(""),E(""),J(!1)},value:y,disabled:H,children:[e.jsx(w,{children:e.jsx(I,{placeholder:H?"Loading...":"Select Program"})}),e.jsx(C,{children:Z.map(s=>e.jsxs(j,{value:s.id.toString(),children:[s.program_name," (",s.abbreviation,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2 col-span-1",children:[e.jsxs(N,{children:["Year Level ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(S,{onValueChange:s=>{te(s),E(""),J(!1)},value:_,disabled:!y,children:[e.jsx(w,{children:e.jsx(I,{placeholder:"Select Year"})}),e.jsx(C,{children:qe.map(s=>e.jsx(j,{value:s.toString(),children:W(s)},s))})]})]}),e.jsxs("div",{className:"space-y-2 col-span-1",children:[e.jsxs(N,{children:["Section ",e.jsx("span",{className:"text-red-500",children:"*"})]}),es?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ts,{placeholder:"New Section Name",value:ae,onChange:s=>E(s.target.value)}),e.jsx(A,{size:"icon",variant:"ghost",onClick:()=>{J(!1),E("")},children:e.jsx(_s,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(S,{onValueChange:E,value:ae,disabled:!_||!y,children:[e.jsx(w,{className:"flex-1",children:e.jsx(I,{placeholder:"Select Section"})}),e.jsx(C,{children:rs.map(s=>e.jsx(j,{value:s,children:s},s))})]}),e.jsx(A,{size:"icon",variant:"outline",onClick:()=>{J(!0),E("")},disabled:!_||!y,title:"Create New Section",children:e.jsx(ze,{className:"h-4 w-4"})})]})]})]}),e.jsx("div",{className:"border-t border-slate-100"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{children:["Subject (from Faculty Loading) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(S,{onValueChange:hs,value:n.loadId?`${n.subjectId}|${n.loadId}`:n.subjectId,disabled:re.length===0,children:[e.jsx(w,{children:e.jsx(I,{placeholder:re.length===0?"No subjects in faculty loading":"Select Subject"})}),e.jsx(C,{children:re.length>0?re.reduce((s,t)=>{const r=as(t.id);if(!r)return s;const a=h.filter(l=>l.subject_id===t.id||l.subject&&l.subject.id===t.id);if(a.length>0){const l=new Map;a.forEach(o=>{const m=o.faculty?.user?.name||"Faculty Unassigned";l.has(m)||l.set(m,[]),l.get(m).push(o)}),l.forEach((o,m)=>{const T=o.map(p=>p.id?String(p.id):`${p.faculty?.id??""}-${p.room_id??""}`).filter(Boolean),b=`${t.id}|${T.join(",")}`,d=o.length>1?` (${o.length})`:"";s.push(e.jsx(j,{value:b,children:e.jsxs("div",{className:"flex flex-col items-start w-full pr-8",children:[e.jsx("span",{className:"font-semibold text-sm leading-tight",children:r.displayName}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mt-0.5",children:[e.jsx(de,{className:"w-3 h-3 text-slate-400 flex-shrink-0"}),e.jsxs("span",{className:"truncate",children:[m,d]})]})]})},`s-${t.id}-g-${m}`))})}else s.push(e.jsx(j,{value:`${t.id}|`,children:e.jsxs("div",{className:"flex flex-col items-start w-full pr-8",children:[e.jsx("span",{className:"font-semibold text-sm leading-tight",children:r.displayName}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mt-0.5",children:[e.jsx(de,{className:"w-3 h-3 text-slate-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Faculty Unassigned"})]})]})},`s-${t.id}`));return s},[]):e.jsx("div",{className:"p-2 text-xs text-muted-foreground text-center",children:y?_?"No subjects assigned in faculty loading for this year":"Select a year level first":"Select a program first"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{children:["Room ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(S,{onValueChange:xs,value:n.roomId,disabled:!n.subjectId,children:[e.jsx(w,{children:e.jsx(I,{placeholder:"Select Room"})}),e.jsx(C,{children:ns.map(s=>e.jsxs(j,{value:s.id.toString(),children:[s.roomNumber," (",s.type,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{children:["Day ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(S,{onValueChange:ps,value:n.day,disabled:!n.roomId,children:[e.jsx(w,{children:e.jsx(I,{placeholder:"Select Day"})}),e.jsx(C,{children:is.map(s=>e.jsx(j,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{children:["Time Slot ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(S,{onValueChange:gs,value:fs,disabled:!n.day,children:[e.jsx(w,{children:e.jsx(I,{placeholder:"Select Time Slot"})}),e.jsx(C,{children:os.map((s,t)=>e.jsx(j,{value:s.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4 text-slate-400"}),s.display]})},t))})]})]})]}),e.jsxs(Be,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx(A,{variant:"outline",children:"Cancel"})}),e.jsx(A,{onClick:bs,disabled:Pe,children:Pe?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"mr-2 h-4 w-4 animate-spin"})," Saving..."]}):"Save Schedule"})]})]})}),e.jsx(Ye,{open:ss,onOpenChange:ys,children:e.jsxs(He,{className:"sm:max-w-[450px]",children:[e.jsx(Oe,{children:e.jsx(Ve,{children:"Class Schedule Details"})}),Ne&&(()=>{const s=vs(Ne);return s?e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 bg-slate-50/70 shadow-sm",children:[e.jsxs("h3",{className:"text-base font-semibold text-slate-700 flex items-center mb-1",children:[e.jsx(de,{className:"w-4 h-4 mr-2 text-blue-600"})," ",s.faculty]}),e.jsxs("h2",{className:"text-xl font-bold text-slate-900 tracking-tight leading-snug",children:[s.subjectCode," - ",s.subjectTitle]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[k&&e.jsxs(me,{variant:"secondary",className:"bg-indigo-100 text-indigo-800 font-medium hover:bg-indigo-200",children:["Program: ",le(k)]}),e.jsxs(me,{variant:"secondary",className:"bg-blue-100 text-blue-800 font-medium hover:bg-blue-200",children:["Section: ",Ne.year_level," Year - ",s.section]})]})]}),e.jsxs("div",{className:"grid gap-3 pt-2",children:[e.jsx(he,{icon:ce,label:"Day",value:s.day}),e.jsx(he,{icon:we,label:"Time Slot",value:`${s.startTime} - ${s.endTime}`}),e.jsx(he,{icon:We,label:"Room",value:s.roomNumber}),e.jsx(he,{icon:Rs,label:"Type",value:s.type})]})]}):e.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"Details not found."})})(),e.jsx(Be,{children:e.jsx(Ue,{asChild:!0,children:e.jsx(A,{variant:"outline",children:"Close"})})})]})})]})},he=({icon:c,label:f,value:h})=>e.jsxs("div",{className:"flex items-center p-3.5 bg-white border border-slate-200 rounded-lg shadow-sm",children:[e.jsx("div",{className:"p-2 bg-slate-100 rounded-md mr-4 flex-shrink-0",children:e.jsx(c,{className:"w-4 h-4 text-slate-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-[10px] font-medium uppercase text-slate-500 block tracking-wider",children:f}),e.jsx("span",{className:"text-sm font-semibold text-slate-800 break-words leading-tight",children:h})]})]});export{nt as C};
