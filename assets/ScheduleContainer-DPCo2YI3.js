import{c as X,j as e,m as q,U as J,C as K,B as k,r as g,t as H}from"./index-Po53OIl0.js";import{I as Y}from"./input-DNoS9bPa.js";import{S as P}from"./sweetalert2.esm.all-ePrzfkxH.js";import{B as G}from"./badge-Rf2epNAW.js";import{C as Z}from"./circle-x-C3tcYMkb.js";import{C as ee}from"./chevron-right-jGiJIYhc.js";import{D as se,a as te,b as ae,c as ne,d as ie,e as re,f as le}from"./dialog-hPjQnq3D.js";import{P as oe}from"./progress-DxGaCGw4.js";import{S as V}from"./search-DXAaClRH.js";import"./Combination-zj8ruZ9V.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],B=X("info",ce),de=[{id:1,name:"Dr. Evelyn Reed",expertise:["Software Engineering","Programming"],availability:{Monday:["08:00-11:00"],Wednesday:["13:00-16:00"]},maxSubjects:4},{id:2,name:"Dr. Samuel Grant",expertise:["Cyber Security","Computer Networks"],availability:{Tuesday:["09:30-12:30"],Thursday:["08:00-09:30","13:00-14:30"]},maxSubjects:4},{id:3,name:"Prof. Alisha Chen",expertise:["HCI","Game Development"],availability:{Friday:["11:00-14:30"],Saturday:["09:30-11:00"]},maxSubjects:3},{id:4,name:"Dr. Ben Carter",expertise:["Computer Graphics & Vision","Programming"],availability:{Monday:["08:00-11:00"],Wednesday:["14:30-16:00"]},maxSubjects:4}],me=[{id:1,code:"CS101",name:"Introduction to Programming",expertise:"Programming",assigned:null},{id:2,code:"CS205",name:"Data Structures and Algorithms",expertise:"Programming",assigned:null},{id:3,code:"SE301",name:"Agile Development",expertise:"Software Engineering",assigned:{faculty:"Dr. Evelyn Reed",time:"Monday 09:30-11:00; Wednesday 13:00-14:30"}},{id:4,code:"CS402",name:"Information Security",expertise:"Cyber Security",assigned:{faculty:"Dr. Samuel Grant",time:"Tuesday 09:30-11:00"}},{id:5,code:"NT201",name:"Computer Networks Fundamentals",expertise:"Computer Networks",assigned:null},{id:6,code:"GD303",name:"Intro to Game Design",expertise:"Game Development",assigned:{faculty:"Prof. Alisha Chen",time:"Friday 11:00-12:30"}}],U=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],O={Monday:["08:00-09:30","09:30-11:00","11:00-12:30","13:00-14:30","14:30-16:00"],Tuesday:["08:00-09:30","09:30-11:00","11:00-12:30","13:00-14:30","14:30-16:00"],Wednesday:["08:00-09:30","09:30-11:00","11:00-12:30","13:00-14:30","14:30-16:00"],Thursday:["08:00-09:30","09:30-11:00","11:00-12:30","13:00-14:30","14:30-16:00"],Friday:["08:00-09:30","09:30-11:00","11:00-12:30","13:00-14:30","14:30-16:00"],Saturday:["08:00-09:30","09:30-11:00","11:00-12:30"]},W=t=>{if(!t||!t.includes(":"))return t;const[a,l]=t.split(":");let n=Number(a);const u=n<12?"am":"pm";return n===0&&(n=12),n>12&&(n-=12),`${String(n).padStart(2,"0")}:${l}${u}`},ue=t=>t?t.split(";").map(a=>a.trim()).filter(Boolean).map(a=>{const[l,n]=a.split(" ");if(!n||!n.includes("-"))return a;const[u,N]=n.split("-");return`${l} ${W(u)}-${W(N)}`}).join("; "):"";function fe({subject:t,index:a,onAssignClick:l,onUnassignClick:n}){const u=!!t.assigned;return e.jsx(q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.05,duration:.3},className:"p-4 rounded-lg border bg-background transition-all hover:border-primary/50",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("p",{className:"font-semibold text-foreground",children:[t.code," - ",t.name]}),e.jsx("div",{className:"flex items-center gap-2 mt-1.5",children:e.jsx(G,{variant:"secondary",children:t.expertise})}),u&&t.assigned&&e.jsxs("div",{className:"mt-2 space-y-1 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(J,{size:14,className:"text-green-500"}),e.jsxs("span",{children:["Assigned to ",e.jsx("strong",{children:t.assigned.faculty})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(K,{size:14}),e.jsx("span",{children:ue(t.assigned.time)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto shrink-0",children:[u&&e.jsxs(k,{variant:"outline",size:"sm",onClick:n,className:"w-full sm:w-auto",children:[e.jsx(Z,{size:16,className:"mr-2"})," Unassign"]}),e.jsxs(k,{size:"sm",onClick:l,className:"w-full sm:w-auto",children:[u?"Re-assign":"Assign",e.jsx(ee,{className:"h-4 w-4 ml-1"})]})]})]})})}const _=t=>{if(!t||!t.includes(":"))return t;const[a,l]=t.split(":");let n=Number(a);const u=n<12?"am":"pm";return n===0&&(n=12),n>12&&(n-=12),`${String(n).padStart(2,"0")}:${l}${u}`},xe=(t,a)=>`${_(t)}-${_(a)}`,Q=t=>{const[a=0,l=0]=t.split(":").map(Number);return a*60+l},A=t=>{const[a="00:00",l="00:00"]=t.split("-");return{s:a,e:l,sm:Q(a),em:Q(l)}},ge=(t,a)=>{const l=A(t),n=A(a);return l.sm<=n.sm&&n.em<=l.em},he=t=>t?t.split(";").map(a=>a.trim()).filter(Boolean).map(a=>{const[l,n]=a.split(" "),[u,N]=(n||"").split("-");return{day:l,start:u,end:N}}).filter(a=>a.day&&a.start&&a.end):[];function pe({isOpen:t,onClose:a,subject:l,faculty:n,subjects:u,onAssign:N}){const[M,$]=g.useState(""),[L,z]=g.useState(""),[E,T]=g.useState([]),[v,r]=g.useState(null),c=g.useMemo(()=>n.filter(s=>s.expertise.includes(l.expertise)),[n,l]),f=g.useMemo(()=>{if(!M.trim())return c;const s=M.toLowerCase();return c.filter(i=>i.name.toLowerCase().includes(s))},[c,M]),d=g.useMemo(()=>n.find(s=>s.name===L)||null,[n,L]),D=s=>u.filter(i=>i.assigned?.faculty===s.name).length,y=(s,i,o,m)=>{const S=u.filter(h=>h.assigned?.faculty===s);for(const h of S){const R=he(h.assigned?.time||"");for(const I of R)if(I.day===i&&o<I.end&&I.start<m)return!0}return!1},p=(s,i)=>d?(d.availability?.[s]||[]).some(m=>ge(m,i)):!1,F=s=>{if(!d||!s)return{perDay:[],assignableDays:[],countAssignable:0};const{s:i,e:o}=A(s),m=E.map(h=>{const R=p(h,s),I=R?y(d.name,h,i,o):!1;return{day:h,allowedByFaculty:R,conflict:I,assignable:R&&!I}}),S=m.filter(h=>h.assignable).map(h=>h.day);return{perDay:m,assignableDays:S,countAssignable:S.length}},j=s=>{if(!d||x)return 0;const i=O[s]||[];let o=0;for(const m of i)if(p(s,m)){const{s:S,e:h}=A(m);y(d.name,s,S,h)||o++}return o},b=d?D(d):0,x=d?b>=d.maxSubjects:!1;g.useEffect(()=>{if(t){const s=c[0]?.name??"";z(s),T([]),r(null),$("")}},[t,c]);const C=()=>{if(!l||!d||!v||x)return;const{s,e:i}=A(v),{assignableDays:o}=F(v);if(o.length===0){H.warning("No assignable days for the selected slot.");return}let m=Math.max(0,d.maxSubjects-b);for(const S of o){if(m<=0)break;N({subjectId:l.id,facultyName:d.name,day:S,startTime:s,endTime:i}),m-=1}a()},w=s=>T(i=>i.includes(s)?i.filter(o=>o!==s):[...i,s]);return e.jsx(se,{open:t,onOpenChange:a,children:e.jsxs(te,{className:"max-w-6xl h-[90vh] flex flex-col",children:[e.jsxs(ae,{children:[e.jsxs(ne,{children:["Assign Subject: ",l.code," - ",l.name]}),e.jsx(ie,{children:"Select an eligible faculty, choose days, then pick a common time slot."})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 flex-grow min-h-0 py-4",children:[e.jsxs("div",{className:"lg:col-span-1 flex flex-col gap-4 border-b lg:border-b-0 lg:border-r pb-6 lg:pb-0 lg:pr-6",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"1. Select an Eligible Faculty"}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:18}),e.jsx(Y,{placeholder:"Search eligible faculty...",value:M,onChange:s=>$(s.target.value),className:"pl-10"})]}),e.jsx("div",{className:"flex-grow overflow-y-auto space-y-2 -mr-6 pr-6",children:f.length>0?f.map(s=>{const i=D(s),o=Math.min(100,Math.round(i/Math.max(1,s.maxSubjects)*100)),m=L===s.name;return e.jsxs("button",{type:"button",onClick:()=>{z(s.name),T([]),r(null)},className:`w-full text-left p-3 rounded-md border transition ${m?"bg-primary/5 border-primary":"hover:border-primary/50"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("p",{className:"font-semibold text-foreground",children:s.name}),e.jsxs(G,{variant:m?"default":"secondary",children:[i,"/",s.maxSubjects]})]}),e.jsx(oe,{value:o,className:"h-1.5 mt-2"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:s.expertise.map(S=>e.jsx(G,{variant:"outline",className:"text-xs",children:S},S))})]},s.id)}):e.jsxs("div",{className:"text-center text-sm text-muted-foreground pt-10",children:[e.jsx(B,{size:24,className:"mx-auto mb-2"}),"No faculty match your search."]})})]}),e.jsx("div",{className:"lg:col-span-2 flex flex-col gap-4",children:d?x?e.jsxs("div",{className:"h-full flex items-center justify-center text-destructive bg-destructive/10 rounded-md p-4",children:[e.jsx(B,{size:24,className:"mr-2"}),"This faculty has reached their maximum teaching load."]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground mb-2",children:"2. Choose Days"}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:U.map(s=>{const i=E.includes(s),o=j(s);return e.jsxs(k,{variant:i?"default":"outline",onClick:()=>w(s),className:"flex items-center gap-2",children:[e.jsx("span",{children:s.substring(0,3)}),e.jsx(G,{variant:i?"secondary":o>0?"default":"destructive",children:o})]},s)})})]}),e.jsxs("div",{className:"flex-grow flex flex-col",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-2",children:"3. Pick a Common Time Slot"}),e.jsx("div",{className:"flex-grow overflow-y-auto border rounded-md p-2 bg-muted/30",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from(new Set(U.flatMap(s=>O[s]||[]))).sort((s,i)=>A(s).sm-A(i).sm).map(s=>{const i=F(s),o=v===s,m=E.length===0||i.countAssignable===0;return e.jsxs(k,{variant:o?"default":"outline",disabled:m,onClick:()=>r(s),className:"flex items-center justify-between gap-2",title:m?"Not available or no days selected":`Available for ${i.countAssignable} day(s)`,children:[e.jsx("span",{children:xe(A(s).s,A(s).e)}),e.jsxs(G,{variant:o?"secondary":"default",children:[i.countAssignable,"/",E.length]})]},s)})})})]})]}):e.jsxs("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:[e.jsx(B,{size:24,className:"mr-2"}),"Select a faculty to see options."]})})]}),e.jsxs(re,{className:"border-t pt-4",children:[e.jsx(le,{asChild:!0,children:e.jsx(k,{variant:"outline",children:"Cancel"})}),e.jsxs(k,{onClick:C,disabled:!v||x||F(v||"")?.countAssignable===0,children:["Assign to ",F(v||"")?.countAssignable||0," Day(s)"]})]})]})})}function ye(){const[t]=g.useState(de),[a,l]=g.useState(me),[n,u]=g.useState(""),[N,M]=g.useState("ALL"),[$,L]=g.useState(null),z=(r,c,f,d)=>{const D=a.filter(y=>y.assigned?.faculty===r);for(const y of D){const F=(y.assigned?.time||"").split(";").map(j=>j.trim()).filter(Boolean);for(const j of F){const[b,x]=j.split(" ");if(b!==c)continue;const[C,w]=(x||"").split("-");if(!(!C||!w)&&f<w&&C<d)return{code:y.code,name:y.name,day:b,start:C,end:w}}}return null},E=r=>{const{subjectId:c,facultyName:f,day:d,startTime:D,endTime:y}=r,p=t.find(b=>b.name===f);if(!p)return;if(a.filter(b=>b.assigned?.faculty===p.name).length>=p.maxSubjects){P.fire({icon:"warning",title:"Maximum Load Reached",text:`${p.name} has reached the max load.`});return}const j=z(p.name,d,D,y);if(j){P.fire({icon:"error",title:"Schedule Conflict",html:`Conflicts with <b>${j.code}</b> on ${j.day} from ${j.start} to ${j.end}.`});return}l(b=>b.map(x=>{if(x.id!==c)return x;const C=`${d} ${D}-${y}`;if(!x.assigned||x.assigned.faculty!==p.name)return{...x,assigned:{faculty:p.name,time:C}};const w=x.assigned.time.split(";").map(o=>o.trim()).filter(Boolean),i=w.some(o=>o===C)?w:[...w,C];return{...x,assigned:{faculty:p.name,time:i.join("; ")}}})),P.fire({icon:"success",title:"Assigned!",timer:900,showConfirmButton:!1})},T=r=>{l(c=>c.map(f=>f.id===r?{...f,assigned:null}:f)),H.success("Subject has been unassigned.")},v=g.useMemo(()=>{let r=a;if(N==="UNASSIGNED"&&(r=r.filter(c=>!c.assigned)),N==="ASSIGNED"&&(r=r.filter(c=>!!c.assigned)),n.trim()){const c=n.toLowerCase();r=r.filter(f=>f.code.toLowerCase().includes(c)||f.name.toLowerCase().includes(c)||f.expertise.toLowerCase().includes(c))}return r},[a,N,n]);return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground tracking-tight",children:"Faculty Loading"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Assign subjects to faculty based on expertise and availability."})]}),e.jsxs(q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"bg-card p-4 md:p-6 rounded-lg shadow-sm border border-border",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-center mb-6",children:[e.jsxs("div",{className:"relative w-full md:max-w-md",children:[e.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:20}),e.jsx(Y,{placeholder:"Search subject code, name, or expertise...",value:n,onChange:r=>u(r.target.value),className:"pl-10"})]}),e.jsx("div",{className:"flex items-center gap-2 w-full md:w-auto",children:["ALL","UNASSIGNED","ASSIGNED"].map(r=>e.jsx(k,{variant:N===r?"default":"outline",onClick:()=>M(r),className:"flex-1 md:flex-none",children:r==="ALL"?"All":r==="UNASSIGNED"?"Unassigned":"Assigned"},r))})]}),e.jsxs("div",{className:"space-y-3 max-h-[70vh] overflow-y-auto pr-2 -mr-3",children:[v.map((r,c)=>e.jsx(fe,{subject:r,index:c,onAssignClick:()=>L(r),onUnassignClick:()=>T(r.id)},r.id)),!v.length&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-40 text-center text-muted-foreground rounded-lg border-2 border-dashed",children:[e.jsx(B,{size:32,className:"mb-2"}),e.jsx("p",{children:"No subjects found with the current filters."})]})]})]}),$&&e.jsx(pe,{isOpen:!!$,onClose:()=>L(null),subject:$,faculty:t,subjects:a,onAssign:E,onUnassign:T})]})}function ke(){return e.jsx("main",{children:e.jsx(ye,{})})}export{ke as default};
