import{r as c,t as d,j as s,a as p}from"./index-BvE5JYxp.js";import{C as F}from"./ClassSchedule-DT5l0ovZ.js";import{L as E}from"./loader-circle-Cja-lxfs.js";import"./label-CMIDtJvt.js";import"./select-X-hGHQsw.js";import"./Combination-Buz4Pr0H.js";import"./check-BE3ZFJig.js";import"./dialog-D4SuVaWO.js";import"./input-aQA31dzU.js";import"./badge-oR1Fztys.js";import"./card-C7SSzq0A.js";import"./funnel-D7xURlKA.js";import"./download-DlAq4g13.js";import"./plus-Ca3xfPL8.js";import"./chevron-right-DVWl-KaW.js";import"./map-pin-DMSizA8K.js";const y=()=>localStorage.getItem("accessToken"),S=()=>({Authorization:`Bearer ${y()}`}),I=async()=>{if(!y())throw d.error("Authentication required for initial data load."),new Error("Missing Auth Token");try{const[l,u,e]=await Promise.all([p.get("/get-subjects",{headers:S()}),p.get("/rooms",{headers:S()}),p.get("/get-faculty-loading",{headers:S()})]),i=l.data.subject.map(a=>({id:a.id,subject_code:a.subject_code,des_title:a.des_title,code:a.subject_code,name:a.des_title,yearLevel:parseInt(a.semester.year_level)||0,semester_id:a.semester_id,total_units:a.total_units,lec_units:a.lec_units,lab_units:a.lab_units})),g=localStorage.getItem("saved_class_sections"),m=g?JSON.parse(g):[];return{subjects:i,rooms:u.data.rooms||[],facultyLoading:e.data.success?e.data.data:[],savedSections:m}}catch(l){throw console.error("Error fetching initial data:",l),new Error("Failed to load global scheduling data.")}},v=async(t=null,l=null)=>{const u=y();if(!u)return{success:!1,data:[],message:"Authentication required."};const e={};t&&(e.year=t),l&&(e.section=l);try{const i=await p.post("/filter-schedule",e,{headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"}});return i.data.success?{success:!0,data:i.data.data||[],message:i.data.message}:{success:!1,data:[],message:i.data.message||"Failed to fetch schedules."}}catch(i){return console.error("Fetch Schedules Error:",i),{success:!1,data:[],message:i.response?.data?.message||"An unexpected error occurred."}}},R=async t=>{if(!y())throw new Error("Authentication required to save schedule.");const u={subject_id:t.subjectId,room_id:t.roomId,day:t.day,start_time:t.startTime,end_time:t.endTime,section:t.section,year_level:t.yearLevel,type:t.type};try{const e=await p.post("/create-schedule",u,{headers:S()});return e.data.success?(d.success(e.data.message||"Schedule created successfully."),{success:!0}):(d.error(e.data.message||"Failed to save schedule."),{success:!1})}catch(e){throw e.response&&e.response.data?d.error(e.response.data.message||"Server error occurred."):d.error("An unexpected network error occurred while saving the schedule."),new Error("Save operation failed.")}};function X(){const[t,l]=c.useState([]),[u,e]=c.useState([]),[i,g]=c.useState([]),[m,a]=c.useState([]),[b,w]=c.useState(!0),[A,x]=c.useState([]),[L,T]=c.useState(!0);c.useEffect(()=>{(async()=>{w(!0);try{const{subjects:n,rooms:o,facultyLoading:h,savedSections:j}=await I();l(n),e(o),g(h),a(j);const f=await v();f.success&&x(f.data)}catch(n){console.error("Failed to load initial scheduling data:",n),d.error(n.message||"Failed to load initial data. Please log in or check console.")}finally{w(!1)}})()},[]);const _=c.useCallback(async(r,n)=>{try{const o=await v(r,n);o.success?x(o.data):d.error(o.message||"Failed to refresh schedule data.")}catch(o){d.error(o.message||"Failed to refresh schedule data.")}},[]),k=c.useCallback(async(r,n)=>{const o=await v(r,n);return o.success&&x(o.data),o},[]),D=c.useCallback(async r=>{try{if((await R(r)).success){if(!m.some(h=>h.yearLevel===r.yearLevel&&h.section===r.section)){const h=[...m,{yearLevel:r.yearLevel,section:r.section}];h.sort((j,f)=>j.section.localeCompare(f.section)),a(h),localStorage.setItem("saved_class_sections",JSON.stringify(h))}return await _(r.yearLevel,r.section),!0}return!1}catch(n){return console.error("Error during Add Schedule:",n),!1}},[_,m]),N=c.useCallback(async r=>(d.error("Permission Denied: You do not have rights to add new schedules."),!1),[]),C=L?D:N;return b?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 tracking-tight",children:"Classroom Schedule"}),s.jsx("p",{className:"text-gray-600 mt-1",children:"Manage, create, and view classroom assignments across all departments."})]}),s.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-lg border border-gray-200 bg-white shadow-sm w-full justify-start",children:[s.jsx("div",{className:"flex items-center justify-center w-10 h-10 bg-white rounded-full border border-gray-100",children:s.jsx(E,{className:"w-5 h-5 text-gray-500 animate-spin"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-800",children:"Loading schedule dataâ€¦"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Fetching rooms, subjects, and faculty loading."})]})]})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 tracking-tight",children:"Classroom Schedule"}),s.jsx("p",{className:"text-gray-600 mt-1",children:"Manage, create, and view classroom assignments across all departments."})]}),s.jsx(F,{scheduleData:A,subjectsData:t,roomsData:u,facultyLoadingData:i,savedSections:m,isInitialLoading:b,onAddSchedule:C,onFilterApply:k})]})}export{X as default};
