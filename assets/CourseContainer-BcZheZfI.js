import{c as ye,j as e,m as he,B as y,b as we,f as ts,r as t,t as w,a as H,T as rs,k as pe,l as fe,n as ge,o as Le,p as as,h as ns,P as Ce,q as os,i as be,u as ls,A as cs}from"./index-COsUb6Dh.js";import{I as C}from"./input-DYCrKkMz.js";import{S as Q,a as Z,b as ee,c as se,d as te,u as is}from"./select-D1JkDa8P.js";import{S as ds}from"./sweetalert2.esm.all-ePrzfkxH.js";import{S as le}from"./square-pen-CKcbIwt-.js";import{T as re,P as xe}from"./trash-2-Coluj9OG.js";import{B as us}from"./book-copy-B9KxebGJ.js";import{S as U,C as ve}from"./skeleton-DeYnH9ba.js";import{D as V,a as K,b as J,c as W,d as Te,e as X,f as ae}from"./dialog-BBWjQA8x.js";import{T as ke,a as Ae,b as $,c as P,d as Ee,e as b,f as Pe}from"./table-VmcbDdZJ.js";import{B as ms}from"./badge-CICJiEPm.js";import{L as ue}from"./layers-S4qQ6Knq.js";import{L as E}from"./label-Db497AKk.js";import{S as hs}from"./search-h5JrbsIm.js";import"./Combination-B7uiuKqB.js";import"./check-Db5-nUdm.js";import"./chevron-up-BQWOaaPa.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],js=ye("archive",xs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]],fs=ye("sliders-horizontal",ps),Se=["from-purple-600 to-indigo-600","from-blue-500 to-teal-400","from-pink-500 to-rose-500","from-orange-500 to-amber-500","from-green-500 to-lime-500","from-cyan-500 to-sky-500"],gs={hidden:{opacity:0,y:20},visible:n=>({opacity:1,y:0,transition:{delay:n*.05}})};function bs({program:n,index:p,onEdit:c,onDelete:o,onManage:s}){const S=Object.values(n.semesters||{}).flatMap(u=>u.subjects).length,h=Object.values(n.semesters||{}).flatMap(u=>u.subjects).reduce((u,i)=>u+i.unitsTotal,0);return e.jsxs(he.div,{variants:gs,custom:p,initial:"hidden",animate:"visible",exit:"hidden",className:"bg-card rounded-xl border border-border shadow-sm overflow-hidden group flex flex-col transition-all duration-300 hover:shadow-md hover:-translate-y-1",children:[e.jsxs("div",{className:`p-5 bg-gradient-to-br text-white relative ${Se[p%Se.length]}`,children:[e.jsx("h2",{className:"text-xl font-bold pr-16",children:n.abbreviation}),e.jsx("p",{className:"opacity-80 truncate text-sm pr-16",children:n.name}),e.jsxs("div",{className:"absolute top-2 right-2 hidden md:flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(y,{size:"icon",variant:"ghost",title:"Edit Program",onClick:u=>{u.stopPropagation(),c(n)},className:"h-8 w-8 bg-black/20 hover:bg-black/40",children:e.jsx(le,{size:16})}),e.jsx(y,{size:"icon",variant:"ghost",title:"Archive Program",onClick:u=>{u.stopPropagation(),o(n.id)},className:"h-8 w-8 bg-black/20 hover:bg-destructive/80",children:e.jsx(re,{size:16})})]}),e.jsxs("div",{className:"absolute top-2 right-2 flex md:hidden gap-1",children:[e.jsx(y,{size:"icon",variant:"ghost",title:"Edit Program",onClick:u=>{u.stopPropagation(),c(n)},className:"h-8 w-8 bg-black/20 hover:bg-black/40",children:e.jsx(le,{size:16})}),e.jsx(y,{size:"icon",variant:"ghost",title:"Archive Program",onClick:u=>{u.stopPropagation(),o(n.id)},className:"h-8 w-8 bg-black/20 hover:bg-destructive/80",children:e.jsx(re,{size:16})})]})]}),e.jsxs("div",{className:"p-5 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-4",children:[e.jsx(we,{size:15}),e.jsxs("span",{children:["A.Y. ",n.effectiveYear]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center text-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx(us,{size:15,className:"text-muted-foreground"}),e.jsx("span",{children:"Total Subjects"})]}),e.jsx("span",{className:"px-2.5 py-0.5 bg-muted text-muted-foreground rounded-full font-semibold",children:S})]}),e.jsxs("div",{className:"flex justify-between items-center text-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx(ts,{size:15,className:"text-muted-foreground"}),e.jsx("span",{children:"Total Units"})]}),e.jsx("span",{className:"px-2.5 py-0.5 bg-muted text-muted-foreground rounded-full font-semibold",children:h})]})]})]}),e.jsx(y,{onClick:s,className:"w-full mt-5",variant:"secondary",children:"Manage Curriculum"})]})]})}function vs(){return e.jsxs("div",{className:"bg-card rounded-xl border border-border shadow-sm p-5 space-y-4",children:[e.jsx(U,{className:"h-8 w-1/4"}),e.jsx(U,{className:"h-5 w-3/4"}),e.jsxs("div",{className:"pt-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(U,{className:"h-5 w-1/2"}),e.jsx(U,{className:"h-6 w-10 rounded-full"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(U,{className:"h-5 w-1/2"}),e.jsx(U,{className:"h-6 w-10 rounded-full"})]})]}),e.jsx(U,{className:"h-10 w-full mt-5"})]})}function Ss({isOpen:n,onClose:p,program:c,onAddSemester:o,onEditSemester:s,onDeleteSemester:S,onAddSubject:h,onEditSubject:u,onDeleteSubject:i,onSetSemesterStatus:v,refreshKey:T}){const[l,f]=t.useState(c.semesters||{}),[k,O]=t.useState(!1);return t.useEffect(()=>{f(c.semesters||{})},[c.semesters]),t.useEffect(()=>{if(!n)return;(async()=>{const m=localStorage.getItem("accessToken");if(!m){w.error("Authentication required.");return}O(!0);try{const j=await H.get("/semester-with-subjects",{params:{program_id:c.id},headers:{Authorization:`Bearer ${m}`}}),z=Array.isArray(j.data.semesters)?j.data.semesters:[],I={};z.forEach(N=>{const F=`${N.year_level}, ${N.semester_level}`;I[F]={subjects:(N.subjects||[]).map(r=>({code:r.subject_code,name:r.des_title,unitsTotal:r.total_units,unitsLec:r.lec_units,unitsLab:r.lab_units,hoursTotal:r.total_hrs,hoursLec:r.total_lec_hrs,hoursLab:r.total_lab_hrs,prerequisite:r.pre_requisite||"None"})),isActive:N.isActive??!0,startDate:N.startDate,endDate:N.endDate}}),f(I)}catch(j){w.error("Failed to load fresh semester data."),console.error("Failed fetching semesters:",j)}finally{O(!1)}})()},[n,c.id,T]),t.useEffect(()=>{c?.semesters&&f(L=>({...L,...c.semesters}))},[c.semesters]),e.jsx(V,{open:n,onOpenChange:p,children:e.jsxs(K,{className:"max-w-7xl h-[95vh] flex flex-col p-0",children:[e.jsxs(J,{className:"p-6 pb-4 bg-muted/50 border-b rounded-t-lg",children:[e.jsxs(W,{className:"text-2xl md:text-3xl font-bold text-foreground flex items-center gap-3",children:[c.name,e.jsx("span",{className:"text-sm font-semibold text-primary bg-primary/10 px-3 py-1 rounded-full",children:c.abbreviation})]}),e.jsxs(Te,{children:["Academic Year of Effectivity: ",c.effectiveYear]})]}),e.jsx("div",{className:"flex-grow overflow-y-auto px-6 py-4 space-y-8",children:k?e.jsx("div",{className:"space-y-6",children:[1,2].map(L=>e.jsxs("div",{className:"bg-card border rounded-xl p-4 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-muted/60 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-48 bg-muted/30 rounded"})]},L))}):Object.keys(l).length===0?e.jsxs("div",{className:"text-center py-20 text-muted-foreground flex flex-col items-center justify-center h-full",children:[e.jsx(ue,{size:56,className:"mx-auto mb-4"}),e.jsx("h4",{className:"font-semibold text-xl text-foreground",children:"No Semesters Found"}),e.jsx("p",{className:"max-w-md mx-auto mt-2 text-sm",children:"This curriculum is empty. Start by adding a semester."}),e.jsxs(y,{onClick:o,className:"mt-6",children:[e.jsx(ue,{size:16,className:"mr-2"})," Add Year/Semester"]})]}):Object.entries(l).map(([L,m])=>e.jsxs("div",{className:"group/semester bg-card border rounded-xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-muted/30 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"text-lg font-semibold text-foreground",children:L}),e.jsx(ms,{variant:m.isActive?"default":"destructive",children:m.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover/semester:opacity-100 transition-opacity",children:[e.jsx(y,{variant:"ghost",size:"icon",title:"Set Status & Dates",className:"h-8 w-8 text-muted-foreground",onClick:()=>v(c,L),children:e.jsx(fs,{size:16})}),e.jsx(y,{variant:"ghost",size:"icon",title:"Rename Semester",className:"h-8 w-8 text-muted-foreground",onClick:()=>s(L),children:e.jsx(le,{size:16})}),e.jsx(y,{variant:"ghost",size:"icon",title:"Delete Semester",className:"h-8 w-8 text-destructive",onClick:()=>S(L),children:e.jsx(re,{size:16})})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ke,{children:[e.jsx(Ae,{children:e.jsxs($,{children:[e.jsx(P,{children:"Code"}),e.jsx(P,{className:"w-2/5",children:"Descriptive Title"}),e.jsx(P,{className:"text-center",children:"Total Units"}),e.jsx(P,{className:"text-center",children:"Lec Units"}),e.jsx(P,{className:"text-center",children:"Lab Units"}),e.jsx(P,{className:"text-center",children:"Total Hours"}),e.jsx(P,{children:"Pre-requisite"}),e.jsx(P,{className:"text-right w-[100px]",children:"Actions"})]})}),e.jsx(Ee,{children:m.subjects.length>0?m.subjects.map(j=>e.jsxs($,{children:[e.jsx(b,{className:"font-semibold",children:j.code}),e.jsx(b,{children:j.name}),e.jsx(b,{className:"text-center font-bold text-primary",children:j.unitsTotal}),e.jsx(b,{className:"text-center",children:j.unitsLec}),e.jsx(b,{className:"text-center",children:j.unitsLab}),e.jsx(b,{className:"text-center font-bold text-primary",children:j.hoursTotal}),e.jsx(b,{children:j.prerequisite}),e.jsx(b,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end",children:[e.jsx(y,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground",onClick:()=>u(L,j),children:e.jsx(le,{size:16})}),e.jsx(y,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>i(L,j.code),children:e.jsx(re,{size:16})})]})})]},j.code)):e.jsx($,{children:e.jsx(b,{colSpan:8,className:"text-center h-24 text-muted-foreground",children:"No subjects added for this semester."})})}),e.jsx(Pe,{children:e.jsxs($,{className:"bg-muted/50 font-bold",children:[e.jsx(b,{colSpan:2,className:"text-right",children:"SEMESTER TOTALS"}),e.jsx(b,{className:"text-center text-lg text-primary",children:m.subjects.reduce((j,z)=>j+z.unitsTotal,0)}),e.jsx(b,{className:"text-center text-muted-foreground",children:m.subjects.reduce((j,z)=>j+z.unitsLec,0)}),e.jsx(b,{className:"text-center text-muted-foreground",children:m.subjects.reduce((j,z)=>j+z.unitsLab,0)}),e.jsx(b,{className:"text-center text-lg text-primary",children:m.subjects.reduce((j,z)=>j+z.hoursTotal,0)}),e.jsx(b,{colSpan:2})]})})]})}),e.jsx("div",{className:"p-2 border-t",children:e.jsxs(y,{onClick:()=>h(L),variant:"link",children:[e.jsx(xe,{size:16,className:"mr-1"})," Add Subject"]})})]},L))}),e.jsx(X,{className:"mt-auto p-6 bg-gray-50 border-t rounded-b-lg",children:e.jsxs(y,{onClick:o,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(ue,{size:16})," Add Year/Semester"]})})]})})}const Ns=()=>{const c=new Date().getFullYear()+5,o=[];for(let s=2015;s<=c;s++)o.push(String(s));return o},Ne=Ns();function ys({isOpen:n,onClose:p,onSave:c,initialData:o}){const[s,S]=t.useState(""),[h,u]=t.useState(""),[i,v]=t.useState(""),[T,l]=t.useState(""),[f,k]=t.useState(!1);t.useEffect(()=>{if(o){S(o.name),u(o.abbreviation);const[m="",j=""]=o.effectiveYear.split("-");v(m),l(j)}else{S(""),u("");const m=new Date().getFullYear();v(String(m)),l(String(m+1))}},[o,n]);const O=async m=>{m.preventDefault(),k(!0);const j={program_name:s,abbreviation:h,year_from:i,year_to:T},z=localStorage.getItem("accessToken");if(!z){w.error("Authentication required."),k(!1);return}const I={Authorization:`Bearer ${z}`};try{const N=!!o,F=N?`/edit-program/${o.id}`:"/add-program",x=await H["post"](F,j,{headers:I});w.success(x.data.message||"Program saved successfully!");const d=x.data.program,D={id:d.id,name:d.program_name,abbreviation:d.abbreviation,effectiveYear:`${d.year_from}-${d.year_to}`,semesters:d.semesters||o?.semesters||{},subjects:d.subjects||o?.subjects||{}};c(D),p()}catch(N){if(H.isAxiosError(N)&&N.response){if(N.response.status===401){w.error("Your session has expired. Please log in again.");return}const F=N.response.data,r=F.errors;if(r&&typeof r=="object"&&Object.keys(r).length>0){const x=Object.keys(r)[0],d=r[x]?.[0];w.error(d||"A validation error occurred.")}else F&&typeof F.message=="string"?w.error(F.message):w.error("An unknown API error occurred.")}else w.error("Failed to connect to the server. Please check your connection."),console.error("Non-Axios error:",N)}finally{k(!1)}},L=m=>{v(m),l(String(Number(m)+1))};return e.jsx(V,{open:n,onOpenChange:p,children:e.jsxs(K,{children:[e.jsx(J,{children:e.jsx(W,{children:o?"Edit Program":"Add New Program"})}),e.jsxs("form",{onSubmit:O,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"progName",children:"Program Name"}),e.jsx(C,{id:"progName",value:s,onChange:m=>S(m.target.value),placeholder:"e.g., Bachelor of Science...",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"progAbbr",children:"Abbreviation"}),e.jsx(C,{id:"progAbbr",value:h,onChange:m=>u(m.target.value),placeholder:"e.g., BSIT",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Effectivity A.Y."}),e.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr] items-center gap-2",children:[e.jsxs(Q,{value:i,onValueChange:L,required:!0,children:[e.jsx(Z,{children:e.jsx(ee,{placeholder:"Start Year"})}),e.jsx(se,{children:Ne.map(m=>e.jsx(te,{value:m,children:m},m))})]}),e.jsx("span",{className:"text-muted-foreground",children:"-"}),e.jsxs(Q,{value:T,onValueChange:l,required:!0,children:[e.jsx(Z,{children:e.jsx(ee,{placeholder:"End Year"})}),e.jsx(se,{children:Ne.map(m=>e.jsx(te,{value:m,children:m},m))})]})]})]}),e.jsxs(X,{className:"pt-4",children:[e.jsx(ae,{asChild:!0,children:e.jsx(y,{type:"button",variant:"outline",disabled:f,children:"Cancel"})}),e.jsx(y,{type:"submit",disabled:f,children:f?"Saving...":o?"Save Changes":"Save Program"})]})]})]})})}const me={code:"",name:"",unitsTotal:0,unitsLec:0,unitsLab:0,hoursTotal:0,hoursLec:0,hoursLab:0,prerequisite:""},ws=["1st Year","2nd Year","3rd Year","4th Year"],Ls=["1st Semester","2nd Semester","Summer"];function Cs({isOpen:n,onClose:p,onSave:c,programId:o}){const[s,S]=t.useState(""),[h,u]=t.useState(""),[i,v]=t.useState([me]),[T,l]=t.useState(!1);t.useEffect(()=>{const r=i.map(x=>{const d=(Number(x.unitsLec)||0)+(Number(x.unitsLab)||0),D=(Number(x.hoursLec)||0)+(Number(x.hoursLab)||0);return{...x,unitsTotal:d,hoursTotal:D}});JSON.stringify(r)!==JSON.stringify(i)&&v(r)},[i]);const{totalUnits:f,totalLecUnits:k,totalLabUnits:O,totalHours:L,totalLecHours:m,totalLabHours:j}=t.useMemo(()=>i.reduce((r,x)=>(r.totalUnits+=Number(x.unitsTotal)||0,r.totalLecUnits+=Number(x.unitsLec)||0,r.totalLabUnits+=Number(x.unitsLab)||0,r.totalHours+=Number(x.hoursTotal)||0,r.totalLecHours+=Number(x.hoursLec)||0,r.totalLabHours+=Number(x.hoursLab)||0,r),{totalUnits:0,totalLecUnits:0,totalLabUnits:0,totalHours:0,totalLecHours:0,totalLabHours:0}),[i]),z=()=>v(r=>[...r,me]),I=r=>v(x=>x.filter((d,D)=>D!==r)),N=(r,x,d)=>{v(D=>D.map((R,G)=>{if(G===r){const q=["unitsLec","unitsLab","hoursLec","hoursLab"].includes(x);return{...R,[x]:q?d===""?"":Number(d):d}}return R}))},F=async r=>{if(r.preventDefault(),!s||!h){w.error("Please select a year level and semester.");return}if(i.some(d=>!d.code||!d.name)){w.error("Please fill out all subject codes and titles.");return}l(!0);try{const d=localStorage.getItem("accessToken");if(!d){w.error("Authentication required. Please log in again.");return}const D=i.map(q=>({subject_code:q.code,des_title:q.name,total_units:q.unitsTotal,lec_units:q.unitsLec,lab_units:q.unitsLab,total_hrs:q.hoursTotal,total_lec_hrs:q.hoursLec,total_lab_hrs:q.hoursLab,pre_requisite:q.prerequisite||null})),R={program_id:o,year_level:s,semester_level:h,subjects:D};if((await H.post("/semester-with-subjects",R,{headers:{Authorization:`Bearer ${d}`}})).status===201&&(w.success("Semester and subjects added successfully!"),p(),c)){const q=`${s}, ${h}`;c(q,i,!0)}}catch(d){d.response?.status===401?w.error("Session expired. Please log in again."):d.response?.data?.error?w.error(d.response.data.error):w.error("Failed to save semester and subjects. Please try again."),console.error("Error saving semester:",d)}finally{l(!1)}};return t.useEffect(()=>{n&&(S(""),u(""),v([me]))},[n]),e.jsx(V,{open:n,onOpenChange:p,children:e.jsx(rs,{children:e.jsxs(K,{className:"max-w-7xl h-[95vh] flex flex-col",children:[e.jsxs(J,{children:[e.jsx(W,{children:"Add New Semester and Subjects"}),e.jsx(Te,{children:"Add subjects in bulk. Totals are calculated automatically."})]}),e.jsxs("form",{onSubmit:F,className:"flex-grow flex flex-col min-h-0 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"yearLevel",className:"text-base",children:"Year Level"}),e.jsxs(Q,{value:s,onValueChange:S,required:!0,children:[e.jsx(Z,{id:"yearLevel",children:e.jsx(ee,{placeholder:"Select a year level"})}),e.jsx(se,{children:ws.map(r=>e.jsx(te,{value:r,children:r},r))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"semester",className:"text-base",children:"Semester"}),e.jsxs(Q,{value:h,onValueChange:u,required:!0,children:[e.jsx(Z,{id:"semester",children:e.jsx(ee,{placeholder:"Select a semester"})}),e.jsx(se,{children:Ls.map(r=>e.jsx(te,{value:r,children:r},r))})]})]})]}),e.jsx("div",{className:"flex-grow overflow-auto border rounded-lg",children:e.jsxs(ke,{className:"min-w-[1200px]",children:[e.jsxs(Ae,{className:"bg-muted/50 sticky top-0 z-10",children:[e.jsxs($,{children:[e.jsx(P,{rowSpan:2,className:"align-middle text-center border-r",children:"Course Code"}),e.jsx(P,{rowSpan:2,className:"align-middle text-center border-r w-[350px]",children:"Descriptive Title"}),e.jsx(P,{colSpan:3,className:"text-center border-r",children:"Units"}),e.jsx(P,{colSpan:3,className:"text-center border-r",children:"Hours per week"}),e.jsx(P,{rowSpan:2,className:"align-middle text-center border-r",children:"Pre-requisite"}),e.jsx(P,{rowSpan:2,className:"align-middle w-[50px]"})]}),e.jsxs($,{children:[e.jsx(P,{className:"text-center border-r",children:"Total"}),e.jsx(P,{className:"text-center border-r",children:"Lec"}),e.jsx(P,{className:"text-center border-r",children:"Lab"}),e.jsx(P,{className:"text-center border-r",children:"Total"}),e.jsx(P,{className:"text-center border-r",children:"Lec"}),e.jsx(P,{className:"text-center border-r",children:"Lab"})]})]}),e.jsx(Ee,{children:i.map((r,x)=>e.jsxs($,{children:[e.jsx(b,{className:"w-[150px]",children:e.jsx(C,{className:"uppercase",placeholder:"e.g. CS101",value:r.code,onChange:d=>N(x,"code",d.target.value)})}),e.jsx(b,{children:e.jsx(C,{placeholder:"e.g. Introduction to Programming",value:r.name,onChange:d=>N(x,"name",d.target.value)})}),e.jsx(b,{children:e.jsxs(pe,{children:[e.jsx(fe,{asChild:!0,children:e.jsx(C,{type:"number",value:r.unitsTotal||"",readOnly:!0,className:"text-center font-bold bg-muted/50 cursor-not-allowed"})}),e.jsx(ge,{children:e.jsx("p",{children:"Auto-calculated from Lec and Lab units."})})]})}),e.jsx(b,{children:e.jsx(C,{min:"0",type:"number",value:r.unitsLec||"",onChange:d=>N(x,"unitsLec",d.target.value),className:"text-center"})}),e.jsx(b,{children:e.jsx(C,{min:"0",type:"number",value:r.unitsLab||"",onChange:d=>N(x,"unitsLab",d.target.value),className:"text-center"})}),e.jsx(b,{children:e.jsxs(pe,{children:[e.jsx(fe,{asChild:!0,children:e.jsx(C,{type:"number",value:r.hoursTotal||"",readOnly:!0,className:"text-center font-bold bg-muted/50 cursor-not-allowed"})}),e.jsx(ge,{children:e.jsx("p",{children:"Auto-calculated from Lec and Lab hours."})})]})}),e.jsx(b,{children:e.jsx(C,{min:"0",type:"number",value:r.hoursLec||"",onChange:d=>N(x,"hoursLec",d.target.value),className:"text-center"})}),e.jsx(b,{children:e.jsx(C,{min:"0",type:"number",value:r.hoursLab||"",onChange:d=>N(x,"hoursLab",d.target.value),className:"text-center"})}),e.jsx(b,{className:"w-[150px]",children:e.jsx(C,{placeholder:"None",value:r.prerequisite,onChange:d=>N(x,"prerequisite",d.target.value)})}),e.jsx(b,{className:"text-center",children:e.jsx(y,{type:"button",variant:"ghost",size:"icon",onClick:()=>I(x),className:"text-destructive h-8 w-8 shrink-0",children:e.jsx(re,{size:16})})})]},x))}),e.jsx(Pe,{className:"sticky bottom-0 bg-muted/80 backdrop-blur-sm",children:e.jsxs($,{children:[e.jsx(b,{colSpan:2,className:"text-right font-bold text-lg",children:"SEMESTER TOTALS"}),e.jsx(b,{className:"text-center font-bold text-lg text-primary",children:f}),e.jsx(b,{className:"text-center font-semibold",children:k}),e.jsx(b,{className:"text-center font-semibold",children:O}),e.jsx(b,{className:"text-center font-bold text-lg text-primary",children:L}),e.jsx(b,{className:"text-center font-semibold",children:m}),e.jsx(b,{className:"text-center font-semibold",children:j}),e.jsx(b,{colSpan:2})]})})]})}),e.jsxs(y,{type:"button",variant:"outline",onClick:z,className:"mt-4 w-full sm:w-auto",children:[e.jsx(xe,{size:16,className:"mr-2"})," Add Subject Row"]}),e.jsxs(X,{className:"mt-5 pt-4 border-t",children:[e.jsx(ae,{asChild:!0,children:e.jsx(y,{type:"button",variant:"outline",disabled:T,children:"Cancel"})}),e.jsx(y,{type:"submit",disabled:T,children:T?"Saving...":"Save Curriculum"})]})]})]})})})}function Ts({isOpen:n,onClose:p,onSave:c,initialData:o}){const[s,S]=t.useState("");t.useEffect(()=>{n&&S(o||"")},[n,o]);const h=u=>{u.preventDefault(),c(s)};return e.jsx(V,{open:n,onOpenChange:p,children:e.jsxs(K,{children:[e.jsx(J,{children:e.jsx(W,{children:"Rename Semester"})}),e.jsxs("form",{onSubmit:h,className:"py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"semesterName",children:"New Semester Name"}),e.jsx(C,{id:"semesterName",value:s,onChange:u=>S(u.target.value),required:!0})]}),e.jsxs(X,{className:"pt-6",children:[e.jsx(ae,{asChild:!0,children:e.jsx(y,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(y,{type:"submit",children:"Save Changes"})]})]})]})})}function ks({isOpen:n,onClose:p,onSave:c,initialData:o}){const[s,S]=t.useState({code:"",name:"",unitsTotal:0,unitsLec:0,unitsLab:0,hoursTotal:0,hoursLec:0,hoursLab:0,prerequisite:""}),[h,u]=t.useState(null);t.useEffect(()=>{const l=s.unitsLec+s.unitsLab,f=s.hoursLec+s.hoursLab;S(k=>({...k,unitsTotal:l,hoursTotal:f}))},[s.unitsLec,s.unitsLab,s.hoursLec,s.hoursLab]),t.useEffect(()=>{const l=s.unitsLec+s.unitsLab>s.unitsTotal?"Lec + Lab units cannot exceed Total.":null,f=s.hoursLec+s.hoursLab>s.hoursTotal?"Lec + Lab hours cannot exceed Total.":null;u(l||f?{unitError:l,hourError:f}:null)},[s]),t.useEffect(()=>{n&&S(o||{code:"",name:"",unitsTotal:0,unitsLec:0,unitsLab:0,hoursTotal:0,hoursLec:0,hoursLab:0,prerequisite:""})},[n,o]);const i=(l,f)=>{S(k=>({...k,[l]:f}))},v=(l,f)=>{const k=Number(f);i(l,k>=0?k:0)},T=l=>{if(l.preventDefault(),h){w.error("Please fix the validation errors before saving.");return}c(s,!!o)};return e.jsx(V,{open:n,onOpenChange:p,children:e.jsxs(K,{children:[e.jsx(J,{children:e.jsx(W,{children:o?`Edit Subject: ${o.code}`:"Add New Subject"})}),e.jsxs("form",{onSubmit:T,className:"py-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"code",children:"Course Code"}),e.jsx(C,{id:"code",value:s.code,onChange:l=>i("code",l.target.value),disabled:!!o,required:!0}),!!o&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Course code cannot be edited."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"prerequisite",children:"Pre-requisite"}),e.jsx(C,{id:"prerequisite",value:s.prerequisite,onChange:l=>i("prerequisite",l.target.value),placeholder:"None"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"name",children:"Descriptive Title"}),e.jsx(C,{id:"name",value:s.name,onChange:l=>i("name",l.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(E,{className:"font-semibold",children:"Unit Allocation"}),e.jsxs("div",{className:`grid grid-cols-3 gap-4 p-4 border rounded-lg bg-muted/30 ${h?.unitError?"border-destructive":""}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{htmlFor:"unitsTotal",children:"Total"}),e.jsx(C,{id:"unitsTotal",type:"number",value:s.unitsTotal||"",disabled:!0,readOnly:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{htmlFor:"unitsLec",children:"Lec"}),e.jsx(C,{id:"unitsLec",type:"number",value:s.unitsLec||"",onChange:l=>v("unitsLec",l.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{htmlFor:"unitsLab",children:"Lab"}),e.jsx(C,{id:"unitsLab",type:"number",value:s.unitsLab||"",onChange:l=>v("unitsLab",l.target.value)})]})]}),h?.unitError&&e.jsxs("p",{className:"text-destructive text-sm flex items-center gap-2 mt-2",children:[e.jsx(ve,{size:16}),h.unitError]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(E,{className:"font-semibold",children:"Hour Allocation"}),e.jsxs("div",{className:`grid grid-cols-3 gap-4 p-4 border rounded-lg bg-muted/30 ${h?.hourError?"border-destructive":""}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{htmlFor:"hoursTotal",children:"Total"}),e.jsx(C,{id:"hoursTotal",type:"number",value:s.hoursTotal||"",disabled:!0,readOnly:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{htmlFor:"hoursLec",children:"Lec"}),e.jsx(C,{id:"hoursLec",type:"number",value:s.hoursLec||"",onChange:l=>v("hoursLec",l.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{htmlFor:"hoursLab",children:"Lab"}),e.jsx(C,{id:"hoursLab",type:"number",value:s.hoursLab||"",onChange:l=>v("hoursLab",l.target.value)})]})]}),h?.hourError&&e.jsxs("p",{className:"text-destructive text-sm flex items-center gap-2 mt-2",children:[e.jsx(ve,{size:16}),h.hourError]})]})]}),e.jsxs(X,{className:"mt-8 pt-4 border-t",children:[e.jsx(ae,{asChild:!0,children:e.jsx(y,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(y,{type:"submit",disabled:!!h,children:h?"Fix Errors":o?"Save Changes":"Save Subject"})]})]})]})})}function As(n,p,{checkForDefaultPrevented:c=!0}={}){return function(s){if(n?.(s),c===!1||!s.defaultPrevented)return p?.(s)}}var ce="Switch",[Es,et]=ns(ce),[Ps,_s]=Es(ce),_e=t.forwardRef((n,p)=>{const{__scopeSwitch:c,name:o,checked:s,defaultChecked:S,required:h,disabled:u,value:i="on",onCheckedChange:v,form:T,...l}=n,[f,k]=t.useState(null),O=Le(p,I=>k(I)),L=t.useRef(!1),m=f?T||!!f.closest("form"):!0,[j,z]=as({prop:s,defaultProp:S??!1,onChange:v,caller:ce});return e.jsxs(Ps,{scope:c,checked:j,disabled:u,children:[e.jsx(Ce.button,{type:"button",role:"switch","aria-checked":j,"aria-required":h,"data-state":Fe(j),"data-disabled":u?"":void 0,disabled:u,value:i,...l,ref:O,onClick:As(n.onClick,I=>{z(N=>!N),m&&(L.current=I.isPropagationStopped(),L.current||I.stopPropagation())})}),m&&e.jsx(qe,{control:f,bubbles:!L.current,name:o,value:i,checked:j,required:h,disabled:u,form:T,style:{transform:"translateX(-100%)"}})]})});_e.displayName=ce;var ze="SwitchThumb",Ye=t.forwardRef((n,p)=>{const{__scopeSwitch:c,...o}=n,s=_s(ze,c);return e.jsx(Ce.span,{"data-state":Fe(s.checked),"data-disabled":s.disabled?"":void 0,...o,ref:p})});Ye.displayName=ze;var zs="SwitchBubbleInput",qe=t.forwardRef(({__scopeSwitch:n,control:p,checked:c,bubbles:o=!0,...s},S)=>{const h=t.useRef(null),u=Le(h,S),i=is(c),v=os(p);return t.useEffect(()=>{const T=h.current;if(!T)return;const l=window.HTMLInputElement.prototype,k=Object.getOwnPropertyDescriptor(l,"checked").set;if(i!==c&&k){const O=new Event("click",{bubbles:o});k.call(T,c),T.dispatchEvent(O)}},[i,c,o]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:c,...s,tabIndex:-1,ref:u,style:{...s.style,...v,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});qe.displayName=zs;function Fe(n){return n?"checked":"unchecked"}var Me=_e,Ys=Ye;const Ie=t.forwardRef(({className:n,...p},c)=>e.jsx(Me,{className:be("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",n),...p,ref:c,children:e.jsx(Ys,{className:be("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));Ie.displayName=Me.displayName;function qs({isOpen:n,onClose:p,onSave:c,semesterName:o,initialData:s}){const[S,h]=t.useState(!0),[u,i]=t.useState(""),[v,T]=t.useState("");t.useEffect(()=>{n&&s?(h(s.isActive),i(s.startDate||""),T(s.endDate||"")):(h(!0),i(""),T(""))},[n,s]);const l=f=>{if(f.preventDefault(),!u||!v){w.error("Please provide both a start and an end date.");return}o&&c(o,S,u,v)};return e.jsx(V,{open:n,onOpenChange:p,children:e.jsxs(K,{children:[e.jsx(J,{children:e.jsx(W,{children:"Set Semester Status & Dates"})}),e.jsxs("form",{onSubmit:l,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Semester"}),e.jsx("p",{className:"font-semibold text-lg",children:o})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[e.jsx(Ie,{id:"semester-status",checked:S,onCheckedChange:h}),e.jsx(E,{htmlFor:"semester-status",children:S?"Active":"Inactive"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"startDate",children:"Start Date"}),e.jsx(C,{id:"startDate",type:"date",value:u,onChange:f=>i(f.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"endDate",children:"End Date"}),e.jsx(C,{id:"endDate",type:"date",value:v,onChange:f=>T(f.target.value),required:!0})]})]}),e.jsxs(X,{className:"pt-4",children:[e.jsx(ae,{asChild:!0,children:e.jsx(y,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(y,{type:"submit",children:"Save Settings"})]})]})]})})}function Fs(){const[n,p]=t.useState([]),[c,o]=t.useState(!0),[s,S]=t.useState(""),[h,u]=t.useState("All Years"),[i,v]=t.useState(null),[T,l]=t.useState(!1),[f,k]=t.useState(null),[O,L]=t.useState(!1),[m,j]=t.useState(0),[z,I]=t.useState(!1),[N,F]=t.useState(!1),[r,x]=t.useState(!1),[d,D]=t.useState(null),[R,G]=t.useState(null),[q,Oe]=t.useState(null),ie=ls(),de=t.useCallback(async()=>{o(!0);const a=localStorage.getItem("accessToken");if(!a){w.error("Authentication required."),o(!1),ie("/facultyscheduler/user-login");return}try{const g=await H.get("/program",{headers:{Authorization:`Bearer ${a}`}}),Y=(Array.isArray(g.data.programs)?g.data.programs:Object.values(g.data.programs||{})).map(A=>({id:A.id,name:A.program_name,abbreviation:A.abbreviation,effectiveYear:`${A.year_from}-${A.year_to}`,semesters:A.semesters?Object.entries(A.semesters).reduce((M,[ne,oe])=>(M[ne]={subjects:(oe.subjects||[]).map(B=>({code:B.subject_code,name:B.des_title,unitsTotal:B.total_units,unitsLec:B.lec_units,unitsLab:B.lab_units,hoursTotal:B.total_hrs,hoursLec:B.total_lec_hrs,hoursLab:B.total_lab_hrs,prerequisite:B.pre_requisite||""})),isActive:oe.isActive??!0,startDate:oe.startDate,endDate:oe.endDate},M),{}):{},subjects:A.subjects||{}}));p(Y)}catch(g){H.isAxiosError(g)&&g.response?.status===401?(w.error("Unauthorized. Please log in again."),ie("/facultyscheduler/user-login")):w.error("Failed to fetch programs.")}finally{o(!1)}},[ie]);t.useEffect(()=>{de()},[de]);const De=a=>{p(!!f?_=>_.map(Y=>Y.id===a.id?a:Y):_=>[a,..._]),l(!1)},Re=()=>{k(null),l(!0)},Be=a=>{k(a),l(!0)},$e=a=>{ds.fire({title:"Are you sure?",text:"This program will be moved to the archives.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, archive it!"}).then(async g=>{if(g.isConfirmed){const _=localStorage.getItem("accessToken");if(!_){w.error("Authentication required.");return}try{const Y=await H.post(`/delete-program/${a}`,{},{headers:{Authorization:`Bearer ${_}`}});w.success(Y.data.message||"Program archived successfully."),p(A=>A.filter(M=>M.id!==a))}catch(Y){w.error("Failed to archive program."),console.error("Error deleting program:",Y)}}})},Ue=async(a,g,_)=>{i&&(_&&(await de(),j(Y=>Y+1)),L(!1))},He=(a,g,_)=>{if(!i)return;const Y={...i,semesters:{...i.semesters}},A={...Y.semesters[a]||{subjects:[],isActive:!0}};_?A.subjects=A.subjects.map(M=>M.code===g.code?g:M):A.subjects=[...A.subjects,g],Y.semesters[a]=A,p(n.map(M=>M.id===Y.id?Y:M)),v(Y),F(!1),w.success(`Subject successfully ${_?"updated":"added"}!`)},Ve=(a,g)=>{const _=a.semesters[g];_&&(Oe({name:g,semester:_}),v(a),x(!0))},Ke=(a,g,_,Y)=>{if(i){const A={...i},M={...A.semesters};M[a]&&(M[a]={...M[a],isActive:g,startDate:_,endDate:Y}),A.semesters=M,p(n.map(ne=>ne.id===A.id?A:ne)),v(A),w.success(`Status for "${a}" has been updated.`)}x(!1)},Je=()=>L(!0),We=a=>{D(a),I(!0)},Xe=a=>{console.log("Deleting:",a)},Ge=a=>{console.log("Renaming to:",a)},Qe=a=>{G({semester:a,subject:null}),F(!0)},Ze=(a,g)=>{G({semester:a,subject:g}),F(!0)},es=(a,g)=>{console.log(`Deleting ${g} from ${a}`)},ss=t.useMemo(()=>{const a=new Set(n.map(g=>g.effectiveYear));return["All Years",...Array.from(a).sort((g,_)=>_.localeCompare(g))]},[n]),je=t.useMemo(()=>n.filter(a=>a.name.toLowerCase().includes(s.toLowerCase())||a.abbreviation.toLowerCase().includes(s.toLowerCase())).filter(a=>h==="All Years"||a.effectiveYear===h),[n,s,h]);return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground tracking-tight",children:"Curriculum Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage academic programs, semesters, and their subjects."})]}),e.jsx("div",{className:"bg-card p-4 md:p-6 rounded-lg shadow-sm border border-border mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-center",children:[e.jsxs("div",{className:"relative w-full md:flex-grow",children:[e.jsx(hs,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:20}),e.jsx(C,{type:"text",placeholder:"Search program...",className:"pl-10 w-full",value:s,onChange:a=>S(a.target.value)})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3 w-full md:w-auto",children:[e.jsxs(Q,{value:h,onValueChange:u,children:[e.jsxs(Z,{className:"w-full sm:w-auto md:w-[180px]",children:[e.jsx(we,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsx(ee,{placeholder:"Filter by A.Y."})]}),e.jsx(se,{children:ss.map(a=>e.jsx(te,{value:a,children:a},a))})]}),e.jsxs(y,{onClick:Re,className:"w-full sm:w-auto",children:[e.jsx(xe,{size:16,className:"mr-2"})," Add Program"]})]})]})}),c?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:3}).map((a,g)=>e.jsx(vs,{},g))}):e.jsx(cs,{children:je.length>0?e.jsx(he.div,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:je.map((a,g)=>e.jsx(bs,{program:a,index:g,onEdit:Be,onDelete:$e,onManage:()=>v(a)},a.id))}):e.jsxs(he.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-20 text-muted-foreground",children:[e.jsx(js,{size:56,className:"mx-auto mb-4"}),e.jsx("h4",{className:"font-semibold text-xl text-foreground",children:"No Programs Found"})]})}),e.jsx(ys,{isOpen:T,onClose:()=>l(!1),onSave:De,initialData:f}),i&&e.jsx(Ss,{isOpen:!!i,onClose:()=>v(null),program:i,onAddSemester:Je,onEditSemester:We,onDeleteSemester:Xe,onAddSubject:Qe,onEditSubject:Ze,onDeleteSubject:es,onSetSemesterStatus:Ve,refreshKey:m}),e.jsx(Cs,{isOpen:O,onClose:()=>L(!1),onSave:Ue,programId:i?i.id:0}),e.jsx(Ts,{isOpen:z,onClose:()=>I(!1),onSave:Ge,initialData:d}),R&&e.jsx(ks,{isOpen:N,onClose:()=>F(!1),onSave:(a,g)=>He(R.semester,a,g),initialData:R.subject,semesterName:R.semester,programId:i?.id??0}),e.jsx(qs,{isOpen:r,onClose:()=>x(!1),onSave:Ke,semesterName:q?.name||null,initialData:q?.semester||null})]})}function st(){return e.jsx("main",{children:e.jsx(Fs,{})})}export{st as default};
