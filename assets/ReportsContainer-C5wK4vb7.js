import{c as W,r as d,j as e,R as ne,a as D,B as K,d as te,A as B,m as V,e as Z,f as ce,b as X,U as J,F as de,g as ie}from"./index-CrtpwQ5O.js";import{T as O,a as U,b as I,c as k,d as q,e as S}from"./table-Or1FViC7.js";import{S as M,a as $,b as A,c as F,d as T}from"./select-CgkOVV0K.js";import{L as G}from"./loader-circle-r76oAEyX.js";import{F as me}from"./funnel-Lk9P4bui.js";import{I as ue}from"./input-BO2_hbqI.js";import{S as xe}from"./search-BXFzNI0j.js";import{P as he}from"./progress-CsSe7uGs.js";import{C as pe}from"./clipboard-list-CDlxVoxm.js";import{D as fe}from"./download-BDsqkfz6.js";import"./Combination-BRixIrwY.js";import"./check-C0iTXvdH.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M7 16h8",key:"srdodz"}],["path",{d:"M7 11h12",key:"127s9w"}],["path",{d:"M7 6h3",key:"w9rmul"}]],ye=W("chart-bar",be);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]],ee=W("graduation-cap",ge);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],se=W("grid-3x3",je);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],ve=W("printer",we),re=t=>{try{const[l,i]=t.split(":").map(Number),c=l>=12?"PM":"AM";return`${l%12||12}:${String(i).padStart(2,"0")}${c}`}catch{return t}},Ne=t=>{const l=new Map;t.forEach(c=>{l.has(c.faculty_id)||l.set(c.faculty_id,[]),l.get(c.faculty_id).push(c)});const i=[];return l.forEach(c=>{const n=c[0].faculty,u=n.id,x=n.user.name,y=new Set;c.forEach(a=>y.add(a.subject.des_title));const o=y.size,h=c.map(a=>{let f=0;a.type==="LEC"?f=a.subject.total_lec_hrs??a.subject.lec_units??0:a.type==="LAB"&&(f=a.subject.total_lab_hrs??a.subject.lab_units??0);const b=re(a.start_time),p=re(a.end_time),w=a.subject.des_title;return{loadCode:`${a.subject.subject_code} ${a.type}`,payingHours:f,day:a.day,time:`${b}-${p}`,room:a.room.roomNumber,remarks:w,remarkRowSpan:0}}),m=[];for(let a=0;a<h.length;a++){const f=h[a];if(a===0||h[a].remarks!==h[a-1].remarks){const b=f.remarks;let p=1;for(let w=a+1;w<h.length&&h[w].remarks===b;w++)p++;f.remarkRowSpan=p}m.push(f)}const v=n.t_load_units,s=h.reduce((a,f)=>a+f.payingHours,0),g=Math.max(0,s-v),N=s.toString();i.push({facultyId:u,name:x,loadString:N,calculatedLoad:v,preps:o,overload:g,subjects:m})}),i};function Se(){const[t,l]=d.useState("all"),[i,c]=d.useState([]),[n,u]=d.useState(!0),[x,y]=d.useState(!1),[o,h]=d.useState(""),m="get-facultyLoading-reports",v="accessToken";d.useEffect(()=>{(async()=>{u(!0),y(!1),h("");const f=localStorage.getItem(v);if(!f){u(!1),y(!0),h("Authentication token not found in Local Storage. Please log in.");return}try{const p=(await D.get(m,{headers:{Authorization:`Bearer ${f}`,Accept:"application/json"}})).data;if(p.success&&Array.isArray(p.facultyLoading))c(p.facultyLoading);else throw new Error("Invalid data structure or success: false received")}catch(b){console.error("Error fetching data with axios:",b),y(!0),D.isAxiosError(b)&&b.response?h(`API Error: ${b.response.statusText} (${b.response.status}). Is the token valid?`):h("Network error or failed to connect to the API.")}finally{u(!1)}})()},[]);const s=d.useMemo(()=>Ne(i),[i]),g=d.useMemo(()=>t==="all"?s:s.filter(a=>a.facultyId.toString()===t),[t,s]),N=d.useMemo(()=>{const a=new Map;return s.forEach(f=>a.set(f.facultyId,f.name)),Array.from(a.entries()).map(([f,b])=>({id:f,name:b}))},[s]);return n?e.jsxs("div",{className:"p-10 text-center flex flex-col items-center justify-center text-primary",children:[e.jsx(G,{className:"h-8 w-8 animate-spin mb-3"}),e.jsx("p",{children:"Loading faculty load reports..."})]}):x?e.jsxs("div",{className:"p-10 text-center text-destructive border border-destructive/50 rounded-lg",children:[e.jsx("h3",{className:"font-bold mb-2",children:"Failed to Load Data"}),e.jsx("p",{children:o||"An unknown error occurred while fetching the data."})]}):e.jsxs("div",{className:"bg-card p-4 md:p-6 rounded-lg shadow-sm border border-border",children:[e.jsx("div",{className:"flex justify-end mb-6",children:e.jsxs(M,{value:t,onValueChange:l,children:[e.jsxs($,{className:"w-full md:w-64",children:[e.jsx(me,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsx(A,{placeholder:"Filter by Faculty"})]}),e.jsxs(F,{children:[e.jsx(T,{value:"all",children:"All Faculty"}),N.map(a=>e.jsx(T,{value:a.id.toString(),children:a.name},a.id))]})]})}),e.jsx("div",{className:"rounded-lg border overflow-x-auto",children:e.jsx("div",{children:e.jsxs(O,{className:"w-full",children:[e.jsx(U,{children:e.jsxs(I,{children:[e.jsx(k,{className:"w-[100px] border-r",children:"Name of Faculty"}),e.jsx(k,{className:"w-[100px] border-r",children:"Load"}),e.jsx(k,{className:"text-center w-[100px] border-r",children:"Paying Hours"}),e.jsx(k,{className:"w-[80px]",children:"Day"}),e.jsx(k,{className:"w-[150px]",children:"Time"}),e.jsx(k,{className:"w-[80px] border-r",children:"Room"}),e.jsx(k,{className:"min-w-[250px] border-r",children:"Remarks"}),e.jsx(k,{className:"w-[80px] text-right border-r",children:"Total Load"}),e.jsx(k,{className:"w-[100px] text-center",children:"Preps"})]})}),e.jsxs(q,{children:[g.map((a,f)=>{const b=a.subjects.length,p=a.overload>0,w=f%2===1?"bg-accent/10":"";return b===0?null:e.jsx(ne.Fragment,{children:a.subjects.map((r,j)=>{const _=j===b-1,E=j===0,L=r.remarkRowSpan>0;return e.jsxs(I,{className:`${w} ${_?"border-b-4 border-gray-300":"border-b border-border/50"}`,children:[E&&e.jsx(S,{rowSpan:b,className:"font-bold text-base align-top border-r whitespace-nowrap",children:a.name}),e.jsx(S,{className:"text-sm font-medium border-r uppercase",children:r.loadCode}),e.jsx(S,{className:"text-center font-medium border-r",children:r.payingHours||""}),e.jsx(S,{className:"text-sm",children:r.day}),e.jsx(S,{className:"text-sm",children:r.time}),e.jsx(S,{className:"text-sm border-r",children:r.room}),L&&e.jsx(S,{rowSpan:r.remarkRowSpan,className:"text-sm text-muted-foreground border-r whitespace-normal align-top",children:r.remarks}),E&&e.jsx(S,{rowSpan:b,className:"text-center font-bold text-lg align-top border-r",children:e.jsxs("div",{className:"py-1",children:[e.jsx("span",{className:"text-xl font-bold",children:a.loadString}),p&&e.jsxs("div",{className:"text-destructive font-semibold text-xs mt-1",children:["overload ",a.overload]})]})}),E&&e.jsx(S,{rowSpan:b,className:"text-center align-top",children:a.preps>2?`${a.preps} preps`:""})]},`${a.facultyId}-${j}`)})},a.facultyId)}),g.length===0&&e.jsx(I,{children:e.jsx(S,{colSpan:9,className:"h-24 text-center text-muted-foreground",children:"No faculty load data found for the selected filter."})})]})]})})})]})}const ae=64,Q=60,_e=t=>{const l=Math.floor(t/60),i=t%60,c=l>=12?"PM":"AM",n=l%12||12;return`${String(n)}:${String(i).padStart(2,"0")}${c}`},ke=(t=7,l=21,i=Q)=>{const c=[],n=t*60,u=l*60;for(let x=n;x<u;x+=i)c.push(_e(x));return c},C=ke(7,21,Q),z=[{value:"all",label:"All Days (Unfiltered)",days:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]},{value:"Monday",label:"Monday Schedule",days:["Monday"]},{value:"Tuesday",label:"Tuesday Schedule",days:["Tuesday"]},{value:"Wednesday",label:"Wednesday Schedule",days:["Wednesday"]},{value:"Thursday",label:"Thursday Schedule",days:["Thursday"]},{value:"Friday",label:"Friday Schedule",days:["Friday"]},{value:"Saturday",label:"Saturday Schedule",days:["Saturday"]}],Le=[{value:"all",label:"All Classes"},{value:"LEC",label:"Lecture (LEC)"},{value:"LAB",label:"Laboratory (LAB)"}],H=t=>{try{const[l,i]=t.split(":").map(Number),c=l>=12?"PM":"AM";return`${l%12||12}:${String(i).padStart(2,"0")}${c}`}catch{return t}},R=t=>{const[l,i]=t.split(":").map(Number);return l*60+i},oe=t=>{const l=t.match(/(\d{1,2}):(\d{2})(am|pm)/i);if(!l)return"";let i=parseInt(l[1],10);const c=l[2],n=l[3].toLowerCase();return n==="pm"&&i!==12&&(i+=12),n==="am"&&i===12&&(i=0),`${String(i).padStart(2,"0")}:${c}`},Te=t=>{const l={},i=new Set;return t.forEach(c=>{const n=c.faculty_loading,u=n.room.roomNumber,x=n.subject.subject_code,y=n.faculty.user.name,o=c.section,h=n.type,m=`${H(n.start_time)}-${H(n.end_time)}`,v=n.start_time.substring(0,5),s=n.end_time.substring(0,5),g=R(v),a=R(s)-g,f=Math.ceil(a/Q);if(f<=0)return;const b=f*ae;for(let p=0;p<C.length;p++){const w=C[p],r=oe(w);if(!r)continue;const j=R(r);if(g===j){const _=`${u}_${w}`,E=e.jsxs("div",{style:{height:`${b}px`,marginTop:"0px"},className:"absolute w-full top-0 left-0 text-center flex flex-col justify-center p-1.5 bg-green-100/80 border-2 border-green-300 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 cursor-pointer z-10",children:[e.jsxs("span",{className:"font-extrabold uppercase text-sm text-green-800 leading-tight block",children:[x," ",o]}),e.jsx("span",{className:"text-xs font-medium text-gray-700 mt-1 block",children:y}),e.jsxs("span",{className:"text-xs text-green-700/80 mt-0.5 block",children:[n.day," | ",m," | ",n.room.roomNumber," | ",h]})]});l[_]={content:E,rowSpan:f};for(let L=1;L<f;L++)p+L<C.length&&i.add(`${u}_${C[p+L]}`);break}}}),{gridData:l,coveredKeys:i}},Ee=t=>{const l={},i=new Set;return t.forEach(c=>{const n=c.faculty_loading,u=`${c.year_level}-${c.section}`,x=n.subject.subject_code,y=n.faculty.user.name,o=n.room.roomNumber,h=n.type,m=`${H(n.start_time)}-${H(n.end_time)}`,v=n.start_time.substring(0,5),s=n.end_time.substring(0,5),g=R(v),a=R(s)-g,f=Math.ceil(a/Q);if(f<=0)return;const b=f*ae;for(let p=0;p<C.length;p++){const w=C[p],r=oe(w);if(!r)continue;const j=R(r);if(g===j){const _=`${u}_${w}`,E=e.jsxs("div",{style:{height:`${b}px`,marginTop:"0px"},className:"absolute w-full top-0 left-0 text-center flex flex-col justify-center p-1.5 bg-blue-100/80 border-2 border-blue-300 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 cursor-pointer z-10",children:[e.jsxs("span",{className:"font-extrabold uppercase text-sm text-blue-800 leading-tight block",children:[x," (",h,")"]}),e.jsx("span",{className:"text-xs font-medium text-gray-700 mt-1 block",children:y}),e.jsxs("span",{className:"text-xs text-blue-700/80 mt-0.5 block",children:[n.day," | ",m," | ",o]})]});l[_]={content:E,rowSpan:f};for(let L=1;L<f;L++)p+L<C.length&&i.add(`${u}_${C[p+L]}`);break}}}),{gridData:l,coveredKeys:i}};function Me({rooms:t,filteredScheduleData:l,selectedDayFilter:i,setSelectedDayFilter:c,selectedClassType:n,setSelectedClassType:u,roomSearchQuery:x,setRoomSearchQuery:y}){return e.jsx(B,{mode:"wait",children:e.jsxs(V.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},className:"bg-card p-4 md:p-6 rounded-xl shadow-2xl border-2 border-border overflow-x-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 border-b pb-4 gap-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-700 flex items-center",children:[e.jsx(te,{className:"h-5 w-5 mr-2 text-primary"})," Room Schedule Filters"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 w-full md:w-auto",children:[e.jsxs(M,{value:i,onValueChange:c,children:[e.jsxs($,{className:"w-full sm:w-[180px] border-primary/50 shadow-sm",children:[e.jsx(Z,{className:"h-4 w-4 mr-2 text-primary"}),e.jsx(A,{placeholder:"Select Day"})]}),e.jsx(F,{children:z.map(o=>e.jsx(T,{value:o.value,children:o.label},o.value))})]}),e.jsxs(M,{value:n,onValueChange:o=>u(o),children:[e.jsxs($,{className:"w-full sm:w-[150px] border-primary/50 shadow-sm",children:[e.jsx(se,{className:"h-4 w-4 mr-2 text-primary"}),e.jsx(A,{placeholder:"Class Type"})]}),e.jsx(F,{children:Le.map(o=>e.jsx(T,{value:o.value,children:o.label},o.value))})]}),e.jsxs("div",{className:"relative w-full sm:w-[200px]",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ue,{placeholder:"Search Room...",value:x,onChange:o=>y(o.target.value),className:"pl-10 border-primary/50 shadow-sm"})]})]})]}),e.jsx("div",{children:e.jsxs(O,{className:"w-full table-fixed border-collapse border-primary/20",children:[e.jsx(U,{className:"bg-primary sticky top-0 z-50 shadow-lg",children:e.jsxs(I,{children:[e.jsx(k,{className:"w-[150px] border-r border-b border-primary-foreground/30 text-center font-extrabold text-primary-foreground text-sm uppercase",children:"Time Slot"}),t.map(o=>e.jsx(k,{className:"w-[150px] border-r border-b border-primary-foreground/30 text-center font-extrabold whitespace-nowrap text-primary-foreground text-sm uppercase",children:o},o))]})}),e.jsx(q,{children:C.map(o=>e.jsxs(I,{className:"h-16 border-b border-gray-200 hover:bg-muted/50 transition-colors duration-200",children:[e.jsx(S,{className:"w-[150px] border-r border-r-gray-300 align-middle p-2 font-bold text-xs whitespace-pre-line bg-muted/40 text-gray-700 sticky left-0 z-5",children:o}),t.map(h=>{const m=`${h}_${o}`,v=l.gridData[m];return l.coveredKeys.has(m)&&!v?e.jsx(S,{className:"w-[150px] border-r border-r-gray-300 align-top p-0 text-center text-sm border-dashed border-gray-300 bg-background/50 relative"},m):v?e.jsx(S,{className:"w-[150px] border-r border-r-gray-300 align-top p-0 text-center text-sm relative",children:v.content},m):e.jsx(S,{className:"w-[150px] border-r border-r-gray-300 align-top p-0 text-center text-sm border-dashed border-gray-300 bg-background/50 relative"},m)})]},o))})]})})]},"room-schedule-content")})}function $e({backendData:t}){const[l,i]=d.useState("all"),[c,n]=d.useState("all"),[u,x]=d.useState("all"),y=d.useMemo(()=>{const s=new Set;return t.forEach(g=>g.year_level&&s.add(g.year_level)),["all",...Array.from(s).sort()]},[t]),o=d.useMemo(()=>{const s=new Set;return t.forEach(g=>g.program?.abbreviation&&s.add(g.program.abbreviation)),["all",...Array.from(s).sort()]},[t]),h=d.useMemo(()=>{const s=z.find(N=>N.value===l),g=s?s.days:[];return t.filter(N=>{const a=g.includes(N.faculty_loading.day),f=c==="all"||String(N.year_level)===c,b=u==="all"||N.program?.abbreviation===u;return a&&f&&b})},[l,t,c,u]),m=d.useMemo(()=>{const s=new Set;return h.forEach(g=>{g.year_level&&g.section&&s.add(`${g.year_level}-${g.section}`)}),Array.from(s).sort((g,N)=>g.localeCompare(N))},[h]),v=d.useMemo(()=>Ee(h),[h]);return e.jsx(B,{mode:"wait",children:e.jsxs(V.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.2},className:"bg-card p-4 md:p-6 rounded-xl shadow-2xl border-2 border-border overflow-x-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 border-b pb-4 gap-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-700 flex items-center",children:[e.jsx(ee,{className:"h-5 w-5 mr-2 text-primary"})," Year Level Schedule Filters"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 w-full md:w-auto",children:[e.jsxs(M,{value:l,onValueChange:i,children:[e.jsxs($,{className:"w-full sm:w-[150px] border-primary/50 shadow-sm",children:[e.jsx(Z,{className:"h-4 w-4 mr-2 text-primary"}),e.jsx(A,{placeholder:"Select Day"})]}),e.jsx(F,{children:z.map(s=>e.jsx(T,{value:s.value,children:s.label},s.value))})]}),e.jsxs(M,{value:c,onValueChange:n,children:[e.jsx($,{className:"w-full sm:w-[150px] border-primary/50 shadow-sm",children:e.jsx(A,{placeholder:"Year Level"})}),e.jsxs(F,{children:[e.jsx(T,{value:"all",children:"All Year Levels"}),y.filter(s=>s!=="all").map(s=>e.jsxs(T,{value:String(s),children:["Year ",s]},s))]})]}),e.jsxs(M,{value:u,onValueChange:x,children:[e.jsx($,{className:"w-full sm:w-[150px] border-primary/50 shadow-sm",children:e.jsx(A,{placeholder:"Program"})}),e.jsx(F,{children:o.map(s=>e.jsx(T,{value:s,children:s==="all"?"All Programs":s},s))})]})]})]}),e.jsxs("div",{children:[e.jsxs(O,{className:"w-full table-fixed border-collapse border-primary/20",children:[e.jsx(U,{className:"bg-primary sticky top-0 z-50 shadow-lg",children:e.jsxs(I,{children:[e.jsx(k,{className:"w-[150px] border-r border-b border-primary-foreground/30 text-center font-extrabold text-primary-foreground text-sm uppercase",children:"Time Slot"}),m.map(s=>e.jsx(k,{className:"w-[150px] border-r border-b border-primary-foreground/30 text-center font-extrabold whitespace-nowrap text-primary-foreground text-sm uppercase",children:s.replace("-"," - Section ")},s))]})}),e.jsx(q,{children:C.map(s=>e.jsxs(I,{className:"h-16 border-b border-gray-200 hover:bg-muted/50 transition-colors duration-200",children:[e.jsx(S,{className:"w-[150px] border-r border-r-gray-300 align-middle p-2 font-bold text-xs whitespace-pre-line bg-muted/40 text-gray-700 sticky left-0 z-5",children:s}),m.map(g=>{const N=`${g}_${s}`,a=v.gridData[N];return v.coveredKeys.has(N)&&!a?e.jsx(S,{className:"w-[150px] border-r border-r-gray-300 align-top p-0 text-center text-sm border-dashed border-gray-300 bg-background/50 relative"},N):a?e.jsx(S,{className:"w-[150px] border-r border-r-gray-300 align-top p-0 text-center text-sm relative",children:a.content},N):e.jsx(S,{className:"w-[150px] border-r border-r-gray-300 align-top p-0 text-center text-sm border-dashed border-gray-300 bg-background/50 relative"},N)})]},s))})]}),m.length===0&&e.jsx("div",{className:"p-8 text-center text-muted-foreground bg-muted/50 rounded-lg mt-4",children:"No schedule data found for the selected filters."})]})]},"yearlevel-schedule-content")})}const Ae="get-classSchedule-reports",Fe="accessToken";function Ce(){const[t,l]=d.useState("room"),[i,c]=d.useState([]),[n,u]=d.useState(!0),[x,y]=d.useState(!1),[o,h]=d.useState("all"),[m,v]=d.useState("all"),[s,g]=d.useState("");d.useEffect(()=>{(async()=>{u(!0),y(!1);const p=localStorage.getItem(Fe);if(!p){u(!1);return}try{const w=await D.get(Ae,{headers:{Authorization:`Bearer ${p}`,Accept:"application/json"}});if(w.data.success&&Array.isArray(w.data.classSchedule))c(w.data.classSchedule);else throw new Error("Invalid data structure")}catch(w){console.error("Error fetching class schedule:",w),y(!0)}finally{u(!1)}})()},[]);const N=d.useMemo(()=>{const b=z.find(w=>w.value===o),p=b?b.days:[];return i.filter(w=>{const r=p.includes(w.faculty_loading.day),j=m==="all"||w.faculty_loading.type===m;return r&&j})},[o,i,m]),a=d.useMemo(()=>{const b=new Set;return N.forEach(p=>{const w=p?.faculty_loading?.room?.roomNumber;w&&w.toString().trim()!==""&&b.add(w.toString())}),Array.from(b).filter(p=>p.toLowerCase().includes(s.toLowerCase())).sort((p,w)=>p.localeCompare(w))},[N,s]),f=d.useMemo(()=>{const b=N.filter(p=>a.includes(p.faculty_loading.room.roomNumber));return Te(b)},[N,a]);return n?e.jsxs("div",{className:"p-10 text-center flex flex-col items-center justify-center text-primary",children:[e.jsx(G,{className:"h-8 w-8 animate-spin mb-3"}),e.jsx("p",{children:"Loading class schedules..."})]}):x?e.jsx("div",{className:"p-10 text-center text-destructive border border-destructive/50 rounded-lg",children:"Error loading class schedule data."}):e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"border-b border-border mb-6",children:e.jsxs("div",{className:"inline-flex items-center gap-1 bg-muted p-1 rounded-lg",children:[e.jsxs(K,{variant:t==="room"?"default":"ghost",onClick:()=>l("room"),className:"flex items-center gap-2 px-4 py-2 h-9 text-sm font-semibold transition-all",children:[e.jsx(te,{size:16})," Room Schedule View"]}),e.jsxs(K,{variant:t==="yearLevel"?"default":"ghost",onClick:()=>l("yearLevel"),className:"flex items-center gap-2 px-4 py-2 h-9 text-sm font-semibold transition-all",children:[e.jsx(ee,{size:16})," Year Level View"]})]})}),t==="room"&&e.jsx(Me,{rooms:a,filteredScheduleData:f,selectedDayFilter:o,setSelectedDayFilter:h,selectedClassType:m,setSelectedClassType:v,roomSearchQuery:s,setRoomSearchQuery:g}),t==="yearLevel"&&e.jsx($e,{backendData:i})]})}function Ie(){const[t,l]=d.useState([]),[i,c]=d.useState(!0),[n,u]=d.useState(null),x=20;return d.useEffect(()=>{(async()=>{try{c(!0),u(null);const o=localStorage.getItem("accessToken");if(!o){u("Authentication token not found. Please log in."),c(!1);return}const h={headers:{Authorization:`Bearer ${o}`}},m=await D.get("faculty-load",h);m.data.success?l(m.data.data):u(m.data.message||"Failed to load faculty data.")}catch(o){const h=D.isAxiosError(o)&&o.response?.data?.message?o.response.data.message:"Could not connect to the server or fetch data.";console.error("Error fetching faculty workload data:",o),u(h)}finally{c(!1)}})()},[]),i?e.jsxs("div",{className:"space-y-6 pt-4",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Faculty Workload Management"}),e.jsx("div",{className:"bg-card p-6 rounded-lg shadow-sm border text-center text-muted-foreground",children:e.jsx("div",{className:"animate-pulse",children:"Loading Faculty Workloads..."})})]}):n?e.jsxs("div",{className:"space-y-6 pt-4",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight text-destructive",children:"Data Error"}),e.jsx("div",{className:"bg-card p-6 rounded-lg shadow-sm border border-destructive text-center text-destructive",children:e.jsxs("p",{children:["Error: ",n]})})]}):t.length===0?e.jsxs("div",{className:"space-y-6 pt-4",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Faculty Workload Management"}),e.jsx("div",{className:"bg-card p-6 rounded-lg shadow-sm border text-center text-muted-foreground",children:e.jsx("p",{children:"No active faculty found to display workload data."})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"pb-2",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight flex items-center gap-3",children:[e.jsx(ye,{className:"h-6 w-6 text-primary"}),"Faculty Workload Management"]}),e.jsxs("p",{className:"text-muted-foreground text-sm mt-1 ml-9",children:["Overview of current unit loads vs. a standard cap of ",e.jsxs("span",{className:"font-semibold",children:[x," units/hours."]})]})]}),e.jsx("div",{className:"bg-card p-4 md:p-6 rounded-lg shadow-sm border border-border",children:e.jsx("div",{className:"space-y-6",children:t.map(y=>{const o=Math.min(100,y.load/x*100);let h="bg-primary";return y.load>x?h="bg-red-600":o>90?h="bg-destructive":o>70?h="bg-yellow-500":h="bg-primary",e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1.5 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-semibold text-foreground",children:y.name})]}),e.jsxs("span",{className:`font-mono font-bold ${y.load>x?"text-red-600":"text-primary"}`,children:[y.load,"h",y.load>x&&e.jsx("span",{className:"ml-1",children:"(OVER)"})]})]}),e.jsx(he,{value:o,className:h})]},y.name)})})})]})}const De=(t,l)=>{try{const i=c=>{const[n,u]=c.split(":").map(Number),x=n>=12?"pm":"am";return`${n%12||12}:${String(u).padStart(2,"0")}${x}`};return`${i(t.substring(0,5))}-${i(l.substring(0,5))}`}catch{return`${t}-${l}`}},Pe="get-classSchedule-reports",Re="accessToken",Ke=()=>{const[t,l]=d.useState([]),[i,c]=d.useState(!0),[n,u]=d.useState(!1),[x,y]=d.useState("all"),[o,h]=d.useState("all"),[m,v]=d.useState("all"),[s,g]=d.useState("all");d.useEffect(()=>{(async()=>{c(!0),u(!1);const j=localStorage.getItem(Re);if(!j){c(!1),u(!0);return}try{const _=await D.get(Pe,{headers:{Authorization:`Bearer ${j}`,Accept:"application/json"}});if(_.data.success&&Array.isArray(_.data.classSchedule))l(_.data.classSchedule);else throw new Error("Invalid data structure or API response")}catch(_){console.error("Error fetching study load:",_),u(!0)}finally{c(!1)}})()},[]);const N=d.useMemo(()=>{const r=new Set;return t.forEach(j=>j.program?.abbreviation&&r.add(j.program.abbreviation)),["all",...Array.from(r).sort()]},[t]),a=d.useMemo(()=>{const r=new Set;return t.forEach(j=>j.year_level&&r.add(j.year_level)),["all",...Array.from(r).sort((j,_)=>j-_)]},[t]),f=d.useMemo(()=>{const r=new Set;return t.filter(j=>(x==="all"||j.program?.abbreviation===x)&&(o==="all"||String(j.year_level)===o)).forEach(j=>j.section&&r.add(j.section)),["all",...Array.from(r).sort()]},[t,x,o]),b=d.useMemo(()=>{const r=new Set;return t.forEach(j=>{const _=j.faculty_loading?.faculty?.user?.name;_&&r.add(_)}),["all",...Array.from(r).sort()]},[t]),p=d.useMemo(()=>t.filter(r=>{const j=x==="all"||r.program?.abbreviation===x,_=o==="all"||String(r.year_level)===o,E=m==="all"||r.section===m,L=r.faculty_loading?.faculty?.user?.name||"";return j&&_&&E&&(s==="all"||L===s)}).map(r=>({course:`${r.faculty_loading.subject.subject_code} ${r.section} ${r.faculty_loading.type==="LEC"?"lec":r.faculty_loading.type==="LAB"?"lab":""}`.trim(),day:r.faculty_loading.day,time:De(r.faculty_loading.start_time,r.faculty_loading.end_time),room:r.faculty_loading.room?.roomNumber||"N/A",teacher:r.faculty_loading.faculty.user.name})),[t,x,o,m,s]),w=d.useMemo(()=>{const r=x!=="all"?x:"",j=o!=="all"?`${o} Year`:"",_=m!=="all"?m:"",E=s!=="all"?s:"",L=[j,_,r].filter(le=>le);let P=L.join(" ");return L.length===0&&(P="Entire Study Load"),s!=="all"&&P!=="Entire Study Load"?P+=` (Assigned to: ${E})`:s!=="all"&&(P=`Assigned to: ${E}`),P},[x,o,m,s]);return i?e.jsxs("div",{className:"p-10 text-center flex flex-col items-center justify-center text-primary bg-card rounded-xl shadow-lg border border-border min-h-[300px]",children:[e.jsx(G,{className:"h-8 w-8 animate-spin mb-3"}),e.jsx("p",{children:"Loading student study load data..."})]}):n?e.jsx("div",{className:"p-10 text-center text-destructive border border-destructive/50 rounded-lg bg-card shadow-lg min-h-[300px]",children:"Error loading student study load data. Please check the API and your connection."}):e.jsx(B,{mode:"wait",children:e.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},className:"bg-card p-4 md:p-6 rounded-xl shadow-2xl border-2 border-border overflow-x-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 border-b pb-4 gap-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-700 flex items-center",children:[e.jsx(X,{className:"h-5 w-5 mr-2 text-primary"})," Student Study Load Filters"]}),e.jsxs("div",{className:"flex flex-wrap gap-4 w-full md:w-auto",children:[e.jsxs(M,{value:x,onValueChange:y,children:[e.jsxs($,{className:"w-full sm:w-[150px] border-primary/50 shadow-sm",children:[e.jsx(ee,{className:"h-4 w-4 mr-2 text-primary"}),e.jsx(A,{placeholder:"Program"})]}),e.jsx(F,{children:N.map(r=>e.jsx(T,{value:r,children:r==="all"?"All Programs":r},r))})]}),e.jsxs(M,{value:o,onValueChange:h,children:[e.jsxs($,{className:"w-full sm:w-[150px] border-primary/50 shadow-sm",children:[e.jsx(se,{className:"h-4 w-4 mr-2 text-primary"}),e.jsx(A,{placeholder:"Year Level"})]}),e.jsxs(F,{children:[e.jsx(T,{value:"all",children:"All Year Levels"}),a.filter(r=>r!=="all").map(r=>e.jsxs(T,{value:String(r),children:["Year ",r]},r))]})]}),e.jsxs(M,{value:m,onValueChange:v,children:[e.jsxs($,{className:"w-full sm:w-[150px] border-primary/50 shadow-sm",children:[e.jsx(J,{className:"h-4 w-4 mr-2 text-primary"}),e.jsx(A,{placeholder:"Section"})]}),e.jsx(F,{children:f.map(r=>e.jsx(T,{value:r,children:r==="all"?"All Sections":r},r))})]}),e.jsxs(M,{value:s,onValueChange:g,children:[e.jsxs($,{className:"w-full sm:w-[180px] border-primary/50 shadow-sm",children:[e.jsx(J,{className:"h-4 w-4 mr-2 text-primary"}),e.jsx(A,{placeholder:"Faculty"})]}),e.jsxs(F,{children:[e.jsx(T,{value:"all",children:"All Faculty"}),b.filter(r=>r!=="all").map(r=>e.jsx(T,{value:r,children:r},r))]})]})]})]}),e.jsxs("div",{className:"border border-border rounded-lg shadow-inner overflow-hidden",children:[e.jsx("div",{className:"p-3",children:e.jsx("h4",{className:"text-sm font-bold uppercase tracking-wider",children:w})}),e.jsxs(O,{className:"w-full border-collapse",children:[e.jsx(U,{className:"bg-primary sticky top-0 z-10",children:e.jsxs(I,{className:"border-b-0",children:[e.jsx(k,{className:"w-1/4 border-r border-primary-foreground/30 text-center font-extrabold text-primary-foreground text-sm uppercase",children:"Subject / Course"}),e.jsx(k,{className:"w-[15%] border-r border-primary-foreground/30 text-center font-extrabold text-primary-foreground text-sm uppercase",children:"Day"}),e.jsx(k,{className:"w-1/4 border-r border-primary-foreground/30 text-center font-extrabold text-primary-foreground text-sm uppercase",children:"Time"}),e.jsx(k,{className:"w-[15%] border-r border-primary-foreground/30 text-center font-extrabold text-primary-foreground text-sm uppercase",children:"Room"}),e.jsx(k,{className:"w-1/4 text-center font-extrabold text-primary-foreground text-sm uppercase",children:"Teacher"})]})}),e.jsx(q,{children:p.length>0?p.map((r,j)=>e.jsxs(I,{className:"border-b border-gray-200 hover:bg-muted/50 transition-colors",children:[e.jsx(S,{className:"border-r border-gray-300 align-middle p-2 text-sm font-medium text-gray-800",children:r.course}),e.jsx(S,{className:"border-r border-gray-300 align-middle p-2 text-center text-sm font-semibold text-gray-700",children:r.day}),e.jsx(S,{className:"border-r border-gray-300 align-middle p-2 text-center text-sm text-gray-700 whitespace-nowrap",children:r.time}),e.jsx(S,{className:"border-r border-gray-300 align-middle p-2 text-center text-sm text-gray-700",children:r.room}),e.jsx(S,{className:"align-middle p-2 text-sm text-gray-700",children:r.teacher})]},j)):e.jsx(I,{children:e.jsx(S,{colSpan:5,className:"h-24 text-center text-muted-foreground",children:"No study load data found for the selected filters."})})})]})]})]},"studyload-content")})};function Ve(){const[t,l]=d.useState("loading"),[i,c]=d.useState({totalFaculty:0,assignedSubjects:0,totalUnitsLoaded:0}),[n,u]=d.useState(!0),[x,y]=d.useState(null);d.useEffect(()=>{(async()=>{try{u(!0),y(null);const v=localStorage.getItem("accessToken");if(!v){y("Authentication token not found. Please log in."),u(!1);return}const s={headers:{Authorization:`Bearer ${v}`}},g=await D.get("reports/kpis",s);g.data.success?c(g.data.data):y("Failed to load KPI data from the server.")}catch(v){console.error("Error fetching KPI data:",v),y("Could not connect to the API or fetch KPI data.")}finally{u(!1)}})()},[]);const o=[{label:"Total Faculty",value:i.totalFaculty,icon:J},{label:"Assigned Subjects",value:i.assignedSubjects,icon:X},{label:"Total Units Loaded",value:i.totalUnitsLoaded,icon:pe}],h=()=>n?e.jsxs("div",{className:"flex justify-center items-center h-20 border rounded-xl bg-card",children:[e.jsx(G,{className:"h-6 w-6 animate-spin text-primary mr-2"}),e.jsx("span",{className:"text-muted-foreground",children:"Loading Metrics..."})]}):x?e.jsxs("div",{className:"bg-red-50 border border-red-300 text-red-700 p-4 rounded-xl",children:[e.jsx("p",{className:"font-semibold",children:"KPI Load Error"}),e.jsx("p",{className:"text-sm",children:x})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map((m,v)=>e.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:v*.1},className:"bg-card p-5 rounded-xl border shadow-sm flex items-center gap-5 border-border",children:[e.jsx("div",{className:"p-3 rounded-lg bg-primary/10 text-primary",children:e.jsx(m.icon,{size:24})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:m.value}),e.jsx("div",{className:"text-sm text-muted-foreground",children:m.label})]})]},m.label))});return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"mb-8 flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground tracking-tight",children:"Generate Reports"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"View and export faculty loading, schedules, and workloads."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(K,{variant:"outline",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"})," Print"]}),e.jsxs(K,{children:[e.jsx(fe,{className:"h-4 w-4 mr-2"})," Download All"]})]})]}),e.jsx("div",{className:"mb-8",children:h()}),e.jsx("div",{className:"border-b border-border mb-6",children:e.jsxs("div",{className:"inline-flex items-center gap-1 bg-muted p-1 rounded-lg",children:[e.jsx(Y,{id:"loading",activeTab:t,setActiveTab:l,icon:e.jsx(de,{size:16}),children:"Loading"}),e.jsx(Y,{id:"schedules",activeTab:t,setActiveTab:l,icon:e.jsx(Z,{size:16}),children:"Schedules"}),e.jsx(Y,{id:"workloads",activeTab:t,setActiveTab:l,icon:e.jsx(ie,{size:16}),children:"Workloads"}),e.jsx(Y,{id:"studyload",activeTab:t,setActiveTab:l,icon:e.jsx(X,{size:16}),children:"Study Load"})]})}),e.jsx(B,{mode:"wait",children:e.jsxs(V.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:[t==="loading"&&e.jsx(Se,{}),t==="schedules"&&e.jsx(Ce,{}),t==="workloads"&&e.jsx(Ie,{}),t==="studyload"&&e.jsx(Ke,{})]},t)})]})}const Y=({id:t,activeTab:l,setActiveTab:i,icon:c,children:n})=>e.jsxs(K,{variant:l===t?"default":"ghost",onClick:()=>i(t),className:"flex items-center gap-2 px-4 py-2 h-9 text-sm font-semibold transition-all",children:[c," ",n]});function Ze(){return e.jsx(Ve,{})}export{Ze as default};
