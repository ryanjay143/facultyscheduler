import{r as i,t as u,j as a,a as p}from"./index-CrtpwQ5O.js";import{C as F}from"./ClassSchedule-CpmWsGqH.js";import{L as I}from"./loader-circle-r76oAEyX.js";import"./label-xulj2FTb.js";import"./select-CgkOVV0K.js";import"./Combination-BRixIrwY.js";import"./check-C0iTXvdH.js";import"./dialog-B0UP4DVh.js";import"./input-BO2_hbqI.js";import"./badge-gfnmk8ZU.js";import"./card-BWoUuyah.js";import"./funnel-Lk9P4bui.js";import"./download-BDsqkfz6.js";import"./plus-CITuiMhz.js";import"./chevron-right-BBhfMQ7n.js";import"./map-pin-xLqOqnRs.js";const f=()=>localStorage.getItem("accessToken"),x=()=>({Authorization:`Bearer ${f()}`}),E=async()=>{if(!f())throw u.error("Authentication required for initial data load.",{duration:1e4}),new Error("Missing Auth Token");try{const[d,l,t]=await Promise.all([p.get("/get-subjects",{headers:x()}),p.get("/rooms",{headers:x()}),p.get("/get-faculty-loading",{headers:x()})]),m=d.data.subject.map(o=>({id:o.id,subject_code:o.subject_code,des_title:o.des_title,code:o.subject_code,name:o.des_title,yearLevel:parseInt(o.semester.year_level)||0,semester_id:o.semester_id,total_units:o.total_units,lec_units:o.lec_units,lab_units:o.lab_units})),c=localStorage.getItem("saved_class_sections"),h=c?JSON.parse(c):[];return{subjects:m,rooms:l.data.rooms||[],facultyLoading:t.data.success?t.data.data:[],savedSections:h}}catch(d){throw console.error("Error fetching initial data:",d),new Error("Failed to load global scheduling data.")}},v=async(s=null,d=null,l=null)=>{const t=f();if(!t)return{success:!1,data:[],message:"Authentication required."};if(!l)return s||d?{success:!1,data:[],message:"Program id is required for filtering schedules."}:{success:!0,data:[],message:"No program selected; schedule list is empty."};const m={};s&&(m.year_level=s),d&&(m.section=d),m.program_id=l;try{const c=await p.post("/filter-schedule",m,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});return c.data.success?{success:!0,data:c.data.data||[],message:c.data.message}:{success:!1,data:[],message:c.data.message||"Failed to fetch schedules."}}catch(c){return console.error("Fetch Schedules Error:",c),{success:!1,data:[],message:c.response?.data?.message||"An unexpected error occurred."}}},T=async s=>{if(!f())throw new Error("Authentication required to save schedule.");const l={subject_id:s.subjectId,room_id:s.roomId,day:s.day,start_time:s.startTime,end_time:s.endTime,section:s.section,year_level:s.yearLevel,type:s.type};s.programId&&(l.program_id=s.programId);try{const t=await p.post("/create-schedule",l,{headers:x()});return t.data.success?(u.success(t.data.message||"Schedule created successfully."),{success:!0}):(u.error(t.data.message||"Failed to save schedule.",{duration:1e4}),{success:!1})}catch(t){throw t.response&&t.response.data?u.error(t.response.data.message,{duration:1e4}):u.error("An unexpected network error occurred while saving the schedule.",{duration:1e4}),new Error("Save operation failed.")}};function X(){const[s,d]=i.useState([]),[l,t]=i.useState([]),[m,c]=i.useState([]),[h,o]=i.useState([]),[b,w]=i.useState(!0),[A,y]=i.useState([]),[L,R]=i.useState(!0);i.useEffect(()=>{(async()=>{w(!0);try{const{subjects:n,rooms:g,facultyLoading:e,savedSections:j}=await E();d(n),t(g),c(e),o(j);const S=await v();S.success&&y(S.data)}catch(n){console.error("Failed to load initial scheduling data:",n),u.error(n.message||"Failed to load initial data. Please log in or check console.",{duration:1e4})}finally{w(!1)}})()},[]);const _=i.useCallback(async(r,n,g)=>{try{const e=await v(r,n,g??null);e.success?y(e.data):u.error(e.message||"Failed to refresh schedule data.",{duration:1e4})}catch(e){u.error(e.message||"Failed to refresh schedule data.",{duration:1e4})}},[]),k=i.useCallback(async(r,n,g)=>{const e=await v(r,n,g??null);return e.success&&y(e.data),e},[]),D=i.useCallback(async r=>{try{if((await T(r)).success){if(!h.some(e=>e.yearLevel===r.yearLevel&&e.section===r.section)){const e=[...h,{yearLevel:r.yearLevel,section:r.section}];e.sort((j,S)=>j.section.localeCompare(S.section)),o(e),localStorage.setItem("saved_class_sections",JSON.stringify(e))}return await _(r.yearLevel,r.section,r.programId),!0}return!1}catch(n){return console.error("Error during Add Schedule:",n),!1}},[_,h]),N=i.useCallback(async r=>(u.error("Permission Denied: You do not have rights to add new schedules.",{duration:1e4}),!1),[]),C=L?D:N;return b?a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 tracking-tight",children:"Classroom Schedule"}),a.jsx("p",{className:"text-gray-600 mt-1",children:"Manage, create, and view classroom assignments across all departments."})]}),a.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-lg border border-gray-200 bg-white shadow-sm w-full justify-start",children:[a.jsx("div",{className:"flex items-center justify-center w-10 h-10 bg-white rounded-full border border-gray-100",children:a.jsx(I,{className:"w-5 h-5 text-gray-500 animate-spin"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-800",children:"Loading schedule dataâ€¦"}),a.jsx("p",{className:"text-xs text-gray-500",children:"Fetching rooms, subjects, and faculty loading."})]})]})]}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 tracking-tight",children:"Classroom Schedule"}),a.jsx("p",{className:"text-gray-600 mt-1",children:"Manage, create, and view classroom assignments across all departments."})]}),a.jsx(F,{scheduleData:A,subjectsData:s,roomsData:l,facultyLoadingData:m,savedSections:h,isInitialLoading:b,onAddSchedule:C,onFilterApply:k,authToken:f()})]})}export{X as default};
