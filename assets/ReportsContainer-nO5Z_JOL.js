import{c as W,r as f,j as e,R as se,a as R,C as K,e as te,B as P,U as re,b as ae,m as U,F as oe,f as ne,A as de}from"./index-DXcYVmw3.js";import{T as B,a as G,b as _,c as N,d as Y,e as j}from"./table-BRYmrhPj.js";import{S as q,a as X,b as J,c as Q,d as H}from"./select-DGh_oc5I.js";import{L as Z}from"./loader-circle-B2W9qXRN.js";import{F as ce}from"./funnel-CLA6V5we.js";import{P as le}from"./progress-D7mMZtQ0.js";import{D as ie}from"./download-Cr3Zmp2l.js";import{C as me}from"./clipboard-list-AHSSHWkf.js";import{T as ue}from"./triangle-alert-CxF7UFS-.js";import"./Combination-Cuf1ytF1.js";import"./check-Bby-FiWF.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M7 16h8",key:"srdodz"}],["path",{d:"M7 11h12",key:"127s9w"}],["path",{d:"M7 6h3",key:"w9rmul"}]],xe=W("chart-bar",he);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],be=W("printer",pe),z=t=>{try{const[a,r]=t.split(":").map(Number),s=a>=12?"PM":"AM";return`${a%12||12}:${String(r).padStart(2,"0")}${s}`}catch{return t}},fe=t=>{const a=new Map;t.forEach(s=>{a.has(s.faculty_id)||a.set(s.faculty_id,[]),a.get(s.faculty_id).push(s)});const r=[];return a.forEach(s=>{const i=s[0].faculty,u=i.id,c=i.user.name,o=new Set;s.forEach(n=>o.add(n.subject.des_title));const h=o.size,x=s.map(n=>{const d=n.type==="LEC"?n.subject.lec_units:n.type==="LAB"?n.subject.lab_units:0,y=z(n.start_time),b=z(n.end_time),g=n.subject.des_title;return{loadCode:`${n.subject.subject_code} ${n.type}`,payingHours:d,day:n.day,time:`${y}-${b}`,room:n.room.roomNumber,remarks:g,remarkRowSpan:0}}),v=[];for(let n=0;n<x.length;n++){const d=x[n];if(n===0||x[n].remarks!==x[n-1].remarks){const y=d.remarks;let b=1;for(let g=n+1;g<x.length&&x[g].remarks===y;g++)b++;d.remarkRowSpan=b}v.push(d)}const m=i.t_load_units,p=i.overload_units,l=x.reduce((n,d)=>n+d.payingHours,0).toString();r.push({facultyId:u,name:c,loadString:l,calculatedLoad:m,preps:h,overload:p,subjects:v})}),r};function ye(){const[t,a]=f.useState("all"),[r,s]=f.useState([]),[i,u]=f.useState(!0),[c,o]=f.useState(!1),[h,x]=f.useState(""),v="get-facultyLoading-reports",m="accessToken";f.useEffect(()=>{(async()=>{u(!0),o(!1),x("");const y=localStorage.getItem(m);if(!y){u(!1),o(!0),x("Authentication token not found in Local Storage. Please log in.");return}try{const g=(await R.get(v,{headers:{Authorization:`Bearer ${y}`,Accept:"application/json"}})).data;if(g.success&&Array.isArray(g.facultyLoading))s(g.facultyLoading);else throw new Error("Invalid data structure or success: false received")}catch(b){console.error("Error fetching data with axios:",b),o(!0),R.isAxiosError(b)&&b.response?x(`API Error: ${b.response.statusText} (${b.response.status}). Is the token valid?`):x("Network error or failed to connect to the API.")}finally{u(!1)}})()},[]);const p=f.useMemo(()=>fe(r),[r]),l=f.useMemo(()=>t==="all"?p:p.filter(d=>d.facultyId.toString()===t),[t,p]),n=f.useMemo(()=>{const d=new Set;return p.forEach(y=>d.add({id:y.facultyId,name:y.name})),Array.from(d).map(y=>({id:y.id,name:y.name}))},[p]);return i?e.jsxs("div",{className:"p-10 text-center flex flex-col items-center justify-center text-primary",children:[e.jsx(Z,{className:"h-8 w-8 animate-spin mb-3"}),e.jsx("p",{children:"Loading faculty load reports..."})]}):c?e.jsxs("div",{className:"p-10 text-center text-destructive border border-destructive/50 rounded-lg",children:[e.jsx("h3",{className:"font-bold mb-2",children:"Failed to Load Data"}),e.jsx("p",{children:h||"An unknown error occurred while fetching the data."})]}):e.jsxs("div",{className:"bg-card p-4 md:p-6 rounded-lg shadow-sm border border-border",children:[e.jsx("div",{className:"flex justify-end mb-6",children:e.jsxs(q,{value:t,onValueChange:a,children:[e.jsxs(X,{className:"w-full md:w-64",children:[e.jsx(ce,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsx(J,{placeholder:"Filter by Faculty"})]}),e.jsxs(Q,{children:[e.jsx(H,{value:"all",children:"All Faculty"}),n.map(d=>e.jsx(H,{value:d.id.toString(),children:d.name},d.id))]})]})}),e.jsx("div",{className:"rounded-lg border overflow-x-auto",children:e.jsx("div",{className:"min-w-[1200px]",children:e.jsxs(B,{className:"w-full",children:[e.jsx(G,{className:"sticky top-0 bg-muted/90 z-10 border-b",children:e.jsxs(_,{children:[e.jsx(N,{className:"w-[100px] border-r",children:"Name of Faculty"}),e.jsx(N,{className:"w-[100px] border-r",children:"Load"}),e.jsx(N,{className:"text-center w-[100px] border-r",children:"Paying Hours"}),e.jsx(N,{className:"w-[80px]",children:"Day"}),e.jsx(N,{className:"w-[150px]",children:"Time"}),e.jsx(N,{className:"w-[80px] border-r",children:"Room"}),e.jsx(N,{className:"min-w-[250px] border-r",children:"Remarks"}),e.jsx(N,{className:"w-[80px] text-right border-r",children:"Total Load"}),e.jsx(N,{className:"w-[100px] text-center",children:"Preps"})]})}),e.jsxs(Y,{children:[l.map((d,y)=>{const b=d.subjects.length,g=d.overload>0,E=y%2===1?"bg-accent/10":"";return b===0?null:e.jsx(se.Fragment,{children:d.subjects.map((w,T)=>{const F=T===b-1,A=T===0,k=w.remarkRowSpan>0;return e.jsxs(_,{className:`${E} ${F?"border-b-4 border-gray-300":"border-b border-border/50"}`,children:[A&&e.jsx(j,{rowSpan:b,className:"font-bold text-base align-top border-r whitespace-nowrap",children:d.name}),e.jsx(j,{className:"text-sm font-medium border-r uppercase",children:w.loadCode}),e.jsx(j,{className:"text-center font-medium border-r",children:w.payingHours||""}),e.jsx(j,{className:"text-sm",children:w.day}),e.jsx(j,{className:"text-sm",children:w.time}),e.jsx(j,{className:"text-sm border-r",children:w.room}),k&&e.jsx(j,{rowSpan:w.remarkRowSpan,className:"text-sm text-muted-foreground border-r whitespace-normal align-top",children:w.remarks}),A&&e.jsx(j,{rowSpan:b,className:"text-center font-bold text-lg align-top border-r",children:e.jsxs("div",{className:"py-1",children:[e.jsx("span",{className:"text-xl font-bold",children:d.loadString}),g&&e.jsxs("div",{className:"text-destructive font-semibold text-xs mt-1",children:["overload ",d.overload]})]})}),A&&e.jsx(j,{rowSpan:b,className:"text-center align-top",children:`${d.preps} preps`})]},`${d.facultyId}-${T}`)})},d.facultyId)}),l.length===0&&e.jsx(_,{children:e.jsx(j,{colSpan:9,className:"h-24 text-center text-muted-foreground",children:"No faculty load data found for the selected filter."})})]})]})})})]})}const ge=t=>{const a=Math.floor(t/60),r=t%60,s=a>=12?"pm":"am",i=a%12||12;return`${String(i).padStart(2,"0")}:${String(r).padStart(2,"0")}${s}`},je=(t=7,a=21,r=30)=>{const s=[],i=t*60,u=a*60;for(let c=i;c<=u;c+=r)s.push(ge(c));return s},M=je(7,21,30),V=[{value:"Monday_Thursday",label:"MONDAYS and THURSDAYS",days:["Monday","Thursday"]},{value:"all",label:"All Days (Unfiltered)",days:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]},{value:"Monday",label:"Monday Schedule",days:["Monday"]},{value:"Tuesday",label:"Tuesday Schedule",days:["Tuesday"]},{value:"Wednesday",label:"Wednesday Schedule",days:["Wednesday"]},{value:"Thursday",label:"Thursday Schedule",days:["Thursday"]},{value:"Friday",label:"Friday Schedule",days:["Friday"]},{value:"Saturday",label:"Saturday Schedule",days:["Saturday"]}],O=t=>{try{const[a,r]=t.split(":").map(Number),s=a>=12?"PM":"AM";return`${a%12||12}:${String(r).padStart(2,"0")}${s}`}catch{return t}},we=t=>{const a={},r=new Set,s=u=>{const[c,o]=u.split(":").map(Number);return c*60+o},i=u=>{const c=u.match(/(\d{1,2}):(\d{2})(am|pm)/i);if(!c)return"";let o=parseInt(c[1],10);const h=c[2],x=c[3].toLowerCase();return x==="pm"&&o!==12&&(o+=12),x==="am"&&o===12&&(o=0),`${String(o).padStart(2,"0")}:${h}`};return t.forEach(u=>{const c=u.faculty_loading,o=c.room.roomNumber,h=c.subject.subject_code,x=c.faculty.user.name,v=u.section,m=c.type,p=`${O(c.start_time)}-${O(c.end_time)}`,l=c.start_time.substring(0,5),n=c.end_time.substring(0,5),d=s(l),y=s(n),b=30;for(let g=0;g<M.length;g++){const E=M[g],w=i(E);if(!w)continue;const T=s(w),F=T+b;if(!(d<F&&y>T))continue;let k=1;for(let S=g+1;S<M.length;S++){const D=i(M[S]);if(!D)break;const L=s(D),C=L+b;if(d<C&&y>L)k++;else break}for(let S=0;S<k;S++){const D=`${o}_${M[g+S]}`;if(S===0){const L=D,C=e.jsxs("div",{className:"text-center h-full flex flex-col justify-center p-1.5 bg-green-100/80 border border-green-300 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 cursor-pointer",children:[e.jsxs("span",{className:"font-extrabold uppercase text-sm text-green-800 leading-tight block",children:[h," ",v]}),e.jsx("span",{className:"text-xs font-medium text-gray-700 mt-1 block",children:x}),e.jsxs("span",{className:"text-xs text-green-700/80 mt-0.5 block",children:[c.day," | ",p," | ",m]})]});a[L]={content:C,rowSpan:k}}else r.add(D)}break}}),{gridData:a,coveredKeys:r}},Ne="get-classSchedule-reports",ve="accessToken";function Se(){const[t,a]=f.useState("Monday_Thursday"),[r,s]=f.useState([]),[i,u]=f.useState(!0),[c,o]=f.useState(!1),h=f.useMemo(()=>{const m=new Set;return r.forEach(p=>{const l=p?.faculty_loading?.room?.roomNumber;l&&l.toString().trim()!==""&&m.add(l.toString())}),Array.from(m).sort((p,l)=>p.localeCompare(l))},[r]);f.useEffect(()=>{(async()=>{u(!0),o(!1);const p=localStorage.getItem(ve);if(!p){u(!1);return}try{const l=await R.get(Ne,{headers:{Authorization:`Bearer ${p}`,Accept:"application/json"}});if(l.data.success&&Array.isArray(l.data.classSchedule))s(l.data.classSchedule);else throw new Error("Invalid data structure")}catch(l){console.error("Error fetching class schedule:",l),o(!0)}finally{u(!1)}})()},[]);const x=f.useMemo(()=>{const m=V.find(l=>l.value===t),p=m?m.days:[];return r.filter(l=>p.includes(l.faculty_loading.day))},[t,r]),v=f.useMemo(()=>we(x),[x]);return i?e.jsxs("div",{className:"p-10 text-center flex flex-col items-center justify-center text-primary",children:[e.jsx(Z,{className:"h-8 w-8 animate-spin mb-3"}),e.jsx("p",{children:"Loading class schedules..."})]}):c?e.jsx("div",{className:"p-10 text-center text-destructive border border-destructive/50 rounded-lg",children:"Error loading class schedule data."}):e.jsxs("div",{className:"bg-card p-4 md:p-6 rounded-xl shadow-2xl border-2 border-border overflow-x-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 border-b pb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-3 md:mb-0",children:"Room Schedule View"}),e.jsxs(q,{value:t,onValueChange:a,children:[e.jsxs(X,{className:"w-full md:w-80 border-primary shadow-lg hover:shadow-xl transition-shadow",children:[e.jsx(K,{className:"h-5 w-5 mr-2 text-primary"}),e.jsx(J,{placeholder:"Select Day"})]}),e.jsx(Q,{children:V.map(m=>e.jsx(H,{value:m.value,children:m.label},m.value))})]})]}),e.jsx("div",{className:"min-w-[1800px] overflow-hidden",children:e.jsxs(B,{className:"w-full table-fixed border-collapse border-primary/20",children:[e.jsx(G,{className:"bg-primary sticky top-0 z-10 shadow-lg",children:e.jsxs(_,{children:[e.jsx(N,{className:"w-[150px] border-r border-b border-primary-foreground/30 text-center font-extrabold text-primary-foreground text-sm uppercase",children:"Time Slot"}),h.map(m=>e.jsx(N,{className:"w-[150px] border-r border-b border-primary-foreground/30 text-center font-extrabold whitespace-nowrap text-primary-foreground text-sm uppercase",children:m},m))]})}),e.jsx(Y,{children:M.map(m=>e.jsxs(_,{className:"h-12 border-b border-gray-200 hover:bg-muted/50 transition-colors duration-200",children:[e.jsx(j,{className:"w-[150px] border-r border-r-gray-300 align-middle p-2 font-bold text-xs whitespace-pre-line bg-muted/40 text-gray-700 sticky left-0 z-5",children:m}),h.map(p=>{const l=`${p}_${m}`,n=v.gridData[l];return v.coveredKeys.has(l)?null:n?e.jsx(j,{rowSpan:n.rowSpan,className:"w-[150px] border-r border-r-gray-300 align-middle p-1.5 text-center text-sm",children:e.jsx("div",{className:"h-full",children:n.content})},l):e.jsx(j,{className:"w-[150px] border-r border-r-gray-300 align-top p-1 text-center text-sm border-dashed border-gray-300 bg-background/50"},l)})]},m))})]})})]})}function Te(){const t=f.useMemo(()=>{const r=new Map;return $.forEach(s=>{r.set(s.assignedTo,(r.get(s.assignedTo)||0)+s.units)}),ee.map(s=>({...s,totalUnits:r.get(s.id)||0}))},[]),a=18;return e.jsxs("div",{className:"bg-card p-4 md:p-6 rounded-lg shadow-sm border border-border",children:[e.jsxs("div",{className:"pb-4 border-b mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-foreground flex items-center gap-3",children:[e.jsx(xe,{className:"text-primary"}),"Faculty Workload Overview"]}),e.jsxs("p",{className:"text-muted-foreground text-sm mt-1",children:["Visualize current unit loads vs. a standard cap of ",a," units."]})]}),e.jsx("div",{className:"space-y-6",children:t.map(r=>{const s=Math.min(100,r.totalUnits/a*100);let i="bg-primary";return s>85?i="bg-destructive":s>65&&(i="bg-yellow-500"),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1.5 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-semibold text-foreground",children:r.name})]}),e.jsxs("span",{className:"font-mono font-bold text-primary",children:[r.totalUnits," Units"]})]}),e.jsx(le,{value:s,className:i})]},r.id)})})]})}const ee=[{id:1,name:"Dr. Evelyn Reed",department:"Computer Science"},{id:2,name:"Dr. Samuel Grant",department:"Data Science"},{id:3,name:"Prof. Alisha Chen",department:"Networking"}],$=[{id:1,code:"CS101",name:"Introduction to Programming",units:3,assignedTo:1,schedule:{day:"Monday",time:"09:00-11:00"}},{id:2,code:"CS205",name:"Data Structures",units:3,assignedTo:1,schedule:{day:"Wednesday",time:"10:00-12:00"}},{id:3,code:"DS301",name:"Machine Learning",units:4,assignedTo:2,schedule:{day:"Tuesday",time:"13:00-15:00"}},{id:4,code:"DB402",name:"Advanced Databases",units:4,assignedTo:2,schedule:{day:"Thursday",time:"09:00-11:00"}},{id:5,code:"NT201",name:"Computer Networks",units:3,assignedTo:3,schedule:{day:"Friday",time:"11:00-13:00"}}];function Me(){const[t,a]=f.useState("loading"),r=ee.length,s=$.length,i=$.reduce((o,h)=>o+h.units,0),u=f.useMemo(()=>{const o=new Map;return $.forEach(h=>o.set(h.assignedTo,(o.get(h.assignedTo)||0)+h.units)),Array.from(o.values()).filter(h=>h>6).length},[]),c=[{label:"Total Faculty",value:r,icon:re},{label:"Assigned Subjects",value:s,icon:ae},{label:"Total Units Loaded",value:i,icon:me},{label:"Faculty w/ Heavy Load",value:u,icon:ue,warning:u>0}];return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"mb-8 flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground tracking-tight",children:"Generate Reports"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"View and export faculty loading, schedules, and workloads."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(P,{variant:"outline",children:[e.jsx(be,{className:"h-4 w-4 mr-2"})," Print"]}),e.jsxs(P,{children:[e.jsx(ie,{className:"h-4 w-4 mr-2"})," Download All"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:c.map((o,h)=>e.jsxs(U.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:h*.1},className:`bg-card p-5 rounded-xl border shadow-sm flex items-center gap-5 ${o.warning?"border-destructive/50 bg-destructive/5":"border-border"}`,children:[e.jsx("div",{className:`p-3 rounded-lg ${o.warning?"bg-destructive/10 text-destructive":"bg-primary/10 text-primary"}`,children:e.jsx(o.icon,{size:24})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:o.value}),e.jsx("div",{className:"text-sm text-muted-foreground",children:o.label})]})]},o.label))}),e.jsx("div",{className:"border-b border-border mb-6",children:e.jsxs("div",{className:"inline-flex items-center gap-1 bg-muted p-1 rounded-lg",children:[e.jsx(I,{id:"loading",activeTab:t,setActiveTab:a,icon:e.jsx(oe,{size:16}),children:"Loading"}),e.jsx(I,{id:"schedules",activeTab:t,setActiveTab:a,icon:e.jsx(K,{size:16}),children:"Schedules"}),e.jsx(I,{id:"workloads",activeTab:t,setActiveTab:a,icon:e.jsx(ne,{size:16}),children:"Workloads"})]})}),e.jsx(de,{mode:"wait",children:e.jsxs(U.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:[t==="loading"&&e.jsx(ye,{}),t==="schedules"&&e.jsx(Se,{}),t==="workloads"&&e.jsx(Te,{})]},t)})]})}const I=({id:t,activeTab:a,setActiveTab:r,icon:s,children:i})=>e.jsxs(P,{variant:a===t?"default":"ghost",onClick:()=>r(t),className:"flex items-center gap-2 px-4 py-2 h-9 text-sm font-semibold transition-all",children:[s," ",i]});function He(){return e.jsx(Me,{})}export{He as default};
