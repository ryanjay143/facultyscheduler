import{c as pe,j as e,C as _e,B as C,r as a,T as Te,k as W,l as J,n as U,t as c,a as F}from"./index-BvE5JYxp.js";import{C as Ae,T as ke,a as Fe,b as ue,c as me}from"./tabs-CNFJN4Zq.js";import{T as te,a as ae,b as $,c as N,d as re,e as h}from"./table-BKJQebjG.js";import{I as V}from"./input-aQA31dzU.js";import{S as le,a as oe,b as ie,c as ne,d as Y}from"./select-X-hGHQsw.js";import{B as Me}from"./badge-oR1Fztys.js";import{S as L}from"./skeleton-CSnJGg2W.js";import{D as G,a as K,b as Q,c as X,d as ce,e as Z,f as ee}from"./dialog-D4SuVaWO.js";import{S as Ie}from"./search-D7Yw0DjG.js";import{F as Re}from"./funnel-D7xURlKA.js";import{E as De}from"./eye-tirQKtJ3.js";import{S as Le}from"./square-pen-9TYu25Af.js";import{T as fe}from"./trash-2-uaZOL2UK.js";import{C as $e}from"./chevron-left-BlldQnLc.js";import{C as Pe}from"./chevron-right-DVWl-KaW.js";import{L as O}from"./label-CMIDtJvt.js";import{L as he}from"./loader-circle-Cja-lxfs.js";import{C as ze}from"./ClassSchedule-DT5l0ovZ.js";import{P as Oe}from"./plus-Ca3xfPL8.js";import"./Combination-Buz4Pr0H.js";import"./check-BE3ZFJig.js";import"./card-C7SSzq0A.js";import"./download-DlAq4g13.js";import"./map-pin-DMSizA8K.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M16 19h6",key:"xwg31i"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M19 16v6",key:"tddt3s"}],["path",{d:"M21 12.598V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8.5",key:"1glfrc"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}]],qe=pe("calendar-plus",Be);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=[["path",{d:"M6 10H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-2",key:"4b9dqc"}],["path",{d:"M6 14H4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-2",key:"22nnkd"}],["path",{d:"M6 6h.01",key:"1utrut"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"m13 6-4 6h6l-4 6",key:"14hqih"}]],Ee=pe("server-crash",Ve),xe=d=>{if(!d)return"";const[b,u]=d.split(":");let o=parseInt(b,10);const p=parseInt(u,10),m=o>=12?"PM":"AM";o=o%12||12;const i=p<10?`0${p}`:p;return`${o}:${i} ${m}`},He=({isOpen:d,onClose:b,room:u,scheduleData:o})=>{if(!u)return null;const p=o.filter(m=>m.faculty_loading.room.id===u.id).sort((m,i)=>{const S=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],f=S.indexOf(m.faculty_loading.day),M=S.indexOf(i.faculty_loading.day);return f!==M?f-M:m.faculty_loading.start_time.localeCompare(i.faculty_loading.start_time)});return e.jsx(G,{open:d,onOpenChange:b,children:e.jsxs(K,{className:"sm:max-w-3xl",children:[e.jsxs(Q,{children:[e.jsxs(X,{children:["Schedule for ",u.roomNumber," (",u.type,")"]}),e.jsx(ce,{children:"A list of all classes currently assigned to this room."})]}),e.jsx("div",{className:"max-h-[70vh] overflow-y-auto border rounded-lg",children:p.length===0?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"No classes are currently scheduled for this room."}):e.jsxs(te,{children:[e.jsx(ae,{children:e.jsxs($,{children:[e.jsx(N,{className:"w-[100px]",children:"Day"}),e.jsx(N,{className:"w-[160px]",children:"Time"}),e.jsx(N,{children:"Subject"}),e.jsx(N,{children:"Section"}),e.jsx(N,{children:"Faculty"}),e.jsx(N,{className:"text-center",children:"Type"})]})}),e.jsx(re,{children:p.map(m=>{const i=m.faculty_loading;return e.jsxs($,{children:[e.jsx(h,{className:"font-semibold",children:i.day}),e.jsxs(h,{className:"flex items-center gap-2 text-sm text-slate-700",children:[e.jsx(_e,{className:"w-3 h-3 text-slate-400"}),xe(i.start_time)," - ",xe(i.end_time)]}),e.jsxs(h,{children:[e.jsx("span",{className:"font-medium",children:i.subject.subject_code}),e.jsx("span",{className:"text-xs text-muted-foreground block",children:i.subject.des_title})]}),e.jsx(h,{children:m.section}),e.jsx(h,{children:i.faculty.user?.name??"Unassigned"}),e.jsx(h,{className:"text-center",children:e.jsx("div",{className:"inline-block px-2 py-0.5 text-xs font-bold rounded bg-blue-100 text-blue-800 uppercase",children:i.type})})]},m.id)})})]})}),e.jsx(Z,{children:e.jsx(ee,{asChild:!0,children:e.jsx(C,{type:"button",variant:"outline",children:"Close"})})})]})})},We=(d,b)=>new Set(b.filter(o=>o.faculty_loading.room.id===d).map(o=>o.faculty_loading.subject.id)).size,Je=()=>e.jsxs($,{children:[e.jsx(h,{children:e.jsx(L,{className:"h-5 w-28"})}),e.jsx(h,{children:e.jsx(L,{className:"h-5 w-24"})}),e.jsx(h,{className:"text-center",children:e.jsx(L,{className:"h-5 w-10 mx-auto"})}),e.jsx(h,{children:e.jsx(L,{className:"h-5 w-10"})}),e.jsx(h,{children:e.jsx(L,{className:"h-6 w-20"})}),e.jsx(h,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(L,{className:"h-8 w-8 rounded-md"}),e.jsx(L,{className:"h-8 w-8 rounded-md"}),e.jsx(L,{className:"h-8 w-8 rounded-md"}),e.jsx(L,{className:"h-8 w-8 rounded-md"})]})})]});function Ue({roomsData:d,scheduleData:b,onEdit:u,onDelete:o,onManageAvailability:p,isLoading:m}){const[i,S]=a.useState(""),[f,M]=a.useState({type:"All"}),[x,T]=a.useState(1),[y]=a.useState(10),[_,A]=a.useState(!1),[r,j]=a.useState(null),v=t=>{j(t),A(!0)},k=a.useMemo(()=>d.filter(t=>t.roomNumber.toLowerCase().includes(i.toLowerCase())).filter(t=>f.type==="All"||t.type===f.type),[d,i,f]),I=a.useMemo(()=>{const t=(x-1)*y;return k.slice(t,t+y)},[k,x,y]),R=Math.ceil(k.length/y),P=["All","Lecture","Laboratory"];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-card p-4 md:p-6 rounded-lg shadow-sm border border-border",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-center mb-6",children:[e.jsxs("div",{className:"relative w-full md:max-w-xs",children:[e.jsx(Ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:20}),e.jsx(V,{placeholder:"Search by room...",className:"pl-10 w-full",value:i,onChange:t=>{S(t.target.value),T(1)}})]}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center gap-3 w-full md:w-auto",children:e.jsxs(le,{value:f.type,onValueChange:t=>{M({type:t}),T(1)},children:[e.jsxs(oe,{className:"w-full sm:w-auto md:w-[180px]",children:[e.jsx(Re,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsx(ie,{placeholder:"All Types"})]}),e.jsx(ne,{children:P.map(t=>e.jsx(Y,{value:t,children:t},t))})]})})]}),e.jsx("div",{className:"rounded-lg border border-border overflow-x-auto",children:e.jsxs(te,{className:"min-w-[600px]",children:[e.jsx(ae,{className:"bg-muted/50",children:e.jsxs($,{children:[e.jsx(N,{children:"Room"}),e.jsx(N,{children:"Type"}),e.jsx(N,{className:"text-center",children:"Capacity"}),e.jsx(N,{children:"Total Subjects"}),e.jsx(N,{children:"Status"}),e.jsx(N,{className:"text-right",children:"Actions"})]})}),e.jsx(re,{children:m?Array.from({length:y}).map((t,z)=>e.jsx(Je,{},z)):I.length===0?e.jsx($,{children:e.jsx(h,{colSpan:6,className:"text-center h-48 text-muted-foreground",children:"No rooms found."})}):I.map(t=>{const z=We(t.id,b),B=t.status===0;return e.jsxs($,{className:"hover:bg-muted",children:[e.jsx(h,{children:e.jsx("p",{className:"font-semibold text-foreground",children:t.roomNumber})}),e.jsx(h,{className:"text-muted-foreground",children:t.type}),e.jsx(h,{className:"text-center text-muted-foreground",children:t.capacity??"--"}),e.jsx(h,{className:"text-muted-foreground",children:z}),e.jsx(h,{children:e.jsx(Me,{variant:B?"default":"destructive",children:B?"Active":"Inactive"})}),e.jsx(h,{className:"text-right",children:e.jsx(Te,{delayDuration:100,children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsxs(W,{children:[e.jsx(J,{asChild:!0,children:e.jsx(C,{variant:"ghost",className:"text-purple-500 hover:text-purple-500",size:"icon",onClick:()=>p(t),children:e.jsx(qe,{className:"h-4 w-4"})})}),e.jsx(U,{children:e.jsx("p",{children:"Manage Availability"})})]}),e.jsxs(W,{children:[e.jsx(J,{asChild:!0,children:e.jsx(C,{variant:"ghost",className:"text-blue-500 hover:text-blue-500",size:"icon",onClick:()=>v(t),children:e.jsx(De,{className:"h-4 w-4"})})}),e.jsx(U,{children:e.jsx("p",{children:"View Schedule"})})]}),e.jsxs(W,{children:[e.jsx(J,{asChild:!0,children:e.jsx(C,{variant:"ghost",className:"text-green-500 hover:text-green-500",size:"icon",onClick:()=>u(t),children:e.jsx(Le,{className:"h-4 w-4"})})}),e.jsx(U,{children:e.jsx("p",{children:"Edit Room Details"})})]}),e.jsxs(W,{children:[e.jsx(J,{asChild:!0,children:e.jsx(C,{variant:"ghost",size:"icon",onClick:()=>o(t.id),className:"text-destructive hover:text-destructive/90",children:e.jsx(fe,{className:"h-4 w-4"})})}),e.jsx(U,{children:e.jsx("p",{children:"Delete Room"})})]})]})})})]},t.id)})})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mt-6 text-sm gap-4",children:[e.jsxs("p",{className:"text-muted-foreground",children:["Showing ",e.jsx("strong",{children:I.length>0?(x-1)*y+1:0})," to ",e.jsx("strong",{children:Math.min(x*y,k.length)})," of ",e.jsx("strong",{children:k.length})," entries"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(C,{variant:"outline",size:"sm",onClick:()=>T(t=>Math.max(1,t-1)),disabled:x===1,children:[e.jsx($e,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsxs("span",{className:"font-medium text-foreground px-2",children:["Page ",x," of ",R||1]}),e.jsxs(C,{variant:"outline",size:"sm",onClick:()=>T(t=>Math.min(R,t+1)),disabled:x>=R,children:["Next",e.jsx(Pe,{className:"h-4 w-4 ml-1"})]})]})]})]}),e.jsx(He,{isOpen:_,onClose:()=>A(!1),room:r,scheduleData:b})]})}function Ye({isOpen:d,onClose:b,onSave:u,initialData:o}){const p={roomNumber:"",type:"Lecture",capacity:40},[m,i]=a.useState(p),[S,f]=a.useState(!1);a.useEffect(()=>{d&&i(o?{roomNumber:o.roomNumber,type:o.type,capacity:o.capacity}:p)},[o,d]);const M=async y=>{y.preventDefault(),f(!0);try{await u(m)}finally{f(!1)}},x=y=>{const{name:_,value:A}=y.target;i(r=>({...r,[_]:_==="capacity"?A===""?null:Number(A):A}))},T=y=>{i(_=>({..._,type:y}))};return e.jsx(G,{open:d,onOpenChange:b,children:e.jsxs(K,{className:"sm:max-w-[425px]",children:[e.jsx(Q,{children:e.jsx(X,{className:"text-xl font-bold",children:o?"Edit Room":"Add New Room"})}),e.jsxs("form",{onSubmit:M,className:"py-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"roomNumber",className:"text-right",children:"Room Number / Name"}),e.jsx(V,{id:"roomNumber",name:"roomNumber",value:m.roomNumber,onChange:x,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"type",children:"Type"}),e.jsxs(le,{value:m.type,onValueChange:T,children:[e.jsx(oe,{id:"type",children:e.jsx(ie,{})}),e.jsxs(ne,{children:[e.jsx(Y,{value:"Lecture",children:"Lecture"}),e.jsx(Y,{value:"Laboratory",children:"Laboratory"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(O,{htmlFor:"capacity",children:["Capacity ",e.jsx("span",{className:"text-muted-foreground text-xs",children:"(Optional)"})]}),e.jsx(V,{id:"capacity",name:"capacity",type:"number",min:"1",value:m.capacity??"",onChange:x})]})]}),e.jsxs(Z,{className:"pt-4",children:[e.jsx(ee,{asChild:!0,children:e.jsx(C,{type:"button",variant:"outline",disabled:S,children:"Cancel"})}),e.jsx(C,{type:"submit",disabled:S,children:S?"Saving...":"Save Room"})]})]})]})})}const q=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],je=d=>{if(!d)return"";const[b,u]=d.split(":"),o=parseInt(b,10),p=o>=12?"PM":"AM",m=o%12||12;return`${String(m).padStart(2,"0")}:${u} ${p}`};function Ge({isOpen:d,onClose:b,room:u}){const[o,p]=a.useState([]),[m,i]=a.useState(!0),[S,f]=a.useState(!1),M={day:"Monday",start_time:"07:00",end_time:"12:00"},[x,T]=a.useState(M);a.useEffect(()=>{(async()=>{if(d&&u){i(!0);try{const j=localStorage.getItem("accessToken");if(!j){c.error("Authentication required.");return}const k=((await F.get(`/rooms/${u.id}/availabilities`,{headers:{Authorization:`Bearer ${j}`}})).data.availabilities||[]).sort((I,R)=>q.indexOf(I.day)-q.indexOf(R.day)||I.start_time.localeCompare(R.start_time));p(k)}catch(j){c.error("Failed to fetch availability."),console.error("Fetch availability error:",j)}finally{i(!1)}}})()},[d,u]);const y=(r,j)=>{T(v=>({...v,[r]:j}))},_=async r=>{if(r.preventDefault(),!!u){if(x.start_time>=x.end_time){c.error("End time must be after start time.");return}f(!0);try{const j=localStorage.getItem("accessToken"),v={availabilities:[{...x,start_time:`${x.start_time}:00`,end_time:`${x.end_time}:00`}]},I=(await F.post(`/rooms/${u.id}/availabilities`,v,{headers:{Authorization:`Bearer ${j}`}})).data.availabilities;p(R=>[...R,...I].sort((P,t)=>q.indexOf(P.day)-q.indexOf(t.day)||P.start_time.localeCompare(t.start_time))),T(M),c.success("New availability slot added!")}catch(j){if(j.response?.status===422){const v=j.response.data.errors;v&&v["availabilities.0.day"]?c.error(v["availabilities.0.day"][0]):c.error("Invalid data provided. Please check the time format and day.")}else c.error("Failed to add new slot. Please try again."),console.error("Add slot error:",j)}finally{f(!1)}}},A=async r=>{f(!0);try{const j=localStorage.getItem("accessToken");await F.delete(`/availabilities/${r}`,{headers:{Authorization:`Bearer ${j}`}}),p(v=>v.filter(k=>k.id!==r)),c.success("Availability slot deleted.")}catch{c.error("Failed to delete slot.")}finally{f(!1)}};return e.jsx(G,{open:d,onOpenChange:b,children:e.jsxs(K,{className:"sm:max-w-2xl",children:[e.jsxs(Q,{children:[e.jsxs(X,{children:["Manage Availability for ",u?.roomNumber]}),e.jsx(ce,{children:"View, add, or delete the available time slots for this room."})]}),e.jsxs("div",{className:"py-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Existing Slots"}),e.jsx("div",{className:"border rounded-lg max-h-64 overflow-y-auto",children:m?e.jsxs("div",{className:"flex items-center justify-center h-24 text-muted-foreground",children:[e.jsx(he,{className:"mr-2 h-4 w-4 animate-spin"}),"Fetching data..."]}):o.length>0?e.jsxs(te,{children:[e.jsx(ae,{children:e.jsxs($,{children:[e.jsx(N,{children:"Day"}),e.jsx(N,{children:"Start Time"}),e.jsx(N,{children:"End Time"}),e.jsx(N,{className:"text-right",children:"Action"})]})}),e.jsx(re,{children:o.map(r=>e.jsxs($,{children:[e.jsx(h,{children:r.day}),e.jsx(h,{children:je(r.start_time)}),e.jsx(h,{children:je(r.end_time)}),e.jsx(h,{className:"text-right",children:e.jsx(C,{variant:"ghost",size:"icon",onClick:()=>A(r.id),disabled:S,children:e.jsx(fe,{className:"h-4 w-4 text-destructive"})})})]},r.id))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-24 text-muted-foreground",children:[e.jsx(Ee,{className:"h-6 w-6 mb-2"}),e.jsx("p",{children:"No availability slots found for this room."})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Add New Slot"}),e.jsxs("form",{onSubmit:_,className:"grid grid-cols-1 sm:grid-cols-4 gap-3 items-end p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(O,{htmlFor:"day",children:"Day"}),e.jsxs(le,{value:x.day,onValueChange:r=>y("day",r),children:[e.jsx(oe,{id:"day",children:e.jsx(ie,{})}),e.jsx(ne,{children:q.map(r=>e.jsx(Y,{value:r,children:r},r))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(O,{htmlFor:"start_time",children:"Start Time"}),e.jsx(V,{id:"start_time",type:"time",value:x.start_time,onChange:r=>y("start_time",r.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(O,{htmlFor:"end_time",children:"End Time"}),e.jsx(V,{id:"end_time",type:"time",value:x.end_time,onChange:r=>y("end_time",r.target.value),required:!0})]}),e.jsxs(C,{type:"submit",disabled:S,children:[S?e.jsx(he,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Ae,{className:"mr-2 h-4 w-4"}),"Add Slot"]})]})]})]}),e.jsx(Z,{children:e.jsx(ee,{asChild:!0,children:e.jsx(C,{type:"button",variant:"outline",children:"Close"})})})]})})}function bs(){const[d,b]=a.useState([]),[u,o]=a.useState([]),[p,m]=a.useState([]),[i,S]=a.useState([]),[f,M]=a.useState(()=>{if(typeof window<"u"){const s=localStorage.getItem("saved_class_sections");return s?JSON.parse(s):[]}return[]}),[x,T]=a.useState(!0),[y,_]=a.useState(!1),[A,r]=a.useState(null),[j,v]=a.useState({open:!1,roomId:null}),[k,I]=a.useState(!1),[R,P]=a.useState(null),t=a.useCallback(async()=>{try{const s=localStorage.getItem("accessToken");if(!s)return c.error("Authentication required."),!1;const n=await F.get("/rooms",{headers:{Authorization:`Bearer ${s}`}});return b(n.data.rooms||[]),!0}catch(s){return c.error("Failed to fetch rooms."),console.error("Fetch Rooms Error:",s),!1}},[]),z=a.useCallback(async()=>{try{const s=localStorage.getItem("accessToken");if(!s)return c.error("Authentication required."),!1;const w=((await F.get("/get-subjects",{headers:{Authorization:`Bearer ${s}`}})).data.subject||[]).map(l=>({id:l.id,subject_code:l.subject_code,des_title:l.des_title,code:l.subject_code,name:l.des_title,yearLevel:parseInt(l.semester.year_level)||0,semester_id:l.semester_id,total_units:l.total_units,lec_units:l.lec_units,lab_units:l.lab_units}));return o(w),!0}catch(s){return c.error("Failed to fetch subjects."),console.error("Fetch Subjects Error:",s),!1}},[]),B=a.useCallback(async()=>{try{const s=localStorage.getItem("accessToken");if(!s)return!1;const n=await F.get("/get-faculty-loading",{headers:{Authorization:`Bearer ${s}`}});return n.data.success?(m(n.data.data||[]),!0):!1}catch(s){return console.error("Fetch Faculty Loading Error:",s),!1}},[]),E=a.useCallback(async(s=null,n=null)=>{const g=localStorage.getItem("accessToken");if(!g)return{success:!1,data:[],message:"Authentication required."};const w={};s&&(w.year=s),n&&(w.section=n);try{const l=await F.post("/filter-schedule",w,{headers:{Authorization:`Bearer ${g}`,"Content-Type":"application/json"}});return l.data.success?{success:!0,data:l.data.data||[],message:l.data.message}:{success:!1,data:[],message:l.data.message||"Failed to fetch schedules."}}catch(l){return l.response?.status===401?{success:!1,data:[],message:"Session expired or unauthorized. Please log in again."}:(console.error("Fetch Schedules Error:",l),{success:!1,data:[],message:l.response?.data?.message||"An unexpected error occurred."})}},[]),de=a.useCallback(async(s,n)=>{const g=await E(s,n);return g.success&&S(g.data),g},[E]);a.useEffect(()=>{(async()=>{T(!0);try{const[n,g,w,l]=await Promise.all([t(),z(),B(),E()]);l.success?S(l.data):c.error(l.message)}catch(n){console.error("An error occurred during data fetching:",n)}finally{T(!1)}})()},[t,z,B,E]);const ye=async s=>{const n=localStorage.getItem("accessToken");if(!n){c.error("Authentication required.");return}try{if(A){const g=await F.put(`/rooms/${A.id}`,s,{headers:{Authorization:`Bearer ${n}`}});c.success(g.data.message||"Room updated successfully!")}else{const g=await F.post("/rooms",s,{headers:{Authorization:`Bearer ${n}`}});c.success(g.data.message||"Room created successfully!");const w=g.data.room?.id;if(w){const l=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],D=[{start_time:"07:00:00",end_time:"12:00:00"},{start_time:"13:00:00",end_time:"21:00:00"}],H={availabilities:l.flatMap(se=>D.map(Ce=>({day:se,...Ce})))};await F.post(`/rooms/${w}/availabilities`,H,{headers:{Authorization:`Bearer ${n}`}}),c.success("Default availability has been set.")}}_(!1),r(null),t()}catch(g){if(g.response?.status===422){const w=g.response.data.errors;for(const l in w){c.error(`Validation Error: ${w[l][0]}`);return}}else c.error("An error occurred. Please try again.")}},ge=()=>{r(null),_(!0)},be=s=>{r(s),_(!0)},ve=s=>{v({open:!0,roomId:s})},Ne=s=>{P(s),I(!0)},Se=async()=>{if(j.roomId===null)return;const s=localStorage.getItem("accessToken");if(!s){c.error("Authentication required.");return}try{const n=await F.delete(`/rooms/${j.roomId}`,{headers:{Authorization:`Bearer ${s}`}});c.success(n.data.message||"Room deleted successfully!"),t()}catch{c.error("Failed to delete room.")}finally{v({open:!1,roomId:null})}},we=async s=>{try{const n=localStorage.getItem("accessToken"),g={subject_id:s.subjectId,room_id:s.roomId,day:s.day,start_time:s.startTime,end_time:s.endTime,section:s.section,year_level:s.yearLevel,type:s.type},w=await F.post("/create-schedule",g,{headers:{Authorization:`Bearer ${n}`}});if(w.data.success){if(c.success(w.data.message),!f.some(D=>D.yearLevel===s.yearLevel&&D.section===s.section)){const D=[...f,{yearLevel:s.yearLevel,section:s.section}];D.sort((H,se)=>H.section.localeCompare(se.section)),M(D),localStorage.setItem("saved_class_sections",JSON.stringify(D))}return await de(s.yearLevel,s.section),!0}return!1}catch(n){return n.response&&n.response.data?c.error(n.response.data.message):c.error("Failed to save schedule."),!1}};return e.jsxs(e.Fragment,{children:[e.jsxs("main",{children:[e.jsxs("header",{className:"mb-8 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground tracking-tight",children:"Classroom & Schedule Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Monitor classroom utilization and view schedules by year level."})]}),e.jsxs(C,{onClick:ge,className:"shadow-md hover:shadow-lg transition-all",children:[e.jsx(Oe,{size:16,className:"mr-2"}),"Add Room"]})]}),e.jsxs(ke,{defaultValue:"classrooms",children:[e.jsxs(Fe,{className:"grid w-full grid-cols-2 mb-4",children:[e.jsx(ue,{value:"classrooms",children:"Classroom List"}),e.jsx(ue,{value:"schedules",children:"Class Schedules"})]}),e.jsx(me,{value:"classrooms",children:e.jsx(Ue,{roomsData:d,scheduleData:i,subjectsData:u,onEdit:be,onDelete:ve,onManageAvailability:Ne,isLoading:x})}),e.jsx(me,{value:"schedules",children:e.jsx(ze,{scheduleData:i,subjectsData:u,roomsData:d,facultyLoadingData:p,savedSections:f,onAddSchedule:we,onFilterApply:de})})]})]}),e.jsx(Ye,{isOpen:y,onClose:()=>{_(!1),r(null)},onSave:ye,initialData:A}),e.jsx(G,{open:j.open,onOpenChange:()=>v({open:!1,roomId:null}),children:e.jsxs(K,{children:[e.jsxs(Q,{children:[e.jsx(X,{children:"Are you absolutely sure?"}),e.jsx(ce,{children:"This action cannot be undone. This will permanently delete the room."})]}),e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(C,{variant:"outline",children:"Cancel"})}),e.jsx(C,{variant:"destructive",onClick:Se,children:"Yes, delete it"})]})]})}),e.jsx(Ge,{isOpen:k,onClose:()=>I(!1),room:R})]})}export{bs as default};
