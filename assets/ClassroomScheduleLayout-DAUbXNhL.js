import{c as Z,r as n,a as Y,j as e,C as ee,B as $,A as se,R as B,X as te,t as P}from"./index-DXcYVmw3.js";import{S as I,a as T,b as k,c as R,d as w}from"./select-DGh_oc5I.js";import{I as V}from"./input-Dh1ozGG5.js";import{D as ae,a as le,b as re,c as ne,d as K,e as ie}from"./dialog-9bz0G8nn.js";import{L as f}from"./label-DdbtWDVU.js";import{T as ce}from"./triangle-alert-CxF7UFS-.js";import{S as Q}from"./square-pen-CdpWP9vr.js";import{C as oe}from"./circle-check-big-VYo9fstF.js";import{P as de}from"./plus-D4orGtOb.js";import"./Combination-Cuf1ytF1.js";import"./check-Bby-FiWF.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]],z=Z("building",me),ue={id:"cs101",code:"CS 101",title:"Intro to Comp",units:3,subject_code:"CS 101",des_title:"Introduction to Computing",total_units:3},he={id:"math110",code:"MATH 110",title:"College Algebra",units:3,subject_code:"MATH 110",des_title:"College Algebra",total_units:3},H={BSCS:{"1st Year":[ue,he]}},W=["BSCS","BSIT"],q=["1st Year","2nd Year"],J=[{value:"Mon",label:"Monday"},{value:"Tue",label:"Tuesday"},{value:"MWF",label:"Monday / Wednesday / Friday"}],xe=[{id:1,subjectId:"cs101",course:"BSCS",yearLevel:"1st Year",dayPair:"MWF",time:"08:30-09:30",instructor:"Dr. Smith",roomId:null,room_id:null,subject_id:1,faculty_id:null,type:"LEC",day:"MWF",start_time:"08:30:00",end_time:"09:30:00"}],ge=[{id:"A-101",capacity:50,type:"Classroom"},{id:"B-203",capacity:40,type:"Lab"}],G=({curriculum:o,courses:l,yearLevels:i,schedules:c,dayPairings:A,onCreateSchedule:b,rooms:v=[],facultyLoadingData:d=[]})=>{const[u,y]=n.useState(""),[h,j]=n.useState(""),[C,p]=n.useState(!1),[S,x]=n.useState(null),N=u&&h&&o[u]?.[h]||[],t=new Set(c.filter(a=>a.course===u&&a.yearLevel===h).map(a=>a.subjectId)),m=a=>{x(a),p(!0)},_=()=>{x(null),p(!1)};return e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 border rounded-lg bg-background",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Program / Course"}),e.jsxs(I,{value:u,onValueChange:y,children:[e.jsx(T,{children:e.jsx(k,{placeholder:"Select a course..."})}),e.jsx(R,{children:l.map(a=>e.jsx(w,{value:a,children:a},a))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Year Level"}),e.jsxs(I,{value:h,onValueChange:j,children:[e.jsx(T,{children:e.jsx(k,{placeholder:"Select a year level..."})}),e.jsx(R,{children:i.map(a=>e.jsx(w,{value:a,children:a},a))})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Curriculum Subjects"}),e.jsxs("div",{className:"space-y-3 mt-4",children:[N.map(a=>{const M=t.has(a.id);return e.jsxs("div",{className:`p-4 rounded-lg border flex items-center justify-between ${M?"bg-green-50 border-green-200":"bg-card"}`,children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold",children:[a.code," - ",a.title]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a.units," units"]})]}),M?e.jsxs("span",{className:"flex items-center gap-2 text-sm font-semibold text-green-600",children:[e.jsx(oe,{size:16})," Scheduled"]}):e.jsxs($,{variant:"outline",size:"sm",onClick:()=>m(a),children:[e.jsx(Q,{size:14,className:"mr-2"})," Schedule Class"]})]},a.id)}),N.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Select a course and year level to see subjects."})]})]}),e.jsx(se,{children:C&&S&&e.jsx(je,{isOpen:C,onClose:_,subject:S,course:u,yearLevel:h,dayPairings:A,onCreateSchedule:b,rooms:v,facultyLoadingData:d})})]})},je=({onClose:o,subject:l,course:i,yearLevel:c,onCreateSchedule:A,facultyLoadingData:b=[],rooms:v=[]})=>{const[d,u]=n.useState(""),[y,h]=n.useState(""),[j,C]=n.useState(""),[p,S]=n.useState(!1),[x,N]=n.useState(""),[t,m]=n.useState(""),_=async()=>{const[s,r,g]=y.split("|"),L=v.find(O=>O.id.toString()===t);if(!d||!s||!r||!j||!x||!t){P.error("Please fill all required fields (Room, Day, Time, Instructor, Section).");return}S(!0);try{await A({subjectId:l.id,course:i,yearLevel:c,dayPair:d,time:`${s}-${r}`,instructor:j,roomId:t,subject_id:l.id,room_id:L?.id||0,day:d,start_time:`${s}:00`,end_time:`${r}:00`,type:g,faculty_id:null}),P.success("Class scheduled (local state updated)."),o()}catch{P.error("Failed to create schedule.")}finally{S(!1)}},a=B.useMemo(()=>!l||!b?[]:b.filter(s=>s.subject_id.toString()===l.id.toString()),[l,b]),M=B.useMemo(()=>v.map(s=>({...s,id:s.id.toString()})),[v]),U=B.useMemo(()=>{if(!t)return[];const s=a.filter(g=>g.room.id.toString()===t);return Array.from(new Set(s.map(g=>g.day))).sort()},[a,t]),F=s=>{if(!s)return"";const r=s.length>5?s.substring(0,5):s,[g,L]=r.split(":").map(Number),O=g>=12?"PM":"AM";return`${g%12===0?12:g%12}:${L<10?"0"+L:L} ${O}`},E=B.useMemo(()=>!t||!d?[]:a.filter(r=>r.room.id.toString()===t&&r.day===d).map(r=>({value:`${r.start_time.substring(0,5)}|${r.end_time.substring(0,5)}|${r.type}`,display:`${F(r.start_time)} - ${F(r.end_time)} (${r.type})`,type:r.type})),[a,t,d]);return e.jsx(ae,{open:!0,onOpenChange:o,children:e.jsxs(le,{className:"sm:max-w-[640px]",children:[e.jsx(re,{children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(ne,{className:"text-lg font-bold",children:"Schedule Class"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[l.subject_code," — ",l.des_title]})]}),e.jsx(K,{asChild:!0,children:e.jsx($,{variant:"ghost",size:"icon",children:e.jsx(te,{})})})]})}),e.jsxs("div",{className:"grid gap-5 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(f,{className:"text-sm",children:["Year Level ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(I,{value:String(c),onValueChange:()=>{},disabled:!0,children:[e.jsx(T,{children:e.jsx(k,{})}),e.jsx(R,{children:e.jsx(w,{value:String(c),children:String(c)})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(f,{className:"text-sm",children:["Section ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(V,{placeholder:"Section name",value:x,onChange:s=>N(s.target.value)}),e.jsx($,{size:"icon",variant:"outline",title:"Create New Section",children:e.jsx(de,{})})]})]})]}),e.jsx("div",{className:"border-t border-slate-100"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(f,{className:"text-sm",children:["Subject ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"p-3 rounded-md bg-slate-50 border border-slate-100",children:[e.jsxs("div",{className:"font-semibold",children:[l.subject_code," — ",l.des_title]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Units: ",l.total_units??"--"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(f,{className:"text-sm",children:["Available Room ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(I,{value:t,onValueChange:s=>m(s),disabled:M.length===0,children:[e.jsx(T,{children:e.jsx(k,{placeholder:M.length?"Select a room":"No rooms"})}),e.jsx(R,{children:M.map(s=>e.jsxs(w,{value:s.id.toString(),children:[s.roomNumber," (",s.type,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(f,{className:"text-sm",children:["Day ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(I,{value:d,onValueChange:u,disabled:U.length===0,children:[e.jsx(T,{children:e.jsx(k,{placeholder:U.length?"Select day":"No available days"})}),e.jsx(R,{children:U.map(s=>e.jsx(w,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(f,{className:"text-sm",children:["Time Slot ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(I,{value:y,onValueChange:h,disabled:E.length===0,children:[e.jsx(T,{children:e.jsx(k,{placeholder:E.length?"Select Time Slot":"Select Room/Day"})}),e.jsx(R,{children:E.map((s,r)=>e.jsx(w,{value:s.value,children:s.display},r))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(f,{className:"text-sm",children:["Instructor ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(V,{value:j,onChange:s=>C(s.target.value),placeholder:"Enter instructor name..."})]})]})]}),e.jsxs(ie,{children:[e.jsx(K,{asChild:!0,children:e.jsx($,{variant:"outline",children:"Cancel"})}),e.jsx($,{onClick:_,disabled:p||!t||!d||!y||!j||!x,children:p?"Saving...":"Confirm Schedule"})]})]})})},D=({title:o,value:l,icon:i,color:c})=>e.jsxs("div",{className:"p-4 rounded-xl border flex items-center justify-between shadow-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:o}),e.jsx("p",{className:"text-2xl font-bold",children:l})]}),e.jsx(i,{size:24,className:c})]});function ke(){const[o,l]=n.useState("Creation"),[i,c]=n.useState(xe),[A,b]=n.useState(ge),[v,d]=n.useState([]),[u,y]=n.useState([]),h=i.filter(t=>t.roomId===null),j=new Set(i.map(t=>t.roomId).filter(Boolean)).size,C=t=>{c(m=>[...m,{...t,id:Date.now().toString()}])},p=n.useCallback(async()=>{try{const t=localStorage.getItem("accessToken");if(!t)return;const m=await Y.get("/rooms",{headers:{Authorization:`Bearer ${t}`}});d(m.data.rooms||[])}catch(t){console.error("Failed to fetch admin rooms",t)}},[]),S=n.useCallback(async()=>{try{const t=localStorage.getItem("accessToken");if(!t)return;const m=await Y.get("/get-faculty-loading",{headers:{Authorization:`Bearer ${t}`}});y(m.data.data||[])}catch(t){console.error("Failed to fetch faculty loading",t)}},[]);n.useEffect(()=>{p(),S()},[p,S]);const x=t=>{c(m=>m.map(_=>_.id===t.id?t:_))},N=()=>{switch(o){case"Creation":return e.jsx(G,{curriculum:H,courses:W,yearLevels:q,schedules:i,dayPairings:J,onCreateSchedule:C,onUpdateSchedule:x,rooms:v,facultyLoadingData:u});case"Rooms":return 0;default:return e.jsx(G,{curriculum:H,courses:W,yearLevels:q,schedules:i,dayPairings:J,onCreateSchedule:C,onUpdateSchedule:x})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 tracking-tight",children:"Classroom Scheduling"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage, create, and view classroom assignments across all departments."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(D,{title:"Total Rooms",value:A.length,icon:z,color:"text-blue-500"}),e.jsx(D,{title:"Rooms in Use",value:j,icon:z,color:"text-indigo-500"}),e.jsx(D,{title:"Total Classes Scheduled",value:i.length,icon:ee,color:"text-green-500"}),e.jsx(D,{title:"Unassigned Classes",value:h.length,icon:ce,color:"text-yellow-500"})]}),e.jsxs("div",{className:"bg-card border rounded-xl shadow-sm",children:[e.jsx("div",{className:"p-3 border-b",children:e.jsxs("div",{className:"inline-flex items-center gap-2 bg-muted p-1 rounded-lg",children:[e.jsx(X,{title:"Class Creation",icon:Q,isActive:o==="Creation",onClick:()=>l("Creation")}),e.jsx(X,{title:"Room Management",icon:z,isActive:o==="Rooms",onClick:()=>l("Rooms")})]})}),e.jsx("div",{className:"p-4",children:N()})]})]})}const X=({title:o,icon:l,isActive:i,onClick:c})=>e.jsxs("button",{onClick:c,className:`flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-md transition-colors ${i?"bg-background text-primary shadow-sm":"text-muted-foreground hover:text-primary"}`,children:[e.jsx(l,{size:16}),o]});export{ke as default};
