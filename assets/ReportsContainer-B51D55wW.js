import{c as O,r as m,j as e,R as Z,a as E,d as V,e as ee,U as se,b as te,B as R,F as re,f as ae,A as oe,m as H}from"./index-D4cq_vOu.js";import{T as Y,a as B,b as A,c as w,d as G,e as N}from"./table-CChJsJ2a.js";import{S as q,a as X,b as J,c as Q,d as C}from"./select-YhEn_NCI.js";import{L as K}from"./loader-circle-CTjplTeF.js";import{F as ne}from"./funnel-Di-99xUR.js";import{P as le}from"./progress-CR-xrrv8.js";import{C as ce}from"./clipboard-list-CpPutRZt.js";import{D as de}from"./download-C1rHNBac.js";import"./Combination-aR6sbofW.js";import"./check-CUMF764Q.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M7 16h8",key:"srdodz"}],["path",{d:"M7 11h12",key:"127s9w"}],["path",{d:"M7 6h3",key:"w9rmul"}]],ue=O("chart-bar",ie);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],xe=O("printer",me),W=t=>{try{const[n,i]=t.split(":").map(Number),a=n>=12?"PM":"AM";return`${n%12||12}:${String(i).padStart(2,"0")}${a}`}catch{return t}},he=t=>{const n=new Map;t.forEach(a=>{n.has(a.faculty_id)||n.set(a.faculty_id,[]),n.get(a.faculty_id).push(a)});const i=[];return n.forEach(a=>{const p=a[0].faculty,u=p.id,r=p.user.name,o=new Set;a.forEach(s=>o.add(s.subject.des_title));const x=o.size,l=a.map(s=>{const h=s.subject,b=h.total_hrs??(h.total_lec_hrs??h.lec_units??0)+(h.total_lab_hrs??h.lab_units??0),y=W(s.start_time),S=W(s.end_time),j=s.subject.des_title;return{loadCode:`${s.subject.subject_code} ${s.type}`,payingHours:b,day:s.day,time:`${y}-${S}`,room:s.room.roomNumber,remarks:j,remarkRowSpan:0}}),g=[];for(let s=0;s<l.length;s++){const h=l[s];if(s===0||l[s].remarks!==l[s-1].remarks){const b=h.remarks;let y=1;for(let S=s+1;S<l.length&&l[S].remarks===b;S++)y++;h.remarkRowSpan=y}g.push(h)}const c=p.t_load_units,f=l.reduce((s,h)=>s+h.payingHours,0),d=Math.max(0,f-c),v=f.toString();i.push({facultyId:u,name:r,loadString:v,calculatedLoad:c,preps:x,overload:d,subjects:g})}),i};function pe(){const[t,n]=m.useState("all"),[i,a]=m.useState([]),[p,u]=m.useState(!0),[r,o]=m.useState(!1),[x,l]=m.useState(""),g="get-facultyLoading-reports",c="accessToken";m.useEffect(()=>{(async()=>{u(!0),o(!1),l("");const h=localStorage.getItem(c);if(!h){u(!1),o(!0),l("Authentication token not found in Local Storage. Please log in.");return}try{const y=(await E.get(g,{headers:{Authorization:`Bearer ${h}`,Accept:"application/json"}})).data;if(y.success&&Array.isArray(y.facultyLoading))a(y.facultyLoading);else throw new Error("Invalid data structure or success: false received")}catch(b){console.error("Error fetching data with axios:",b),o(!0),E.isAxiosError(b)&&b.response?l(`API Error: ${b.response.statusText} (${b.response.status}). Is the token valid?`):l("Network error or failed to connect to the API.")}finally{u(!1)}})()},[]);const f=m.useMemo(()=>he(i),[i]),d=m.useMemo(()=>t==="all"?f:f.filter(s=>s.facultyId.toString()===t),[t,f]),v=m.useMemo(()=>{const s=new Map;return f.forEach(h=>s.set(h.facultyId,h.name)),Array.from(s.entries()).map(([h,b])=>({id:h,name:b}))},[f]);return p?e.jsxs("div",{className:"p-10 text-center flex flex-col items-center justify-center text-primary",children:[e.jsx(K,{className:"h-8 w-8 animate-spin mb-3"}),e.jsx("p",{children:"Loading faculty load reports..."})]}):r?e.jsxs("div",{className:"p-10 text-center text-destructive border border-destructive/50 rounded-lg",children:[e.jsx("h3",{className:"font-bold mb-2",children:"Failed to Load Data"}),e.jsx("p",{children:x||"An unknown error occurred while fetching the data."})]}):e.jsxs("div",{className:"bg-card p-4 md:p-6 rounded-lg shadow-sm border border-border",children:[e.jsx("div",{className:"flex justify-end mb-6",children:e.jsxs(q,{value:t,onValueChange:n,children:[e.jsxs(X,{className:"w-full md:w-64",children:[e.jsx(ne,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsx(J,{placeholder:"Filter by Faculty"})]}),e.jsxs(Q,{children:[e.jsx(C,{value:"all",children:"All Faculty"}),v.map(s=>e.jsx(C,{value:s.id.toString(),children:s.name},s.id))]})]})}),e.jsx("div",{className:"rounded-lg border overflow-x-auto",children:e.jsx("div",{children:e.jsxs(Y,{className:"w-full",children:[e.jsx(B,{children:e.jsxs(A,{children:[e.jsx(w,{className:"w-[100px] border-r",children:"Name of Faculty"}),e.jsx(w,{className:"w-[100px] border-r",children:"Load"}),e.jsx(w,{className:"text-center w-[100px] border-r",children:"Paying Hours"}),e.jsx(w,{className:"w-[80px]",children:"Day"}),e.jsx(w,{className:"w-[150px]",children:"Time"}),e.jsx(w,{className:"w-[80px] border-r",children:"Room"}),e.jsx(w,{className:"min-w-[250px] border-r",children:"Remarks"}),e.jsx(w,{className:"w-[80px] text-right border-r",children:"Total Load"}),e.jsx(w,{className:"w-[100px] text-center",children:"Preps"})]})}),e.jsxs(G,{children:[d.map((s,h)=>{const b=s.subjects.length,y=s.overload>0,S=h%2===1?"bg-accent/10":"";return b===0?null:e.jsx(Z.Fragment,{children:s.subjects.map((j,T)=>{const $=T===b-1,F=T===0,_=j.remarkRowSpan>0;return e.jsxs(A,{className:`${S} ${$?"border-b-4 border-gray-300":"border-b border-border/50"}`,children:[F&&e.jsx(N,{rowSpan:b,className:"font-bold text-base align-top border-r whitespace-nowrap",children:s.name}),e.jsx(N,{className:"text-sm font-medium border-r uppercase",children:j.loadCode}),e.jsx(N,{className:"text-center font-medium border-r",children:j.payingHours||""}),e.jsx(N,{className:"text-sm",children:j.day}),e.jsx(N,{className:"text-sm",children:j.time}),e.jsx(N,{className:"text-sm border-r",children:j.room}),_&&e.jsx(N,{rowSpan:j.remarkRowSpan,className:"text-sm text-muted-foreground border-r whitespace-normal align-top",children:j.remarks}),F&&e.jsx(N,{rowSpan:b,className:"text-center font-bold text-lg align-top border-r",children:e.jsxs("div",{className:"py-1",children:[e.jsx("span",{className:"text-xl font-bold",children:s.loadString}),y&&e.jsxs("div",{className:"text-destructive font-semibold text-xs mt-1",children:["overload ",s.overload]})]})}),F&&e.jsx(N,{rowSpan:b,className:"text-center align-top",children:s.preps>2?`${s.preps} preps`:""})]},`${s.facultyId}-${T}`)})},s.facultyId)}),d.length===0&&e.jsx(A,{children:e.jsx(N,{colSpan:9,className:"h-24 text-center text-muted-foreground",children:"No faculty load data found for the selected filter."})})]})]})})})]})}const fe=t=>{const n=Math.floor(t/60),i=t%60,a=n>=12?"pm":"am",p=n%12||12;return`${String(p).padStart(2,"0")}:${String(i).padStart(2,"0")}${a}`},be=(t=7,n=21,i=30)=>{const a=[],p=t*60,u=n*60;for(let r=p;r<=u;r+=i)a.push(fe(r));return a},M=be(7,21,30),z=[{value:"Monday_Thursday",label:"MONDAYS and THURSDAYS",days:["Monday","Thursday"]},{value:"all",label:"All Days (Unfiltered)",days:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]},{value:"Monday",label:"Monday Schedule",days:["Monday"]},{value:"Tuesday",label:"Tuesday Schedule",days:["Tuesday"]},{value:"Wednesday",label:"Wednesday Schedule",days:["Wednesday"]},{value:"Thursday",label:"Thursday Schedule",days:["Thursday"]},{value:"Friday",label:"Friday Schedule",days:["Friday"]},{value:"Saturday",label:"Saturday Schedule",days:["Saturday"]}],U=t=>{try{const[n,i]=t.split(":").map(Number),a=n>=12?"PM":"AM";return`${n%12||12}:${String(i).padStart(2,"0")}${a}`}catch{return t}},ge=t=>{const n={},i=new Set,a=u=>{const[r,o]=u.split(":").map(Number);return r*60+o},p=u=>{const r=u.match(/(\d{1,2}):(\d{2})(am|pm)/i);if(!r)return"";let o=parseInt(r[1],10);const x=r[2],l=r[3].toLowerCase();return l==="pm"&&o!==12&&(o+=12),l==="am"&&o===12&&(o=0),`${String(o).padStart(2,"0")}:${x}`};return t.forEach(u=>{const r=u.faculty_loading,o=r.room.roomNumber,x=r.subject.subject_code,l=r.faculty.user.name,g=u.section,c=r.type,f=`${U(r.start_time)}-${U(r.end_time)}`,d=r.start_time.substring(0,5),v=r.end_time.substring(0,5),s=a(d),h=a(v),b=30;for(let y=0;y<M.length;y++){const S=M[y],j=p(S);if(!j)continue;const T=a(j),$=T+b;if(!(s<$&&h>T))continue;let _=1;for(let k=y+1;k<M.length;k++){const L=p(M[k]);if(!L)break;const I=a(L),D=I+b;if(s<D&&h>I)_++;else break}for(let k=0;k<_;k++){const L=`${o}_${M[y+k]}`;if(k===0){const I=L,D=e.jsxs("div",{className:"text-center h-full flex flex-col justify-center p-1.5 bg-green-100/80 border border-green-300 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 cursor-pointer",children:[e.jsxs("span",{className:"font-extrabold uppercase text-sm text-green-800 leading-tight block",children:[x," ",g]}),e.jsx("span",{className:"text-xs font-medium text-gray-700 mt-1 block",children:l}),e.jsxs("span",{className:"text-xs text-green-700/80 mt-0.5 block",children:[r.day," | ",f," | ",c]})]});n[I]={content:D,rowSpan:_}}else i.add(L)}break}}),{gridData:n,coveredKeys:i}},ye="get-classSchedule-reports",je="accessToken";function Ne(){const[t,n]=m.useState("Monday_Thursday"),[i,a]=m.useState([]),[p,u]=m.useState(!0),[r,o]=m.useState(!1),x=m.useMemo(()=>{const c=new Set;return i.forEach(f=>{const d=f?.faculty_loading?.room?.roomNumber;d&&d.toString().trim()!==""&&c.add(d.toString())}),Array.from(c).sort((f,d)=>f.localeCompare(d))},[i]);m.useEffect(()=>{(async()=>{u(!0),o(!1);const f=localStorage.getItem(je);if(!f){u(!1);return}try{const d=await E.get(ye,{headers:{Authorization:`Bearer ${f}`,Accept:"application/json"}});if(d.data.success&&Array.isArray(d.data.classSchedule))a(d.data.classSchedule);else throw new Error("Invalid data structure")}catch(d){console.error("Error fetching class schedule:",d),o(!0)}finally{u(!1)}})()},[]);const l=m.useMemo(()=>{const c=z.find(d=>d.value===t),f=c?c.days:[];return i.filter(d=>f.includes(d.faculty_loading.day))},[t,i]),g=m.useMemo(()=>ge(l),[l]);return p?e.jsxs("div",{className:"p-10 text-center flex flex-col items-center justify-center text-primary",children:[e.jsx(K,{className:"h-8 w-8 animate-spin mb-3"}),e.jsx("p",{children:"Loading class schedules..."})]}):r?e.jsx("div",{className:"p-10 text-center text-destructive border border-destructive/50 rounded-lg",children:"Error loading class schedule data."}):e.jsxs("div",{className:"bg-card p-4 md:p-6 rounded-xl shadow-2xl border-2 border-border overflow-x-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 border-b pb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-3 md:mb-0",children:"Room Schedule View"}),e.jsxs(q,{value:t,onValueChange:n,children:[e.jsxs(X,{className:"w-full md:w-80 border-primary shadow-lg hover:shadow-xl transition-shadow",children:[e.jsx(V,{className:"h-5 w-5 mr-2 text-primary"}),e.jsx(J,{placeholder:"Select Day"})]}),e.jsx(Q,{children:z.map(c=>e.jsx(C,{value:c.value,children:c.label},c.value))})]})]}),e.jsx("div",{className:"min-w-[1800px] overflow-hidden",children:e.jsxs(Y,{className:"w-full table-fixed border-collapse border-primary/20",children:[e.jsx(B,{className:"bg-primary sticky top-0 z-10 shadow-lg",children:e.jsxs(A,{children:[e.jsx(w,{className:"w-[150px] border-r border-b border-primary-foreground/30 text-center font-extrabold text-primary-foreground text-sm uppercase",children:"Time Slot"}),x.map(c=>e.jsx(w,{className:"w-[150px] border-r border-b border-primary-foreground/30 text-center font-extrabold whitespace-nowrap text-primary-foreground text-sm uppercase",children:c},c))]})}),e.jsx(G,{children:M.map(c=>e.jsxs(A,{className:"h-12 border-b border-gray-200 hover:bg-muted/50 transition-colors duration-200",children:[e.jsx(N,{className:"w-[150px] border-r border-r-gray-300 align-middle p-2 font-bold text-xs whitespace-pre-line bg-muted/40 text-gray-700 sticky left-0 z-5",children:c}),x.map(f=>{const d=`${f}_${c}`,v=g.gridData[d];return g.coveredKeys.has(d)?null:v?e.jsx(N,{rowSpan:v.rowSpan,className:"w-[150px] border-r border-r-gray-300 align-middle p-1.5 text-center text-sm",children:e.jsx("div",{className:"h-full",children:v.content})},d):e.jsx(N,{className:"w-[150px] border-r border-r-gray-300 align-top p-1 text-center text-sm border-dashed border-gray-300 bg-background/50"},d)})]},c))})]})})]})}function we(){const[t,n]=m.useState([]),[i,a]=m.useState(!0),[p,u]=m.useState(null),r=20;return m.useEffect(()=>{(async()=>{try{a(!0),u(null);const x=localStorage.getItem("accessToken");if(!x){u("Authentication token not found. Please log in."),a(!1);return}const l={headers:{Authorization:`Bearer ${x}`}},g=await E.get("faculty-load",l);g.data.success?n(g.data.data):u(g.data.message||"Failed to load faculty data.")}catch(x){const l=E.isAxiosError(x)&&x.response?.data?.message?x.response.data.message:"Could not connect to the server or fetch data.";console.error("Error fetching faculty workload data:",x),u(l)}finally{a(!1)}})()},[]),i?e.jsxs("div",{className:"space-y-6 pt-4",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Faculty Workload Management"}),e.jsx("div",{className:"bg-card p-6 rounded-lg shadow-sm border text-center text-muted-foreground",children:e.jsx("div",{className:"animate-pulse",children:"Loading Faculty Workloads..."})})]}):p?e.jsxs("div",{className:"space-y-6 pt-4",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight text-destructive",children:"Data Error"}),e.jsx("div",{className:"bg-card p-6 rounded-lg shadow-sm border border-destructive text-center text-destructive",children:e.jsxs("p",{children:["Error: ",p]})})]}):t.length===0?e.jsxs("div",{className:"space-y-6 pt-4",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Faculty Workload Management"}),e.jsx("div",{className:"bg-card p-6 rounded-lg shadow-sm border text-center text-muted-foreground",children:e.jsx("p",{children:"No active faculty found to display workload data."})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"pb-2",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight flex items-center gap-3",children:[e.jsx(ue,{className:"h-6 w-6 text-primary"}),"Faculty Workload Management"]}),e.jsxs("p",{className:"text-muted-foreground text-sm mt-1 ml-9",children:["Overview of current unit loads vs. a standard cap of ",e.jsxs("span",{className:"font-semibold",children:[r," units/hours."]})]})]}),e.jsx("div",{className:"bg-card p-4 md:p-6 rounded-lg shadow-sm border border-border",children:e.jsx("div",{className:"space-y-6",children:t.map(o=>{const x=Math.min(100,o.load/r*100);let l="bg-primary";return o.load>r?l="bg-red-600":x>90?l="bg-destructive":x>70?l="bg-yellow-500":l="bg-primary",e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1.5 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-semibold text-foreground",children:o.name})]}),e.jsxs("span",{className:`font-mono font-bold ${o.load>r?"text-red-600":"text-primary"}`,children:[o.load,"h",o.load>r&&e.jsx("span",{className:"ml-1",children:"(OVER)"})]})]}),e.jsx(le,{value:x,className:l})]},o.name)})})})]})}function ve(){const[t,n]=m.useState("loading"),[i,a]=m.useState({totalFaculty:0,assignedSubjects:0,totalUnitsLoaded:0}),[p,u]=m.useState(!0),[r,o]=m.useState(null);m.useEffect(()=>{(async()=>{try{u(!0),o(null);const c=localStorage.getItem("accessToken");if(!c){o("Authentication token not found. Please log in."),u(!1);return}const f={headers:{Authorization:`Bearer ${c}`}},d=await E.get("reports/kpis",f);d.data.success?a(d.data.data):o("Failed to load KPI data from the server.")}catch(c){console.error("Error fetching KPI data:",c),o("Could not connect to the API or fetch KPI data.")}finally{u(!1)}})()},[]);const x=[{label:"Total Faculty",value:i.totalFaculty,icon:se},{label:"Assigned Subjects",value:i.assignedSubjects,icon:te},{label:"Total Units Loaded",value:i.totalUnitsLoaded,icon:ce}],l=()=>p?e.jsxs("div",{className:"flex justify-center items-center h-20 border rounded-xl bg-card",children:[e.jsx(K,{className:"h-6 w-6 animate-spin text-primary mr-2"}),e.jsx("span",{className:"text-muted-foreground",children:"Loading Metrics..."})]}):r?e.jsxs("div",{className:"bg-red-50 border border-red-300 text-red-700 p-4 rounded-xl",children:[e.jsx("p",{className:"font-semibold",children:"KPI Load Error"}),e.jsx("p",{className:"text-sm",children:r})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:x.map((g,c)=>e.jsxs(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:c*.1},className:"bg-card p-5 rounded-xl border shadow-sm flex items-center gap-5 border-border",children:[e.jsx("div",{className:"p-3 rounded-lg bg-primary/10 text-primary",children:e.jsx(g.icon,{size:24})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:g.value}),e.jsx("div",{className:"text-sm text-muted-foreground",children:g.label})]})]},g.label))});return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"mb-8 flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground tracking-tight",children:"Generate Reports"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"View and export faculty loading, schedules, and workloads."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(R,{variant:"outline",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"})," Print"]}),e.jsxs(R,{children:[e.jsx(de,{className:"h-4 w-4 mr-2"})," Download All"]})]})]}),e.jsx("div",{className:"mb-8",children:l()}),e.jsx("div",{className:"border-b border-border mb-6",children:e.jsxs("div",{className:"inline-flex items-center gap-1 bg-muted p-1 rounded-lg",children:[e.jsx(P,{id:"loading",activeTab:t,setActiveTab:n,icon:e.jsx(re,{size:16}),children:"Loading"}),e.jsx(P,{id:"schedules",activeTab:t,setActiveTab:n,icon:e.jsx(V,{size:16}),children:"Schedules"}),e.jsx(P,{id:"workloads",activeTab:t,setActiveTab:n,icon:e.jsx(ae,{size:16}),children:"Workloads"})]})}),e.jsx(oe,{mode:"wait",children:e.jsxs(H.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:[t==="loading"&&e.jsx(pe,{}),t==="schedules"&&e.jsx(Ne,{}),t==="workloads"&&e.jsx(we,{})]},t)})]})}const P=({id:t,activeTab:n,setActiveTab:i,icon:a,children:p})=>e.jsxs(R,{variant:n===t?"default":"ghost",onClick:()=>i(t),className:"flex items-center gap-2 px-4 py-2 h-9 text-sm font-semibold transition-all",children:[a," ",p]});function De(){return e.jsx(ve,{})}export{De as default};
