import{c as Z,j as e,d as ue,r as c,a as M,t as B,B as Q,e as Oe,b as Re,A as ze}from"./index-DXcYVmw3.js";import{L as Ue,V as Ve,S as _e}from"./ViewAssignedSubjectsDialog-BTa-y5jA.js";import{I as le}from"./input-Dh1ozGG5.js";import{S as V}from"./skeleton-CGPDtiiA.js";import{D as Pe,a as We,b as qe,c as Ye,f as Qe,e as He,d as Ge}from"./dialog-9bz0G8nn.js";import{B as xe}from"./badge-DcyDaA5F.js";import{L as me}from"./label-DdbtWDVU.js";import{C as Ke,a as Xe}from"./tabs-Baoaaq0a.js";import{L as Y}from"./loader-circle-B2W9qXRN.js";import{T as he}from"./triangle-alert-CxF7UFS-.js";import{C as J}from"./check-Bby-FiWF.js";import{S as Ae}from"./search-Dd19T1-d.js";import{C as Je}from"./circle-check-big-VYo9fstF.js";import{C as Ze}from"./calendar-x-2-fPFptCus.js";import"./Combination-Cuf1ytF1.js";import"./card-pjwBgWwe.js";import"./circle-alert-R-vDJWKV.js";import"./calendar-check-MGws4jZw.js";import"./presentation-z3vDVaLw.js";import"./map-pin-DFGNKCWs.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=[["path",{d:"M4.2 4.2A2 2 0 0 0 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 1.82-1.18",key:"16swn3"}],["path",{d:"M21 15.5V6a2 2 0 0 0-2-2H9.5",key:"yhw86o"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h7",key:"1wap6i"}],["path",{d:"M21 10h-5.5",key:"quycpq"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],tt=Z("calendar-off",et);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]],at=Z("circle-arrow-down",st);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],lt=Z("circle-check",rt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],ot=Z("info",nt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Se=Z("trending-up",it);function ct(){return e.jsxs("div",{className:"bg-white rounded-xl overflow-hidden shadow-lg border flex",children:[e.jsx("div",{className:"relative flex-shrink-0 w-1/3 bg-slate-50 flex items-center justify-center p-6",children:e.jsx(V,{className:"w-24 h-24 rounded-full"})}),e.jsxs("div",{className:"flex-grow flex flex-col p-5 w-2/3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"h-6 w-4/5"}),e.jsx(V,{className:"h-4 w-3/5"})]}),e.jsx("div",{className:"flex-grow"}),e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx(V,{className:"h-3 w-1/3"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(V,{className:"h-5 w-20 rounded-full"}),e.jsx(V,{className:"h-5 w-24 rounded-full"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsx(V,{className:"h-9 w-full rounded-md"}),e.jsx(V,{className:"h-9 w-full rounded-md"})]})]})]})}const dt=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],ke=t=>{if(!t||!t.includes(":"))return"Invalid Time";const[d,s]=t.split(":");let r=parseInt(d,10);const f=r>=12?"PM":"AM";return r=r%12||12,`${r}:${s} ${f}`};function mt({schedule:t}){const d=new Date().toLocaleString("en-US",{weekday:"long"});return e.jsx("div",{className:"bg-background p-2 rounded-lg border max-h-64 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-1 lg:grid-cols-1 gap-2",children:dt.map(s=>{const r=t[s],f=r&&r.length>0,x=s===d;return e.jsxs("div",{className:`rounded-md p-3 flex flex-col min-h-[80px] transition-all duration-200 ${x?"bg-primary/10 border-2 border-primary/80":"bg-muted/50 border border-transparent"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:`font-bold text-sm ${x?"text-primary":"text-foreground"}`,children:s}),x&&e.jsx(xe,{variant:"default",className:"text-[10px] h-5",children:"TODAY"})]}),f?e.jsx("div",{className:"space-y-1.5 flex-grow",children:r.map((g,u)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-3.5 w-3.5 text-muted-foreground flex-shrink-0"}),e.jsxs("p",{className:"font-mono text-xs text-foreground font-medium",children:[ke(g.start)," - ",ke(g.end)]})]},u))}):e.jsxs("div",{className:"flex flex-col items-center justify-center flex-grow text-center text-slate-400",children:[e.jsx(tt,{className:"h-5 w-5 mb-1"}),e.jsx("p",{className:"text-xs italic",children:"Not available"})]})]},s)})})})}const L=t=>{if(!t)return 0;const[d,s]=t.split(":").map(Number);return d*60+s},ut=t=>{const d=Math.floor(t/60),s=t%60;return`${String(d).padStart(2,"0")}:${String(s).padStart(2,"0")}`},xt=(t,d)=>{if(!t)return"";const s=L(t)+d,r=Math.max(0,Math.min(1439,s));return ut(r)},ne=t=>{if(!t)return"";const d=t.split(":");if(d.length<2)return t;const s=parseInt(d[0]||"0",10),r=parseInt(d[1]||"0",10),f=s>=12?"PM":"AM";return`${s%12===0?12:s%12}:${String(r).padStart(2,"0")} ${f}`},ht=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],gt=(t,d,s,r)=>{if(!t||!d||!s||!r)return!1;const f=L(t),x=L(d),g=L(s),u=L(r);return Math.max(f,g)<Math.min(x,u)},ft=(t,d)=>{if(!t)return!1;const s=t.toString().toLowerCase(),r=d.toString().toLowerCase();return r.includes("lab")?s.includes("lab")||s.includes("labor"):r.includes("lec")||r.includes("lecture")?s.includes("lec")||s.includes("lecture"):s===r},Ce=({type:t,hours:d,schedules:s,facultySchedule:r,onScheduleChange:f,timeError:x})=>{const g=c.useMemo(()=>{const u=s[t].day;if(!u||!r[u]?.length)return{min:void 0,max:void 0};const b=r[u],a=b.reduce((_,v)=>v.start<_?v.start:_,b[0].start),$=b.reduce((_,v)=>v.end>_?v.end:_,b[0].end);return{min:a,max:$}},[s[t].day,r,t,s]);return e.jsxs("div",{className:"pt-4 border-t space-y-4",children:[e.jsxs("h4",{className:"font-semibold text-md text-foreground",children:[t==="lec"?"Lecture":"Laboratory"," Schedule (",d," hours)"]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{children:[e.jsx(me,{htmlFor:`${t}-day`,children:"Day of Class"}),e.jsxs("select",{id:`${t}-day`,value:s[t].day,onChange:u=>f(t,"day",u.target.value),className:"w-full mt-1 p-2 border rounded-md bg-background disabled:opacity-50",children:[e.jsx("option",{value:"",disabled:!0,children:"Select a day"}),ht.map(u=>e.jsxs("option",{value:u,disabled:!r[u]?.length,children:[u," ",!r[u]?.length&&"(Unavailable)"]},u))]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(me,{htmlFor:`${t}-start-time`,className:"text-xs font-semibold text-muted-foreground",children:"Start Time"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(le,{id:`${t}-start-time`,type:"time",value:s[t].startTime,onChange:u=>f(t,"startTime",u.target.value),className:"pl-9",step:"1800",min:g.min,max:g.max,disabled:!s[t].day})]})]}),e.jsxs("div",{children:[e.jsx(me,{htmlFor:`${t}-end-time`,className:"text-xs font-semibold text-muted-foreground",children:"End Time"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(le,{id:`${t}-end-time`,type:"time",value:s[t].endTime,onChange:u=>f(t,"endTime",u.target.value),className:"pl-9",step:"1800",min:g.min,max:g.max,disabled:!s[t].day})]})]})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:(()=>{const u=b=>{if(!b)return"--:--";const a=b.split(":");return`${a[0]?.padStart(2,"0")}:${a[1]?.padStart(2,"0")}`};return`Window: ${u(g.min)} - ${u(g.max)}`})()}),(d??0)>0&&s[t].startTime&&e.jsxs(Q,{type:"button",size:"sm",variant:"outline",onClick:()=>f(t,"endTime",xt(s[t].startTime,(d||0)*60)),children:["Auto-fill end (+",d,"h)"]})]}),x&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-destructive/10 border-destructive/30 rounded-lg text-destructive text-sm",children:[e.jsx(he,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("p",{children:x})]})]})},$e=({type:t,schedules:d,availableRooms:s,isLoadingRooms:r,selectedRooms:f,onSelectRoom:x})=>{const g=d[t].day||"",u=d[t].startTime||"",b=d[t].endTime||"",a=t==="lec"?"Lecture":"Laboratory",$=c.useMemo(()=>{if(!g||!u||!b)return new Set;const N=s[t].filter(S=>ft(S.type,a)?(S.availabilities||[]).filter(y=>(y.day||"").toString().toLowerCase()===g.toString().toLowerCase()).some(y=>{const z=y.start_time??y.start??"",D=y.end_time??y.end??"";return!z||!D?!1:L(z)<=L(u)&&L(D)>=L(b)}):!1);return new Set(N.map(S=>S.id))},[s,t,g,u,b,a]),_=s[t],v=!!g&&!!u&&!!b,E=v?`${ne(u)} - ${ne(b)}`:"--:-- - --:--";return e.jsx("div",{className:"pt-4 border-t space-y-3",children:r[t]?e.jsx("div",{className:"flex items-center justify-center h-24",children:e.jsx(Y,{className:"h-6 w-6 animate-spin text-primary"})}):v?_.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-24 text-center text-destructive bg-destructive/5 border border-destructive/20 rounded-lg p-3",children:[e.jsx(he,{className:"h-5 w-5 mb-1 flex-shrink-0"}),e.jsxs("p",{className:"text-sm font-semibold",children:["ALL ",a.toUpperCase()," ROOMS ARE BUSY"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["No rooms are free for the slot: (",g,", ",E,"). Please change the time or day."]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-xs text-muted-foreground font-semibold",children:["Showing ",$.size," available ",a," rooms for ",g,", ",E,":"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto pr-2 -mr-2",children:_.map(N=>{const S=$.has(N.id),O=S?"AVAILABLE":"BUSY",R=S?"bg-green-100 text-green-700":"bg-red-100 text-red-700",y=S?f[t]===N.id?"bg-primary/10 border-primary shadow-sm":"bg-background hover:border-primary/50":"bg-red-50 border-red-300 opacity-70 cursor-not-allowed";return e.jsxs("button",{onClick:()=>S&&x(t,N.id),disabled:!S,className:`p-2 border rounded-md text-left transition-all relative ${y}`,children:[e.jsx("div",{className:`absolute top-0 right-0 p-1 px-2 rounded-tr-md rounded-bl-md text-xs font-semibold ${R}`,children:O}),f[t]===N.id&&S&&e.jsx(J,{className:"h-4 w-4 text-primary absolute top-2 right-2 mt-2"}),e.jsx("p",{className:"font-semibold text-sm pt-2",children:N.roomNumber}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Cap: ",N.capacity??"--"]}),N.type&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-slate-100 text-slate-700 font-medium",children:N.type})]}),e.jsxs("p",{className:`text-[10px] mt-1 truncate ${S?"text-green-700 font-medium":"text-red-700 font-medium"}`,children:["Slot: ",E," is ",O]})]},N.id)})})]}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Set a full valid day and time schedule to view room status."})})};function bt({isOpen:t,onClose:d,faculty:s,availableSubjects:r=[],onAssign:f}){const[x,g]=c.useState(1),[u,b]=c.useState(""),[a,$]=c.useState(null),[_,v]=c.useState(0),[E,N]=c.useState(!0),[S,O]=c.useState([]),[R,y]=c.useState([]),[z,D]=c.useState(!1),[ee,H]=c.useState(null),[p,k]=c.useState({lec:{day:"",startTime:"",endTime:""},lab:{day:"",startTime:"",endTime:""}}),[j,C]=c.useState({lec:null,lab:null}),[F,U]=c.useState({lec:[],lab:[]}),[W,A]=c.useState({lec:!1,lab:!1}),[I,ge]=c.useState({lec:null,lab:null}),[q,fe]=c.useState({}),[Le,oe]=c.useState([]),[Me,ie]=c.useState(!0),[ce,te]=c.useState(!1),be=c.useCallback(()=>{g(1),b(""),$(null),k({lec:{day:"",startTime:"",endTime:""},lab:{day:"",startTime:"",endTime:""}}),C({lec:null,lab:null}),U({lec:[],lab:[]}),ge({lec:null,lab:null}),te(!1)},[]);c.useEffect(()=>{if(t){if(b(""),be(),r&&Array.isArray(r)){const l=r.map(n=>{const i=n.total_lec_hrs??n.lec_units??0,o=n.total_lab_hrs??n.lab_units??0,m=n.total_hrs??i+o;return{...n,total_lec_hrs:i,total_lab_hrs:o,total_hrs:m,total_units:n.total_units??m}});H(l),y(l)}else(async()=>{D(!0);try{const n=localStorage.getItem("accessToken");let i;try{i=await M.get("get-subjects",{headers:n?{Authorization:`Bearer ${n}`}:void 0})}catch{i=await M.get("get-subjects")}const m=(i.data?.subject||i.data?.data||[]).map(h=>{const w=h.total_lec_hrs??h.lec_units??0,T=h.total_lab_hrs??h.lab_units??0,P=h.total_hrs??w+T;return{...h,total_lec_hrs:w,total_lab_hrs:T,total_hrs:P,total_units:h.total_units??P}});H(m),y(m)}catch(n){console.error("Failed to fetch subjects:",n),y([]),H([])}finally{D(!1)}})();if(s){const l=async()=>{N(!0);const o=localStorage.getItem("accessToken");if(!o){N(!1);return}try{const m=await M.get(`/faculties/${s.id}/current-load`,{headers:{Authorization:`Bearer ${o}`}});v(m.data.current_load_units??0),O(m.data.assigned_subject_ids??m.data.assigned_subjects??[])}catch(m){console.error("Error fetching current load:",m),v(0),B.error("Failed to fetch faculty's current load.")}finally{N(!1)}},n=async()=>{ie(!0);const o=localStorage.getItem("accessToken");if(!o){ie(!1);return}try{const m=await M.get(`/faculties/${s.id}/availability`,{headers:{Authorization:`Bearer ${o}`}});fe(m.data)}catch{fe({})}finally{ie(!1)}},i=async()=>{const o=localStorage.getItem("accessToken");if(!o){oe([]);return}try{const m=await M.get(`faculty-loading/${s.id}/schedules`,{headers:{Authorization:`Bearer ${o}`}}),h=m.data?.data||m.data||[];oe(Array.isArray(h)?h:[])}catch(m){console.error("Failed to fetch assigned schedules",m),oe([])}};l(),n(),i()}}},[t,s,r,be]);const{totalAllowedLoad:de,potentialTotalLoad:pe,isLoadExceeded:G}=c.useMemo(()=>{const l=s.t_load_units??0,n=s.overload_units??0,i=l+n,o=a?.total_hrs??a?.total_units??0,m=_+o,h=i>0&&m>i;return{totalAllowedLoad:i,potentialTotalLoad:m,isLoadExceeded:h}},[s,_,a]),Fe=a?.total_hrs??a?.total_units??0,je=async()=>{const l=u.trim();if(!l){ee&&y(ee);return}D(!0);try{const n=localStorage.getItem("accessToken");let i;try{i=await M.get("filter-subjects",{params:{subject:l},headers:n?{Authorization:`Bearer ${n}`}:void 0})}catch{i=await M.get("filter-subjects",{params:{subject:l}})}const m=(i.data?.data||i.data?.subject||[]).map(h=>{const w=h.total_lec_hrs??h.lec_units??0,T=h.total_lab_hrs??h.lab_units??0,P=h.total_hrs??w+T;return{id:h.id,subject_code:h.subject_code,des_title:h.des_title,total_lec_hrs:w,total_lab_hrs:T,total_hrs:P,total_units:h.total_units??P}});y(m)}catch(n){console.error("Subject search failed:",n),B.error("Search failed"),y([])}finally{D(!1)}};c.useEffect(()=>{a&&g(2)},[a]),c.useEffect(()=>{const l=(n,i)=>{const{day:o,startTime:m,endTime:h}=p[n];if(!m||!h||!a||!o||i===0)return null;const w=L(m),T=L(h),P=i*60,Be=T-w;if(w>=T)return"End time must be after start time.";if(Be>P)return`Duration cannot exceed ${i} hour(s).`;const ye=q[o];return ye?.length?ye.some(we=>w>=L(we.start)&&T<=L(we.end))?null:"Time is outside faculty's availability.":"Faculty is not available on this day."};a&&ge({lec:l("lec",a.total_lec_hrs??0),lab:l("lab",a.total_lab_hrs??0)})},[p,a,q]);const se=c.useCallback(async l=>{const n=p[l];if(!n.day||!n.startTime||!n.endTime||I[l]){U(o=>({...o,[l]:[]}));return}A(o=>({...o,[l]:!0}));const i=localStorage.getItem("accessToken");if(!i){A(o=>({...o,[l]:!1}));return}try{const m=(await M.get("/rooms/availabilities",{headers:{Authorization:`Bearer ${i}`},params:{day:n.day,start_time:n.startTime,end_time:n.endTime,type:l==="lec"?"Lecture":"Laboratory"}})).data.rooms||[],h=await Promise.all(m.map(async w=>{try{const T=await M.get(`/rooms/${w.id}/availabilities`,{headers:{Authorization:`Bearer ${i}`}});return{...w,availabilities:T.data.availabilities||[]}}catch{return{...w,availabilities:[]}}}));U(w=>({...w,[l]:h}))}catch{B.error(`Failed to fetch available ${l} rooms.`),U(m=>({...m,[l]:[]}))}finally{A(o=>({...o,[l]:!1}))}},[p,I]),K=c.useMemo(()=>(a?.total_lec_hrs??0)>0?p.lec.day&&p.lec.startTime&&p.lec.endTime&&!I.lec:!0,[p.lec,I.lec,a]),X=c.useMemo(()=>(a?.total_lab_hrs??0)>0?p.lab.day&&p.lab.startTime&&p.lab.endTime&&!I.lab:!0,[p.lab,I.lab,a]);c.useEffect(()=>{K&&(a?.total_lec_hrs??0)>0&&se("lec")},[K,p.lec,a,se]),c.useEffect(()=>{X&&(a?.total_lab_hrs??0)>0&&se("lab")},[X,p.lab,a,se]),c.useEffect(()=>{a||g(1)},[a]);const ve=(l,n,i)=>{k(o=>({...o,[l]:{...o[l],[n]:i}})),C(o=>({...o,[l]:null}))},Ne=(l,n)=>{C(i=>({...i,[l]:n}))},Ie=async()=>{if(!a)return;if(G){B.error(`Assignment blocked: Potential load of ${pe} exceeds maximum allowed load of ${de} units.`);return}const l=[];if((a.total_lec_hrs??0)>0){const{day:n,startTime:i,endTime:o}=p.lec;if(!n||!i||!o||!j.lec){B.error("Incomplete lecture schedule or room selection.");return}l.push({type:"LEC",day:n,time:`${i}-${o}`,roomId:j.lec})}if((a.total_lab_hrs??0)>0){const{day:n,startTime:i,endTime:o}=p.lab;if(!n||!i||!o||!j.lab){B.error("Incomplete laboratory schedule or room selection.");return}l.push({type:"LAB",day:n,time:`${i}-${o}`,roomId:j.lab})}te(!0);try{for(const n of l){const[i,o]=n.time.split("-");for(const m of Le){if(!m.day||m.day.toString().toLowerCase()!==n.day.toString().toLowerCase())continue;const h=m.start_time??m.start??"",w=m.end_time??m.end??"";if(gt(i,o,h,w)){const T=`Conflict: Faculty is already assigned a class on ${n.day} from ${ne(h)} to ${ne(w)}. Assignment failed.`;B.error(T),te(!1);return}}}}catch(n){console.error("Conflict check failed",n)}try{const n=localStorage.getItem("accessToken"),i={facultyId:s.id,subjectId:a.id,schedules:l},o=await M.post("faculty-loading/assign",i,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});o.data.success&&(B.success(o.data.message||"Subject assigned successfully!"),f(s.id,a.id,l),d())}catch(n){console.error("Assignment Error:",n);const i=n.response?.data?.message||"Failed to assign subject. Please check conflicts.";B.error(i)}finally{te(!1)}},ae=(a?.total_lec_hrs??0)>0?!!j.lec:!0,re=(a?.total_lab_hrs??0)>0?!!j.lab:!0,Ee=!a||!K||!X||!ae||!re||ce||G||E,De=Object.values(q).some(l=>l.length>0);return e.jsx(Pe,{open:t,onOpenChange:d,children:e.jsxs(We,{className:"max-w-7xl w-[96%] h-[92vh] flex flex-col p-0",children:[e.jsxs(qe,{className:"p-6 pb-4 border-b bg-gradient-to-r from-indigo-50 to-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Ye,{className:"text-2xl font-bold tracking-tight",children:"Assign Subject"}),e.jsxs(Qe,{children:["Assign a subject to ",e.jsx("span",{className:"font-semibold text-foreground",children:s.name}),"."]})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{className:`h-6 px-2 rounded-full flex items-center gap-1 ${a?"bg-green-100 text-green-700":"bg-indigo-100 text-indigo-700"}`,children:[e.jsx("span",{className:"font-semibold",children:"1"}),e.jsx("span",{children:"Select"})]}),e.jsx(Ke,{className:"w-4 h-4"}),e.jsxs("div",{className:`h-6 px-2 rounded-full flex items-center gap-1 ${x>=2?ae&&re?"bg-green-100 text-green-700":"bg-indigo-100 text-indigo-700":"bg-muted text-muted-foreground"}`,children:[e.jsx("span",{className:"font-semibold",children:"2"}),e.jsx("span",{children:"Details"})]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-white border rounded-lg shadow-sm",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Faculty Load Status"}),E?e.jsxs("div",{className:"flex items-center gap-2 text-primary text-sm",children:[e.jsx(Y,{className:"h-4 w-4 animate-spin"})," Fetching Load..."]}):e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("p",{className:"font-medium",children:["Normal Load: ",e.jsxs("span",{className:"text-foreground font-bold",children:[s.t_load_units??0," units"]})]}),e.jsxs("p",{className:"font-medium",children:["Max Overload: ",e.jsxs("span",{className:"text-foreground font-bold",children:[s.overload_units??0," units"]})]}),e.jsxs("p",{className:"font-medium",children:["Total Max: ",e.jsxs("span",{className:"text-foreground font-bold",children:[de," units"]})]}),e.jsxs("p",{className:"col-span-3 text-sm pt-2 border-t mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Current Assigned:"}),e.jsxs("span",{className:"text-foreground font-bold ml-1",children:[_," units"]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-muted-foreground ml-2",children:["(Current + ",Fe," units)"]}),e.jsxs("span",{className:`font-bold ml-2 ${G?"text-destructive":"text-primary"}`,children:["â†’ Potential Total: ",pe," units"]})]})]})]}),G&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 p-2 bg-destructive/10 border-destructive/30 rounded-lg text-destructive text-sm",children:[e.jsx(he,{className:"h-4 w-4 flex-shrink-0"}),e.jsxs("p",{className:"font-medium",children:["Warning: This assignment will exceed the total allowed load of ",de," units. Please select another faculty or subject."]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 flex-grow overflow-y-auto px-6 py-6 bg-muted/30",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border shadow-sm flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`flex-shrink-0 h-8 w-8 rounded-full flex items-center justify-center font-bold text-lg transition-colors ${a?"bg-green-500 text-white":"bg-primary text-primary-foreground"}`,children:a?e.jsx(J,{className:"h-5 w-5"}):"1"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Select Subject"})]})}),e.jsxs("div",{className:"flex flex-col flex-grow",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(Ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:18}),e.jsx(le,{placeholder:"Search by code or title...",value:u,onChange:l=>b(l.target.value),onKeyDown:l=>l.key==="Enter"&&je(),className:"pl-10 bg-background"})]}),e.jsx(Q,{variant:"default",onClick:je,disabled:z||!u.trim(),children:z?e.jsx(Y,{className:"h-4 w-4 animate-spin"}):"Search"})]}),e.jsx("div",{className:"flex-grow overflow-y-auto space-y-2 -mr-2 pr-2",children:R.length>0?R.map(l=>e.jsxs("button",{onClick:()=>$(l),className:`w-full text-left p-3 rounded-md border transition-all duration-200 relative ${a?.id===l.id?"bg-primary/10 border-primary shadow-sm":"bg-background hover:border-primary/50 hover:bg-primary/5"}`,children:[a?.id===l.id&&e.jsx(Je,{className:"h-5 w-5 text-primary absolute top-3 right-3"}),e.jsx("p",{className:"font-semibold text-foreground pr-6 uppercase",children:l.subject_code}),e.jsx("p",{className:"text-sm text-muted-foreground truncate mb-2 uppercase",children:l.des_title}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsxs("span",{className:"bg-blue-50 text-blue-700 px-2 py-0.5 rounded",children:["Lec: ",l.total_lec_hrs??0]}),e.jsxs("span",{className:"bg-amber-50 text-amber-700 px-2 py-0.5 rounded",children:["Lab: ",l.total_lab_hrs??0]}),e.jsxs("span",{className:"bg-gray-100 text-gray-700 px-2 py-0.5 rounded",children:["Units: ",l.total_hrs??l.total_units??0]})]})]},l.id)):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-muted-foreground rounded-lg bg-background border-2 border-dashed p-4",children:[e.jsx(Y,{className:"h-8 w-8 mb-2"}),e.jsx("p",{className:"text-sm",children:z?"Searching...":u?"No subjects found.":"Enter a subject to search."})]})})]})]}),e.jsxs("div",{className:`bg-white p-4 rounded-xl border shadow-sm flex flex-col transition-all ${x<2&&"opacity-50 pointer-events-none"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:`flex-shrink-0 h-8 w-8 rounded-full flex items-center justify-center font-bold text-lg transition-colors ${x>=2&&K&&X?"bg-green-500 text-white":x>=2?"bg-primary text-primary-foreground":"bg-muted-foreground/30 text-muted-foreground"}`,children:x>=2&&K&&X?e.jsx(J,{className:"h-5 w-5"}):"2"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Set Schedule"})]}),x>=2&&e.jsx("div",{className:"flex-grow overflow-y-auto -mr-2 pr-2",children:Me?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(Y,{className:"h-8 w-8 animate-spin text-primary"})}):De?e.jsxs("div",{className:"space-y-4",children:[e.jsx(mt,{schedule:q}),(a?.total_lec_hrs??0)>0&&e.jsx(Ce,{type:"lec",hours:a?.total_lec_hrs??0,schedules:p,facultySchedule:q,onScheduleChange:ve,timeError:I.lec}),(a?.total_lab_hrs??0)>0&&e.jsx(Ce,{type:"lab",hours:a?.total_lab_hrs??0,schedules:p,facultySchedule:q,onScheduleChange:ve,timeError:I.lab})]}):e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-destructive/10 border-destructive/30 rounded-lg text-destructive",children:[e.jsx(Ze,{className:"h-5 w-5 flex-shrink-0"}),e.jsx("p",{className:"text-sm font-medium",children:"No faculty availability found."})]})})]}),e.jsxs("div",{className:`flex flex-col gap-4 h-full ${x<2&&"opacity-50 pointer-events-none"}`,children:[(a?.total_lec_hrs??0)>0&&e.jsxs("div",{className:"bg-white p-4 rounded-xl border shadow-sm flex flex-col flex-1 min-h-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`flex-shrink-0 h-8 w-8 rounded-full flex items-center justify-center font-bold text-lg transition-colors ${x>=3&&ae?"bg-green-500 text-white":x>=3?"bg-primary text-primary-foreground":"bg-muted-foreground/30 text-muted-foreground"}`,children:x>=3&&ae?e.jsx(J,{className:"h-5 w-5"}):"3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Lecture Room"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select room"})]})]}),x>=2&&e.jsx("div",{className:"flex-grow overflow-y-auto -mr-2 pr-2",children:e.jsx($e,{type:"lec",schedules:p,availableRooms:F,isLoadingRooms:W,selectedRooms:j,onSelectRoom:Ne})})]}),(a?.total_lab_hrs??0)>0&&e.jsxs("div",{className:"bg-white p-4 rounded-xl border shadow-sm flex flex-col flex-1 min-h-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`flex-shrink-0 h-8 w-8 rounded-full flex items-center justify-center font-bold text-lg transition-colors ${x>=3&&re?"bg-green-500 text-white":x>=3?"bg-primary text-primary-foreground":"bg-muted-foreground/30 text-muted-foreground"}`,children:x>=3&&re?e.jsx(J,{className:"h-5 w-5"}):"3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Laboratory Room"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select room"})]})]}),x>=2&&e.jsx("div",{className:"flex-grow overflow-y-auto -mr-2 pr-2",children:e.jsx($e,{type:"lab",schedules:p,availableRooms:F,isLoadingRooms:W,selectedRooms:j,onSelectRoom:Ne})})]}),(a?.total_lec_hrs??0)===0&&(a?.total_lab_hrs??0)===0&&e.jsx("div",{className:"bg-white p-4 rounded-xl border shadow-sm flex flex-col items-center justify-center h-full text-muted-foreground",children:e.jsx("p",{children:"Select a subject to view room options."})})]})]}),e.jsxs(He,{className:"p-6 pt-4 border-t bg-background",children:[e.jsx(Ge,{asChild:!0,children:e.jsx(Q,{variant:"outline",disabled:ce,children:"Cancel"})}),e.jsx(Q,{onClick:Ie,disabled:Ee,children:ce?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"})," Assigning..."]}):G?"Load Exceeded":"Assign Subject"})]})]})})}const Te=[{bg:"bg-blue-100",text:"text-blue-800"},{bg:"bg-emerald-100",text:"text-emerald-800"},{bg:"bg-amber-100",text:"text-amber-800"},{bg:"bg-rose-100",text:"text-rose-800"},{bg:"bg-indigo-100",text:"text-indigo-800"},{bg:"bg-cyan-100",text:"text-cyan-800"},{bg:"bg-pink-100",text:"text-pink-800"}];function pt(t){let d=0;const s=(t||"").toLowerCase();for(let f=0;f<s.length;f++)d=(d<<5)-d+s.charCodeAt(f),d|=0;const r=Math.abs(d)%Te.length;return Te[r]}function jt({data:t,onAssignClick:d,onViewSubjectsClick:s}){return t.length?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-2 gap-6",children:t.map(r=>{const f=r.profile_picture?r.profile_picture.startsWith("http")?r.profile_picture:`https://green-deer-882383.hostingersite.com/${r.profile_picture}`:null,g=r.overload_units>0?"overloaded":"ok",b={overloaded:{label:"Overload",icon:Se,text:"text-red-700",bg:"bg-red-50",ring:"ring-1 ring-red-200",dot:"bg-red-500"},ok:{label:"Teaching",icon:lt,text:"text-emerald-700",bg:"bg-emerald-50",ring:"ring-1 ring-emerald-200",dot:"bg-emerald-500"}}[g],a=b.icon;return e.jsxs("div",{className:`relative overflow-hidden rounded-2xl border bg-white p-5 shadow-sm transition-all duration-300 hover:shadow-lg hover:-translate-y-0.5 ${b.ring}`,children:[e.jsx("div",{className:"pointer-events-none absolute -right-16 -top-16 h-40 w-40 rounded-full bg-gradient-to-br from-primary/15 to-indigo-100 blur-2xl"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"relative",children:[f?e.jsx("img",{src:f,alt:r.name,className:"h-16 w-16 rounded-full object-cover border-4 border-white shadow-md ring-2 ring-primary/20"}):e.jsx("div",{className:"h-16 w-16 rounded-full bg-gradient-to-br from-indigo-500 to-violet-500 text-white grid place-items-center text-lg font-bold border-4 border-white shadow-md ring-2 ring-primary/20",children:e.jsx(Oe,{className:"w-7 h-7 opacity-90"})}),e.jsx("span",{className:`absolute -bottom-1 -right-1 h-3.5 w-3.5 rounded-full ring-2 ring-white ${b.dot}`})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"truncate text-lg font-bold text-foreground",children:r.name}),e.jsxs("div",{className:`ml-2 inline-flex items-center gap-1.5 rounded-full px-2 py-0.5 text-[11px] font-semibold ${b.bg} ${b.text}`,children:[e.jsx(a,{size:12}),e.jsx("span",{children:b.label})]})]}),e.jsx("div",{className:"mt-1",children:e.jsx(xe,{variant:"secondary",className:"text-[10px] px-2 py-0 font-normal text-muted-foreground border-slate-200",children:r.department})}),r.expertise?.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-1.5",children:r.expertise.slice(0,3).map(($,_)=>{const v=pt($);return e.jsx(xe,{className:`text-[10px] px-2 py-0.5 ${v.bg} hover:${v.bg} ${v.text} border-0`,children:$},`${$}-${_}`)})})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center p-3 rounded-xl bg-blue-50/50 border border-blue-100 text-center",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-blue-600 mb-1",children:[e.jsx(Re,{size:14}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wide",children:"Teaching"})]}),e.jsxs("div",{className:"mt-1",children:[e.jsx("span",{className:"text-2xl font-bold text-blue-900 leading-none",children:r.t_load_units||0}),e.jsx("span",{className:"block text-[10px] font-medium text-blue-600/70 mt-0.5",children:"Units"})]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center p-3 rounded-xl bg-amber-50/50 border border-amber-100 text-center",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-amber-600 mb-1",children:[e.jsx(at,{size:14}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wide",children:"Deload"})]}),e.jsxs("div",{className:"mt-1",children:[e.jsx("span",{className:"text-2xl font-bold text-amber-900 leading-none",children:r.deload_units||0}),e.jsx("span",{className:"block text-[10px] font-medium text-amber-600/70 mt-0.5",children:"Units"})]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center p-3 rounded-xl bg-red-50/50 border border-red-100 text-center",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-red-600 mb-1",children:[e.jsx(Se,{size:14}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wide",children:"Overload"})]}),e.jsxs("div",{className:"mt-1",children:[e.jsx("span",{className:"text-2xl font-bold text-red-900 leading-none",children:r.overload_units||0}),e.jsx("span",{className:"block text-[10px] font-medium text-red-600/70 mt-0.5",children:"Units"})]})]})]}),e.jsxs("div",{className:"mt-5 flex justify-end gap-2 border-t pt-4",children:[e.jsxs(Q,{size:"sm",onClick:()=>d(r),className:"shadow-sm h-8",children:[e.jsx(Xe,{className:"mr-2 h-3.5 w-3.5"})," Assign"]}),e.jsxs(Q,{size:"sm",variant:"outline",onClick:()=>s(r),className:"h-8",children:[e.jsx(Ue,{className:"mr-2 h-3.5 w-3.5"})," View Schedule"]})]})]},r.id)})}):e.jsx("div",{className:"flex items-center justify-center h-48 text-muted-foreground",children:"No faculty found."})}function vt(){const[t,d]=c.useState([]),[s,r]=c.useState([]),[f,x]=c.useState([]),[g,u]=c.useState(""),[b,a]=c.useState(!0),[$,_]=c.useState(!1),[v,E]=c.useState(null),[N,S]=c.useState(!1),[O,R]=c.useState(null);c.useEffect(()=>{(async()=>{a(!0);try{const j=localStorage.getItem("accessToken");if(!j){_e.fire({icon:"warning",title:"Authentication Error",text:"You must be logged in."}),a(!1);return}const C={headers:{Authorization:`Bearer ${j}`}},[F,U]=await Promise.all([M.get("/faculties",C),M.get("/get-subjects",C)]),W=F.data.faculties.map(A=>({id:A.id,name:A.user.name,department:A.department||"No Department",expertise:A.expertises?A.expertises.map(I=>I.list_of_expertise):[],profile_picture:A.profile_picture,t_load_units:A.t_load_units??0,deload_units:A.deload_units??0,overload_units:A.overload_units??0,availability:{},assignedSubjects:[]}));d(W),r(U.data.subject||[])}catch(j){console.error("Error fetching data:",j),_e.fire({icon:"error",title:"Fetch Error",text:"Failed to retrieve data from the server."})}finally{a(!1)}})()},[]);const y=t.filter(k=>k.name.toLowerCase().includes(g.toLowerCase())||k.expertise.some(j=>j.toLowerCase().includes(g.toLowerCase()))),z=k=>{const j=k.expertise.map(C=>(C||"").toLowerCase().trim()).filter(Boolean).flatMap(C=>C.split(/\s+|[,;/]+/).map(F=>F.trim())).filter(C=>C.length>2);if(!j.length)x([]);else{const C=s.filter(F=>{const U=`${F.des_title??""} ${F.subject_code??""} ${F.pre_requisite??""}`.toLowerCase();return j.some(W=>U.includes(W))});x(C)}E(k),_(!0)},D=()=>{_(!1),E(null),x([])},ee=k=>{R(k),S(!0)},H=()=>{S(!1),R(null)},p=(k,j,C)=>{console.log("Assigning Subject:",{facultyId:k,subjectId:j,schedules:C})};return e.jsxs(e.Fragment,{children:[e.jsxs(ze,{children:[$&&v&&e.jsx(bt,{isOpen:$,onClose:D,faculty:v,availableSubjects:f,onAssign:p}),N&&O&&e.jsx(Ve,{isOpen:N,onClose:H,faculty:O})]}),e.jsxs("header",{className:"mb-8 text-start",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground tracking-tight",children:"Faculty Loading"}),e.jsx("p",{className:"text-muted-foreground mt-3 ",children:"Assign subjects to faculty based on expertise and availability."})]}),e.jsxs("div",{className:"bg-card p-4 md:p-6 rounded-xl shadow-sm border border-border",children:[e.jsx("div",{className:"flex justify-start mb-8",children:e.jsxs("div",{className:"relative w-full md:max-w-lg",children:[e.jsx(Ae,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-muted-foreground",size:20}),e.jsx(le,{placeholder:"Search by faculty name or expertise...",value:g,onChange:k=>u(k.target.value),className:"pl-12 h-12 rounded-full text-base"})]})}),b?e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:Array.from({length:6}).map((k,j)=>e.jsx(ct,{},j))}):y.length>0?e.jsx(jt,{data:y,onAssignClick:z,onViewSubjectsClick:ee}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center text-muted-foreground bg-muted/50 rounded-lg border-2 border-dashed",children:[e.jsx(ot,{size:40,className:"mb-4 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-foreground",children:"No Faculty Found"}),e.jsxs("p",{children:['Your search for "',g,'" did not match any faculty profiles.']})]})]})]})}function Vt(){return e.jsx("main",{children:e.jsx(vt,{})})}export{Vt as default};
