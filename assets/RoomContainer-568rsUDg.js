import{c as ke,h as Pe,r as o,j as e,w as De,P as B,q as Le,s as Oe,x as dt,y as Ne,i as je,B as M,T as ut,n as Q,o as X,p as Z,t as T,a as L}from"./index-BmRH5HVe.js";import{e as mt,f as $e,S as H,a as q,b as K,c as Y,d as U}from"./select-DlgOzp9D.js";import{T as ge,a as be,b as O,c as _,d as ve,e as I}from"./table-B6Y8HKUQ.js";import{I as W}from"./input-6nGrx8wH.js";import{B as ht}from"./badge-Bapalvis.js";import{D as se,a as re,b as ne,c as ae,e as oe,f as ie,S as D,d as Ve,L as Se}from"./dialog-MfKDcEq7.js";import{S as xt}from"./search-DrBLcFK_.js";import{F as ft,C as pt,a as jt}from"./funnel-cs1ojnsm.js";import{E as gt}from"./eye-DdsnQjpg.js";import{S as bt}from"./square-pen-CG24t8mN.js";import{T as ze,P as vt}from"./trash-2-BK-56ARM.js";import{C as we,a as Te,c as Ce,d as yt,b as Ie}from"./card-DMhHQG86.js";import{L as $}from"./label-CTkcG2QO.js";import{C as Nt}from"./circle-plus-tTcCrvNF.js";import"./Combination-BtY-t67S.js";import"./check-B640tUrU.js";import"./chevron-up-C1SLqss-.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=[["path",{d:"M16 19h6",key:"xwg31i"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M19 16v6",key:"tddt3s"}],["path",{d:"M21 12.598V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8.5",key:"1glfrc"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}]],wt=ke("calendar-plus",St);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=[["path",{d:"M6 10H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-2",key:"4b9dqc"}],["path",{d:"M6 14H4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-2",key:"22nnkd"}],["path",{d:"M6 6h.01",key:"1utrut"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"m13 6-4 6h6l-4 6",key:"14hqih"}]],Ct=ke("server-crash",Tt);function de(t,s,{checkForDefaultPrevented:n=!0}={}){return function(i){if(t?.(i),n===!1||!i.defaultPrevented)return s?.(i)}}function G(t,s,{checkForDefaultPrevented:n=!0}={}){return function(i){if(t?.(i),n===!1||!i.defaultPrevented)return s?.(i)}}var ue="rovingFocusGroup.onEntryFocus",It={bubbles:!1,cancelable:!0},J="RovingFocusGroup",[xe,Ge,At]=mt(J),[Rt,Ue]=Pe(J,[At]),[Mt,Ft]=Rt(J),Be=o.forwardRef((t,s)=>e.jsx(xe.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(xe.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(Et,{...t,ref:s})})}));Be.displayName=J;var Et=o.forwardRef((t,s)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:i=!1,dir:d,currentTabStopId:l,defaultCurrentTabStopId:f,onCurrentTabStopIdChange:p,onEntryFocus:h,preventScrollOnEntryFocus:c=!1,...m}=t,g=o.useRef(null),b=Le(s,g),A=$e(d),[j,a]=Oe({prop:l,defaultProp:f??null,onChange:p,caller:J}),[v,S]=o.useState(!1),C=dt(h),y=Ge(n),N=o.useRef(!1),[w,x]=o.useState(0);return o.useEffect(()=>{const u=g.current;if(u)return u.addEventListener(ue,C),()=>u.removeEventListener(ue,C)},[C]),e.jsx(Mt,{scope:n,orientation:r,dir:A,loop:i,currentTabStopId:j,onItemFocus:o.useCallback(u=>a(u),[a]),onItemShiftTab:o.useCallback(()=>S(!0),[]),onFocusableItemAdd:o.useCallback(()=>x(u=>u+1),[]),onFocusableItemRemove:o.useCallback(()=>x(u=>u-1),[]),children:e.jsx(B.div,{tabIndex:v||w===0?-1:0,"data-orientation":r,...m,ref:b,style:{outline:"none",...t.style},onMouseDown:G(t.onMouseDown,()=>{N.current=!0}),onFocus:G(t.onFocus,u=>{const R=!N.current;if(u.target===u.currentTarget&&R&&!v){const F=new CustomEvent(ue,It);if(u.currentTarget.dispatchEvent(F),!F.defaultPrevented){const E=y().filter(P=>P.focusable),k=E.find(P=>P.active),V=E.find(P=>P.id===j),ce=[k,V,...E].filter(Boolean).map(P=>P.ref.current);Ke(ce,c)}}N.current=!1}),onBlur:G(t.onBlur,()=>S(!1))})})}),He="RovingFocusGroupItem",qe=o.forwardRef((t,s)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:i=!1,tabStopId:d,children:l,...f}=t,p=De(),h=d||p,c=Ft(He,n),m=c.currentTabStopId===h,g=Ge(n),{onFocusableItemAdd:b,onFocusableItemRemove:A,currentTabStopId:j}=c;return o.useEffect(()=>{if(r)return b(),()=>A()},[r,b,A]),e.jsx(xe.ItemSlot,{scope:n,id:h,focusable:r,active:i,children:e.jsx(B.span,{tabIndex:m?0:-1,"data-orientation":c.orientation,...f,ref:s,onMouseDown:G(t.onMouseDown,a=>{r?c.onItemFocus(h):a.preventDefault()}),onFocus:G(t.onFocus,()=>c.onItemFocus(h)),onKeyDown:G(t.onKeyDown,a=>{if(a.key==="Tab"&&a.shiftKey){c.onItemShiftTab();return}if(a.target!==a.currentTarget)return;const v=Pt(a,c.orientation,c.dir);if(v!==void 0){if(a.metaKey||a.ctrlKey||a.altKey||a.shiftKey)return;a.preventDefault();let C=g().filter(y=>y.focusable).map(y=>y.ref.current);if(v==="last")C.reverse();else if(v==="prev"||v==="next"){v==="prev"&&C.reverse();const y=C.indexOf(a.currentTarget);C=c.loop?Dt(C,y+1):C.slice(y+1)}setTimeout(()=>Ke(C))}}),children:typeof l=="function"?l({isCurrentTabStop:m,hasTabStop:j!=null}):l})})});qe.displayName=He;var _t={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function kt(t,s){return s!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function Pt(t,s,n){const r=kt(t.key,n);if(!(s==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(s==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return _t[r]}function Ke(t,s=!1){const n=document.activeElement;for(const r of t)if(r===n||(r.focus({preventScroll:s}),document.activeElement!==n))return}function Dt(t,s){return t.map((n,r)=>t[(s+r)%t.length])}var Lt=Be,Ot=qe;function $t(t,s){return o.useReducer((n,r)=>s[n][r]??n,t)}var Ye=t=>{const{present:s,children:n}=t,r=Vt(s),i=typeof n=="function"?n({present:r.isPresent}):o.Children.only(n),d=Le(r.ref,zt(i));return typeof n=="function"||r.isPresent?o.cloneElement(i,{ref:d}):null};Ye.displayName="Presence";function Vt(t){const[s,n]=o.useState(),r=o.useRef(null),i=o.useRef(t),d=o.useRef("none"),l=t?"mounted":"unmounted",[f,p]=$t(l,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return o.useEffect(()=>{const h=ee(r.current);d.current=f==="mounted"?h:"none"},[f]),Ne(()=>{const h=r.current,c=i.current;if(c!==t){const g=d.current,b=ee(h);t?p("MOUNT"):b==="none"||h?.display==="none"?p("UNMOUNT"):p(c&&g!==b?"ANIMATION_OUT":"UNMOUNT"),i.current=t}},[t,p]),Ne(()=>{if(s){let h;const c=s.ownerDocument.defaultView??window,m=b=>{const j=ee(r.current).includes(CSS.escape(b.animationName));if(b.target===s&&j&&(p("ANIMATION_END"),!i.current)){const a=s.style.animationFillMode;s.style.animationFillMode="forwards",h=c.setTimeout(()=>{s.style.animationFillMode==="forwards"&&(s.style.animationFillMode=a)})}},g=b=>{b.target===s&&(d.current=ee(r.current))};return s.addEventListener("animationstart",g),s.addEventListener("animationcancel",m),s.addEventListener("animationend",m),()=>{c.clearTimeout(h),s.removeEventListener("animationstart",g),s.removeEventListener("animationcancel",m),s.removeEventListener("animationend",m)}}else p("ANIMATION_END")},[s,p]),{isPresent:["mounted","unmountSuspended"].includes(f),ref:o.useCallback(h=>{r.current=h?getComputedStyle(h):null,n(h)},[])}}function ee(t){return t?.animationName||"none"}function zt(t){let s=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=s&&"isReactWarning"in s&&s.isReactWarning;return n?t.ref:(s=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=s&&"isReactWarning"in s&&s.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var le="Tabs",[Gt,js]=Pe(le,[Ue]),We=Ue(),[Ut,ye]=Gt(le),Je=o.forwardRef((t,s)=>{const{__scopeTabs:n,value:r,onValueChange:i,defaultValue:d,orientation:l="horizontal",dir:f,activationMode:p="automatic",...h}=t,c=$e(f),[m,g]=Oe({prop:r,onChange:i,defaultProp:d??"",caller:le});return e.jsx(Ut,{scope:n,baseId:De(),value:m,onValueChange:g,orientation:l,dir:c,activationMode:p,children:e.jsx(B.div,{dir:c,"data-orientation":l,...h,ref:s})})});Je.displayName=le;var Qe="TabsList",Xe=o.forwardRef((t,s)=>{const{__scopeTabs:n,loop:r=!0,...i}=t,d=ye(Qe,n),l=We(n);return e.jsx(Lt,{asChild:!0,...l,orientation:d.orientation,dir:d.dir,loop:r,children:e.jsx(B.div,{role:"tablist","aria-orientation":d.orientation,...i,ref:s})})});Xe.displayName=Qe;var Ze="TabsTrigger",et=o.forwardRef((t,s)=>{const{__scopeTabs:n,value:r,disabled:i=!1,...d}=t,l=ye(Ze,n),f=We(n),p=rt(l.baseId,r),h=nt(l.baseId,r),c=r===l.value;return e.jsx(Ot,{asChild:!0,...f,focusable:!i,active:c,children:e.jsx(B.button,{type:"button",role:"tab","aria-selected":c,"aria-controls":h,"data-state":c?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:p,...d,ref:s,onMouseDown:de(t.onMouseDown,m=>{!i&&m.button===0&&m.ctrlKey===!1?l.onValueChange(r):m.preventDefault()}),onKeyDown:de(t.onKeyDown,m=>{[" ","Enter"].includes(m.key)&&l.onValueChange(r)}),onFocus:de(t.onFocus,()=>{const m=l.activationMode!=="manual";!c&&!i&&m&&l.onValueChange(r)})})})});et.displayName=Ze;var tt="TabsContent",st=o.forwardRef((t,s)=>{const{__scopeTabs:n,value:r,forceMount:i,children:d,...l}=t,f=ye(tt,n),p=rt(f.baseId,r),h=nt(f.baseId,r),c=r===f.value,m=o.useRef(c);return o.useEffect(()=>{const g=requestAnimationFrame(()=>m.current=!1);return()=>cancelAnimationFrame(g)},[]),e.jsx(Ye,{present:i||c,children:({present:g})=>e.jsx(B.div,{"data-state":c?"active":"inactive","data-orientation":f.orientation,role:"tabpanel","aria-labelledby":p,hidden:!g,id:h,tabIndex:0,...l,ref:s,style:{...t.style,animationDuration:m.current?"0s":void 0},children:g&&d})})});st.displayName=tt;function rt(t,s){return`${t}-trigger-${s}`}function nt(t,s){return`${t}-content-${s}`}var Bt=Je,at=Xe,ot=et,it=st;const Ht=Bt,lt=o.forwardRef(({className:t,...s},n)=>e.jsx(at,{ref:n,className:je("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",t),...s}));lt.displayName=at.displayName;const fe=o.forwardRef(({className:t,...s},n)=>e.jsx(ot,{ref:n,className:je("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",t),...s}));fe.displayName=ot.displayName;const pe=o.forwardRef(({className:t,...s},n)=>e.jsx(it,{ref:n,className:je("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s}));pe.displayName=it.displayName;function qt({isOpen:t,onClose:s,room:n,scheduleData:r,subjectsData:i}){if(!n)return null;const d=r.filter(l=>l.roomId===n.id);return e.jsx(se,{open:t,onOpenChange:s,children:e.jsxs(re,{className:"max-w-2xl",children:[e.jsx(ne,{children:e.jsxs(ae,{className:"text-2xl font-bold",children:["Schedule for Room: ",n.roomNumber]})}),e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"rounded-lg border",children:e.jsxs(ge,{children:[e.jsx(be,{children:e.jsxs(O,{children:[e.jsx(_,{children:"Subject"}),e.jsx(_,{children:"Day"}),e.jsx(_,{children:"Time"})]})}),e.jsx(ve,{children:d.length>0?d.map(l=>{const f=i.find(p=>p.id===l.subjectId);return e.jsxs(O,{children:[e.jsx(I,{children:f?`${f.code} - ${f.name}`:"Unknown Subject"}),e.jsx(I,{children:l.day}),e.jsxs(I,{children:[l.startTime," - ",l.endTime]})]},l.scheduleId)}):e.jsx(O,{children:e.jsx(I,{colSpan:3,className:"text-center h-24",children:"No classes scheduled for this room."})})})]})})}),e.jsx(oe,{className:"pt-4",children:e.jsx(ie,{asChild:!0,children:e.jsx(M,{type:"button",variant:"outline",children:"Close"})})})]})})}const Kt=(t,s)=>new Set(s.filter(r=>r.roomId===t).map(r=>r.subjectId)).size,Yt=()=>e.jsxs(O,{children:[e.jsx(I,{children:e.jsx(D,{className:"h-5 w-28"})}),e.jsx(I,{children:e.jsx(D,{className:"h-5 w-24"})}),e.jsx(I,{className:"text-center",children:e.jsx(D,{className:"h-5 w-10 mx-auto"})}),e.jsx(I,{children:e.jsx(D,{className:"h-5 w-10"})}),e.jsx(I,{children:e.jsx(D,{className:"h-6 w-20"})}),e.jsx(I,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(D,{className:"h-8 w-8 rounded-md"}),e.jsx(D,{className:"h-8 w-8 rounded-md"}),e.jsx(D,{className:"h-8 w-8 rounded-md"}),e.jsx(D,{className:"h-8 w-8 rounded-md"})]})})]});function Wt({roomsData:t,scheduleData:s,subjectsData:n,onEdit:r,onDelete:i,onManageAvailability:d,isLoading:l}){const[f,p]=o.useState(""),[h,c]=o.useState({type:"All"}),[m,g]=o.useState(1),[b]=o.useState(10),[A,j]=o.useState(!1),[a,v]=o.useState(null),S=o.useMemo(()=>t.filter(x=>x.roomNumber.toLowerCase().includes(f.toLowerCase())).filter(x=>h.type==="All"||x.type===h.type),[t,f,h]),C=o.useMemo(()=>{const x=(m-1)*b;return S.slice(x,x+b)},[S,m,b]),y=Math.ceil(S.length/b),N=x=>{v(x),j(!0)},w=["All","Lecture","Laboratory"];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-card p-4 md:p-6 rounded-lg shadow-sm border border-border",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-center mb-6",children:[e.jsxs("div",{className:"relative w-full md:max-w-xs",children:[e.jsx(xt,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:20}),e.jsx(W,{placeholder:"Search by room...",className:"pl-10 w-full",value:f,onChange:x=>{p(x.target.value),g(1)}})]}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center gap-3 w-full md:w-auto",children:e.jsxs(H,{value:h.type,onValueChange:x=>{c({type:x}),g(1)},children:[e.jsxs(q,{className:"w-full sm:w-auto md:w-[180px]",children:[e.jsx(ft,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsx(K,{placeholder:"All Types"})]}),e.jsx(Y,{children:w.map(x=>e.jsx(U,{value:x,children:x},x))})]})})]}),e.jsx("div",{className:"rounded-lg border border-border overflow-x-auto",children:e.jsxs(ge,{className:"min-w-[600px]",children:[e.jsx(be,{className:"bg-muted/50",children:e.jsxs(O,{children:[e.jsx(_,{children:"Room"}),e.jsx(_,{children:"Type"}),e.jsx(_,{className:"text-center",children:"Capacity"}),e.jsx(_,{children:"Total Subjects"}),e.jsx(_,{children:"Status"}),e.jsx(_,{className:"text-right",children:"Actions"})]})}),e.jsx(ve,{children:l?Array.from({length:b}).map((x,u)=>e.jsx(Yt,{},u)):C.length===0?e.jsx(O,{children:e.jsx(I,{colSpan:6,className:"text-center h-48 text-muted-foreground",children:"No rooms found."})}):C.map(x=>{const u=Kt(x.id,s),R=x.status===0;return e.jsxs(O,{className:"hover:bg-muted",children:[e.jsx(I,{children:e.jsx("p",{className:"font-semibold text-foreground",children:x.roomNumber})}),e.jsx(I,{className:"text-muted-foreground",children:x.type}),e.jsx(I,{className:"text-center text-muted-foreground",children:x.capacity??"--"}),e.jsx(I,{className:"text-muted-foreground",children:u}),e.jsx(I,{children:e.jsx(ht,{variant:R?"default":"destructive",children:R?"Active":"Inactive"})}),e.jsx(I,{className:"text-right",children:e.jsx(ut,{delayDuration:100,children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsxs(Q,{children:[e.jsx(X,{asChild:!0,children:e.jsx(M,{variant:"ghost",className:"text-purple-500 hover:text-purple-500",size:"icon",onClick:()=>d(x),children:e.jsx(wt,{className:"h-4 w-4"})})}),e.jsx(Z,{children:e.jsx("p",{children:"Manage Availability"})})]}),e.jsxs(Q,{children:[e.jsx(X,{asChild:!0,children:e.jsx(M,{variant:"ghost",className:"text-blue-500 hover:text-blue-500",size:"icon",onClick:()=>N(x),children:e.jsx(gt,{className:"h-4 w-4"})})}),e.jsx(Z,{children:e.jsx("p",{children:"View Schedule"})})]}),e.jsxs(Q,{children:[e.jsx(X,{asChild:!0,children:e.jsx(M,{variant:"ghost",className:"text-green-500 hover:text-green-500",size:"icon",onClick:()=>r(x),children:e.jsx(bt,{className:"h-4 w-4"})})}),e.jsx(Z,{children:e.jsx("p",{children:"Edit Room Details"})})]}),e.jsxs(Q,{children:[e.jsx(X,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"icon",onClick:()=>i(x.id),className:"text-destructive hover:text-destructive/90",children:e.jsx(ze,{className:"h-4 w-4"})})}),e.jsx(Z,{children:e.jsx("p",{children:"Delete Room"})})]})]})})})]},x.id)})})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mt-6 text-sm gap-4",children:[e.jsxs("p",{className:"text-muted-foreground",children:["Showing ",e.jsx("strong",{children:C.length>0?(m-1)*b+1:0})," to ",e.jsx("strong",{children:Math.min(m*b,S.length)})," of ",e.jsx("strong",{children:S.length})," entries"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>g(x=>Math.max(1,x-1)),disabled:m===1,children:[e.jsx(pt,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsxs("span",{className:"font-medium text-foreground px-2",children:["Page ",m," of ",y||1]}),e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>g(x=>Math.min(y,x+1)),disabled:m>=y,children:["Next",e.jsx(jt,{className:"h-4 w-4 ml-1"})]})]})]})]}),e.jsx(qt,{isOpen:A,onClose:()=>j(!1),room:a,scheduleData:s,subjectsData:n})]})}const Ae=["Mon","Tues","Wed","Thurs","Fri","Sat"],te=7,ct=18,me=ct-te,Re=[{bg:"bg-blue-100",border:"border-blue-400",text:"text-blue-800"},{bg:"bg-green-100",border:"border-green-400",text:"text-green-800"},{bg:"bg-purple-100",border:"border-purple-400",text:"text-purple-800"},{bg:"bg-orange-100",border:"border-orange-400",text:"text-orange-800"},{bg:"bg-red-100",border:"border-red-400",text:"text-red-800"},{bg:"bg-yellow-100",border:"border-yellow-400",text:"text-yellow-800"},{bg:"bg-indigo-100",border:"border-indigo-400",text:"text-indigo-800"},{bg:"bg-pink-100",border:"border-pink-400",text:"text-pink-800"}],Jt=t=>Re[t%Re.length],Me=t=>{const[s,n]=t.split(":");let r=parseInt(s,10);const i=parseInt(n,10),d=r>=12?"PM":"AM";r=r%12||12;const l=i<10?`0${i}`:i;return`${r}:${l} ${d}`},Fe=t=>{const[s,n]=t.split(":").map(Number);return s*60+n},Qt=({scheduleData:t,subjectsData:s,roomsData:n})=>{const[r,i]=o.useState(null),[d,l]=o.useState(null),[f,p]=o.useState(!1),h=()=>{r!==null&&d!==null&&p(!0)},c=()=>{i(null),l(null),p(!1)},m=a=>{i(parseInt(a,10)),l(null),p(!1)},g=a=>{l(a),p(!1)},b=o.useMemo(()=>[...new Set(s.map(a=>a.yearLevel))].sort((a,v)=>a-v),[s]),A=o.useMemo(()=>{if(r===null)return[];const a=s.filter(S=>S.yearLevel===r).map(S=>S.id),v=t.filter(S=>a.includes(S.subjectId));return[...new Set(v.map(S=>S.section))].sort()},[r,t,s]),j=()=>{if(!f||r===null||d===null)return null;const a=s.filter(y=>y.yearLevel===r).map(y=>y.id),v=t.filter(y=>a.includes(y.subjectId)&&y.section===d);if(v.length===0)return e.jsx("div",{className:"text-center text-muted-foreground p-12 mt-8 border-2 border-dashed rounded-lg",children:"No schedule data available for this section."});const S=(ct-te)*60,C=r===1?"st":r===2?"nd":r===3?"rd":"th";return e.jsx("div",{className:"space-y-8 mt-8",children:e.jsxs(we,{className:"overflow-hidden",children:[e.jsx(Te,{children:e.jsx(Ce,{children:`${r}${C} Year - Section ${d}`})}),e.jsx(Ie,{className:"p-0",children:e.jsx("div",{className:"border border-border rounded-lg overflow-hidden",children:e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"w-20 flex-shrink-0 relative bg-slate-50 dark:bg-slate-800/50",children:[e.jsx("div",{className:"h-12 border-b border-border"})," ",Array.from({length:me}).map((y,N)=>e.jsx("div",{className:"h-16 border-b border-border"},N)),Array.from({length:me+1}).map((y,N)=>{const w=te+N,x=w>12?w-12:w===0?12:w,u=w>=12?"PM":"AM";return e.jsx("div",{className:"absolute right-3",style:{top:`calc(3rem + ${N*4}rem)`},children:e.jsxs("span",{className:"text-[11px] text-muted-foreground -translate-y-1/2",children:[x,":00 ",u]})},w)})]}),e.jsxs("div",{className:"flex-1 grid grid-cols-6",children:[Ae.map(y=>e.jsx("div",{className:"h-12 text-center font-medium text-sm text-foreground border-b border-border flex items-center justify-center bg-slate-50 dark:bg-slate-800/50 border-l",children:y},y)),Ae.map(y=>e.jsxs("div",{className:"relative border-l border-border bg-background",children:[Array.from({length:me}).map((N,w)=>e.jsx("div",{className:"h-16 border-b border-border"},w)),v.filter(N=>N.day===y).map(N=>{const w=s.find(z=>z.id===N.subjectId),x=n.find(z=>z.id===N.roomId);if(!w)return null;const u=Fe(N.startTime),F=Fe(N.endTime)-u,E=(u-te*60)/S*100,k=F/S*100,V=Jt(w.id);return e.jsx("div",{className:"absolute w-full px-1",style:{top:`${E}%`,height:`${k}%`},children:e.jsxs("div",{className:`rounded-lg p-2 h-full flex flex-col overflow-hidden ${V.bg} ${V.border} ${V.text} border-l-4 shadow transition-all duration-200 ease-in-out transform hover:scale-[1.02] hover:shadow-lg hover:z-10`,children:[e.jsx("p",{className:"font-bold text-xs leading-tight truncate",children:w.code}),e.jsx("p",{className:"text-[11px] opacity-80 leading-tight flex-1 truncate",children:w.name}),e.jsxs("div",{className:"mt-1 text-[10px] opacity-90",children:[e.jsx("p",{className:"truncate",children:x?.roomNumber||"N/A"}),e.jsxs("p",{children:[Me(N.startTime)," - ",Me(N.endTime)]})]})]})},N.scheduleId)})]},y))]})]})})})]})})};return e.jsxs("div",{children:[e.jsxs(we,{className:"w-full mx-auto",children:[e.jsxs(Te,{children:[e.jsx(Ce,{children:"Generate Section Schedule"}),e.jsx(yt,{children:"Select a year and section to view the weekly class schedule."})]}),e.jsx(Ie,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"year-level",children:"Select Year Level"}),e.jsxs(H,{onValueChange:m,value:r?.toString()??"",children:[e.jsx(q,{id:"year-level",children:e.jsx(K,{placeholder:"Select a year..."})}),e.jsx(Y,{children:b.map(a=>e.jsxs(U,{value:a.toString(),children:[a,a===1?"st":a===2?"nd":a===3?"rd":"th"," Year"]},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"section",children:"Select Section"}),e.jsxs(H,{onValueChange:g,value:d??"",disabled:r===null,children:[e.jsx(q,{id:"section",children:e.jsx(K,{placeholder:"Select a section..."})}),e.jsx(Y,{children:A.map(a=>e.jsxs(U,{value:a,children:["Section ",a]},a))})]})]}),e.jsx(M,{onClick:h,className:"w-full",disabled:r===null||d===null,children:"Generate Schedule"}),e.jsx(M,{onClick:c,variant:"destructive",className:"w-full",disabled:r===null&&d===null,children:"Clear"})]})})]}),f?j():e.jsx("div",{className:"mt-8 flex items-center justify-center text-center text-muted-foreground p-12 border-2 border-dashed rounded-lg",children:e.jsx("p",{children:'Please select a year level and section, then click "Generate Schedule" to view the timetable.'})})]})};function Xt({isOpen:t,onClose:s,onSave:n,initialData:r}){const i={roomNumber:"",type:"Lecture",capacity:40},[d,l]=o.useState(i),[f,p]=o.useState(!1);o.useEffect(()=>{t&&l(r?{roomNumber:r.roomNumber,type:r.type,capacity:r.capacity}:i)},[r,t]);const h=async g=>{g.preventDefault(),p(!0);try{await n(d)}finally{p(!1)}},c=g=>{const{name:b,value:A}=g.target;l(j=>({...j,[b]:b==="capacity"?A===""?null:Number(A):A}))},m=g=>{l(b=>({...b,type:g}))};return e.jsx(se,{open:t,onOpenChange:s,children:e.jsxs(re,{className:"sm:max-w-[425px]",children:[e.jsx(ne,{children:e.jsx(ae,{className:"text-xl font-bold",children:r?"Edit Room":"Add New Room"})}),e.jsxs("form",{onSubmit:h,className:"py-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"roomNumber",className:"text-right",children:"Room Number / Name"}),e.jsx(W,{id:"roomNumber",name:"roomNumber",value:d.roomNumber,onChange:c,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"type",children:"Type"}),e.jsxs(H,{value:d.type,onValueChange:m,children:[e.jsx(q,{id:"type",children:e.jsx(K,{})}),e.jsxs(Y,{children:[e.jsx(U,{value:"Lecture",children:"Lecture"}),e.jsx(U,{value:"Laboratory",children:"Laboratory"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs($,{htmlFor:"capacity",children:["Capacity ",e.jsx("span",{className:"text-muted-foreground text-xs",children:"(Optional)"})]}),e.jsx(W,{id:"capacity",name:"capacity",type:"number",min:"1",value:d.capacity??"",onChange:c})]})]}),e.jsxs(oe,{className:"pt-4",children:[e.jsx(ie,{asChild:!0,children:e.jsx(M,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(M,{type:"submit",disabled:f,children:f?"Saving...":"Save Room"})]})]})]})})}const he=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Ee=t=>{if(!t)return"";const[s,n]=t.split(":"),r=parseInt(s,10),i=r>=12?"PM":"AM",d=r%12||12;return`${String(d).padStart(2,"0")}:${n} ${i}`};function Zt({isOpen:t,onClose:s,room:n}){const[r,i]=o.useState([]),[d,l]=o.useState(!0),[f,p]=o.useState(!1),h={day:"Monday",start_time:"07:00",end_time:"12:00"},[c,m]=o.useState(h);o.useEffect(()=>{(async()=>{if(t&&n){l(!0);try{const a=localStorage.getItem("accessToken");if(!a){T.error("Authentication required.");return}const v=await L.get(`/rooms/${n.id}/availabilities`,{headers:{Authorization:`Bearer ${a}`}});i(v.data.availabilities||[])}catch(a){T.error("Failed to fetch availability."),console.error("Fetch availability error:",a)}finally{l(!1)}}})()},[t,n]);const g=(j,a)=>{m(v=>({...v,[j]:a}))},b=async j=>{if(j.preventDefault(),!!n){if(c.start_time>=c.end_time){T.error("End time must be after start time.");return}p(!0);try{const a=localStorage.getItem("accessToken"),v={availabilities:[{...c,start_time:`${c.start_time}:00`,end_time:`${c.end_time}:00`}]},C=(await L.post(`/rooms/${n.id}/availabilities`,v,{headers:{Authorization:`Bearer ${a}`}})).data.availabilities;i(y=>[...y,...C].sort((N,w)=>he.indexOf(N.day)-he.indexOf(w.day)||N.start_time.localeCompare(w.start_time))),m(h),T.success("New availability slot added!")}catch(a){if(a.response?.status===422){const v=a.response.data.errors;v&&v["availabilities.0.day"]?T.error(v["availabilities.0.day"][0]):T.error("Invalid data provided. Please check the time format and day.")}else T.error("Failed to add new slot. Please try again."),console.error("Add slot error:",a)}finally{p(!1)}}},A=async j=>{p(!0);try{const a=localStorage.getItem("accessToken");await L.delete(`/availabilities/${j}`,{headers:{Authorization:`Bearer ${a}`}}),i(v=>v.filter(S=>S.id!==j)),T.success("Availability slot deleted.")}catch{T.error("Failed to delete slot.")}finally{p(!1)}};return e.jsx(se,{open:t,onOpenChange:s,children:e.jsxs(re,{className:"sm:max-w-2xl",children:[e.jsxs(ne,{children:[e.jsxs(ae,{children:["Manage Availability for ",n?.roomNumber]}),e.jsx(Ve,{children:"View, add, or delete the available time slots for this room."})]}),e.jsxs("div",{className:"py-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Existing Slots"}),e.jsx("div",{className:"border rounded-lg max-h-64 overflow-y-auto",children:d?e.jsxs("div",{className:"flex items-center justify-center h-24 text-muted-foreground",children:[e.jsx(Se,{className:"mr-2 h-4 w-4 animate-spin"}),"Fetching data..."]}):r.length>0?e.jsxs(ge,{children:[e.jsx(be,{children:e.jsxs(O,{children:[e.jsx(_,{children:"Day"}),e.jsx(_,{children:"Start Time"}),e.jsx(_,{children:"End Time"}),e.jsx(_,{className:"text-right",children:"Action"})]})}),e.jsx(ve,{children:r.map(j=>e.jsxs(O,{children:[e.jsx(I,{children:j.day}),e.jsx(I,{children:Ee(j.start_time)}),e.jsx(I,{children:Ee(j.end_time)}),e.jsx(I,{className:"text-right",children:e.jsx(M,{variant:"ghost",size:"icon",onClick:()=>A(j.id),disabled:f,children:e.jsx(ze,{className:"h-4 w-4 text-destructive"})})})]},j.id))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-24 text-muted-foreground",children:[e.jsx(Ct,{className:"h-6 w-6 mb-2"}),e.jsx("p",{children:"No availability slots found for this room."})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Add New Slot"}),e.jsxs("form",{onSubmit:b,className:"grid grid-cols-1 sm:grid-cols-4 gap-3 items-end p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx($,{htmlFor:"day",children:"Day"}),e.jsxs(H,{value:c.day,onValueChange:j=>g("day",j),children:[e.jsx(q,{id:"day",children:e.jsx(K,{})}),e.jsx(Y,{children:he.map(j=>e.jsx(U,{value:j,children:j},j))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx($,{htmlFor:"start_time",children:"Start Time"}),e.jsx(W,{id:"start_time",type:"time",value:c.start_time,onChange:j=>g("start_time",j.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx($,{htmlFor:"end_time",children:"End Time"}),e.jsx(W,{id:"end_time",type:"time",value:c.end_time,onChange:j=>g("end_time",j.target.value),required:!0})]}),e.jsxs(M,{type:"submit",disabled:f,children:[f?e.jsx(Se,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Nt,{className:"mr-2 h-4 w-4"}),"Add Slot"]})]})]})]}),e.jsx(oe,{children:e.jsx(ie,{asChild:!0,children:e.jsx(M,{type:"button",variant:"outline",children:"Close"})})})]})})}const _e=[{scheduleId:1,roomId:1,subjectId:7,section:"A",day:"Mon",startTime:"09:00",endTime:"10:30"}];function gs(){const[t,s]=o.useState([]),[n,r]=o.useState([]),[i,d]=o.useState(!0),[l,f]=o.useState(!1),[p,h]=o.useState(null),[c,m]=o.useState({open:!1,roomId:null}),[g,b]=o.useState(!1),[A,j]=o.useState(null),a=o.useCallback(async()=>{try{const u=localStorage.getItem("accessToken");if(!u){T.error("Authentication required.");return}const R=await L.get("/rooms",{headers:{Authorization:`Bearer ${u}`}});s(R.data.rooms||[])}catch(u){T.error("Failed to fetch rooms."),console.error("Fetch Rooms Error:",u)}},[]),v=o.useCallback(async()=>{try{const u=localStorage.getItem("accessToken");if(!u){T.error("Authentication required.");return}const E=((await L.get("/get-subjects",{headers:{Authorization:`Bearer ${u}`}})).data.subject||[]).map(k=>({id:k.id,code:k.subject_code,name:k.des_title,yearLevel:parseInt(k.semester.year_level)||0}));r(E)}catch(u){T.error("Failed to fetch subjects."),console.error("Fetch Subjects Error:",u)}},[]);o.useEffect(()=>{(async()=>{d(!0);try{await Promise.all([a(),v()])}catch(R){console.error("An error occurred during data fetching:",R)}finally{d(!1)}})()},[a,v]);const S=async u=>{const R=localStorage.getItem("accessToken");if(!R){T.error("Authentication required.");return}try{if(p){const F=await L.put(`/rooms/${p.id}`,u,{headers:{Authorization:`Bearer ${R}`}});T.success(F.data.message||"Room updated successfully!")}else{const F=await L.post("/rooms",u,{headers:{Authorization:`Bearer ${R}`}});T.success(F.data.message||"Room created successfully!");const E=F.data.room?.id;if(E){const k=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],V=[{start_time:"07:00:00",end_time:"12:00:00"},{start_time:"13:00:00",end_time:"21:00:00"}],z={availabilities:k.flatMap(ce=>V.map(P=>({day:ce,...P})))};await L.post(`/rooms/${E}/availabilities`,z,{headers:{Authorization:`Bearer ${R}`}}),T.success("Default availability has been set.")}}f(!1),h(null),a()}catch(F){if(F.response?.status===422){const E=F.response.data.errors;for(const k in E){T.error(`Validation Error: ${E[k][0]}`);return}}else T.error("An error occurred. Please try again."),console.error("Save Room Error:",F)}},C=()=>{h(null),f(!0)},y=u=>{h(u),f(!0)},N=async()=>{if(c.roomId===null)return;const u=localStorage.getItem("accessToken");if(!u){T.error("Authentication required.");return}try{const R=await L.delete(`/rooms/${c.roomId}`,{headers:{Authorization:`Bearer ${u}`}});T.success(R.data.message||"Room deleted successfully!"),a()}catch{T.error("Failed to delete room.")}finally{m({open:!1,roomId:null})}},w=u=>{m({open:!0,roomId:u})},x=u=>{j(u),b(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs("main",{children:[e.jsxs("header",{className:"mb-8 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground tracking-tight",children:"Classroom & Schedule Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Monitor classroom utilization and view schedules by year level."})]}),e.jsxs(M,{onClick:C,children:[e.jsx(vt,{size:16,className:"mr-2"}),"Add Room"]})]}),e.jsxs(Ht,{defaultValue:"classrooms",children:[e.jsxs(lt,{className:"grid w-full grid-cols-2 mb-4",children:[e.jsx(fe,{value:"classrooms",children:"Classroom List"}),e.jsx(fe,{value:"schedules",children:"Generate Schedules"})]}),e.jsx(pe,{value:"classrooms",children:e.jsx(Wt,{roomsData:t,scheduleData:_e,subjectsData:n,onEdit:y,onDelete:w,onManageAvailability:x,isLoading:i})}),e.jsx(pe,{value:"schedules",children:e.jsx(Qt,{scheduleData:_e,subjectsData:n,roomsData:t})})]})]}),e.jsx(Xt,{isOpen:l,onClose:()=>{f(!1),h(null)},onSave:S,initialData:p}),e.jsx(se,{open:c.open,onOpenChange:()=>m({open:!1,roomId:null}),children:e.jsxs(re,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Are you absolutely sure?"}),e.jsx(Ve,{children:"This action cannot be undone. This will permanently delete the room."})]}),e.jsxs(oe,{children:[e.jsx(ie,{asChild:!0,children:e.jsx(M,{variant:"outline",children:"Cancel"})}),e.jsx(M,{variant:"destructive",onClick:N,children:"Yes, delete it"})]})]})}),e.jsx(Zt,{isOpen:g,onClose:()=>b(!1),room:A})]})}export{gs as default};
