import{c as ue,j as e,m as be,b as ze,f as jt,B as P,r as s,t as m,a as M,T as pt,l as ke,n as Pe,o as Ee,p as Me,q as ft,h as bt,P as Oe,s as gt,i as Ie,u as vt,A as St}from"./index-DgBvKuMI.js";import{I as q}from"./input-CLeiS4na.js";import{S as V,a as K,b as J,c as W,d as R,u as yt}from"./select-B_zCFP1n.js";import{D as G,a as Q,b as Z,c as ee,d as ve,e as te,f as se}from"./dialog-ckoxcie1.js";import{B as Nt}from"./book-copy-digo2jvc.js";import{S as ge}from"./square-pen-rOmKqOb4.js";import{T as Se,P as ye}from"./trash-2-DAENKryb.js";import{S as X,L as Ne}from"./skeleton-B93RE2HI.js";import{T as Re,a as Be,b as U,c as I,d as De,e as y,f as Ue}from"./table-C4xg0iBA.js";import{B as wt}from"./badge-C6YW9m5z.js";import{L as qe}from"./layers-B0zmQVtB.js";import{L as F}from"./label-MclnY30V.js";import{C as Fe}from"./circle-alert-Bwn4MsWM.js";import{S as Lt}from"./search-SHKQjIRt.js";import"./Combination-CcEhSoom.js";import"./check-CZxRGhJA.js";import"./chevron-up-BggDdKn_.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],_t=ue("activity",Ct);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h2",key:"tvwodi"}],["path",{d:"M20 8v11a2 2 0 0 1-2 2h-2",key:"1gkqxj"}],["path",{d:"m9 15 3-3 3 3",key:"1pd0qc"}],["path",{d:"M12 12v9",key:"192myk"}]],Tt=ue("archive-restore",At);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],Pt=ue("archive",kt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]],It=ue("sliders-horizontal",Et),Ye=["from-purple-600 to-indigo-600","from-blue-500 to-teal-400","from-pink-500 to-rose-500","from-orange-500 to-amber-500","from-green-500 to-lime-500","from-cyan-500 to-sky-500"],qt={hidden:{opacity:0,y:20},visible:l=>({opacity:1,y:0,transition:{delay:l*.05}})};function Ft({program:l,index:N,onEdit:v,onArchive:h,onRestore:u,onManage:i}){const b=l.total_subjects,f=l.total_units,g=()=>e.jsxs(e.Fragment,{children:[e.jsx(P,{size:"icon",variant:"ghost",title:"Edit Program",onClick:S=>{S.stopPropagation(),v(l)},className:"h-8 w-8 bg-black/20 hover:bg-green-500",children:e.jsx(ge,{size:16})}),l.isActive?e.jsx(P,{size:"icon",variant:"ghost",title:"Archive Program",onClick:S=>{S.stopPropagation(),h(l.id)},className:"h-8 w-8 bg-black/20 hover:bg-destructive/80",children:e.jsx(Se,{size:16})}):e.jsx(P,{size:"icon",variant:"ghost",title:"Restore Program",onClick:S=>{S.stopPropagation(),u(l.id)},className:"h-8 w-8 bg-black/20 hover:bg-green-500",children:e.jsx(Tt,{size:16})})]});return e.jsxs(be.div,{variants:qt,custom:N,initial:"hidden",animate:"visible",exit:"hidden",className:"bg-card rounded-xl border border-border shadow-sm overflow-hidden group flex flex-col transition-all duration-300 hover:shadow-md hover:-translate-y-1",children:[e.jsxs("div",{className:`p-5 bg-gradient-to-br text-white relative ${Ye[N%Ye.length]} ${!l.isActive&&"opacity-60"}`,children:[e.jsx("h2",{className:"text-xl font-bold pr-20",children:l.abbreviation}),e.jsx("p",{className:"opacity-80 truncate text-sm pr-20",children:l.name}),!l.isActive&&e.jsx("div",{className:"absolute bottom-2 left-5 px-2.5 py-1 bg-red-600/90 text-white text-[10px] font-bold rounded-full uppercase tracking-wider",children:"Inactive"}),e.jsx("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(g,{})})]}),e.jsxs("div",{className:"p-5 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-4",children:[e.jsx(ze,{size:15}),e.jsxs("span",{children:["A.Y. ",l.effectiveYear]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center text-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx(Nt,{size:15,className:"text-muted-foreground"}),e.jsx("span",{children:"Total Subjects"})]}),e.jsx("span",{className:"px-2.5 py-0.5 bg-muted text-muted-foreground rounded-full font-semibold",children:b})]}),e.jsxs("div",{className:"flex justify-between items-center text-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx(jt,{size:15,className:"text-muted-foreground"}),e.jsx("span",{children:"Total Units"})]}),e.jsx("span",{className:"px-2.5 py-0.5 bg-muted text-muted-foreground rounded-full font-semibold",children:f})]})]})]}),e.jsx(P,{onClick:i,className:"w-full mt-5",variant:"secondary",disabled:!l.isActive,children:"Manage Curriculum"})]})]})}function Yt(){return e.jsxs("div",{className:"bg-card rounded-xl border border-border shadow-sm p-5 space-y-4",children:[e.jsx(X,{className:"h-8 w-1/4"}),e.jsx(X,{className:"h-5 w-3/4"}),e.jsxs("div",{className:"pt-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(X,{className:"h-5 w-1/2"}),e.jsx(X,{className:"h-6 w-10 rounded-full"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(X,{className:"h-5 w-1/2"}),e.jsx(X,{className:"h-6 w-10 rounded-full"})]})]}),e.jsx(X,{className:"h-10 w-full mt-5"})]})}const $t=(l,N)=>{const[v,h]=l.split(", "),[u,i]=N.split(", "),b=parseInt(v),f=parseInt(u);return b!==f?b-f:h?.includes("Summer")?1:i?.includes("Summer")?-1:parseInt(h)-parseInt(i)};function zt({isOpen:l,onClose:N,program:v,onAddSemester:h,onEditSemester:u,onAddSubject:i,onEditSubject:b,onDeleteSubject:f,onSetSemesterStatus:g,refreshKey:S,updatedSubjectData:j,newSemesterData:_,updatedSemesterData:p}){const[k,x]=s.useState({}),[L,c]=s.useState(!1);s.useEffect(()=>{if(!l)return;(async()=>{c(!0);const r=localStorage.getItem("accessToken");if(!r){m.error("Authentication required."),c(!1);return}try{const a=await M.get("/semester-with-subjects",{params:{program_id:v.id},headers:{Authorization:`Bearer ${r}`}}),o=Array.isArray(a.data.semesters)?a.data.semesters:[],A={};o.forEach(E=>{const C=`${E.year_level}, ${E.semester_level}`;A[C]={id:E.id,subjects:(E.subjects||[]).map(Y=>({id:Y.id,code:Y.subject_code,name:Y.des_title,unitsTotal:Y.total_units,unitsLec:Y.lec_units,unitsLab:Y.lab_units,hoursTotal:Y.total_hrs,hoursLec:Y.total_lec_hrs,hoursLab:Y.total_lab_hrs,prerequisite:Y.pre_requisite||"None"})),isActive:E.status===1,startDate:E.start_date,endDate:E.end_date}}),x(A)}catch{m.error("Failed to load semester data.")}finally{c(!1)}})()},[l,v.id,S]),s.useEffect(()=>{if(j){const{semesterName:t,subject:r}=j;x(a=>{const o=JSON.parse(JSON.stringify(a)),A=o[t];if(A){const E=A.subjects.findIndex(C=>C.id===r.id);E!==-1?A.subjects[E]=r:A.subjects.push(r)}return o})}},[j]),s.useEffect(()=>{if(_){const{name:t,semester:r}=_;x(a=>({...a,[t]:r}))}},[_]),s.useEffect(()=>{if(p){const{name:t,semester:r,newName:a}=p;x(o=>{const A={...o},E=A[t];return E?(a&&a!==t?(A[a]={...E,...r},delete A[t]):A[t]={...E,...r},A):o})}},[p]);const n=s.useMemo(()=>Object.entries(k).sort(([t],[r])=>$t(t,r)),[k]);return e.jsx(G,{open:l,onOpenChange:N,children:e.jsxs(Q,{className:"max-w-7xl h-[95vh] flex flex-col p-0",children:[e.jsxs(Z,{className:"p-6 pb-4 bg-muted/50 border-b rounded-t-lg",children:[e.jsxs(ee,{className:"text-2xl md:text-3xl font-bold text-foreground flex items-center gap-3",children:[v.name,e.jsx("span",{className:"text-sm font-semibold text-primary bg-primary/10 px-3 py-1 rounded-full",children:v.abbreviation})]}),e.jsxs(ve,{children:["Academic Year of Effectivity: ",v.effectiveYear]})]}),e.jsx("div",{className:"flex-grow overflow-y-auto px-6 py-4 space-y-8",children:L?e.jsx("div",{className:"space-y-6",children:[1,2].map(t=>e.jsxs("div",{className:"bg-card border rounded-xl p-4 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-muted/60 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-48 bg-muted/30 rounded"})]},t))}):n.length===0?e.jsxs("div",{className:"text-center py-20 text-muted-foreground flex flex-col items-center justify-center h-full",children:[e.jsx(qe,{size:56,className:"mx-auto mb-4"}),e.jsx("h4",{className:"font-semibold text-xl text-foreground",children:"No Semesters Found"}),e.jsx("p",{className:"max-w-md mx-auto mt-2 text-sm",children:"This curriculum is empty."})]}):n.map(([t,r])=>e.jsxs("div",{className:`group/semester border rounded-xl overflow-hidden shadow-sm transition-opacity ${r.isActive?"bg-card":"opacity-70 bg-muted/20"}`,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-muted/30 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"text-lg font-semibold text-foreground",children:t}),e.jsx(wt,{variant:r.isActive?"default":"destructive",children:r.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover/semester:opacity-100 transition-opacity",children:[e.jsx(P,{variant:"ghost",size:"icon",title:"Set Status & Dates",className:"h-8 w-8 text-muted-foreground",onClick:()=>g(t,r),children:e.jsx(It,{size:16})}),e.jsx(P,{variant:"ghost",size:"icon",title:"Rename Semester",className:"h-8 w-8 text-green-500 hover:text-green-500",onClick:()=>u(r.id,t),children:e.jsx(ge,{size:16})})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Re,{className:"min-w-[1200px]",children:[e.jsxs(Be,{className:"bg-muted/50 sticky top-0 z-10",children:[e.jsxs(U,{children:[e.jsx(I,{rowSpan:2,className:"align-middle text-center border-r",children:"Course Code"}),e.jsx(I,{rowSpan:2,className:"align-middle text-center border-r w-[350px]",children:"Descriptive Title"}),e.jsx(I,{colSpan:3,className:"text-center border-r",children:"Units"}),e.jsx(I,{colSpan:3,className:"text-center border-r",children:"Hours per week"}),e.jsx(I,{rowSpan:2,className:"align-middle text-center border-r",children:"Pre-requisite"}),e.jsx(I,{rowSpan:2,className:"align-middle w-[50px]"})]}),e.jsxs(U,{children:[e.jsx(I,{className:"text-center border-r",children:"Total"}),e.jsx(I,{className:"text-center border-r",children:"Lec"}),e.jsx(I,{className:"text-center border-r",children:"Lab"}),e.jsx(I,{className:"text-center border-r",children:"Total"}),e.jsx(I,{className:"text-center border-r",children:"Lec"}),e.jsx(I,{className:"text-center border-r",children:"Lab"})]})]}),e.jsx(De,{children:r.subjects.length>0?r.subjects.map(a=>e.jsxs(U,{children:[e.jsx(y,{className:"w-[150px] font-semibold uppercase text-center",children:a.code}),e.jsx(y,{children:a.name}),e.jsx(y,{className:"text-center font-bold text-primary",children:a.unitsTotal}),e.jsx(y,{className:"text-center",children:a.unitsLec}),e.jsx(y,{className:"text-center",children:a.unitsLab}),e.jsx(y,{className:"text-center font-bold text-primary",children:a.hoursTotal}),e.jsx(y,{className:"text-center",children:a.hoursLec}),e.jsx(y,{className:"text-center",children:a.hoursLab}),e.jsx(y,{className:"w-[150px] text-center",children:a.prerequisite}),e.jsx(y,{className:"text-center",children:e.jsxs("div",{className:"flex justify-end",children:[e.jsx(P,{variant:"ghost",size:"icon",className:"h-8 w-8 text-green-500 hover:text-green-500",onClick:()=>b(t,a),children:e.jsx(ge,{size:16})}),e.jsx(P,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>f(t,a.id),children:e.jsx(Se,{size:16})})]})})]},a.id||a.code)):e.jsx(U,{children:e.jsx(y,{colSpan:10,className:"text-center h-24 text-muted-foreground",children:"No subjects added for this semester."})})}),e.jsx(Ue,{className:"sticky bottom-0 bg-muted/80 backdrop-blur-sm",children:e.jsxs(U,{children:[e.jsx(y,{colSpan:2,className:"text-right font-bold text-lg",children:"SEMESTER TOTALS"}),e.jsx(y,{className:"text-center font-bold text-lg text-primary",children:r.subjects.reduce((a,o)=>a+(Number(o.unitsTotal)||0),0)}),e.jsx(y,{className:"text-center font-semibold",children:r.subjects.reduce((a,o)=>a+(Number(o.unitsLec)||0),0)}),e.jsx(y,{className:"text-center font-semibold",children:r.subjects.reduce((a,o)=>a+(Number(o.unitsLab)||0),0)}),e.jsx(y,{className:"text-center font-bold text-lg text-primary",children:r.subjects.reduce((a,o)=>a+(Number(o.hoursTotal)||0),0)}),e.jsx(y,{className:"text-center font-semibold",children:r.subjects.reduce((a,o)=>a+(Number(o.hoursLec)||0),0)}),e.jsx(y,{className:"text-center font-semibold",children:r.subjects.reduce((a,o)=>a+(Number(o.hoursLab)||0),0)}),e.jsx(y,{colSpan:2})]})})]})}),e.jsx("div",{className:"p-2 border-t",children:e.jsxs(P,{onClick:()=>i(t,r.id),variant:"link",children:[e.jsx(ye,{size:16,className:"mr-1"})," Add Subject"]})})]},t))}),e.jsxs(te,{className:"mt-auto p-6 bg-gray-50 border-t rounded-b-lg flex flex-col md:flex-row md:justify-end gap-2",children:[e.jsx(se,{asChild:!0,children:e.jsx(P,{type:"button",variant:"outline",children:"Cancel"})}),e.jsxs(P,{onClick:h,className:"flex items-center gap-2",children:[e.jsx(qe,{size:16})," Add Year/Semester"]})]})]})})}const Mt=()=>{const v=new Date().getFullYear()+5,h=[];for(let u=2015;u<=v;u++)h.push(String(u));return h},$e=Mt();function Ot({isOpen:l,onClose:N,onSave:v,initialData:h}){const[u,i]=s.useState(""),[b,f]=s.useState(""),[g,S]=s.useState(""),[j,_]=s.useState(""),[p,k]=s.useState(!1);s.useEffect(()=>{if(h){i(h.name),f(h.abbreviation);const[c="",n=""]=h.effectiveYear.split("-");S(c),_(n)}else{i(""),f("");const c=new Date().getFullYear();S(String(c)),_(String(c+1))}},[h,l]);const x=async c=>{c.preventDefault(),k(!0);const n={program_name:u,abbreviation:b,year_from:g,year_to:j},t=localStorage.getItem("accessToken");if(!t){m.error("Authentication required."),k(!1);return}const r={Authorization:`Bearer ${t}`};try{const a=!!h,o=a?`/edit-program/${h.id}`:"/add-program",E=await M["post"](o,n,{headers:r});m.success(E.data.message||"Program saved successfully!");const C=E.data.program,Y=C.subjects||h?.subjects||{},ne=typeof C.total_subjects=="number"?C.total_subjects:Object.keys(Y).length,de=typeof C.total_units=="number"?C.total_units:h?.total_units??0,oe={id:C.id,name:C.program_name,abbreviation:C.abbreviation,effectiveYear:`${C.year_from}-${C.year_to}`,semesters:C.semesters||h?.semesters||{},subjects:Y,total_subjects:ne,total_units:de,isActive:C.isActive??C.is_active??h?.isActive??!0};v(oe),N()}catch(a){if(M.isAxiosError(a)&&a.response){if(a.response.status===401){m.error("Your session has expired. Please log in again.");return}const o=a.response.data,A=o.errors;if(A&&typeof A=="object"&&Object.keys(A).length>0){const E=Object.keys(A)[0],C=A[E]?.[0];m.error(C||"A validation error occurred.")}else o&&typeof o.message=="string"?m.error(o.message):m.error("An unknown API error occurred.")}else m.error("Failed to connect to the server. Please check your connection."),console.error("Non-Axios error:",a)}finally{k(!1)}},L=c=>{S(c),_(String(Number(c)+1))};return e.jsx(G,{open:l,onOpenChange:N,children:e.jsxs(Q,{children:[e.jsx(Z,{children:e.jsx(ee,{children:h?"Edit Program":"Add New Program"})}),e.jsxs("form",{onSubmit:x,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"progName",children:"Program Name"}),e.jsx(q,{id:"progName",value:u,onChange:c=>i(c.target.value),placeholder:"e.g., Bachelor of Science...",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"progAbbr",children:"Abbreviation"}),e.jsx(q,{id:"progAbbr",value:b,onChange:c=>f(c.target.value),placeholder:"e.g., BSIT",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Effectivity A.Y."}),e.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr] items-center gap-2",children:[e.jsxs(V,{value:g,onValueChange:L,required:!0,children:[e.jsx(K,{children:e.jsx(J,{placeholder:"Start Year"})}),e.jsx(W,{children:$e.map(c=>e.jsx(R,{value:c,children:c},c))})]}),e.jsx("span",{className:"text-muted-foreground",children:"-"}),e.jsxs(V,{value:j,onValueChange:_,required:!0,children:[e.jsx(K,{children:e.jsx(J,{placeholder:"End Year"})}),e.jsx(W,{children:$e.map(c=>e.jsx(R,{value:c,children:c},c))})]})]})]}),e.jsxs(te,{className:"pt-4",children:[e.jsx(se,{asChild:!0,children:e.jsx(P,{type:"button",variant:"outline",disabled:p,children:"Cancel"})}),e.jsx(P,{type:"submit",disabled:p,children:p?"Saving...":h?"Save Changes":"Save Program"})]})]})]})})}const fe={id:0,code:"",name:"",unitsTotal:0,unitsLec:"",unitsLab:"",hoursTotal:0,hoursLec:"",hoursLab:"",prerequisite:""},Rt=["1st Year","2nd Year","3rd Year","4th Year"],Bt=["1st Semester","2nd Semester","Summer"];function Dt({isOpen:l,onClose:N,onSave:v,programId:h}){const[u,i]=s.useState(""),[b,f]=s.useState(""),[g,S]=s.useState([fe]),[j,_]=s.useState(!1);s.useEffect(()=>{const n=g.map(t=>({...t,unitsTotal:(Number(t.unitsLec)||0)+(Number(t.unitsLab)||0),hoursTotal:(Number(t.hoursLec)||0)+(Number(t.hoursLab)||0)}));JSON.stringify(n)!==JSON.stringify(g)&&S(n)},[g]);const p=s.useMemo(()=>g.reduce((n,t)=>(n.totalUnits+=Number(t.unitsTotal)||0,n.totalLecUnits+=Number(t.unitsLec)||0,n.totalLabUnits+=Number(t.unitsLab)||0,n.totalHours+=Number(t.hoursTotal)||0,n.totalLecHours+=Number(t.hoursLec)||0,n.totalLabHours+=Number(t.hoursLab)||0,n),{totalUnits:0,totalLecUnits:0,totalLabUnits:0,totalHours:0,totalLecHours:0,totalLabHours:0}),[g]),k=()=>S(n=>[...n,{...fe}]),x=n=>S(t=>t.length>1?t.filter((r,a)=>a!==n):t),L=(n,t,r)=>S(a=>a.map((o,A)=>A===n?{...o,[t]:r}:o)),c=async n=>{if(n.preventDefault(),!u||!b){m.error("Please select a year level and semester.");return}if(g.some(t=>!t.code.trim()||!t.name.trim())){m.error("Please fill out all subject codes and titles.");return}_(!0);try{const t=localStorage.getItem("accessToken");if(!t){m.error("Authentication required."),_(!1);return}const r={program_id:h,year_level:u,semester_level:b,subjects:g.map(o=>({subject_code:o.code,des_title:o.name,total_units:o.unitsTotal,lec_units:Number(o.unitsLec)||0,lab_units:Number(o.unitsLab)||0,total_hrs:o.hoursTotal,total_lec_hrs:Number(o.hoursLec)||0,total_lab_hrs:Number(o.hoursLab)||0,pre_requisite:o.prerequisite||null}))},a=await M.post("/semester-with-subjects",r,{headers:{Authorization:`Bearer ${t}`}});if(a.status===201&&a.data.semester){m.success("Semester and subjects added successfully!");const o=a.data.semester,A=`${o.year_level}, ${o.semester_level}`,E={id:o.id,isActive:o.status===1,startDate:o.start_date,endDate:o.end_date,subjects:(o.subjects||[]).map(C=>({id:C.id,code:C.subject_code,name:C.des_title,unitsTotal:C.total_units,unitsLec:C.lec_units,unitsLab:C.lab_units,hoursTotal:C.total_hrs,hoursLec:C.total_lec_hrs,hoursLab:C.total_lab_hrs,prerequisite:C.pre_requisite||"None"}))};v&&v({name:A,semester:E}),N()}}catch(t){m.error(t.response?.data?.error||"Failed to save. Please try again.")}finally{_(!1)}};return s.useEffect(()=>{l&&(i(""),f(""),S([fe]))},[l]),e.jsx(G,{open:l,onOpenChange:N,children:e.jsx(pt,{children:e.jsxs(Q,{className:"max-w-7xl h-[95vh] flex flex-col",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Add New Semester and Subjects"}),e.jsx(ve,{children:"Add subjects in bulk for a new semester. Totals are calculated automatically."})]}),e.jsxs("form",{onSubmit:c,className:"flex-grow flex flex-col min-h-0 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"yearLevel",className:"text-base",children:"Year Level"}),e.jsxs(V,{value:u,onValueChange:i,required:!0,children:[e.jsx(K,{id:"yearLevel",children:e.jsx(J,{placeholder:"Select a year level"})}),e.jsx(W,{children:Rt.map(n=>e.jsx(R,{value:n,children:n},n))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"semester",className:"text-base",children:"Semester"}),e.jsxs(V,{value:b,onValueChange:f,required:!0,children:[e.jsx(K,{id:"semester",children:e.jsx(J,{placeholder:"Select a semester"})}),e.jsx(W,{children:Bt.map(n=>e.jsx(R,{value:n,children:n},n))})]})]})]}),e.jsx("div",{className:"flex-grow overflow-auto border rounded-lg",children:e.jsxs(Re,{className:"min-w-[1200px]",children:[e.jsxs(Be,{className:"bg-muted/50 sticky top-0 z-10",children:[e.jsxs(U,{children:[e.jsx(I,{rowSpan:2,className:"align-middle text-center border-r",children:"Course Code"}),e.jsx(I,{rowSpan:2,className:"align-middle text-center border-r w-[350px]",children:"Descriptive Title"}),e.jsx(I,{colSpan:3,className:"text-center border-r",children:"Units"}),e.jsx(I,{colSpan:3,className:"text-center border-r",children:"Hours per week"}),e.jsx(I,{rowSpan:2,className:"align-middle text-center border-r",children:"Pre-requisite"}),e.jsx(I,{rowSpan:2,className:"align-middle w-[50px]"})]}),e.jsxs(U,{children:[e.jsx(I,{className:"text-center border-r",children:"Total"}),e.jsx(I,{className:"text-center border-r",children:"Lec"}),e.jsx(I,{className:"text-center border-r",children:"Lab"}),e.jsx(I,{className:"text-center border-r",children:"Total"}),e.jsx(I,{className:"text-center border-r",children:"Lec"}),e.jsx(I,{className:"text-center border-r",children:"Lab"})]})]}),e.jsx(De,{children:g.map((n,t)=>e.jsxs(U,{children:[e.jsx(y,{className:"w-[150px]",children:e.jsx(q,{required:!0,className:"uppercase",placeholder:"e.g. CS101",value:n.code,onChange:r=>L(t,"code",r.target.value)})}),e.jsx(y,{children:e.jsx(q,{required:!0,placeholder:"e.g. Intro to Programming",value:n.name,onChange:r=>L(t,"name",r.target.value)})}),e.jsx(y,{children:e.jsxs(ke,{children:[e.jsx(Pe,{asChild:!0,children:e.jsx(q,{value:n.unitsTotal||"",readOnly:!0,className:"text-center font-bold bg-muted/50 cursor-not-allowed"})}),e.jsx(Ee,{children:"Auto-calculated"})]})}),e.jsx(y,{children:e.jsx(q,{min:"0",type:"number",value:n.unitsLec,onChange:r=>L(t,"unitsLec",r.target.value),className:"text-center"})}),e.jsx(y,{children:e.jsx(q,{min:"0",type:"number",value:n.unitsLab,onChange:r=>L(t,"unitsLab",r.target.value),className:"text-center"})}),e.jsx(y,{children:e.jsxs(ke,{children:[e.jsx(Pe,{asChild:!0,children:e.jsx(q,{value:n.hoursTotal||"",readOnly:!0,className:"text-center font-bold bg-muted/50 cursor-not-allowed"})}),e.jsx(Ee,{children:"Auto-calculated"})]})}),e.jsx(y,{children:e.jsx(q,{min:"0",type:"number",value:n.hoursLec,onChange:r=>L(t,"hoursLec",r.target.value),className:"text-center"})}),e.jsx(y,{children:e.jsx(q,{min:"0",type:"number",value:n.hoursLab,onChange:r=>L(t,"hoursLab",r.target.value),className:"text-center"})}),e.jsx(y,{className:"w-[150px]",children:e.jsx(q,{placeholder:"None",value:n.prerequisite,onChange:r=>L(t,"prerequisite",r.target.value)})}),e.jsx(y,{className:"text-center",children:e.jsx(P,{type:"button",variant:"ghost",size:"icon",onClick:()=>x(t),disabled:g.length<=1,className:"text-destructive h-8 w-8 shrink-0 disabled:opacity-50",children:e.jsx(Se,{size:16})})})]},t))}),e.jsx(Ue,{className:"sticky bottom-0 bg-muted/80 backdrop-blur-sm",children:e.jsxs(U,{children:[e.jsx(y,{colSpan:2,className:"text-right font-bold text-lg",children:"SEMESTER TOTALS"}),e.jsx(y,{className:"text-center font-bold text-lg text-primary",children:p.totalUnits}),e.jsx(y,{className:"text-center font-semibold",children:p.totalLecUnits}),e.jsx(y,{className:"text-center font-semibold",children:p.totalLabUnits}),e.jsx(y,{className:"text-center font-bold text-lg text-primary",children:p.totalHours}),e.jsx(y,{className:"text-center font-semibold",children:p.totalLecHours}),e.jsx(y,{className:"text-center font-semibold",children:p.totalLabHours}),e.jsx(y,{colSpan:2})]})})]})}),e.jsxs(P,{type:"button",variant:"outline",onClick:k,className:"mt-4 w-full sm:w-auto",children:[e.jsx(ye,{size:16,className:"mr-2"})," Add Subject Row"]}),e.jsxs(te,{className:"mt-5 pt-4 border-t",children:[e.jsx(se,{asChild:!0,children:e.jsx(P,{type:"button",variant:"outline",disabled:j,children:"Cancel"})}),e.jsx(P,{type:"submit",disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"mr-2 h-4 w-4 animate-spin"})," Saving..."]}):"Save Curriculum"})]})]})]})})})}const Ut=["1st Year","2nd Year","3rd Year","4th Year"],Ht=["1st Semester","2nd Semester","Summer"];function Vt({isOpen:l,onClose:N,onSaveSuccess:v,semesterId:h,initialData:u}){const[i,b]=s.useState(!1),[f,g]=s.useState(""),[S,j]=s.useState("");s.useEffect(()=>{if(l&&u){const p=u.split(", ");p.length===2&&(g(p[0]),j(p[1]))}},[l,u]);const _=async p=>{p.preventDefault();const k=`${f}, ${S}`;if(!f||!S){m.error("Please select both a year level and a semester.");return}if(k===u){m.info("No changes were made."),N();return}if(!h){m.error("Semester ID is missing.");return}b(!0);try{const x=localStorage.getItem("accessToken");if(!x){m.error("Authentication required."),b(!1);return}const L={year_level:f,semester_level:S};await M.put(`/semesters/${h}/rename`,L,{headers:{Authorization:`Bearer ${x}`}}),m.success("Semester renamed successfully!"),v(u,k),N()}catch(x){m.error(x.response?.data?.message||"Failed to rename semester.")}finally{b(!1)}};return e.jsx(G,{open:l,onOpenChange:N,children:e.jsxs(Q,{children:[e.jsx(Z,{children:e.jsx(ee,{children:"Rename Semester"})}),e.jsxs("form",{onSubmit:_,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"yearPart",children:"Year Level"}),e.jsxs(V,{value:f,onValueChange:g,children:[e.jsx(K,{id:"yearPart",children:e.jsx(J,{placeholder:"Select a year level"})}),e.jsx(W,{children:Ut.map(p=>e.jsx(R,{value:p,children:p},p))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"semesterPart",children:"Semester"}),e.jsxs(V,{value:S,onValueChange:j,children:[e.jsx(K,{id:"semesterPart",children:e.jsx(J,{placeholder:"Select a semester"})}),e.jsx(W,{children:Ht.map(p=>e.jsx(R,{value:p,children:p},p))})]})]}),e.jsxs(te,{className:"pt-4",children:[e.jsx(se,{asChild:!0,children:e.jsx(P,{type:"button",variant:"outline",disabled:i,children:"Cancel"})}),e.jsx(P,{type:"submit",disabled:i||!f||!S,children:i?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"mr-2 h-4 w-4 animate-spin"})," Renaming..."]}):"Rename"})]})]})]})})}function Kt(l){const{isOpen:N,onClose:v,onSave:h,initialData:u}=l,[i,b]=s.useState({id:0,code:"",name:"",unitsTotal:0,unitsLec:0,unitsLab:0,hoursTotal:0,hoursLec:0,hoursLab:0,prerequisite:""}),[f,g]=s.useState(null);s.useEffect(()=>{const x=(Number(i.unitsLec)||0)+(Number(i.unitsLab)||0),L=(Number(i.hoursLec)||0)+(Number(i.hoursLab)||0);b(c=>({...c,unitsTotal:x,hoursTotal:L}))},[i.unitsLec,i.unitsLab,i.hoursLec,i.hoursLab]),s.useEffect(()=>{const x=Number(i.unitsLec)||0,L=Number(i.unitsLab)||0,c=Number(i.unitsTotal)||0,n=x+L>c?"Lec + Lab units cannot exceed Total.":null,t=Number(i.hoursLec)||0,r=Number(i.hoursLab)||0,a=Number(i.hoursTotal)||0,o=t+r>a?"Lec + Lab hours cannot exceed Total.":null;g(n||o?{unitError:n,hourError:o}:null)},[i]),s.useEffect(()=>{N&&b(u||{id:0,code:"",name:"",unitsTotal:0,unitsLec:0,unitsLab:0,hoursTotal:0,hoursLec:0,hoursLab:0,prerequisite:""})},[N,u]);const S=(x,L)=>{b(c=>({...c,[x]:L}))},j=(x,L)=>{const c=Number(L);S(x,c>=0?c:0)},[_,p]=s.useState(!1),k=async x=>{if(x.preventDefault(),f){m.error("Please fix the validation errors before saving.");return}const L=!!u;p(!0);try{await h(i,L),v()}catch(c){console.error("Subject save failed:",c),m.error("Failed to save subject.")}finally{p(!1)}};return e.jsx(G,{open:N,onOpenChange:v,children:e.jsxs(Q,{children:[e.jsx(Z,{children:e.jsx(ee,{children:u?`Edit Subject: ${u.code}`:"Add New Subject"})}),e.jsxs("form",{onSubmit:k,className:"py-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"code",children:"Course Code"}),e.jsx(q,{id:"code",value:i.code,onChange:x=>S("code",x.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"prerequisite",children:"Pre-requisite"}),e.jsx(q,{id:"prerequisite",value:i.prerequisite,onChange:x=>S("prerequisite",x.target.value),placeholder:"None"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"name",children:"Descriptive Title"}),e.jsx(q,{id:"name",value:i.name,onChange:x=>S("name",x.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(F,{className:"font-semibold",children:"Unit Allocation"}),e.jsxs("div",{className:`grid grid-cols-3 gap-4 p-4 border rounded-lg bg-muted/30 ${f?.unitError?"border-destructive":""}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(F,{htmlFor:"unitsTotal",children:"Total"}),e.jsx(q,{id:"unitsTotal",type:"number",value:i.unitsTotal||"",disabled:!0,readOnly:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(F,{htmlFor:"unitsLec",children:"Lec"}),e.jsx(q,{id:"unitsLec",type:"number",value:i.unitsLec||"",onChange:x=>j("unitsLec",x.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(F,{htmlFor:"unitsLab",children:"Lab"}),e.jsx(q,{id:"unitsLab",type:"number",value:i.unitsLab||"",onChange:x=>j("unitsLab",x.target.value)})]})]}),f?.unitError&&e.jsxs("p",{className:"text-destructive text-sm flex items-center gap-2 mt-2",children:[e.jsx(Fe,{size:16}),f.unitError]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(F,{className:"font-semibold",children:"Hour Allocation"}),e.jsxs("div",{className:`grid grid-cols-3 gap-4 p-4 border rounded-lg bg-muted/30 ${f?.hourError?"border-destructive":""}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(F,{htmlFor:"hoursTotal",children:"Total"}),e.jsx(q,{id:"hoursTotal",type:"number",value:i.hoursTotal||"",disabled:!0,readOnly:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(F,{htmlFor:"hoursLec",children:"Lec"}),e.jsx(q,{id:"hoursLec",type:"number",value:i.hoursLec||"",onChange:x=>j("hoursLec",x.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(F,{htmlFor:"hoursLab",children:"Lab"}),e.jsx(q,{id:"hoursLab",type:"number",value:i.hoursLab||"",onChange:x=>j("hoursLab",x.target.value)})]})]}),f?.hourError&&e.jsxs("p",{className:"text-destructive text-sm flex items-center gap-2 mt-2",children:[e.jsx(Fe,{size:16}),f.hourError]})]})]}),e.jsxs(te,{className:"mt-8 pt-4 border-t",children:[e.jsx(se,{asChild:!0,children:e.jsx(P,{type:"button",variant:"outline",disabled:_,children:"Cancel"})}),e.jsx(P,{type:"submit",disabled:!!f||_,children:_?"Saving...":u?"Save Changes":"Save Subject"})]})]})]})})}function Jt(l,N,{checkForDefaultPrevented:v=!0}={}){return function(u){if(l?.(u),v===!1||!u.defaultPrevented)return N?.(u)}}var me="Switch",[Wt,gs]=bt(me),[Xt,Gt]=Wt(me),He=s.forwardRef((l,N)=>{const{__scopeSwitch:v,name:h,checked:u,defaultChecked:i,required:b,disabled:f,value:g="on",onCheckedChange:S,form:j,..._}=l,[p,k]=s.useState(null),x=Me(N,r=>k(r)),L=s.useRef(!1),c=p?j||!!p.closest("form"):!0,[n,t]=ft({prop:u,defaultProp:i??!1,onChange:S,caller:me});return e.jsxs(Xt,{scope:v,checked:n,disabled:f,children:[e.jsx(Oe.button,{type:"button",role:"switch","aria-checked":n,"aria-required":b,"data-state":We(n),"data-disabled":f?"":void 0,disabled:f,value:g,..._,ref:x,onClick:Jt(l.onClick,r=>{t(a=>!a),c&&(L.current=r.isPropagationStopped(),L.current||r.stopPropagation())})}),c&&e.jsx(Je,{control:p,bubbles:!L.current,name:h,value:g,checked:n,required:b,disabled:f,form:j,style:{transform:"translateX(-100%)"}})]})});He.displayName=me;var Ve="SwitchThumb",Ke=s.forwardRef((l,N)=>{const{__scopeSwitch:v,...h}=l,u=Gt(Ve,v);return e.jsx(Oe.span,{"data-state":We(u.checked),"data-disabled":u.disabled?"":void 0,...h,ref:N})});Ke.displayName=Ve;var Qt="SwitchBubbleInput",Je=s.forwardRef(({__scopeSwitch:l,control:N,checked:v,bubbles:h=!0,...u},i)=>{const b=s.useRef(null),f=Me(b,i),g=yt(v),S=gt(N);return s.useEffect(()=>{const j=b.current;if(!j)return;const _=window.HTMLInputElement.prototype,k=Object.getOwnPropertyDescriptor(_,"checked").set;if(g!==v&&k){const x=new Event("click",{bubbles:h});k.call(j,v),j.dispatchEvent(x)}},[g,v,h]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:v,...u,tabIndex:-1,ref:f,style:{...u.style,...S,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Je.displayName=Qt;function We(l){return l?"checked":"unchecked"}var Xe=He,Zt=Ke;const Ge=s.forwardRef(({className:l,...N},v)=>e.jsx(Xe,{className:Ie("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",l),...N,ref:v,children:e.jsx(Zt,{className:Ie("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));Ge.displayName=Xe.displayName;function es({isOpen:l,onClose:N,onSaveSuccess:v,semesterId:h,semesterName:u,initialData:i}){const[b,f]=s.useState(!1),[g,S]=s.useState(""),[j,_]=s.useState(""),[p,k]=s.useState(!1);s.useEffect(()=>{if(l)if(i){f(i.isActive);const c=n=>{if(!n)return"";const t=new Date(n),r=(t.getMonth()+1).toString().padStart(2,"0"),a=t.getDate().toString().padStart(2,"0"),o=t.getFullYear();return`${r}-${a}-${o}`};S(c(i.startDate)),_(c(i.endDate))}else f(!1),S(""),_("")},[l,i]);const x=async c=>{if(c.preventDefault(),!h){m.error("Semester ID is missing.");return}if(b&&(!g||!j)){m.error("Start and end dates are required when semester is Active.");return}if(g&&j&&new Date(g)>new Date(j)){m.error("Start date cannot be after the end date.");return}const n=localStorage.getItem("accessToken");if(!n){m.error("Authentication required.");return}k(!0);try{const t=`/semesters/${h}/status`,r=A=>A?new Date(A).toISOString().split("T")[0]:null,a={status:b?1:0,start_date:r(g),end_date:r(j)},o=await M.put(t,a,{headers:{Authorization:`Bearer ${n}`}});m.success(o.data.message||"Semester status updated!"),v(u,{isActive:b,startDate:g||void 0,endDate:j||void 0}),N()}catch(t){m.error(t.response?.data?.message||"Failed to update semester.")}finally{k(!1)}},L=c=>{if(!c)return"";const n=new Date(c),t=n.getFullYear(),r=(n.getMonth()+1).toString().padStart(2,"0"),a=n.getDate().toString().padStart(2,"0");return`${t}-${r}-${a}`};return e.jsx(G,{open:l,onOpenChange:N,children:e.jsxs(Q,{children:[e.jsx(Z,{children:e.jsx(ee,{children:"Set Semester Status & Dates"})}),e.jsxs("form",{onSubmit:x,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Semester"}),e.jsx("p",{className:"font-semibold text-lg",children:u})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[e.jsx(Ge,{id:"semester-status",checked:b,onCheckedChange:f}),e.jsx(F,{htmlFor:"semester-status",className:"cursor-pointer",children:b?"Active":"Inactive"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"startDate",children:"Start Date"}),e.jsx(q,{id:"startDate",type:"date",value:L(g),onChange:c=>S(c.target.value),required:b})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"endDate",children:"End Date"}),e.jsx(q,{id:"endDate",type:"date",value:L(j),onChange:c=>_(c.target.value),required:b})]})]}),e.jsxs(te,{className:"pt-4",children:[e.jsx(se,{asChild:!0,children:e.jsx(P,{type:"button",variant:"outline",disabled:p,children:"Cancel"})}),e.jsx(P,{type:"submit",disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"mr-2 h-4 w-4 animate-spin"})," Saving..."]}):"Save Settings"})]})]})]})})}function ts(){const[l,N]=s.useState([]),[v,h]=s.useState(!0),[u,i]=s.useState(""),[b,f]=s.useState("All Years"),[g,S]=s.useState("Active"),[j,_]=s.useState(null),[p,k]=s.useState(!1),[x,L]=s.useState(null),[c,n]=s.useState(!1),[t,r]=s.useState(!1),[a,o]=s.useState(!1),[A,E]=s.useState(!1),[C,Y]=s.useState(0),[ne,de]=s.useState(null),[oe,we]=s.useState(null),[he,xe]=s.useState(null),[re,Le]=s.useState(null),[je,Qe]=s.useState({name:null,semester:null}),[Ce,Ze]=s.useState({id:null,name:null}),_e=vt(),H=s.useCallback(async(d=!0)=>{d&&h(!0);const w=localStorage.getItem("accessToken");if(!w){m.error("Authentication required."),h(!1),_e("/facultyscheduler/user-login");return}try{const T=await M.get("/program",{headers:{Authorization:`Bearer ${w}`}}),ie=(Array.isArray(T.data.programs)?T.data.programs:Object.values(T.data.programs||{})).map($=>({id:$.id,name:$.program_name,abbreviation:$.abbreviation,effectiveYear:`${$.year_from}-${$.year_to}`,total_subjects:$.total_subjects||0,total_units:$.total_units||0,isActive:$.status===0,semesters:$.semesters?Object.entries($.semesters).reduce((ce,[z,D])=>(ce[z]={id:D.id,subjects:(D.subjects||[]).map(O=>({id:O.id,code:O.subject_code,name:O.des_title,unitsTotal:O.total_units,unitsLec:O.lec_units,unitsLab:O.lab_units,hoursTotal:O.total_hrs,hoursLec:O.total_lec_hrs,hoursLab:O.total_lab_hrs,prerequisite:O.pre_requisite||""})),isActive:D.status===1,startDate:D.start_date,endDate:D.end_date},ce),{}):{},subjects:$.subjects||{}}));N(ie)}catch{m.error("Failed to fetch programs.")}finally{d&&h(!1)}},[_e]);s.useEffect(()=>{H(!0)},[H]),s.useEffect(()=>{ne&&de(null)},[ne]),s.useEffect(()=>{oe&&we(null)},[oe]),s.useEffect(()=>{he&&xe(null)},[he]);const et=(d,w)=>{Qe({name:d,semester:w}),E(!0)},tt=(d,w)=>{Ze({id:d,name:w}),r(!0)},st=()=>{H(!1),k(!1)},rt=()=>{L(null),k(!0)},at=d=>{L(d),k(!0)},[B,le]=s.useState(null),[pe,Ae]=s.useState(!1),nt=d=>{le({open:!0,title:"Archive Program",description:"This will move the program to the archives and make it inactive.",confirmText:"Yes, archive it!",confirmVariant:"destructive",onConfirm:async()=>{const w=localStorage.getItem("accessToken");if(!w){m.error("Authentication required.");return}try{const T=await M.post(`/archive-program/${d}`,{},{headers:{Authorization:`Bearer ${w}`}});m.success(T.data?.message||"Program archived successfully."),await H(!1)}catch{m.error("Failed to archive program.")}}})},ot=d=>{le({open:!0,title:"Restore Program",description:"This will make the program active again.",confirmText:"Yes, restore it!",confirmVariant:"default",onConfirm:async()=>{const w=localStorage.getItem("accessToken");if(!w){m.error("Authentication required.");return}try{await M.post(`/restore-program/${d}`,{},{headers:{Authorization:`Bearer ${w}`}}),m.success("Program restored successfully."),await H(!1)}catch{m.error("Failed to restore program.")}}})},lt=(d,w)=>{Le({semester:d,semesterId:w,subject:null}),o(!0)},it=(d,w)=>{const T=j?.semesters?.[d]?.id;Le({semester:d,semesterId:T,subject:w}),o(!0)},ct=(d,w)=>{if(!w){m.error("Could not find subject ID to delete.");return}le({open:!0,title:"Delete Subject",description:"This will permanently delete this subject. This action cannot be reverted.",confirmText:"Yes, delete it!",confirmVariant:"destructive",onConfirm:async()=>{const T=localStorage.getItem("accessToken");if(!T){m.error("Authentication required.");return}try{await M.delete(`/subjects/${w}`,{headers:{Authorization:`Bearer ${T}`}}),m.success("Subject deleted successfully!"),Y(ae=>ae+1),await H(!1)}catch{m.error("Failed to delete subject.")}}})},dt=async(d,w,T,ae)=>{if(!j){m.error("No program selected.");return}const ie=localStorage.getItem("accessToken");if(!ie){m.error("Authentication required.");return}try{const $=w??j?.semesters?.[d]?.id;if(!ae&&!$){m.error("Semester ID not found.");return}const ce={subject_code:T.code,des_title:T.name,total_units:T.unitsTotal,lec_units:T.unitsLec,lab_units:T.unitsLab,total_hrs:T.hoursTotal,total_lec_hrs:T.hoursLec,total_lab_hrs:T.hoursLab,pre_requisite:T.prerequisite||null};let z;if(ae){if(!T.id){m.error("Subject ID missing for update.");return}z=await M.put(`/subjects/${T.id}`,ce,{headers:{Authorization:`Bearer ${ie}`}}),m.success("Subject updated successfully.")}else z=await M.post(`/semesters/${$}/subjects`,ce,{headers:{Authorization:`Bearer ${ie}`}}),m.success("Subject added successfully.");if(z.data?.subject){const D={id:z.data.subject.id,code:z.data.subject.subject_code,name:z.data.subject.des_title,unitsTotal:z.data.subject.total_units,unitsLec:z.data.subject.lec_units,unitsLab:z.data.subject.lab_units,hoursTotal:z.data.subject.total_hrs,hoursLec:z.data.subject.total_lec_hrs,hoursLab:z.data.subject.total_lab_hrs,prerequisite:z.data.subject.pre_requisite||"None"};de({semesterName:d,subject:D})}else Y(D=>D+1);await H(!1)}catch{m.error("Failed to save subject.")}},ut=d=>{we(d),H(!1)},mt=(d,w)=>{xe({name:d,semester:w})},ht=(d,w)=>{xe({name:d,semester:{},newName:w})},xt=s.useMemo(()=>{const d=new Set(l.map(w=>w.effectiveYear));return["All Years",...Array.from(d).sort((w,T)=>T.localeCompare(w))]},[l]),Te=s.useMemo(()=>l.filter(d=>d.name.toLowerCase().includes(u.toLowerCase())||d.abbreviation.toLowerCase().includes(u.toLowerCase())).filter(d=>b==="All Years"||d.effectiveYear===b).filter(d=>g==="All"?!0:g==="Active"?d.isActive:!d.isActive),[l,u,b,g]);return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground tracking-tight",children:"Curriculum Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage academic programs, semesters, and their subjects."})]}),e.jsx("div",{className:"bg-card p-4 md:p-6 rounded-lg shadow-sm border border-border mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-center",children:[e.jsxs("div",{className:"relative w-full md:flex-grow",children:[e.jsx(Lt,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:20}),e.jsx(q,{type:"text",placeholder:"Search program...",className:"pl-10 w-full",value:u,onChange:d=>i(d.target.value)})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3 w-full md:w-auto",children:[e.jsxs(V,{value:b,onValueChange:f,children:[e.jsxs(K,{className:"w-full sm:w-auto md:w-[180px]",children:[e.jsx(ze,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsx(J,{placeholder:"Filter by A.Y."})]}),e.jsx(W,{children:xt.map(d=>e.jsx(R,{value:d,children:d},d))})]}),e.jsxs(V,{value:g,onValueChange:S,children:[e.jsxs(K,{className:"w-full sm:w-auto md:w-[180px]",children:[e.jsx(_t,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsx(J,{placeholder:"Filter by Status"})]}),e.jsxs(W,{children:[e.jsx(R,{value:"All",children:"All"}),e.jsx(R,{value:"Active",children:"Active"}),e.jsx(R,{value:"Inactive",children:"Inactive"})]})]}),e.jsxs(P,{onClick:rt,className:"w-full sm:w-auto",children:[e.jsx(ye,{size:16,className:"mr-2"})," Add Program"]})]})]})}),v?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:3}).map((d,w)=>e.jsx(Yt,{},w))}):e.jsx(St,{children:Te.length>0?e.jsx(be.div,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Te.map((d,w)=>e.jsx(Ft,{program:d,index:w,onEdit:at,onArchive:nt,onRestore:ot,onManage:()=>_(d)},d.id))}):e.jsxs(be.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-20 text-muted-foreground",children:[e.jsx(Pt,{size:56,className:"mx-auto mb-4"}),e.jsx("h4",{className:"font-semibold text-xl text-foreground",children:"No Programs Found"}),e.jsx("p",{children:"Try adjusting your filters or add a new program."})]})}),e.jsx(Ot,{isOpen:p,onClose:()=>k(!1),onSave:st,initialData:x}),B&&e.jsx(G,{open:B.open,onOpenChange:d=>!d&&le(null),children:e.jsxs(Q,{children:[e.jsxs(Z,{children:[e.jsx(ee,{children:B.title}),B.description&&e.jsx(ve,{children:B.description})]}),e.jsxs(te,{children:[e.jsx(se,{asChild:!0,children:e.jsx(P,{variant:"outline",disabled:pe,children:"Cancel"})}),e.jsx(P,{onClick:async()=>{if(B?.onConfirm){Ae(!0);try{await B.onConfirm()}finally{Ae(!1),le(null)}}},disabled:pe,variant:B.confirmVariant,children:pe?"Processing...":B.confirmText||"Confirm"})]})]})}),j&&e.jsx(zt,{isOpen:!!j,onClose:()=>_(null),program:j,onAddSemester:()=>n(!0),onEditSemester:tt,onDeleteSemester:()=>{},onAddSubject:lt,onEditSubject:it,onDeleteSubject:ct,onSetSemesterStatus:et,refreshKey:C,updatedSubjectData:ne,newSemesterData:oe,updatedSemesterData:he}),e.jsx(Dt,{isOpen:c,onClose:()=>n(!1),onSave:ut,programId:j?j.id:0}),e.jsx(Vt,{isOpen:t,onClose:()=>r(!1),onSaveSuccess:ht,semesterId:Ce.id,initialData:Ce.name||""}),re&&e.jsx(Kt,{isOpen:a,onClose:()=>o(!1),onSave:(d,w)=>dt(re.semester,re.semesterId,d,w),initialData:re.subject,programId:j?.id??0,semesterName:re.semester||"",semesterId:re.semesterId}),e.jsx(es,{isOpen:A,onClose:()=>E(!1),onSaveSuccess:mt,semesterId:je?.semester?.id||null,semesterName:je?.name||"",initialData:je?.semester||null})]})}function vs(){return e.jsx("main",{children:e.jsx(ts,{})})}export{vs as default};
