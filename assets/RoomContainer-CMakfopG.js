import{c as ye,j as e,B as T,r as l,T as ke,s as U,v as W,w as J,t as p,a as D}from"./index-OPaprxhi.js";import{T as Ae,a as Me,b as ie,c as ce}from"./tabs-DMNIAjGF.js";import{T as le,a as ne,b as P,c as M,d as oe,e as f}from"./table-B2OUfQ9V.js";import{I as B}from"./input-BYhbHLVf.js";import{S as q,a as H,b as Y,c as G,d as z}from"./select-r8uDAhXK.js";import{B as Ie}from"./badge-CTm3coYD.js";import{D as Q,a as X,b as Z,c as ee,e as se,f as te,S as L,d as Ne}from"./dialog-B7vVHQq0.js";import{S as Re}from"./search-B-KhkR3H.js";import{F as _e}from"./funnel-CmN29CdF.js";import{E as $e}from"./eye-CDa8H3Zi.js";import{S as Fe}from"./square-pen-Bwaq_TJn.js";import{T as Se,P as Le}from"./trash-2-DTupxB7F.js";import{C as De}from"./chevron-left-CfankGQi.js";import{C as Pe}from"./chevron-right-B-LvHPFy.js";import{C as de,a as he,c as me,d as Ee,b as ue}from"./card-D5eL2WsC.js";import{L as E}from"./label-s_wDV_Zn.js";import{L as xe}from"./loader-circle-CO1KivE4.js";import{C as ze}from"./circle-plus-B_3saWs4.js";import"./Combination-N5JmmW9F.js";import"./check-fQlgCkkG.js";import"./chevron-up-DcQHaALJ.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=[["path",{d:"M16 19h6",key:"xwg31i"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M19 16v6",key:"tddt3s"}],["path",{d:"M21 12.598V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8.5",key:"1glfrc"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}]],Oe=ye("calendar-plus",Ve);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M6 10H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-2",key:"4b9dqc"}],["path",{d:"M6 14H4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-2",key:"22nnkd"}],["path",{d:"M6 6h.01",key:"1utrut"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"m13 6-4 6h6l-4 6",key:"14hqih"}]],qe=ye("server-crash",Be);function He({isOpen:o,onClose:d,room:i,scheduleData:t,subjectsData:b}){if(!i)return null;const c=t.filter(h=>h.roomId===i.id);return e.jsx(Q,{open:o,onOpenChange:d,children:e.jsxs(X,{className:"max-w-2xl",children:[e.jsx(Z,{children:e.jsxs(ee,{className:"text-2xl font-bold",children:["Schedule for Room: ",i.roomNumber]})}),e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"rounded-lg border",children:e.jsxs(le,{children:[e.jsx(ne,{children:e.jsxs(P,{children:[e.jsx(M,{children:"Subject"}),e.jsx(M,{children:"Day"}),e.jsx(M,{children:"Time"})]})}),e.jsx(oe,{children:c.length>0?c.map(h=>{const u=b.find(v=>v.id===h.subjectId);return e.jsxs(P,{children:[e.jsx(f,{children:u?`${u.code} - ${u.name}`:"Unknown Subject"}),e.jsx(f,{children:h.day}),e.jsxs(f,{children:[h.startTime," - ",h.endTime]})]},h.scheduleId)}):e.jsx(P,{children:e.jsx(f,{colSpan:3,className:"text-center h-24",children:"No classes scheduled for this room."})})})]})})}),e.jsx(se,{className:"pt-4",children:e.jsx(te,{asChild:!0,children:e.jsx(T,{type:"button",variant:"outline",children:"Close"})})})]})})}const Ye=(o,d)=>new Set(d.filter(t=>t.roomId===o).map(t=>t.subjectId)).size,Ge=()=>e.jsxs(P,{children:[e.jsx(f,{children:e.jsx(L,{className:"h-5 w-28"})}),e.jsx(f,{children:e.jsx(L,{className:"h-5 w-24"})}),e.jsx(f,{className:"text-center",children:e.jsx(L,{className:"h-5 w-10 mx-auto"})}),e.jsx(f,{children:e.jsx(L,{className:"h-5 w-10"})}),e.jsx(f,{children:e.jsx(L,{className:"h-6 w-20"})}),e.jsx(f,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(L,{className:"h-8 w-8 rounded-md"}),e.jsx(L,{className:"h-8 w-8 rounded-md"}),e.jsx(L,{className:"h-8 w-8 rounded-md"}),e.jsx(L,{className:"h-8 w-8 rounded-md"})]})})]});function Ue({roomsData:o,scheduleData:d,subjectsData:i,onEdit:t,onDelete:b,onManageAvailability:c,isLoading:h}){const[u,v]=l.useState(""),[k,N]=l.useState({type:"All"}),[w,C]=l.useState(1),[S]=l.useState(10),[I,a]=l.useState(!1),[s,m]=l.useState(null),g=l.useMemo(()=>o.filter(r=>r.roomNumber.toLowerCase().includes(u.toLowerCase())).filter(r=>k.type==="All"||r.type===k.type),[o,u,k]),$=l.useMemo(()=>{const r=(w-1)*S;return g.slice(r,r+S)},[g,w,S]),x=Math.ceil(g.length/S),j=r=>{m(r),a(!0)},y=["All","Lecture","Laboratory"];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-card p-4 md:p-6 rounded-lg shadow-sm border border-border",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-center mb-6",children:[e.jsxs("div",{className:"relative w-full md:max-w-xs",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:20}),e.jsx(B,{placeholder:"Search by room...",className:"pl-10 w-full",value:u,onChange:r=>{v(r.target.value),C(1)}})]}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center gap-3 w-full md:w-auto",children:e.jsxs(q,{value:k.type,onValueChange:r=>{N({type:r}),C(1)},children:[e.jsxs(H,{className:"w-full sm:w-auto md:w-[180px]",children:[e.jsx(_e,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsx(Y,{placeholder:"All Types"})]}),e.jsx(G,{children:y.map(r=>e.jsx(z,{value:r,children:r},r))})]})})]}),e.jsx("div",{className:"rounded-lg border border-border overflow-x-auto",children:e.jsxs(le,{className:"min-w-[600px]",children:[e.jsx(ne,{className:"bg-muted/50",children:e.jsxs(P,{children:[e.jsx(M,{children:"Room"}),e.jsx(M,{children:"Type"}),e.jsx(M,{className:"text-center",children:"Capacity"}),e.jsx(M,{children:"Total Subjects"}),e.jsx(M,{children:"Status"}),e.jsx(M,{className:"text-right",children:"Actions"})]})}),e.jsx(oe,{children:h?Array.from({length:S}).map((r,n)=>e.jsx(Ge,{},n)):$.length===0?e.jsx(P,{children:e.jsx(f,{colSpan:6,className:"text-center h-48 text-muted-foreground",children:"No rooms found."})}):$.map(r=>{const n=Ye(r.id,d),A=r.status===0;return e.jsxs(P,{className:"hover:bg-muted",children:[e.jsx(f,{children:e.jsx("p",{className:"font-semibold text-foreground",children:r.roomNumber})}),e.jsx(f,{className:"text-muted-foreground",children:r.type}),e.jsx(f,{className:"text-center text-muted-foreground",children:r.capacity??"--"}),e.jsx(f,{className:"text-muted-foreground",children:n}),e.jsx(f,{children:e.jsx(Ie,{variant:A?"default":"destructive",children:A?"Active":"Inactive"})}),e.jsx(f,{className:"text-right",children:e.jsx(ke,{delayDuration:100,children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsxs(U,{children:[e.jsx(W,{asChild:!0,children:e.jsx(T,{variant:"ghost",className:"text-purple-500 hover:text-purple-500",size:"icon",onClick:()=>c(r),children:e.jsx(Oe,{className:"h-4 w-4"})})}),e.jsx(J,{children:e.jsx("p",{children:"Manage Availability"})})]}),e.jsxs(U,{children:[e.jsx(W,{asChild:!0,children:e.jsx(T,{variant:"ghost",className:"text-blue-500 hover:text-blue-500",size:"icon",onClick:()=>j(r),children:e.jsx($e,{className:"h-4 w-4"})})}),e.jsx(J,{children:e.jsx("p",{children:"View Schedule"})})]}),e.jsxs(U,{children:[e.jsx(W,{asChild:!0,children:e.jsx(T,{variant:"ghost",className:"text-green-500 hover:text-green-500",size:"icon",onClick:()=>t(r),children:e.jsx(Fe,{className:"h-4 w-4"})})}),e.jsx(J,{children:e.jsx("p",{children:"Edit Room Details"})})]}),e.jsxs(U,{children:[e.jsx(W,{asChild:!0,children:e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>b(r.id),className:"text-destructive hover:text-destructive/90",children:e.jsx(Se,{className:"h-4 w-4"})})}),e.jsx(J,{children:e.jsx("p",{children:"Delete Room"})})]})]})})})]},r.id)})})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mt-6 text-sm gap-4",children:[e.jsxs("p",{className:"text-muted-foreground",children:["Showing ",e.jsx("strong",{children:$.length>0?(w-1)*S+1:0})," to ",e.jsx("strong",{children:Math.min(w*S,g.length)})," of ",e.jsx("strong",{children:g.length})," entries"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>C(r=>Math.max(1,r-1)),disabled:w===1,children:[e.jsx(De,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsxs("span",{className:"font-medium text-foreground px-2",children:["Page ",w," of ",x||1]}),e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>C(r=>Math.min(x,r+1)),disabled:w>=x,children:["Next",e.jsx(Pe,{className:"h-4 w-4 ml-1"})]})]})]})]}),e.jsx(He,{isOpen:I,onClose:()=>a(!1),room:s,scheduleData:d,subjectsData:i})]})}const je=["Mon","Tues","Wed","Thurs","Fri","Sat"],K=7,we=18,re=we-K,pe=[{bg:"bg-blue-100",border:"border-blue-400",text:"text-blue-800"},{bg:"bg-green-100",border:"border-green-400",text:"text-green-800"},{bg:"bg-purple-100",border:"border-purple-400",text:"text-purple-800"},{bg:"bg-orange-100",border:"border-orange-400",text:"text-orange-800"},{bg:"bg-red-100",border:"border-red-400",text:"text-red-800"},{bg:"bg-yellow-100",border:"border-yellow-400",text:"text-yellow-800"},{bg:"bg-indigo-100",border:"border-indigo-400",text:"text-indigo-800"},{bg:"bg-pink-100",border:"border-pink-400",text:"text-pink-800"}],We=o=>pe[o%pe.length],be=o=>{const[d,i]=o.split(":");let t=parseInt(d,10);const b=parseInt(i,10),c=t>=12?"PM":"AM";t=t%12||12;const h=b<10?`0${b}`:b;return`${t}:${h} ${c}`},ge=o=>{const[d,i]=o.split(":").map(Number);return d*60+i},Je=({scheduleData:o,subjectsData:d,roomsData:i})=>{const[t,b]=l.useState(null),[c,h]=l.useState(null),[u,v]=l.useState(!1),k=()=>{t!==null&&c!==null&&v(!0)},N=()=>{b(null),h(null),v(!1)},w=s=>{b(parseInt(s,10)),h(null),v(!1)},C=s=>{h(s),v(!1)},S=l.useMemo(()=>[...new Set(d.map(s=>s.yearLevel))].sort((s,m)=>s-m),[d]),I=l.useMemo(()=>{if(t===null)return[];const s=d.filter(g=>g.yearLevel===t).map(g=>g.id),m=o.filter(g=>s.includes(g.subjectId));return[...new Set(m.map(g=>g.section))].sort()},[t,o,d]),a=()=>{if(!u||t===null||c===null)return null;const s=d.filter(x=>x.yearLevel===t).map(x=>x.id),m=o.filter(x=>s.includes(x.subjectId)&&x.section===c);if(m.length===0)return e.jsx("div",{className:"text-center text-muted-foreground p-12 mt-8 border-2 border-dashed rounded-lg",children:"No schedule data available for this section."});const g=(we-K)*60,$=t===1?"st":t===2?"nd":t===3?"rd":"th";return e.jsx("div",{className:"space-y-8 mt-8",children:e.jsxs(de,{className:"overflow-hidden",children:[e.jsx(he,{children:e.jsx(me,{children:`${t}${$} Year - Section ${c}`})}),e.jsx(ue,{className:"p-0",children:e.jsx("div",{className:"border border-border rounded-lg overflow-hidden",children:e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"w-20 flex-shrink-0 relative bg-slate-50 dark:bg-slate-800/50",children:[e.jsx("div",{className:"h-12 border-b border-border"})," ",Array.from({length:re}).map((x,j)=>e.jsx("div",{className:"h-16 border-b border-border"},j)),Array.from({length:re+1}).map((x,j)=>{const y=K+j,r=y>12?y-12:y===0?12:y,n=y>=12?"PM":"AM";return e.jsx("div",{className:"absolute right-3",style:{top:`calc(3rem + ${j*4}rem)`},children:e.jsxs("span",{className:"text-[11px] text-muted-foreground -translate-y-1/2",children:[r,":00 ",n]})},y)})]}),e.jsxs("div",{className:"flex-1 grid grid-cols-6",children:[je.map(x=>e.jsx("div",{className:"h-12 text-center font-medium text-sm text-foreground border-b border-border flex items-center justify-center bg-slate-50 dark:bg-slate-800/50 border-l",children:x},x)),je.map(x=>e.jsxs("div",{className:"relative border-l border-border bg-background",children:[Array.from({length:re}).map((j,y)=>e.jsx("div",{className:"h-16 border-b border-border"},y)),m.filter(j=>j.day===x).map(j=>{const y=d.find(O=>O.id===j.subjectId),r=i.find(O=>O.id===j.roomId);if(!y)return null;const n=ge(j.startTime),R=ge(j.endTime)-n,F=(n-K*60)/g*100,_=R/g*100,V=We(y.id);return e.jsx("div",{className:"absolute w-full px-1",style:{top:`${F}%`,height:`${_}%`},children:e.jsxs("div",{className:`rounded-lg p-2 h-full flex flex-col overflow-hidden ${V.bg} ${V.border} ${V.text} border-l-4 shadow transition-all duration-200 ease-in-out transform hover:scale-[1.02] hover:shadow-lg hover:z-10`,children:[e.jsx("p",{className:"font-bold text-xs leading-tight truncate",children:y.code}),e.jsx("p",{className:"text-[11px] opacity-80 leading-tight flex-1 truncate",children:y.name}),e.jsxs("div",{className:"mt-1 text-[10px] opacity-90",children:[e.jsx("p",{className:"truncate",children:r?.roomNumber||"N/A"}),e.jsxs("p",{children:[be(j.startTime)," - ",be(j.endTime)]})]})]})},j.scheduleId)})]},x))]})]})})})]})})};return e.jsxs("div",{children:[e.jsxs(de,{className:"w-full mx-auto",children:[e.jsxs(he,{children:[e.jsx(me,{children:"Generate Section Schedule"}),e.jsx(Ee,{children:"Select a year and section to view the weekly class schedule."})]}),e.jsx(ue,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"year-level",children:"Select Year Level"}),e.jsxs(q,{onValueChange:w,value:t?.toString()??"",children:[e.jsx(H,{id:"year-level",children:e.jsx(Y,{placeholder:"Select a year..."})}),e.jsx(G,{children:S.map(s=>e.jsxs(z,{value:s.toString(),children:[s,s===1?"st":s===2?"nd":s===3?"rd":"th"," Year"]},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"section",children:"Select Section"}),e.jsxs(q,{onValueChange:C,value:c??"",disabled:t===null,children:[e.jsx(H,{id:"section",children:e.jsx(Y,{placeholder:"Select a section..."})}),e.jsx(G,{children:I.map(s=>e.jsxs(z,{value:s,children:["Section ",s]},s))})]})]}),e.jsx(T,{onClick:k,className:"w-full",disabled:t===null||c===null,children:"Generate Schedule"}),e.jsx(T,{onClick:N,variant:"destructive",className:"w-full",disabled:t===null&&c===null,children:"Clear"})]})})]}),u?a():e.jsx("div",{className:"mt-8 flex items-center justify-center text-center text-muted-foreground p-12 border-2 border-dashed rounded-lg",children:e.jsx("p",{children:'Please select a year level and section, then click "Generate Schedule" to view the timetable.'})})]})};function Ke({isOpen:o,onClose:d,onSave:i,initialData:t}){const b={roomNumber:"",type:"Lecture",capacity:40},[c,h]=l.useState(b),[u,v]=l.useState(!1);l.useEffect(()=>{o&&h(t?{roomNumber:t.roomNumber,type:t.type,capacity:t.capacity}:b)},[t,o]);const k=async C=>{C.preventDefault(),v(!0);try{await i(c)}finally{v(!1)}},N=C=>{const{name:S,value:I}=C.target;h(a=>({...a,[S]:S==="capacity"?I===""?null:Number(I):I}))},w=C=>{h(S=>({...S,type:C}))};return e.jsx(Q,{open:o,onOpenChange:d,children:e.jsxs(X,{className:"sm:max-w-[425px]",children:[e.jsx(Z,{children:e.jsx(ee,{className:"text-xl font-bold",children:t?"Edit Room":"Add New Room"})}),e.jsxs("form",{onSubmit:k,className:"py-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"roomNumber",className:"text-right",children:"Room Number / Name"}),e.jsx(B,{id:"roomNumber",name:"roomNumber",value:c.roomNumber,onChange:N,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"type",children:"Type"}),e.jsxs(q,{value:c.type,onValueChange:w,children:[e.jsx(H,{id:"type",children:e.jsx(Y,{})}),e.jsxs(G,{children:[e.jsx(z,{value:"Lecture",children:"Lecture"}),e.jsx(z,{value:"Laboratory",children:"Laboratory"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(E,{htmlFor:"capacity",children:["Capacity ",e.jsx("span",{className:"text-muted-foreground text-xs",children:"(Optional)"})]}),e.jsx(B,{id:"capacity",name:"capacity",type:"number",min:"1",value:c.capacity??"",onChange:N})]})]}),e.jsxs(se,{className:"pt-4",children:[e.jsx(te,{asChild:!0,children:e.jsx(T,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(T,{type:"submit",disabled:u,children:u?"Saving...":"Save Room"})]})]})]})})}const ae=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],fe=o=>{if(!o)return"";const[d,i]=o.split(":"),t=parseInt(d,10),b=t>=12?"PM":"AM",c=t%12||12;return`${String(c).padStart(2,"0")}:${i} ${b}`};function Qe({isOpen:o,onClose:d,room:i}){const[t,b]=l.useState([]),[c,h]=l.useState(!0),[u,v]=l.useState(!1),k={day:"Monday",start_time:"07:00",end_time:"12:00"},[N,w]=l.useState(k);l.useEffect(()=>{(async()=>{if(o&&i){h(!0);try{const s=localStorage.getItem("accessToken");if(!s){p.error("Authentication required.");return}const m=await D.get(`/rooms/${i.id}/availabilities`,{headers:{Authorization:`Bearer ${s}`}});b(m.data.availabilities||[])}catch(s){p.error("Failed to fetch availability."),console.error("Fetch availability error:",s)}finally{h(!1)}}})()},[o,i]);const C=(a,s)=>{w(m=>({...m,[a]:s}))},S=async a=>{if(a.preventDefault(),!!i){if(N.start_time>=N.end_time){p.error("End time must be after start time.");return}v(!0);try{const s=localStorage.getItem("accessToken"),m={availabilities:[{...N,start_time:`${N.start_time}:00`,end_time:`${N.end_time}:00`}]},$=(await D.post(`/rooms/${i.id}/availabilities`,m,{headers:{Authorization:`Bearer ${s}`}})).data.availabilities;b(x=>[...x,...$].sort((j,y)=>ae.indexOf(j.day)-ae.indexOf(y.day)||j.start_time.localeCompare(y.start_time))),w(k),p.success("New availability slot added!")}catch(s){if(s.response?.status===422){const m=s.response.data.errors;m&&m["availabilities.0.day"]?p.error(m["availabilities.0.day"][0]):p.error("Invalid data provided. Please check the time format and day.")}else p.error("Failed to add new slot. Please try again."),console.error("Add slot error:",s)}finally{v(!1)}}},I=async a=>{v(!0);try{const s=localStorage.getItem("accessToken");await D.delete(`/availabilities/${a}`,{headers:{Authorization:`Bearer ${s}`}}),b(m=>m.filter(g=>g.id!==a)),p.success("Availability slot deleted.")}catch{p.error("Failed to delete slot.")}finally{v(!1)}};return e.jsx(Q,{open:o,onOpenChange:d,children:e.jsxs(X,{className:"sm:max-w-2xl",children:[e.jsxs(Z,{children:[e.jsxs(ee,{children:["Manage Availability for ",i?.roomNumber]}),e.jsx(Ne,{children:"View, add, or delete the available time slots for this room."})]}),e.jsxs("div",{className:"py-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Existing Slots"}),e.jsx("div",{className:"border rounded-lg max-h-64 overflow-y-auto",children:c?e.jsxs("div",{className:"flex items-center justify-center h-24 text-muted-foreground",children:[e.jsx(xe,{className:"mr-2 h-4 w-4 animate-spin"}),"Fetching data..."]}):t.length>0?e.jsxs(le,{children:[e.jsx(ne,{children:e.jsxs(P,{children:[e.jsx(M,{children:"Day"}),e.jsx(M,{children:"Start Time"}),e.jsx(M,{children:"End Time"}),e.jsx(M,{className:"text-right",children:"Action"})]})}),e.jsx(oe,{children:t.map(a=>e.jsxs(P,{children:[e.jsx(f,{children:a.day}),e.jsx(f,{children:fe(a.start_time)}),e.jsx(f,{children:fe(a.end_time)}),e.jsx(f,{className:"text-right",children:e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>I(a.id),disabled:u,children:e.jsx(Se,{className:"h-4 w-4 text-destructive"})})})]},a.id))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-24 text-muted-foreground",children:[e.jsx(qe,{className:"h-6 w-6 mb-2"}),e.jsx("p",{children:"No availability slots found for this room."})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Add New Slot"}),e.jsxs("form",{onSubmit:S,className:"grid grid-cols-1 sm:grid-cols-4 gap-3 items-end p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{htmlFor:"day",children:"Day"}),e.jsxs(q,{value:N.day,onValueChange:a=>C("day",a),children:[e.jsx(H,{id:"day",children:e.jsx(Y,{})}),e.jsx(G,{children:ae.map(a=>e.jsx(z,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{htmlFor:"start_time",children:"Start Time"}),e.jsx(B,{id:"start_time",type:"time",value:N.start_time,onChange:a=>C("start_time",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{htmlFor:"end_time",children:"End Time"}),e.jsx(B,{id:"end_time",type:"time",value:N.end_time,onChange:a=>C("end_time",a.target.value),required:!0})]}),e.jsxs(T,{type:"submit",disabled:u,children:[u?e.jsx(xe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ze,{className:"mr-2 h-4 w-4"}),"Add Slot"]})]})]})]}),e.jsx(se,{children:e.jsx(te,{asChild:!0,children:e.jsx(T,{type:"button",variant:"outline",children:"Close"})})})]})})}const ve=[{scheduleId:1,roomId:1,subjectId:7,section:"A",day:"Mon",startTime:"09:00",endTime:"10:30"}];function fs(){const[o,d]=l.useState([]),[i,t]=l.useState([]),[b,c]=l.useState(!0),[h,u]=l.useState(!1),[v,k]=l.useState(null),[N,w]=l.useState({open:!1,roomId:null}),[C,S]=l.useState(!1),[I,a]=l.useState(null),s=l.useCallback(async()=>{try{const n=localStorage.getItem("accessToken");if(!n){p.error("Authentication required.");return}const A=await D.get("/rooms",{headers:{Authorization:`Bearer ${n}`}});d(A.data.rooms||[])}catch(n){p.error("Failed to fetch rooms."),console.error("Fetch Rooms Error:",n)}},[]),m=l.useCallback(async()=>{try{const n=localStorage.getItem("accessToken");if(!n){p.error("Authentication required.");return}const F=((await D.get("/get-subjects",{headers:{Authorization:`Bearer ${n}`}})).data.subject||[]).map(_=>({id:_.id,code:_.subject_code,name:_.des_title,yearLevel:parseInt(_.semester.year_level)||0}));t(F)}catch(n){p.error("Failed to fetch subjects."),console.error("Fetch Subjects Error:",n)}},[]);l.useEffect(()=>{(async()=>{c(!0);try{await Promise.all([s(),m()])}catch(A){console.error("An error occurred during data fetching:",A)}finally{c(!1)}})()},[s,m]);const g=async n=>{const A=localStorage.getItem("accessToken");if(!A){p.error("Authentication required.");return}try{if(v){const R=await D.put(`/rooms/${v.id}`,n,{headers:{Authorization:`Bearer ${A}`}});p.success(R.data.message||"Room updated successfully!")}else{const R=await D.post("/rooms",n,{headers:{Authorization:`Bearer ${A}`}});p.success(R.data.message||"Room created successfully!");const F=R.data.room?.id;if(F){const _=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],V=[{start_time:"07:00:00",end_time:"12:00:00"},{start_time:"13:00:00",end_time:"21:00:00"}],O={availabilities:_.flatMap(Ce=>V.map(Te=>({day:Ce,...Te})))};await D.post(`/rooms/${F}/availabilities`,O,{headers:{Authorization:`Bearer ${A}`}}),p.success("Default availability has been set.")}}u(!1),k(null),s()}catch(R){if(R.response?.status===422){const F=R.response.data.errors;for(const _ in F){p.error(`Validation Error: ${F[_][0]}`);return}}else p.error("An error occurred. Please try again."),console.error("Save Room Error:",R)}},$=()=>{k(null),u(!0)},x=n=>{k(n),u(!0)},j=async()=>{if(N.roomId===null)return;const n=localStorage.getItem("accessToken");if(!n){p.error("Authentication required.");return}try{const A=await D.delete(`/rooms/${N.roomId}`,{headers:{Authorization:`Bearer ${n}`}});p.success(A.data.message||"Room deleted successfully!"),s()}catch{p.error("Failed to delete room.")}finally{w({open:!1,roomId:null})}},y=n=>{w({open:!0,roomId:n})},r=n=>{a(n),S(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs("main",{children:[e.jsxs("header",{className:"mb-8 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground tracking-tight",children:"Classroom & Schedule Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Monitor classroom utilization and view schedules by year level."})]}),e.jsxs(T,{onClick:$,children:[e.jsx(Le,{size:16,className:"mr-2"}),"Add Room"]})]}),e.jsxs(Ae,{defaultValue:"classrooms",children:[e.jsxs(Me,{className:"grid w-full grid-cols-2 mb-4",children:[e.jsx(ie,{value:"classrooms",children:"Classroom List"}),e.jsx(ie,{value:"schedules",children:"Generate Schedules"})]}),e.jsx(ce,{value:"classrooms",children:e.jsx(Ue,{roomsData:o,scheduleData:ve,subjectsData:i,onEdit:x,onDelete:y,onManageAvailability:r,isLoading:b})}),e.jsx(ce,{value:"schedules",children:e.jsx(Je,{scheduleData:ve,subjectsData:i,roomsData:o})})]})]}),e.jsx(Ke,{isOpen:h,onClose:()=>{u(!1),k(null)},onSave:g,initialData:v}),e.jsx(Q,{open:N.open,onOpenChange:()=>w({open:!1,roomId:null}),children:e.jsxs(X,{children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Are you absolutely sure?"}),e.jsx(Ne,{children:"This action cannot be undone. This will permanently delete the room."})]}),e.jsxs(se,{children:[e.jsx(te,{asChild:!0,children:e.jsx(T,{variant:"outline",children:"Cancel"})}),e.jsx(T,{variant:"destructive",onClick:j,children:"Yes, delete it"})]})]})}),e.jsx(Qe,{isOpen:C,onClose:()=>S(!1),room:I})]})}export{fs as default};
