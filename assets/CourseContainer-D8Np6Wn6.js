import{c as ce,j as e,m as fe,B as _,b as Ie,f as is,r as t,t as c,a as R,T as cs,k as Ce,l as _e,n as ke,o as Fe,p as ds,h as us,P as Ye,q as ms,i as Te,u as hs,A as xs}from"./index-BB__maXp.js";import{I as E}from"./input-BBUvVNWt.js";import{S as X,a as G,b as Q,c as Z,d as H,u as ps}from"./select-Dy8_Pn9_.js";import{D as se,a as te,b as re,c as ae,d as ge,e as ne,f as oe}from"./dialog-XgkgzKKZ.js";import{S as de}from"./square-pen-B6Jt_Oo4.js";import{B as js}from"./book-copy-CKHA73Qt.js";import{T as be,P as ve}from"./trash-2-Ci1MaF5p.js";import{S as ee,C as Ae}from"./skeleton-CY-tA_vX.js";import{T as qe,a as ze,b as K,c as P,d as Me,e as b,f as Oe}from"./table-BkqDN2VF.js";import{B as fs}from"./badge-D5BQQ1Of.js";import{L as pe}from"./layers-C7jutbgE.js";import{L as F}from"./label-CfNd2pgk.js";import{S as gs}from"./search-D74ohLea.js";import"./Combination-C9hTuAhi.js";import"./check-1GmuTo-E.js";import"./chevron-up-EBwRyBN0.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],vs=ce("activity",bs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h2",key:"tvwodi"}],["path",{d:"M20 8v11a2 2 0 0 1-2 2h-2",key:"1gkqxj"}],["path",{d:"m9 15 3-3 3 3",key:"1pd0qc"}],["path",{d:"M12 12v9",key:"192myk"}]],Ss=ce("archive-restore",ys);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],ws=ce("archive",Ns);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],$e=ce("loader-circle",Ls);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]],_s=ce("sliders-horizontal",Cs),Pe=["from-purple-600 to-indigo-600","from-blue-500 to-teal-400","from-pink-500 to-rose-500","from-orange-500 to-amber-500","from-green-500 to-lime-500","from-cyan-500 to-sky-500"],ks={hidden:{opacity:0,y:20},visible:r=>({opacity:1,y:0,transition:{delay:r*.05}})};function Ts({program:r,index:w,onEdit:g,onDelete:h,onRestore:u,onManage:o}){const j=typeof r.total_subjects=="number"?r.total_subjects:Object.values(r.semesters||{}).flatMap(p=>p.subjects||[]).length,v=typeof r.total_units=="number"?r.total_units:Object.values(r.semesters||{}).flatMap(p=>p.subjects||[]).reduce((p,d)=>p+(d?.unitsTotal||0),0),f=({isMobile:p=!1})=>e.jsx(e.Fragment,{children:r.isActive?e.jsx(_,{size:"icon",variant:"ghost",title:"Archive Program",onClick:d=>{d.stopPropagation(),h(r.id)},className:"h-8 w-8 bg-black/20 hover:bg-destructive/80",children:e.jsx(be,{size:16})}):e.jsx(_,{size:"icon",variant:"ghost",title:"Restore Program",onClick:d=>{d.stopPropagation(),u(r.id)},className:"h-8 w-8 bg-black/20 hover:bg-green-500",children:e.jsx(Ss,{size:16})})});return e.jsxs(fe.div,{variants:ks,custom:w,initial:"hidden",animate:"visible",exit:"hidden",className:"bg-card rounded-xl border border-border shadow-sm overflow-hidden group flex flex-col transition-all duration-300 hover:shadow-md hover:-translate-y-1",children:[e.jsxs("div",{className:`p-5 bg-gradient-to-br text-white relative ${Pe[w%Pe.length]} ${!r.isActive&&"opacity-60"}`,children:[e.jsx("h2",{className:"text-xl font-bold pr-16",children:r.abbreviation}),e.jsx("p",{className:"opacity-80 truncate text-sm pr-16",children:r.name}),!r.isActive&&e.jsx("div",{className:"absolute bottom-2 left-5 px-2.5 py-1 bg-red-600/90 text-white text-[10px] font-bold rounded-full uppercase tracking-wider",children:"Inactive"}),e.jsxs("div",{className:"absolute top-2 right-2 hidden md:flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(_,{size:"icon",variant:"ghost",title:"Edit Program",onClick:p=>{p.stopPropagation(),g(r)},className:"h-8 w-8 bg-black/20 hover:bg-green-500",children:e.jsx(de,{size:16})}),e.jsx(f,{})]}),e.jsxs("div",{className:"absolute top-2 right-2 flex md:hidden gap-1",children:[e.jsx(_,{size:"icon",variant:"ghost",title:"Edit Program",onClick:p=>{p.stopPropagation(),g(r)},className:"h-8 w-8 bg-black/20 hover:bg-black/40",children:e.jsx(de,{size:16})}),e.jsx(f,{isMobile:!0})]})]}),e.jsxs("div",{className:"p-5 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-4",children:[e.jsx(Ie,{size:15}),e.jsxs("span",{children:["A.Y. ",r.effectiveYear]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center text-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx(js,{size:15,className:"text-muted-foreground"}),e.jsx("span",{children:"Total Subjects"})]}),e.jsx("span",{className:"px-2.5 py-0.5 bg-muted text-muted-foreground rounded-full font-semibold",children:j})]}),e.jsxs("div",{className:"flex justify-between items-center text-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx(is,{size:15,className:"text-muted-foreground"}),e.jsx("span",{children:"Total Units"})]}),e.jsx("span",{className:"px-2.5 py-0.5 bg-muted text-muted-foreground rounded-full font-semibold",children:v})]})]})]}),e.jsx(_,{onClick:o,className:"w-full mt-5",variant:"secondary",disabled:!r.isActive,children:"Manage Curriculum"})]})]})}function As(){return e.jsxs("div",{className:"bg-card rounded-xl border border-border shadow-sm p-5 space-y-4",children:[e.jsx(ee,{className:"h-8 w-1/4"}),e.jsx(ee,{className:"h-5 w-3/4"}),e.jsxs("div",{className:"pt-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(ee,{className:"h-5 w-1/2"}),e.jsx(ee,{className:"h-6 w-10 rounded-full"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(ee,{className:"h-5 w-1/2"}),e.jsx(ee,{className:"h-6 w-10 rounded-full"})]})]}),e.jsx(ee,{className:"h-10 w-full mt-5"})]})}function Ps({isOpen:r,onClose:w,program:g,onAddSemester:h,onEditSemester:u,onAddSubject:o,onEditSubject:j,onDeleteSubject:v,onSetSemesterStatus:f,refreshKey:p,refreshSemesterName:d}){const[T,y]=t.useState({}),[k,m]=t.useState(!1);return t.useEffect(()=>{if(!r)return;(async()=>{const s=localStorage.getItem("accessToken");if(!s){c.error("Authentication required.");return}m(!0);try{const l=await R.get("/semester-with-subjects",{params:{program_id:g.id},headers:{Authorization:`Bearer ${s}`}}),A=Array.isArray(l.data.semesters)?l.data.semesters:[],Y={};if(A.forEach(C=>{const M=`${C.year_level}, ${C.semester_level}`;Y[M]={id:C.id,subjects:(C.subjects||[]).map(a=>({id:a.id,code:a.subject_code,name:a.des_title,unitsTotal:a.total_units,unitsLec:a.lec_units,unitsLab:a.lab_units,hoursTotal:a.total_hrs,hoursLec:a.total_lec_hrs,hoursLab:a.total_lab_hrs,prerequisite:a.pre_requisite||"None"})),isActive:C.status===0,startDate:C.start_date,endDate:C.end_date}}),d){const C=Y[d];y(C?M=>({...M,[d]:C}):Y)}else y(Y)}catch(l){c.error("Failed to load semester data."),console.error("Failed fetching semesters:",l)}finally{m(!1)}})()},[r,g.id,p]),e.jsx(se,{open:r,onOpenChange:w,children:e.jsxs(te,{className:"max-w-7xl h-[95vh] flex flex-col p-0",children:[e.jsxs(re,{className:"p-6 pb-4 bg-muted/50 border-b rounded-t-lg",children:[e.jsxs(ae,{className:"text-2xl md:text-3xl font-bold text-foreground flex items-center gap-3",children:[g.name,e.jsx("span",{className:"text-sm font-semibold text-primary bg-primary/10 px-3 py-1 rounded-full",children:g.abbreviation})]}),e.jsxs(ge,{children:["Academic Year of Effectivity: ",g.effectiveYear]})]}),e.jsx("div",{className:"flex-grow overflow-y-auto px-6 py-4 space-y-8",children:k?e.jsx("div",{className:"space-y-6",children:[1,2].map(x=>e.jsxs("div",{className:"bg-card border rounded-xl p-4 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-muted/60 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-48 bg-muted/30 rounded"})]},x))}):Object.keys(T).length===0?e.jsxs("div",{className:"text-center py-20 text-muted-foreground flex flex-col items-center justify-center h-full",children:[e.jsx(pe,{size:56,className:"mx-auto mb-4"}),e.jsx("h4",{className:"font-semibold text-xl text-foreground",children:"No Semesters Found"}),e.jsx("p",{className:"max-w-md mx-auto mt-2 text-sm",children:"This curriculum is empty. Start by adding a semester."}),e.jsxs(_,{onClick:h,className:"mt-6",children:[e.jsx(pe,{size:16,className:"mr-2"})," Add Year/Semester"]})]}):Object.entries(T).map(([x,s])=>e.jsxs("div",{className:`group/semester border rounded-xl overflow-hidden shadow-sm transition-opacity ${s.isActive?"bg-card":"opacity-70 bg-muted/20"}`,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-muted/30 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"text-lg font-semibold text-foreground",children:x}),e.jsx(fs,{variant:s.isActive?"default":"destructive",children:s.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover/semester:opacity-100 transition-opacity",children:[e.jsx(_,{variant:"ghost",size:"icon",title:"Set Status & Dates",className:"h-8 w-8 text-muted-foreground",onClick:()=>f(x,s),children:e.jsx(_s,{size:16})}),e.jsx(_,{variant:"ghost",size:"icon",title:"Rename Semester",className:"h-8 w-8 text-green-500 hover:text-green-500",onClick:()=>u(s.id,x),children:e.jsx(de,{size:16})})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(qe,{className:"min-w-[1200px]",children:[e.jsxs(ze,{className:"bg-muted/50 sticky top-0 z-10",children:[e.jsxs(K,{children:[e.jsx(P,{rowSpan:2,className:"align-middle text-center border-r",children:"Course Code"}),e.jsx(P,{rowSpan:2,className:"align-middle text-center border-r w-[350px]",children:"Descriptive Title"}),e.jsx(P,{colSpan:3,className:"text-center border-r",children:"Units"}),e.jsx(P,{colSpan:3,className:"text-center border-r",children:"Hours per week"}),e.jsx(P,{rowSpan:2,className:"align-middle text-center border-r",children:"Pre-requisite"}),e.jsx(P,{rowSpan:2,className:"align-middle w-[50px]"})]}),e.jsxs(K,{children:[e.jsx(P,{className:"text-center border-r",children:"Total"}),e.jsx(P,{className:"text-center border-r",children:"Lec"}),e.jsx(P,{className:"text-center border-r",children:"Lab"}),e.jsx(P,{className:"text-center border-r",children:"Total"}),e.jsx(P,{className:"text-center border-r",children:"Lec"}),e.jsx(P,{className:"text-center border-r",children:"Lab"})]})]}),e.jsx(Me,{children:s.subjects.length>0?s.subjects.map(l=>e.jsxs(K,{children:[e.jsx(b,{className:"w-[150px] font-semibold uppercase text-center",children:l.code}),e.jsx(b,{className:"text-center",children:l.name}),e.jsx(b,{className:"text-center font-bold text-primary",children:l.unitsTotal}),e.jsx(b,{className:"text-center",children:l.unitsLec}),e.jsx(b,{className:"text-center",children:l.unitsLab}),e.jsx(b,{className:"text-center font-bold text-primary",children:l.hoursTotal}),e.jsx(b,{className:"text-center",children:l.hoursLec}),e.jsx(b,{className:"text-center",children:l.hoursLab}),e.jsx(b,{className:"w-[150px] text-center",children:l.prerequisite}),e.jsx(b,{className:"text-center",children:e.jsxs("div",{className:"flex justify-end",children:[e.jsx(_,{variant:"ghost",size:"icon",className:"h-8 w-8 text-green-500 hover:text-green-500",onClick:()=>j(x,l),disabled:!s.isActive,children:e.jsx(de,{size:16})}),e.jsx(_,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>v(x,l.id),disabled:!s.isActive,children:e.jsx(be,{size:16})})]})})]},l.code)):e.jsx(K,{children:e.jsx(b,{colSpan:10,className:"text-center h-24 text-muted-foreground",children:"No subjects added for this semester."})})}),e.jsx(Oe,{className:"sticky bottom-0 bg-muted/80 backdrop-blur-sm",children:e.jsxs(K,{children:[e.jsx(b,{colSpan:2,className:"text-right font-bold text-lg",children:"SEMESTER TOTALS"}),e.jsx(b,{className:"text-center font-bold text-lg text-primary",children:s.subjects.reduce((l,A)=>l+A.unitsTotal,0)}),e.jsx(b,{className:"text-center font-semibold",children:s.subjects.reduce((l,A)=>l+A.unitsLec,0)}),e.jsx(b,{className:"text-center font-semibold",children:s.subjects.reduce((l,A)=>l+A.unitsLab,0)}),e.jsx(b,{className:"text-center font-bold text-lg text-primary",children:s.subjects.reduce((l,A)=>l+A.hoursTotal,0)}),e.jsx(b,{className:"text-center font-semibold",children:s.subjects.reduce((l,A)=>l+A.hoursLec,0)}),e.jsx(b,{className:"text-center font-semibold",children:s.subjects.reduce((l,A)=>l+A.hoursLab,0)}),e.jsx(b,{colSpan:2})]})})]})}),e.jsx("div",{className:"p-2 border-t",children:e.jsxs(_,{onClick:()=>o(x,s.id),variant:"link",disabled:!s.isActive,children:[e.jsx(ve,{size:16,className:"mr-1"})," Add Subject"]})})]},x))}),e.jsxs(ne,{className:"mt-auto p-6 bg-gray-50 border-t rounded-b-lg",children:[e.jsx(oe,{asChild:!0,children:e.jsx(_,{type:"button",variant:"outline",children:"Cancel"})}),e.jsxs(_,{onClick:h,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(pe,{size:16})," Add Year/Semester"]})]})]})})}const Es=()=>{const g=new Date().getFullYear()+5,h=[];for(let u=2015;u<=g;u++)h.push(String(u));return h},Ee=Es();function Is({isOpen:r,onClose:w,onSave:g,initialData:h}){const[u,o]=t.useState(""),[j,v]=t.useState(""),[f,p]=t.useState(""),[d,T]=t.useState(""),[y,k]=t.useState(!1);t.useEffect(()=>{if(h){o(h.name),v(h.abbreviation);const[s="",l=""]=h.effectiveYear.split("-");p(s),T(l)}else{o(""),v("");const s=new Date().getFullYear();p(String(s)),T(String(s+1))}},[h,r]);const m=async s=>{s.preventDefault(),k(!0);const l={program_name:u,abbreviation:j,year_from:f,year_to:d},A=localStorage.getItem("accessToken");if(!A){c.error("Authentication required."),k(!1);return}const Y={Authorization:`Bearer ${A}`};try{const C=!!h,M=C?`/edit-program/${h.id}`:"/add-program",S=await R["post"](M,l,{headers:Y});c.success(S.data.message||"Program saved successfully!");const i=S.data.program,q=i.subjects||h?.subjects||{},J=typeof i.total_subjects=="number"?i.total_subjects:Object.keys(q).length,W=typeof i.total_units=="number"?i.total_units:h?.total_units??0,I={id:i.id,name:i.program_name,abbreviation:i.abbreviation,effectiveYear:`${i.year_from}-${i.year_to}`,semesters:i.semesters||h?.semesters||{},subjects:q,total_subjects:J,total_units:W,isActive:i.isActive??i.is_active??h?.isActive??!0};g(I),w()}catch(C){if(R.isAxiosError(C)&&C.response){if(C.response.status===401){c.error("Your session has expired. Please log in again.");return}const M=C.response.data,a=M.errors;if(a&&typeof a=="object"&&Object.keys(a).length>0){const S=Object.keys(a)[0],i=a[S]?.[0];c.error(i||"A validation error occurred.")}else M&&typeof M.message=="string"?c.error(M.message):c.error("An unknown API error occurred.")}else c.error("Failed to connect to the server. Please check your connection."),console.error("Non-Axios error:",C)}finally{k(!1)}},x=s=>{p(s),T(String(Number(s)+1))};return e.jsx(se,{open:r,onOpenChange:w,children:e.jsxs(te,{children:[e.jsx(re,{children:e.jsx(ae,{children:h?"Edit Program":"Add New Program"})}),e.jsxs("form",{onSubmit:m,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"progName",children:"Program Name"}),e.jsx(E,{id:"progName",value:u,onChange:s=>o(s.target.value),placeholder:"e.g., Bachelor of Science...",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"progAbbr",children:"Abbreviation"}),e.jsx(E,{id:"progAbbr",value:j,onChange:s=>v(s.target.value),placeholder:"e.g., BSIT",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Effectivity A.Y."}),e.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr] items-center gap-2",children:[e.jsxs(X,{value:f,onValueChange:x,required:!0,children:[e.jsx(G,{children:e.jsx(Q,{placeholder:"Start Year"})}),e.jsx(Z,{children:Ee.map(s=>e.jsx(H,{value:s,children:s},s))})]}),e.jsx("span",{className:"text-muted-foreground",children:"-"}),e.jsxs(X,{value:d,onValueChange:T,required:!0,children:[e.jsx(G,{children:e.jsx(Q,{placeholder:"End Year"})}),e.jsx(Z,{children:Ee.map(s=>e.jsx(H,{value:s,children:s},s))})]})]})]}),e.jsxs(ne,{className:"pt-4",children:[e.jsx(oe,{asChild:!0,children:e.jsx(_,{type:"button",variant:"outline",disabled:y,children:"Cancel"})}),e.jsx(_,{type:"submit",disabled:y,children:y?"Saving...":h?"Save Changes":"Save Program"})]})]})]})})}const je={id:0,code:"",name:"",unitsTotal:0,unitsLec:0,unitsLab:0,hoursTotal:0,hoursLec:0,hoursLab:0,prerequisite:""},Fs=["1st Year","2nd Year","3rd Year","4th Year"],Ys=["1st Semester","2nd Semester","Summer"];function qs({isOpen:r,onClose:w,onSave:g,programId:h}){const[u,o]=t.useState(""),[j,v]=t.useState(""),[f,p]=t.useState([je]),[d,T]=t.useState(!1);t.useEffect(()=>{const a=f.map(S=>{const i=(Number(S.unitsLec)||0)+(Number(S.unitsLab)||0),q=(Number(S.hoursLec)||0)+(Number(S.hoursLab)||0);return{...S,unitsTotal:i,hoursTotal:q}});JSON.stringify(a)!==JSON.stringify(f)&&p(a)},[f]);const{totalUnits:y,totalLecUnits:k,totalLabUnits:m,totalHours:x,totalLecHours:s,totalLabHours:l}=t.useMemo(()=>f.reduce((a,S)=>(a.totalUnits+=Number(S.unitsTotal)||0,a.totalLecUnits+=Number(S.unitsLec)||0,a.totalLabUnits+=Number(S.unitsLab)||0,a.totalHours+=Number(S.hoursTotal)||0,a.totalLecHours+=Number(S.hoursLec)||0,a.totalLabHours+=Number(S.hoursLab)||0,a),{totalUnits:0,totalLecUnits:0,totalLabUnits:0,totalHours:0,totalLecHours:0,totalLabHours:0}),[f]),A=()=>p(a=>[...a,je]),Y=a=>p(S=>S.filter((i,q)=>q!==a)),C=(a,S,i)=>{p(q=>q.map((J,W)=>{if(W===a){const I=["unitsLec","unitsLab","hoursLec","hoursLab"].includes(S);return{...J,[S]:I?i===""?"":Number(i):i}}return J}))},M=async a=>{if(a.preventDefault(),!u||!j){c.error("Please select a year level and semester.");return}if(f.some(i=>!i.code||!i.name)){c.error("Please fill out all subject codes and titles.");return}T(!0);try{const i=localStorage.getItem("accessToken");if(!i){c.error("Authentication required. Please log in again.");return}const q=f.map(I=>({subject_code:I.code,des_title:I.name,total_units:I.unitsTotal,lec_units:I.unitsLec,lab_units:I.unitsLab,total_hrs:I.hoursTotal,total_lec_hrs:I.hoursLec,total_lab_hrs:I.hoursLab,pre_requisite:I.prerequisite||null})),J={program_id:h,year_level:u,semester_level:j,subjects:q};if((await R.post("/semester-with-subjects",J,{headers:{Authorization:`Bearer ${i}`}})).status===201&&(c.success("Semester and subjects added successfully!"),w(),g)){const I=`${u}, ${j}`;g(I,f,!0)}}catch(i){i.response?.status===401?c.error("Session expired. Please log in again."):i.response?.data?.error?c.error(i.response.data.error):c.error("Failed to save semester and subjects. Please try again."),console.error("Error saving semester:",i)}finally{T(!1)}};return t.useEffect(()=>{r&&(o(""),v(""),p([je]))},[r]),e.jsx(se,{open:r,onOpenChange:w,children:e.jsx(cs,{children:e.jsxs(te,{className:"max-w-7xl h-[95vh] flex flex-col",children:[e.jsxs(re,{children:[e.jsx(ae,{children:"Add New Semester and Subjects"}),e.jsx(ge,{children:"Add subjects in bulk. Totals are calculated automatically."})]}),e.jsxs("form",{onSubmit:M,className:"flex-grow flex flex-col min-h-0 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"yearLevel",className:"text-base",children:"Year Level"}),e.jsxs(X,{value:u,onValueChange:o,required:!0,children:[e.jsx(G,{id:"yearLevel",children:e.jsx(Q,{placeholder:"Select a year level"})}),e.jsx(Z,{children:Fs.map(a=>e.jsx(H,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"semester",className:"text-base",children:"Semester"}),e.jsxs(X,{value:j,onValueChange:v,required:!0,children:[e.jsx(G,{id:"semester",children:e.jsx(Q,{placeholder:"Select a semester"})}),e.jsx(Z,{children:Ys.map(a=>e.jsx(H,{value:a,children:a},a))})]})]})]}),e.jsx("div",{className:"flex-grow overflow-auto border rounded-lg",children:e.jsxs(qe,{className:"min-w-[1200px]",children:[e.jsxs(ze,{className:"bg-muted/50 sticky top-0 z-10",children:[e.jsxs(K,{children:[e.jsx(P,{rowSpan:2,className:"align-middle text-center border-r",children:"Course Code"}),e.jsx(P,{rowSpan:2,className:"align-middle text-center border-r w-[350px]",children:"Descriptive Title"}),e.jsx(P,{colSpan:3,className:"text-center border-r",children:"Units"}),e.jsx(P,{colSpan:3,className:"text-center border-r",children:"Hours per week"}),e.jsx(P,{rowSpan:2,className:"align-middle text-center border-r",children:"Pre-requisite"}),e.jsx(P,{rowSpan:2,className:"align-middle w-[50px]"})]}),e.jsxs(K,{children:[e.jsx(P,{className:"text-center border-r",children:"Total"}),e.jsx(P,{className:"text-center border-r",children:"Lec"}),e.jsx(P,{className:"text-center border-r",children:"Lab"}),e.jsx(P,{className:"text-center border-r",children:"Total"}),e.jsx(P,{className:"text-center border-r",children:"Lec"}),e.jsx(P,{className:"text-center border-r",children:"Lab"})]})]}),e.jsx(Me,{children:f.map((a,S)=>e.jsxs(K,{children:[e.jsx(b,{className:"w-[150px]",children:e.jsx(E,{className:"uppercase",placeholder:"e.g. CS101",value:a.code,onChange:i=>C(S,"code",i.target.value)})}),e.jsx(b,{children:e.jsx(E,{placeholder:"e.g. Introduction to Programming",value:a.name,onChange:i=>C(S,"name",i.target.value)})}),e.jsx(b,{children:e.jsxs(Ce,{children:[e.jsx(_e,{asChild:!0,children:e.jsx(E,{type:"number",value:a.unitsTotal||"",readOnly:!0,className:"text-center font-bold bg-muted/50 cursor-not-allowed"})}),e.jsx(ke,{children:e.jsx("p",{children:"Auto-calculated from Lec and Lab units."})})]})}),e.jsx(b,{children:e.jsx(E,{min:"0",type:"number",value:a.unitsLec||"",onChange:i=>C(S,"unitsLec",i.target.value),className:"text-center"})}),e.jsx(b,{children:e.jsx(E,{min:"0",type:"number",value:a.unitsLab||"",onChange:i=>C(S,"unitsLab",i.target.value),className:"text-center"})}),e.jsx(b,{children:e.jsxs(Ce,{children:[e.jsx(_e,{asChild:!0,children:e.jsx(E,{type:"number",value:a.hoursTotal||"",readOnly:!0,className:"text-center font-bold bg-muted/50 cursor-not-allowed"})}),e.jsx(ke,{children:e.jsx("p",{children:"Auto-calculated from Lec and Lab hours."})})]})}),e.jsx(b,{children:e.jsx(E,{min:"0",type:"number",value:a.hoursLec||"",onChange:i=>C(S,"hoursLec",i.target.value),className:"text-center"})}),e.jsx(b,{children:e.jsx(E,{min:"0",type:"number",value:a.hoursLab||"",onChange:i=>C(S,"hoursLab",i.target.value),className:"text-center"})}),e.jsx(b,{className:"w-[150px]",children:e.jsx(E,{placeholder:"None",value:a.prerequisite,onChange:i=>C(S,"prerequisite",i.target.value)})}),e.jsx(b,{className:"text-center",children:e.jsx(_,{type:"button",variant:"ghost",size:"icon",onClick:()=>Y(S),className:"text-destructive h-8 w-8 shrink-0",children:e.jsx(be,{size:16})})})]},S))}),e.jsx(Oe,{className:"sticky bottom-0 bg-muted/80 backdrop-blur-sm",children:e.jsxs(K,{children:[e.jsx(b,{colSpan:2,className:"text-right font-bold text-lg",children:"SEMESTER TOTALS"}),e.jsx(b,{className:"text-center font-bold text-lg text-primary",children:y}),e.jsx(b,{className:"text-center font-semibold",children:k}),e.jsx(b,{className:"text-center font-semibold",children:m}),e.jsx(b,{className:"text-center font-bold text-lg text-primary",children:x}),e.jsx(b,{className:"text-center font-semibold",children:s}),e.jsx(b,{className:"text-center font-semibold",children:l}),e.jsx(b,{colSpan:2})]})})]})}),e.jsxs(_,{type:"button",variant:"outline",onClick:A,className:"mt-4 w-full sm:w-auto",children:[e.jsx(ve,{size:16,className:"mr-2"})," Add Subject Row"]}),e.jsxs(ne,{className:"mt-5 pt-4 border-t",children:[e.jsx(oe,{asChild:!0,children:e.jsx(_,{type:"button",variant:"outline",disabled:d,children:"Cancel"})}),e.jsx(_,{type:"submit",disabled:d,children:d?"Saving...":"Save Curriculum"})]})]})]})})})}const zs=["1st Year","2nd Year","3rd Year","4th Year","5th Year"],Ms=["1st Semester","2nd Semester","Summer"];function Os({isOpen:r,onClose:w,onSaveSuccess:g,semesterId:h,initialData:u}){const[o,j]=t.useState(""),[v,f]=t.useState(""),[p,d]=t.useState(!1);t.useEffect(()=>{if(r)if(u){const y=u.split(",").map(k=>k.trim());j(y[0]||""),f(y[1]||"")}else j(""),f("")},[r,u]);const T=async y=>{if(y.preventDefault(),!o||!v||!h){c.error("Missing required information to rename.");return}const k=localStorage.getItem("accessToken");if(!k){c.error("Authentication required.");return}d(!0);try{const m=`/semesters/${h}/rename`,x={year_level:o,semester_level:v},s=await R.put(m,x,{headers:{Authorization:`Bearer ${k}`}});c.success(s.data.message||"Semester renamed successfully!"),g(),w()}catch(m){console.error("Failed to rename semester:",m.response?.data),c.error(m.response?.data?.message||"Failed to rename semester.")}finally{d(!1)}};return e.jsx(se,{open:r,onOpenChange:w,children:e.jsxs(te,{children:[e.jsx(re,{children:e.jsx(ae,{children:"Rename Semester"})}),e.jsxs("form",{onSubmit:T,className:"py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"yearLevel",children:"Year Level"}),e.jsxs(X,{value:o,onValueChange:j,required:!0,children:[e.jsx(G,{id:"yearLevel",children:e.jsx(Q,{placeholder:"Select year level"})}),e.jsx(Z,{children:zs.map(y=>e.jsx(H,{value:y,children:y},y))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"semester",children:"Semester"}),e.jsxs(X,{value:v,onValueChange:f,required:!0,children:[e.jsx(G,{id:"semester",children:e.jsx(Q,{placeholder:"Select semester"})}),e.jsx(Z,{children:Ms.map(y=>e.jsx(H,{value:y,children:y},y))})]})]})]}),e.jsxs(ne,{className:"pt-6",children:[e.jsx(oe,{asChild:!0,children:e.jsx(_,{type:"button",variant:"outline",disabled:p,children:"Cancel"})}),e.jsx(_,{type:"submit",disabled:!o||!v||p,children:p?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Changes"})]})]})]})})}function $s(r){const{isOpen:w,onClose:g,onSave:h,initialData:u}=r,[o,j]=t.useState({id:0,code:"",name:"",unitsTotal:0,unitsLec:0,unitsLab:0,hoursTotal:0,hoursLec:0,hoursLab:0,prerequisite:""}),[v,f]=t.useState(null);t.useEffect(()=>{const m=o.unitsLec+o.unitsLab,x=o.hoursLec+o.hoursLab;j(s=>({...s,unitsTotal:m,hoursTotal:x}))},[o.unitsLec,o.unitsLab,o.hoursLec,o.hoursLab]),t.useEffect(()=>{const m=o.unitsLec+o.unitsLab>o.unitsTotal?"Lec + Lab units cannot exceed Total.":null,x=o.hoursLec+o.hoursLab>o.hoursTotal?"Lec + Lab hours cannot exceed Total.":null;f(m||x?{unitError:m,hourError:x}:null)},[o]),t.useEffect(()=>{w&&j(u||{id:0,code:"",name:"",unitsTotal:0,unitsLec:0,unitsLab:0,hoursTotal:0,hoursLec:0,hoursLab:0,prerequisite:""})},[w,u]);const p=(m,x)=>{j(s=>({...s,[m]:x}))},d=(m,x)=>{const s=Number(x);p(m,s>=0?s:0)},[T,y]=t.useState(!1),k=async m=>{if(m.preventDefault(),v){c.error("Please fix the validation errors before saving.");return}const x=!!u;y(!0);try{await h(o,x),g()}catch(s){console.error("Subject save failed:",s),c.error("Failed to save subject.")}finally{y(!1)}};return e.jsx(se,{open:w,onOpenChange:g,children:e.jsxs(te,{children:[e.jsx(re,{children:e.jsx(ae,{children:u?`Edit Subject: ${u.code}`:"Add New Subject"})}),e.jsxs("form",{onSubmit:k,className:"py-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"code",children:"Course Code"}),e.jsx(E,{id:"code",value:o.code,onChange:m=>p("code",m.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"prerequisite",children:"Pre-requisite"}),e.jsx(E,{id:"prerequisite",value:o.prerequisite,onChange:m=>p("prerequisite",m.target.value),placeholder:"None"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"name",children:"Descriptive Title"}),e.jsx(E,{id:"name",value:o.name,onChange:m=>p("name",m.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(F,{className:"font-semibold",children:"Unit Allocation"}),e.jsxs("div",{className:`grid grid-cols-3 gap-4 p-4 border rounded-lg bg-muted/30 ${v?.unitError?"border-destructive":""}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(F,{htmlFor:"unitsTotal",children:"Total"}),e.jsx(E,{id:"unitsTotal",type:"number",value:o.unitsTotal||"",disabled:!0,readOnly:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(F,{htmlFor:"unitsLec",children:"Lec"}),e.jsx(E,{id:"unitsLec",type:"number",value:o.unitsLec||"",onChange:m=>d("unitsLec",m.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(F,{htmlFor:"unitsLab",children:"Lab"}),e.jsx(E,{id:"unitsLab",type:"number",value:o.unitsLab||"",onChange:m=>d("unitsLab",m.target.value)})]})]}),v?.unitError&&e.jsxs("p",{className:"text-destructive text-sm flex items-center gap-2 mt-2",children:[e.jsx(Ae,{size:16}),v.unitError]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(F,{className:"font-semibold",children:"Hour Allocation"}),e.jsxs("div",{className:`grid grid-cols-3 gap-4 p-4 border rounded-lg bg-muted/30 ${v?.hourError?"border-destructive":""}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(F,{htmlFor:"hoursTotal",children:"Total"}),e.jsx(E,{id:"hoursTotal",type:"number",value:o.hoursTotal||"",disabled:!0,readOnly:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(F,{htmlFor:"hoursLec",children:"Lec"}),e.jsx(E,{id:"hoursLec",type:"number",value:o.hoursLec||"",onChange:m=>d("hoursLec",m.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(F,{htmlFor:"hoursLab",children:"Lab"}),e.jsx(E,{id:"hoursLab",type:"number",value:o.hoursLab||"",onChange:m=>d("hoursLab",m.target.value)})]})]}),v?.hourError&&e.jsxs("p",{className:"text-destructive text-sm flex items-center gap-2 mt-2",children:[e.jsx(Ae,{size:16}),v.hourError]})]})]}),e.jsxs(ne,{className:"mt-8 pt-4 border-t",children:[e.jsx(oe,{asChild:!0,children:e.jsx(_,{type:"button",variant:"outline",disabled:T,children:"Cancel"})}),e.jsx(_,{type:"submit",disabled:!!v||T,children:T?"Saving...":u?"Save Changes":"Save Subject"})]})]})]})})}function Rs(r,w,{checkForDefaultPrevented:g=!0}={}){return function(u){if(r?.(u),g===!1||!u.defaultPrevented)return w?.(u)}}var ue="Switch",[Bs,ut]=us(ue),[Hs,Us]=Bs(ue),Re=t.forwardRef((r,w)=>{const{__scopeSwitch:g,name:h,checked:u,defaultChecked:o,required:j,disabled:v,value:f="on",onCheckedChange:p,form:d,...T}=r,[y,k]=t.useState(null),m=Fe(w,Y=>k(Y)),x=t.useRef(!1),s=y?d||!!y.closest("form"):!0,[l,A]=ds({prop:u,defaultProp:o??!1,onChange:p,caller:ue});return e.jsxs(Hs,{scope:g,checked:l,disabled:v,children:[e.jsx(Ye.button,{type:"button",role:"switch","aria-checked":l,"aria-required":j,"data-state":Ve(l),"data-disabled":v?"":void 0,disabled:v,value:f,...T,ref:m,onClick:Rs(r.onClick,Y=>{A(C=>!C),s&&(x.current=Y.isPropagationStopped(),x.current||Y.stopPropagation())})}),s&&e.jsx(Ue,{control:y,bubbles:!x.current,name:h,value:f,checked:l,required:j,disabled:v,form:d,style:{transform:"translateX(-100%)"}})]})});Re.displayName=ue;var Be="SwitchThumb",He=t.forwardRef((r,w)=>{const{__scopeSwitch:g,...h}=r,u=Us(Be,g);return e.jsx(Ye.span,{"data-state":Ve(u.checked),"data-disabled":u.disabled?"":void 0,...h,ref:w})});He.displayName=Be;var Vs="SwitchBubbleInput",Ue=t.forwardRef(({__scopeSwitch:r,control:w,checked:g,bubbles:h=!0,...u},o)=>{const j=t.useRef(null),v=Fe(j,o),f=ps(g),p=ms(w);return t.useEffect(()=>{const d=j.current;if(!d)return;const T=window.HTMLInputElement.prototype,k=Object.getOwnPropertyDescriptor(T,"checked").set;if(f!==g&&k){const m=new Event("click",{bubbles:h});k.call(d,g),d.dispatchEvent(m)}},[f,g,h]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:g,...u,tabIndex:-1,ref:v,style:{...u.style,...p,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Ue.displayName=Vs;function Ve(r){return r?"checked":"unchecked"}var De=Re,Ds=He;const Ke=t.forwardRef(({className:r,...w},g)=>e.jsx(De,{className:Te("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",r),...w,ref:g,children:e.jsx(Ds,{className:Te("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));Ke.displayName=De.displayName;function Ks({isOpen:r,onClose:w,onSaveSuccess:g,semesterId:h,semesterName:u,initialData:o}){const[j,v]=t.useState(!0),[f,p]=t.useState(""),[d,T]=t.useState(""),[y,k]=t.useState(!1);t.useEffect(()=>{if(r&&o){v(o.isActive);const x=s=>{if(!s)return"";try{return new Date(s).toISOString().split("T")[0]}catch{return""}};p(x(o.startDate)),T(x(o.endDate))}},[r,o]);const m=async x=>{if(x.preventDefault(),!h){c.error("Semester ID is missing. Cannot save.");return}if(!j){if(!f||!d){c.error("Please provide both start and end dates when marking as Inactive.");return}if(new Date(f)>new Date(d)){c.error("Start date cannot be after the end date.");return}}const s=localStorage.getItem("accessToken");if(!s){c.error("Authentication required.");return}k(!0);try{const l=`/semesters/${h}/status`,A={status:j?0:1};j||(A.start_date=f,A.end_date=d);const Y=await R.put(l,A,{headers:{Authorization:`Bearer ${s}`}});c.success(Y.data.message||"Semester status updated successfully!"),g(),w()}catch(l){console.error("Failed to update semester:",l.response?.data),c.error(l.response?.data?.message||"Failed to update semester.")}finally{k(!1)}};return e.jsx(se,{open:r,onOpenChange:w,children:e.jsxs(te,{children:[e.jsx(re,{children:e.jsx(ae,{children:"Set Semester Status & Dates"})}),e.jsxs("form",{onSubmit:m,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Semester"}),e.jsx("p",{className:"font-semibold text-lg",children:u})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[e.jsx(Ke,{id:"semester-status",checked:j,onCheckedChange:v}),e.jsx(F,{htmlFor:"semester-status",className:"cursor-pointer",children:j?"Active":"Inactive"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"startDate",children:"Start Date"}),e.jsx(E,{id:"startDate",type:"date",value:f,onChange:x=>p(x.target.value),disabled:j,required:!j})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"endDate",children:"End Date"}),e.jsx(E,{id:"endDate",type:"date",value:d,onChange:x=>T(x.target.value),disabled:j,required:!j})]})]}),e.jsxs(ne,{className:"pt-4",children:[e.jsx(oe,{asChild:!0,children:e.jsx(_,{type:"button",variant:"outline",disabled:y,children:"Cancel"})}),e.jsx(_,{type:"submit",disabled:y,children:y?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Settings"})]})]})]})})}function Js(){const[r,w]=t.useState([]),[g,h]=t.useState(!0),[u,o]=t.useState(""),[j,v]=t.useState("All Years"),[f,p]=t.useState("Active"),[d,T]=t.useState(null),[y,k]=t.useState(!1),[m,x]=t.useState(null),[s,l]=t.useState(!1),[A,Y]=t.useState(!1),[C,M]=t.useState(!1),[a,S]=t.useState(!1),[i,q]=t.useState(0),[J,W]=t.useState(null),[I,ye]=t.useState(null),[me,Je]=t.useState({name:null,semester:null}),[Se,We]=t.useState({id:null,name:null}),he=hs(),U=t.useCallback(async()=>{h(!0);const n=localStorage.getItem("accessToken");if(!n){c.error("Authentication required."),h(!1),he("/facultyscheduler/user-login");return}try{const N=await R.get("/program",{headers:{Authorization:`Bearer ${n}`}}),D=(Array.isArray(N.data.programs)?N.data.programs:Object.values(N.data.programs||{})).map(z=>({id:z.id,name:z.program_name,abbreviation:z.abbreviation,effectiveYear:`${z.year_from}-${z.year_to}`,total_subjects:z.total_subjects||0,total_units:z.total_units||0,isActive:z.status===0,semesters:z.semesters?Object.entries(z.semesters).reduce((B,[le,O])=>(B[le]={id:O.id,subjects:(O.subjects||[]).map($=>({id:$.id,code:$.subject_code,name:$.des_title,unitsTotal:$.total_units,unitsLec:$.lec_units,unitsLab:$.lab_units,hoursTotal:$.total_hrs,hoursLec:$.total_lec_hrs,hoursLab:$.total_lab_hrs,prerequisite:$.pre_requisite||""})),isActive:O.status===0,startDate:O.start_date,endDate:O.end_date},B),{}):{},subjects:z.subjects||{}}));w(D)}catch(N){R.isAxiosError(N)&&N.response?.status===401?(c.error("Unauthorized. Please log in again."),he("/facultyscheduler/user-login")):c.error("Failed to fetch programs.")}finally{h(!1)}},[he]);t.useEffect(()=>{U()},[U]);const Xe=(n,N)=>{Je({name:n,semester:N}),S(!0)},Ge=(n,N)=>{We({id:n,name:N}),Y(!0)},Qe=n=>{U(),k(!1)},Ze=()=>{x(null),k(!0)},es=n=>{x(n),k(!0)},[V,ie]=t.useState(null),[xe,Ne]=t.useState(!1),ss=n=>{ie({open:!0,title:"Archive Program",description:"This program will be moved to the archives.",confirmText:"Yes, archive it!",onConfirm:async()=>{const N=localStorage.getItem("accessToken");if(!N){c.error("Authentication required.");return}try{const L=await R.post(`/delete-program/${n}`,{},{headers:{Authorization:`Bearer ${N}`}});c.success(L.data.message||"Program archived successfully."),await U()}catch{c.error("Failed to archive program.")}}})},ts=n=>{ie({open:!0,title:"Restore Program",description:"This will make the program active again.",confirmText:"Yes, restore it!",onConfirm:async()=>{const N=localStorage.getItem("accessToken");if(!N){c.error("Authentication required.");return}try{const L=await R.post(`/restore-program/${n}`,{},{headers:{Authorization:`Bearer ${N}`}});c.success(L.data.message||"Program restored successfully."),await U()}catch{c.error("Failed to restore program.")}}})},rs=(n,N)=>{ye({semester:n,semesterId:N,subject:null}),M(!0)},as=(n,N)=>{const z=d?.semesters?.[n]?.id;ye({semester:n,semesterId:z,subject:N}),M(!0)},ns=(n,N)=>{if(!N){c.error("Could not find subject ID to delete.");return}ie({open:!0,title:"Delete Subject",description:"This will permanently delete this subject. You won't be able to revert this!",confirmText:"Yes, delete it!",confirmVariant:"destructive",onConfirm:async()=>{const L=localStorage.getItem("accessToken");if(!L){c.error("Authentication required.");return}try{await R.delete(`/subjects/${N}`,{headers:{Authorization:`Bearer ${L}`}}),c.success("Subject deleted successfully!"),W(n),q(D=>D+1),await U()}catch(D){c.error("Failed to delete subject."),console.error("Delete subject error:",D)}}})},os=async(n,N,L,D)=>{if(!d){c.error("No program selected.");return}const z=localStorage.getItem("accessToken");if(!z){c.error("Authentication required.");return}try{let B=N;if(!D){const O=r.find($=>$.id===d.id)?.semesters?.[n];if(B=B??O?.id,!B)for(const $ of r){const Le=$.semesters?.[n];if(Le?.id){B=Le.id;break}}if(!B){c.error("Semester ID not found. Please refresh and try again.");return}}if(D){if(!L.id){c.error("Subject ID missing for update.");return}const le={subject_code:L.code,des_title:L.name,total_units:L.unitsTotal,lec_units:L.unitsLec,lab_units:L.unitsLab,total_hrs:L.hoursTotal,total_lec_hrs:L.hoursLec,total_lab_hrs:L.hoursLab,pre_requisite:L.prerequisite||null};await R.put(`/subjects/${L.id}`,le,{headers:{Authorization:`Bearer ${z}`}}),c.success("Subject updated successfully."),W(n),q(O=>O+1),await U()}else{const le={subject_code:L.code,des_title:L.name,total_units:L.unitsTotal,lec_units:L.unitsLec,lab_units:L.unitsLab,total_hrs:L.hoursTotal,total_lec_hrs:L.hoursLec,total_lab_hrs:L.hoursLab,pre_requisite:L.prerequisite||null};try{await R.post(`/semesters/${B}/subjects`,le,{headers:{Authorization:`Bearer ${z}`}}),c.success("Subject added successfully."),W(n),q(O=>O+1),await U()}catch(O){if(O?.response?.status===404)c.error("Semester not found on server. Refreshing programs."),await U();else throw O}}}catch(B){console.error("Save subject error:",B),c.error("Failed to save subject.")}},ls=t.useMemo(()=>{const n=new Set(r.map(N=>N.effectiveYear));return["All Years",...Array.from(n).sort((N,L)=>L.localeCompare(N))]},[r]),we=t.useMemo(()=>r.filter(n=>n.name.toLowerCase().includes(u.toLowerCase())||n.abbreviation.toLowerCase().includes(u.toLowerCase())).filter(n=>j==="All Years"||n.effectiveYear===j).filter(n=>f==="All"?!0:f==="Active"?n.isActive:!n.isActive),[r,u,j,f]);return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground tracking-tight",children:"Curriculum Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage academic programs, semesters, and their subjects."})]}),e.jsx("div",{className:"bg-card p-4 md:p-6 rounded-lg shadow-sm border border-border mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-center",children:[e.jsxs("div",{className:"relative w-full md:flex-grow",children:[e.jsx(gs,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:20}),e.jsx(E,{type:"text",placeholder:"Search program...",className:"pl-10 w-full",value:u,onChange:n=>o(n.target.value)})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3 w-full md:w-auto",children:[e.jsxs(X,{value:j,onValueChange:v,children:[e.jsxs(G,{className:"w-full sm:w-auto md:w-[180px]",children:[e.jsx(Ie,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsx(Q,{placeholder:"Filter by A.Y."})]}),e.jsx(Z,{children:ls.map(n=>e.jsx(H,{value:n,children:n},n))})]}),e.jsxs(X,{value:f,onValueChange:p,children:[e.jsxs(G,{className:"w-full sm:w-auto md:w-[180px]",children:[e.jsx(vs,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsx(Q,{placeholder:"Filter by Status"})]}),e.jsxs(Z,{children:[e.jsx(H,{value:"All",children:"All"}),e.jsx(H,{value:"Active",children:"Active"}),e.jsx(H,{value:"Inactive",children:"Inactive"})]})]}),e.jsxs(_,{onClick:Ze,className:"w-full sm:w-auto",children:[e.jsx(ve,{size:16,className:"mr-2"})," Add Program"]})]})]})}),g?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:3}).map((n,N)=>e.jsx(As,{},N))}):e.jsx(xs,{children:we.length>0?e.jsx(fe.div,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:we.map((n,N)=>e.jsx(Ts,{program:n,index:N,onEdit:es,onDelete:ss,onRestore:ts,onManage:()=>T(n)},n.id))}):e.jsxs(fe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-20 text-muted-foreground",children:[e.jsx(ws,{size:56,className:"mx-auto mb-4"}),e.jsx("h4",{className:"font-semibold text-xl text-foreground",children:"No Programs Found"})]})}),e.jsx(Is,{isOpen:y,onClose:()=>k(!1),onSave:Qe,initialData:m}),V&&e.jsx(se,{open:V.open,onOpenChange:n=>{n||ie(null)},children:e.jsxs(te,{children:[e.jsxs(re,{children:[e.jsx(ae,{children:V.title}),V.description&&e.jsx(ge,{children:V.description})]}),e.jsxs(ne,{children:[e.jsx(oe,{asChild:!0,children:e.jsx(_,{variant:"outline",disabled:xe,children:"Cancel"})}),e.jsx(_,{onClick:async()=>{if(V?.onConfirm){Ne(!0);try{await V.onConfirm()}finally{Ne(!1),ie(null)}}},disabled:xe,variant:V.confirmVariant,children:xe?"Processing...":V.confirmText||"Confirm"})]})]})}),d&&e.jsx(Ps,{isOpen:!!d,onClose:()=>T(null),program:d,onAddSemester:()=>l(!0),onEditSemester:Ge,onDeleteSemester:()=>{},onAddSubject:rs,onEditSubject:as,onDeleteSubject:ns,onSetSemesterStatus:Xe,refreshKey:i,refreshSemesterName:J}),e.jsx(qs,{isOpen:s,onClose:()=>l(!1),onSave:()=>q(n=>n+1),programId:d?d.id:0}),e.jsx(Os,{isOpen:A,onClose:()=>Y(!1),onSaveSuccess:()=>q(n=>n+1),semesterId:Se.id,initialData:Se.name}),I&&e.jsx($s,{isOpen:C,onClose:()=>M(!1),onSave:(n,N)=>os(I.semester,I.semesterId,n,N),initialData:I.subject,programId:d?.id??0,semesterName:I.semester,semesterId:I.semesterId}),e.jsx(Ks,{isOpen:a,onClose:()=>S(!1),onSaveSuccess:()=>q(n=>n+1),semesterId:me?.semester?.id||null,semesterName:me?.name||null,initialData:me?.semester||null})]})}function mt(){return e.jsx("main",{children:e.jsx(Js,{})})}export{mt as default};
