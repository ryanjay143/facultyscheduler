import{c as pe,j as e,C as Te,B as _,r as a,T as ke,k as J,l as U,n as Y,t as n,a as M}from"./index-CrtpwQ5O.js";import{C as Ae,T as Fe,a as Me,b as ue,c as me}from"./tabs-r9SCLAuX.js";import{T as te,a as ae,b as $,c as C,d as re,e as h}from"./table-Or1FViC7.js";import{I as V}from"./input-BO2_hbqI.js";import{S as le,a as oe,b as ie,c as ne,d as G}from"./select-CgkOVV0K.js";import{B as Ie}from"./badge-gfnmk8ZU.js";import{S as L}from"./skeleton-BRjJP6dE.js";import{D as K,a as Q,b as X,c as Z,d as ce,e as ee,f as se}from"./dialog-B0UP4DVh.js";import{S as Re}from"./search-BXFzNI0j.js";import{F as De}from"./funnel-Lk9P4bui.js";import{E as Le}from"./eye--nun9LUm.js";import{S as $e}from"./square-pen-Dnayql6H.js";import{T as fe}from"./trash-2-DXfieRB4.js";import{C as Pe}from"./chevron-left-g8NOlthD.js";import{C as ze}from"./chevron-right-BBhfMQ7n.js";import{L as O}from"./label-xulj2FTb.js";import{L as he}from"./loader-circle-r76oAEyX.js";import{C as Oe}from"./ClassSchedule-CpmWsGqH.js";import{P as Be}from"./plus-CITuiMhz.js";import"./Combination-BRixIrwY.js";import"./check-C0iTXvdH.js";import"./card-BWoUuyah.js";import"./download-BDsqkfz6.js";import"./map-pin-xLqOqnRs.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["path",{d:"M16 19h6",key:"xwg31i"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M19 16v6",key:"tddt3s"}],["path",{d:"M21 12.598V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8.5",key:"1glfrc"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}]],Ve=pe("calendar-plus",qe);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M6 10H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-2",key:"4b9dqc"}],["path",{d:"M6 14H4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-2",key:"22nnkd"}],["path",{d:"M6 6h.01",key:"1utrut"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"m13 6-4 6h6l-4 6",key:"14hqih"}]],He=pe("server-crash",Ee),xe=d=>{if(!d)return"";const[v,u]=d.split(":");let o=parseInt(v,10);const p=parseInt(u,10),m=o>=12?"PM":"AM";o=o%12||12;const i=p<10?`0${p}`:p;return`${o}:${i} ${m}`},We=({isOpen:d,onClose:v,room:u,scheduleData:o})=>{if(!u)return null;const p=o.filter(m=>m.faculty_loading.room.id===u.id).sort((m,i)=>{const w=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],f=w.indexOf(m.faculty_loading.day),I=w.indexOf(i.faculty_loading.day);return f!==I?f-I:m.faculty_loading.start_time.localeCompare(i.faculty_loading.start_time)});return e.jsx(K,{open:d,onOpenChange:v,children:e.jsxs(Q,{className:"sm:max-w-3xl",children:[e.jsxs(X,{children:[e.jsxs(Z,{children:["Schedule for ",u.roomNumber," (",u.type,")"]}),e.jsx(ce,{children:"A list of all classes currently assigned to this room."})]}),e.jsx("div",{className:"max-h-[70vh] overflow-y-auto border rounded-lg",children:p.length===0?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"No classes are currently scheduled for this room."}):e.jsxs(te,{children:[e.jsx(ae,{children:e.jsxs($,{children:[e.jsx(C,{className:"w-[100px]",children:"Day"}),e.jsx(C,{className:"w-[160px]",children:"Time"}),e.jsx(C,{children:"Subject"}),e.jsx(C,{children:"Section"}),e.jsx(C,{children:"Faculty"}),e.jsx(C,{className:"text-center",children:"Type"})]})}),e.jsx(re,{children:p.map(m=>{const i=m.faculty_loading;return e.jsxs($,{children:[e.jsx(h,{className:"font-semibold",children:i.day}),e.jsxs(h,{className:"flex items-center gap-2 text-sm text-slate-700",children:[e.jsx(Te,{className:"w-3 h-3 text-slate-400"}),xe(i.start_time)," - ",xe(i.end_time)]}),e.jsxs(h,{children:[e.jsx("span",{className:"font-medium",children:i.subject.subject_code}),e.jsx("span",{className:"text-xs text-muted-foreground block",children:i.subject.des_title})]}),e.jsx(h,{children:m.section}),e.jsx(h,{children:i.faculty.user?.name??"Unassigned"}),e.jsx(h,{className:"text-center",children:e.jsx("div",{className:"inline-block px-2 py-0.5 text-xs font-bold rounded bg-blue-100 text-blue-800 uppercase",children:i.type})})]},m.id)})})]})}),e.jsx(ee,{children:e.jsx(se,{asChild:!0,children:e.jsx(_,{type:"button",variant:"outline",children:"Close"})})})]})})},Je=(d,v)=>new Set(v.filter(o=>o.faculty_loading.room.id===d).map(o=>o.faculty_loading.subject.id)).size,Ue=()=>e.jsxs($,{children:[e.jsx(h,{children:e.jsx(L,{className:"h-5 w-28"})}),e.jsx(h,{children:e.jsx(L,{className:"h-5 w-24"})}),e.jsx(h,{className:"text-center",children:e.jsx(L,{className:"h-5 w-10 mx-auto"})}),e.jsx(h,{children:e.jsx(L,{className:"h-5 w-10"})}),e.jsx(h,{children:e.jsx(L,{className:"h-6 w-20"})}),e.jsx(h,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(L,{className:"h-8 w-8 rounded-md"}),e.jsx(L,{className:"h-8 w-8 rounded-md"}),e.jsx(L,{className:"h-8 w-8 rounded-md"}),e.jsx(L,{className:"h-8 w-8 rounded-md"})]})})]});function Ye({roomsData:d,scheduleData:v,onEdit:u,onDelete:o,onManageAvailability:p,isLoading:m}){const[i,w]=a.useState(""),[f,I]=a.useState({type:"All"}),[x,k]=a.useState(1),[g]=a.useState(10),[T,A]=a.useState(!1),[r,j]=a.useState(null),N=t=>{j(t),A(!0)},F=a.useMemo(()=>d.filter(t=>t.roomNumber.toLowerCase().includes(i.toLowerCase())).filter(t=>f.type==="All"||t.type===f.type),[d,i,f]),R=a.useMemo(()=>{const t=(x-1)*g;return F.slice(t,t+g)},[F,x,g]),D=Math.ceil(F.length/g),P=["All","Lecture","Laboratory"];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-card p-4 md:p-6 rounded-lg shadow-sm border border-border",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-center mb-6",children:[e.jsxs("div",{className:"relative w-full md:max-w-xs",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:20}),e.jsx(V,{placeholder:"Search by room...",className:"pl-10 w-full",value:i,onChange:t=>{w(t.target.value),k(1)}})]}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center gap-3 w-full md:w-auto",children:e.jsxs(le,{value:f.type,onValueChange:t=>{I({type:t}),k(1)},children:[e.jsxs(oe,{className:"w-full sm:w-auto md:w-[180px]",children:[e.jsx(De,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsx(ie,{placeholder:"All Types"})]}),e.jsx(ne,{children:P.map(t=>e.jsx(G,{value:t,children:t},t))})]})})]}),e.jsx("div",{className:"rounded-lg border border-border overflow-x-auto",children:e.jsxs(te,{className:"min-w-[600px]",children:[e.jsx(ae,{className:"bg-muted/50",children:e.jsxs($,{children:[e.jsx(C,{children:"Room"}),e.jsx(C,{children:"Type"}),e.jsx(C,{className:"text-center",children:"Capacity"}),e.jsx(C,{children:"Total Subjects"}),e.jsx(C,{children:"Status"}),e.jsx(C,{className:"text-right",children:"Actions"})]})}),e.jsx(re,{children:m?Array.from({length:g}).map((t,z)=>e.jsx(Ue,{},z)):R.length===0?e.jsx($,{children:e.jsx(h,{colSpan:6,className:"text-center h-48 text-muted-foreground",children:"No rooms found."})}):R.map(t=>{const z=Je(t.id,v),B=t.status===0;return e.jsxs($,{className:"hover:bg-muted",children:[e.jsx(h,{children:e.jsx("p",{className:"font-semibold text-foreground",children:t.roomNumber})}),e.jsx(h,{className:"text-muted-foreground",children:t.type}),e.jsx(h,{className:"text-center text-muted-foreground",children:t.capacity??"--"}),e.jsx(h,{className:"text-muted-foreground",children:z}),e.jsx(h,{children:e.jsx(Ie,{variant:B?"default":"destructive",children:B?"Active":"Inactive"})}),e.jsx(h,{className:"text-right",children:e.jsx(ke,{delayDuration:100,children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsxs(J,{children:[e.jsx(U,{asChild:!0,children:e.jsx(_,{variant:"ghost",className:"text-purple-500 hover:text-purple-500",size:"icon",onClick:()=>p(t),children:e.jsx(Ve,{className:"h-4 w-4"})})}),e.jsx(Y,{children:e.jsx("p",{children:"Manage Availability"})})]}),e.jsxs(J,{children:[e.jsx(U,{asChild:!0,children:e.jsx(_,{variant:"ghost",className:"text-blue-500 hover:text-blue-500",size:"icon",onClick:()=>N(t),children:e.jsx(Le,{className:"h-4 w-4"})})}),e.jsx(Y,{children:e.jsx("p",{children:"View Schedule"})})]}),e.jsxs(J,{children:[e.jsx(U,{asChild:!0,children:e.jsx(_,{variant:"ghost",className:"text-green-500 hover:text-green-500",size:"icon",onClick:()=>u(t),children:e.jsx($e,{className:"h-4 w-4"})})}),e.jsx(Y,{children:e.jsx("p",{children:"Edit Room Details"})})]}),e.jsxs(J,{children:[e.jsx(U,{asChild:!0,children:e.jsx(_,{variant:"ghost",size:"icon",onClick:()=>o(t.id),className:"text-destructive hover:text-destructive/90",children:e.jsx(fe,{className:"h-4 w-4"})})}),e.jsx(Y,{children:e.jsx("p",{children:"Delete Room"})})]})]})})})]},t.id)})})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mt-6 text-sm gap-4",children:[e.jsxs("p",{className:"text-muted-foreground",children:["Showing ",e.jsx("strong",{children:R.length>0?(x-1)*g+1:0})," to ",e.jsx("strong",{children:Math.min(x*g,F.length)})," of ",e.jsx("strong",{children:F.length})," entries"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>k(t=>Math.max(1,t-1)),disabled:x===1,children:[e.jsx(Pe,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsxs("span",{className:"font-medium text-foreground px-2",children:["Page ",x," of ",D||1]}),e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>k(t=>Math.min(D,t+1)),disabled:x>=D,children:["Next",e.jsx(ze,{className:"h-4 w-4 ml-1"})]})]})]})]}),e.jsx(We,{isOpen:T,onClose:()=>A(!1),room:r,scheduleData:v})]})}function Ge({isOpen:d,onClose:v,onSave:u,initialData:o}){const p={roomNumber:"",type:"Lecture",capacity:40},[m,i]=a.useState(p),[w,f]=a.useState(!1);a.useEffect(()=>{d&&i(o?{roomNumber:o.roomNumber,type:o.type,capacity:o.capacity}:p)},[o,d]);const I=async g=>{g.preventDefault(),f(!0);try{await u(m)}finally{f(!1)}},x=g=>{const{name:T,value:A}=g.target;i(r=>({...r,[T]:T==="capacity"?A===""?null:Number(A):A}))},k=g=>{i(T=>({...T,type:g}))};return e.jsx(K,{open:d,onOpenChange:v,children:e.jsxs(Q,{className:"sm:max-w-[425px]",children:[e.jsx(X,{children:e.jsx(Z,{className:"text-xl font-bold",children:o?"Edit Room":"Add New Room"})}),e.jsxs("form",{onSubmit:I,className:"py-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"roomNumber",className:"text-right",children:"Room Number / Name"}),e.jsx(V,{id:"roomNumber",name:"roomNumber",value:m.roomNumber,onChange:x,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"type",children:"Type"}),e.jsxs(le,{value:m.type,onValueChange:k,children:[e.jsx(oe,{id:"type",children:e.jsx(ie,{})}),e.jsxs(ne,{children:[e.jsx(G,{value:"Lecture",children:"Lecture"}),e.jsx(G,{value:"Laboratory",children:"Laboratory"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(O,{htmlFor:"capacity",children:["Capacity ",e.jsx("span",{className:"text-muted-foreground text-xs",children:"(Optional)"})]}),e.jsx(V,{id:"capacity",name:"capacity",type:"number",min:"1",value:m.capacity??"",onChange:x})]})]}),e.jsxs(ee,{className:"pt-4",children:[e.jsx(se,{asChild:!0,children:e.jsx(_,{type:"button",variant:"outline",disabled:w,children:"Cancel"})}),e.jsx(_,{type:"submit",disabled:w,children:w?"Saving...":"Save Room"})]})]})]})})}const q=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],je=d=>{if(!d)return"";const[v,u]=d.split(":"),o=parseInt(v,10),p=o>=12?"PM":"AM",m=o%12||12;return`${String(m).padStart(2,"0")}:${u} ${p}`};function Ke({isOpen:d,onClose:v,room:u}){const[o,p]=a.useState([]),[m,i]=a.useState(!0),[w,f]=a.useState(!1),I={day:"Monday",start_time:"07:00",end_time:"12:00"},[x,k]=a.useState(I);a.useEffect(()=>{(async()=>{if(d&&u){i(!0);try{const j=localStorage.getItem("accessToken");if(!j){n.error("Authentication required.");return}const F=((await M.get(`/rooms/${u.id}/availabilities`,{headers:{Authorization:`Bearer ${j}`}})).data.availabilities||[]).sort((R,D)=>q.indexOf(R.day)-q.indexOf(D.day)||R.start_time.localeCompare(D.start_time));p(F)}catch(j){n.error("Failed to fetch availability."),console.error("Fetch availability error:",j)}finally{i(!1)}}})()},[d,u]);const g=(r,j)=>{k(N=>({...N,[r]:j}))},T=async r=>{if(r.preventDefault(),!!u){if(x.start_time>=x.end_time){n.error("End time must be after start time.");return}f(!0);try{const j=localStorage.getItem("accessToken"),N={availabilities:[{...x,start_time:`${x.start_time}:00`,end_time:`${x.end_time}:00`}]},R=(await M.post(`/rooms/${u.id}/availabilities`,N,{headers:{Authorization:`Bearer ${j}`}})).data.availabilities;p(D=>[...D,...R].sort((P,t)=>q.indexOf(P.day)-q.indexOf(t.day)||P.start_time.localeCompare(t.start_time))),k(I),n.success("New availability slot added!")}catch(j){if(j.response?.status===422){const N=j.response.data.errors;N&&N["availabilities.0.day"]?n.error(N["availabilities.0.day"][0]):n.error("Invalid data provided. Please check the time format and day.")}else n.error("Failed to add new slot. Please try again."),console.error("Add slot error:",j)}finally{f(!1)}}},A=async r=>{f(!0);try{const j=localStorage.getItem("accessToken");await M.delete(`/availabilities/${r}`,{headers:{Authorization:`Bearer ${j}`}}),p(N=>N.filter(F=>F.id!==r)),n.success("Availability slot deleted.")}catch{n.error("Failed to delete slot.")}finally{f(!1)}};return e.jsx(K,{open:d,onOpenChange:v,children:e.jsxs(Q,{className:"sm:max-w-2xl",children:[e.jsxs(X,{children:[e.jsxs(Z,{children:["Manage Availability for ",u?.roomNumber]}),e.jsx(ce,{children:"View, add, or delete the available time slots for this room."})]}),e.jsxs("div",{className:"py-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Existing Slots"}),e.jsx("div",{className:"border rounded-lg max-h-64 overflow-y-auto",children:m?e.jsxs("div",{className:"flex items-center justify-center h-24 text-muted-foreground",children:[e.jsx(he,{className:"mr-2 h-4 w-4 animate-spin"}),"Fetching data..."]}):o.length>0?e.jsxs(te,{children:[e.jsx(ae,{children:e.jsxs($,{children:[e.jsx(C,{children:"Day"}),e.jsx(C,{children:"Start Time"}),e.jsx(C,{children:"End Time"}),e.jsx(C,{className:"text-right",children:"Action"})]})}),e.jsx(re,{children:o.map(r=>e.jsxs($,{children:[e.jsx(h,{children:r.day}),e.jsx(h,{children:je(r.start_time)}),e.jsx(h,{children:je(r.end_time)}),e.jsx(h,{className:"text-right",children:e.jsx(_,{variant:"ghost",size:"icon",onClick:()=>A(r.id),disabled:w,children:e.jsx(fe,{className:"h-4 w-4 text-destructive"})})})]},r.id))})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-24 text-muted-foreground",children:[e.jsx(He,{className:"h-6 w-6 mb-2"}),e.jsx("p",{children:"No availability slots found for this room."})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Add New Slot"}),e.jsxs("form",{onSubmit:T,className:"grid grid-cols-1 sm:grid-cols-4 gap-3 items-end p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(O,{htmlFor:"day",children:"Day"}),e.jsxs(le,{value:x.day,onValueChange:r=>g("day",r),children:[e.jsx(oe,{id:"day",children:e.jsx(ie,{})}),e.jsx(ne,{children:q.map(r=>e.jsx(G,{value:r,children:r},r))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(O,{htmlFor:"start_time",children:"Start Time"}),e.jsx(V,{id:"start_time",type:"time",value:x.start_time,onChange:r=>g("start_time",r.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(O,{htmlFor:"end_time",children:"End Time"}),e.jsx(V,{id:"end_time",type:"time",value:x.end_time,onChange:r=>g("end_time",r.target.value),required:!0})]}),e.jsxs(_,{type:"submit",disabled:w,children:[w?e.jsx(he,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Ae,{className:"mr-2 h-4 w-4"}),"Add Slot"]})]})]})]}),e.jsx(ee,{children:e.jsx(se,{asChild:!0,children:e.jsx(_,{type:"button",variant:"outline",children:"Close"})})})]})})}function vs(){const[d,v]=a.useState([]),[u,o]=a.useState([]),[p,m]=a.useState([]),[i,w]=a.useState([]),[f,I]=a.useState(()=>{if(typeof window<"u"){const s=localStorage.getItem("saved_class_sections");return s?JSON.parse(s):[]}return[]}),[x,k]=a.useState(!0),[g,T]=a.useState(!1),[A,r]=a.useState(null),[j,N]=a.useState({open:!1,roomId:null}),[F,R]=a.useState(!1),[D,P]=a.useState(null),t=a.useCallback(async()=>{try{const s=localStorage.getItem("accessToken");if(!s)return n.error("Authentication required."),!1;const l=await M.get("/rooms",{headers:{Authorization:`Bearer ${s}`}});return v(l.data.rooms||[]),!0}catch(s){return n.error("Failed to fetch rooms."),console.error("Fetch Rooms Error:",s),!1}},[]),z=a.useCallback(async()=>{try{const s=localStorage.getItem("accessToken");if(!s)return n.error("Authentication required."),!1;const y=((await M.get("/get-subjects",{headers:{Authorization:`Bearer ${s}`}})).data.subject||[]).map(c=>({id:c.id,subject_code:c.subject_code,des_title:c.des_title,code:c.subject_code,name:c.des_title,yearLevel:parseInt(c.semester.year_level)||0,semester_id:c.semester_id,total_units:c.total_units,lec_units:c.lec_units,lab_units:c.lab_units}));return o(y),!0}catch(s){return n.error("Failed to fetch subjects."),console.error("Fetch Subjects Error:",s),!1}},[]),B=a.useCallback(async()=>{try{const s=localStorage.getItem("accessToken");if(!s)return!1;const l=await M.get("get-faculty-loading",{headers:{Authorization:`Bearer ${s}`}});return l.data.success?(m(l.data.data||[]),!0):!1}catch(s){return console.error("Fetch Faculty Loading Error:",s),!1}},[]),E=a.useCallback(async(s=null,l=null,S=null)=>{const y=localStorage.getItem("accessToken");if(!y)return{success:!1,data:[],message:"Authentication required."};if(!S)return s||l?{success:!1,data:[],message:"Program id is required for filtering schedules."}:{success:!0,data:[],message:"No program selected; schedule list is empty."};const c={};s&&(c.year_level=s),l&&(c.section=l),c.program_id=S;try{const b=await M.post("/filter-schedule",c,{headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"}});return b.data.success?{success:!0,data:b.data.data||[],message:b.data.message}:{success:!1,data:[],message:b.data.message||"Failed to fetch schedules."}}catch(b){return b.response?.status===401?{success:!1,data:[],message:"Session expired or unauthorized. Please log in again."}:(console.error("Fetch Schedules Error:",b),{success:!1,data:[],message:b.response?.data?.message||"An unexpected error occurred."})}},[]),de=a.useCallback(async(s,l,S)=>{const y=await E(s,l,S);return y.success&&w(y.data),y},[E]);a.useEffect(()=>{(async()=>{k(!0);try{const[l,S,y,c]=await Promise.all([t(),z(),B(),E()]);c.success?w(c.data):n.error(c.message)}catch(l){console.error("An error occurred during data fetching:",l)}finally{k(!1)}})()},[t,z,B,E]);const ge=async s=>{const l=localStorage.getItem("accessToken");if(!l){n.error("Authentication required.");return}try{if(A){const S=await M.put(`/rooms/${A.id}`,s,{headers:{Authorization:`Bearer ${l}`}});n.success(S.data.message||"Room updated successfully!")}else{const S=await M.post("/rooms",s,{headers:{Authorization:`Bearer ${l}`}});n.success(S.data.message||"Room created successfully!");const y=S.data.room?.id;if(y){const c=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],b=[{start_time:"07:00:00",end_time:"12:00:00"},{start_time:"13:00:00",end_time:"21:00:00"}],H={availabilities:c.flatMap(W=>b.map(_e=>({day:W,..._e})))};await M.post(`/rooms/${y}/availabilities`,H,{headers:{Authorization:`Bearer ${l}`}}),n.success("Default availability has been set.")}}T(!1),r(null),t()}catch(S){if(S.response?.status===422){const y=S.response.data.errors;for(const c in y){n.error(`Validation Error: ${y[c][0]}`);return}}else n.error("An error occurred. Please try again.")}},ye=()=>{r(null),T(!0)},be=s=>{r(s),T(!0)},ve=s=>{N({open:!0,roomId:s})},Ne=s=>{P(s),R(!0)},Se=async()=>{if(j.roomId===null)return;const s=localStorage.getItem("accessToken");if(!s){n.error("Authentication required.");return}try{const l=await M.delete(`/rooms/${j.roomId}`,{headers:{Authorization:`Bearer ${s}`}});n.success(l.data.message||"Room deleted successfully!"),t()}catch{n.error("Failed to delete room.")}finally{N({open:!1,roomId:null})}},Ce=async s=>{try{const l=localStorage.getItem("accessToken"),S={subject_id:s.subjectId,room_id:s.roomId,day:s.day,start_time:s.startTime,end_time:s.endTime,section:s.section,year_level:s.yearLevel,type:s.type,program_id:s.programId},y=await M.post("/create-schedule",S,{headers:{Authorization:`Bearer ${l}`}});if(y.data.success){if(n.success(y.data.message),!f.some(b=>b.yearLevel===s.yearLevel&&b.section===s.section)){const b=[...f,{yearLevel:s.yearLevel,section:s.section}];b.sort((H,W)=>H.section.localeCompare(W.section)),I(b),localStorage.setItem("saved_class_sections",JSON.stringify(b))}return await de(s.yearLevel,s.section,s.programId),!0}return!1}catch(l){return l.response&&l.response.data?n.error(l.response.data.message):n.error("Failed to save schedule."),!1}},we=localStorage.getItem("accessToken");return e.jsxs(e.Fragment,{children:[e.jsxs("main",{children:[e.jsxs("header",{className:"mb-8 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground tracking-tight",children:"Classroom & Schedule Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Monitor classroom utilization and view schedules by year level."})]}),e.jsxs(_,{onClick:ye,className:"shadow-md hover:shadow-lg transition-all",children:[e.jsx(Be,{size:16,className:"mr-2"}),"Add Room"]})]}),e.jsxs(Fe,{defaultValue:"classrooms",children:[e.jsxs(Me,{className:"grid w-full grid-cols-2 mb-4",children:[e.jsx(ue,{value:"classrooms",children:"Classroom List"}),e.jsx(ue,{value:"schedules",children:"Class Schedules"})]}),e.jsx(me,{value:"classrooms",children:e.jsx(Ye,{roomsData:d,scheduleData:i,subjectsData:u,onEdit:be,onDelete:ve,onManageAvailability:Ne,isLoading:x})}),e.jsx(me,{value:"schedules",children:e.jsx(Oe,{scheduleData:i,subjectsData:u,roomsData:d,facultyLoadingData:p,savedSections:f,onAddSchedule:Ce,onFilterApply:de,authToken:we})})]})]}),e.jsx(Ge,{isOpen:g,onClose:()=>{T(!1),r(null)},onSave:ge,initialData:A}),e.jsx(K,{open:j.open,onOpenChange:()=>N({open:!1,roomId:null}),children:e.jsxs(Q,{children:[e.jsxs(X,{children:[e.jsx(Z,{children:"Are you absolutely sure?"}),e.jsx(ce,{children:"This action cannot be undone. This will permanently delete the room."})]}),e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsx(_,{variant:"outline",children:"Cancel"})}),e.jsx(_,{variant:"destructive",onClick:Se,children:"Yes, delete it"})]})]})}),e.jsx(Ke,{isOpen:F,onClose:()=>R(!1),room:D})]})}export{vs as default};
