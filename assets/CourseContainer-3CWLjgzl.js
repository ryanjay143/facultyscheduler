import{c as ye,j as e,m as he,B as y,b as we,f as ts,r as t,t as w,a as H,T as rs,k as pe,l as fe,n as ge,o as Le,p as as,h as ns,P as Ce,q as os,i as be,u as ls,A as cs}from"./index-B7-ioslR.js";import{I as C}from"./input-BlnGnrQN.js";import{S as Q,a as Z,b as ee,c as se,d as te,u as is}from"./select-DBSvAbne.js";import{S as ds}from"./sweetalert2.esm.all-ePrzfkxH.js";import{S as le}from"./square-pen-pMzqhdJz.js";import{T as re,P as xe}from"./trash-2-DQCpgFhN.js";import{B as us}from"./book-copy-EbodxhPI.js";import{S as U,C as ve}from"./skeleton-H6s7PLhB.js";import{D as V,a as K,b as J,c as W,d as Te,e as X,f as ae}from"./dialog-BNijiZgj.js";import{T as ke,a as Ae,b as $,c as P,d as Ee,e as b,f as Pe}from"./table-DOeMTMOO.js";import{B as ms}from"./badge-CpAVj5PB.js";import{L as ue}from"./layers-CSmnF7dx.js";import{L as E}from"./label-CjppUUpb.js";import{S as hs}from"./search-BMf7dtlm.js";import"./Combination-Byckn_oF.js";import"./check-2ndhOYSX.js";import"./chevron-up-icmVRxTg.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],js=ye("archive",xs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]],fs=ye("sliders-horizontal",ps),Se=["from-purple-600 to-indigo-600","from-blue-500 to-teal-400","from-pink-500 to-rose-500","from-orange-500 to-amber-500","from-green-500 to-lime-500","from-cyan-500 to-sky-500"],gs={hidden:{opacity:0,y:20},visible:r=>({opacity:1,y:0,transition:{delay:r*.05}})};function bs({program:r,index:j,onEdit:l,onDelete:o,onManage:s}){const S=Object.values(r.semesters||{}).flatMap(u=>u.subjects).length,h=Object.values(r.semesters||{}).flatMap(u=>u.subjects).reduce((u,i)=>u+i.unitsTotal,0);return e.jsxs(he.div,{variants:gs,custom:j,initial:"hidden",animate:"visible",exit:"hidden",className:"bg-card rounded-xl border border-border shadow-sm overflow-hidden group flex flex-col transition-all duration-300 hover:shadow-md hover:-translate-y-1",children:[e.jsxs("div",{className:`p-5 bg-gradient-to-br text-white relative ${Se[j%Se.length]}`,children:[e.jsx("h2",{className:"text-xl font-bold pr-16",children:r.abbreviation}),e.jsx("p",{className:"opacity-80 truncate text-sm pr-16",children:r.name}),e.jsxs("div",{className:"absolute top-2 right-2 hidden md:flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(y,{size:"icon",variant:"ghost",title:"Edit Program",onClick:u=>{u.stopPropagation(),l(r)},className:"h-8 w-8 bg-black/20 hover:bg-black/40",children:e.jsx(le,{size:16})}),e.jsx(y,{size:"icon",variant:"ghost",title:"Archive Program",onClick:u=>{u.stopPropagation(),o(r.id)},className:"h-8 w-8 bg-black/20 hover:bg-destructive/80",children:e.jsx(re,{size:16})})]}),e.jsxs("div",{className:"absolute top-2 right-2 flex md:hidden gap-1",children:[e.jsx(y,{size:"icon",variant:"ghost",title:"Edit Program",onClick:u=>{u.stopPropagation(),l(r)},className:"h-8 w-8 bg-black/20 hover:bg-black/40",children:e.jsx(le,{size:16})}),e.jsx(y,{size:"icon",variant:"ghost",title:"Archive Program",onClick:u=>{u.stopPropagation(),o(r.id)},className:"h-8 w-8 bg-black/20 hover:bg-destructive/80",children:e.jsx(re,{size:16})})]})]}),e.jsxs("div",{className:"p-5 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-4",children:[e.jsx(we,{size:15}),e.jsxs("span",{children:["A.Y. ",r.effectiveYear]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center text-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx(us,{size:15,className:"text-muted-foreground"}),e.jsx("span",{children:"Total Subjects"})]}),e.jsx("span",{className:"px-2.5 py-0.5 bg-muted text-muted-foreground rounded-full font-semibold",children:S})]}),e.jsxs("div",{className:"flex justify-between items-center text-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx(ts,{size:15,className:"text-muted-foreground"}),e.jsx("span",{children:"Total Units"})]}),e.jsx("span",{className:"px-2.5 py-0.5 bg-muted text-muted-foreground rounded-full font-semibold",children:h})]})]})]}),e.jsx(y,{onClick:s,className:"w-full mt-5",variant:"secondary",children:"Manage Curriculum"})]})]})}function vs(){return e.jsxs("div",{className:"bg-card rounded-xl border border-border shadow-sm p-5 space-y-4",children:[e.jsx(U,{className:"h-8 w-1/4"}),e.jsx(U,{className:"h-5 w-3/4"}),e.jsxs("div",{className:"pt-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(U,{className:"h-5 w-1/2"}),e.jsx(U,{className:"h-6 w-10 rounded-full"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(U,{className:"h-5 w-1/2"}),e.jsx(U,{className:"h-6 w-10 rounded-full"})]})]}),e.jsx(U,{className:"h-10 w-full mt-5"})]})}function Ss({isOpen:r,onClose:j,program:l,onAddSemester:o,onEditSemester:s,onDeleteSemester:S,onAddSubject:h,onEditSubject:u,onDeleteSubject:i,onSetSemesterStatus:v,refreshKey:T}){const[c,f]=t.useState(l.semesters||{}),[k,O]=t.useState(!1);return t.useEffect(()=>{f(l.semesters||{})},[l.semesters]),t.useEffect(()=>{if(!r)return;(async()=>{const m=localStorage.getItem("accessToken");if(!m){w.error("Authentication required.");return}O(!0);try{const p=await H.get("/semester-with-subjects",{params:{program_id:l.id},headers:{Authorization:`Bearer ${m}`}}),z=Array.isArray(p.data.semesters)?p.data.semesters:[],I={};z.forEach(N=>{const F=`${N.year_level}, ${N.semester_level}`;I[F]={subjects:(N.subjects||[]).map(a=>({code:a.subject_code,name:a.des_title,unitsTotal:a.total_units,unitsLec:a.lec_units,unitsLab:a.lab_units,hoursTotal:a.total_hrs,hoursLec:a.total_lec_hrs,hoursLab:a.total_lab_hrs,prerequisite:a.pre_requisite||"None"})),isActive:N.isActive??!0,startDate:N.startDate,endDate:N.endDate}}),f(I)}catch(p){w.error("Failed to load fresh semester data."),console.error("Failed fetching semesters:",p)}finally{O(!1)}})()},[r,l.id,T]),t.useEffect(()=>{l?.semesters&&f(L=>({...L,...l.semesters}))},[l.semesters]),e.jsx(V,{open:r,onOpenChange:j,children:e.jsxs(K,{className:"max-w-7xl h-[95vh] flex flex-col p-0",children:[e.jsxs(J,{className:"p-6 pb-4 bg-muted/50 border-b rounded-t-lg",children:[e.jsxs(W,{className:"text-2xl md:text-3xl font-bold text-foreground flex items-center gap-3",children:[l.name,e.jsx("span",{className:"text-sm font-semibold text-primary bg-primary/10 px-3 py-1 rounded-full",children:l.abbreviation})]}),e.jsxs(Te,{children:["Academic Year of Effectivity: ",l.effectiveYear]})]}),e.jsx("div",{className:"flex-grow overflow-y-auto px-6 py-4 space-y-8",children:k?e.jsx("div",{className:"space-y-6",children:[1,2].map(L=>e.jsxs("div",{className:"bg-card border rounded-xl p-4 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-muted/60 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-48 bg-muted/30 rounded"})]},L))}):Object.keys(c).length===0?e.jsxs("div",{className:"text-center py-20 text-muted-foreground flex flex-col items-center justify-center h-full",children:[e.jsx(ue,{size:56,className:"mx-auto mb-4"}),e.jsx("h4",{className:"font-semibold text-xl text-foreground",children:"No Semesters Found"}),e.jsx("p",{className:"max-w-md mx-auto mt-2 text-sm",children:"This curriculum is empty. Start by adding a semester."}),e.jsxs(y,{onClick:o,className:"mt-6",children:[e.jsx(ue,{size:16,className:"mr-2"})," Add Year/Semester"]})]}):Object.entries(c).map(([L,m])=>e.jsxs("div",{className:"group/semester bg-card border rounded-xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-muted/30 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"text-lg font-semibold text-foreground",children:L}),e.jsx(ms,{variant:m.isActive?"default":"destructive",children:m.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover/semester:opacity-100 transition-opacity",children:[e.jsx(y,{variant:"ghost",size:"icon",title:"Set Status & Dates",className:"h-8 w-8 text-muted-foreground",onClick:()=>v(l,L),children:e.jsx(fs,{size:16})}),e.jsx(y,{variant:"ghost",size:"icon",title:"Rename Semester",className:"h-8 w-8 text-muted-foreground",onClick:()=>s(L),children:e.jsx(le,{size:16})}),e.jsx(y,{variant:"ghost",size:"icon",title:"Delete Semester",className:"h-8 w-8 text-destructive",onClick:()=>S(L),children:e.jsx(re,{size:16})})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ke,{children:[e.jsx(Ae,{children:e.jsxs($,{children:[e.jsx(P,{children:"Code"}),e.jsx(P,{className:"w-2/5",children:"Descriptive Title"}),e.jsx(P,{className:"text-center",children:"Total Units"}),e.jsx(P,{className:"text-center",children:"Lec Units"}),e.jsx(P,{className:"text-center",children:"Lab Units"}),e.jsx(P,{className:"text-center",children:"Total Hours"}),e.jsx(P,{children:"Pre-requisite"}),e.jsx(P,{className:"text-right w-[100px]",children:"Actions"})]})}),e.jsx(Ee,{children:m.subjects.length>0?m.subjects.map(p=>e.jsxs($,{children:[e.jsx(b,{className:"font-semibold",children:p.code}),e.jsx(b,{children:p.name}),e.jsx(b,{className:"text-center font-bold text-primary",children:p.unitsTotal}),e.jsx(b,{className:"text-center",children:p.unitsLec}),e.jsx(b,{className:"text-center",children:p.unitsLab}),e.jsx(b,{className:"text-center font-bold text-primary",children:p.hoursTotal}),e.jsx(b,{children:p.prerequisite}),e.jsx(b,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end",children:[e.jsx(y,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground",onClick:()=>u(L,p),children:e.jsx(le,{size:16})}),e.jsx(y,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>i(L,p.code),children:e.jsx(re,{size:16})})]})})]},p.code)):e.jsx($,{children:e.jsx(b,{colSpan:8,className:"text-center h-24 text-muted-foreground",children:"No subjects added for this semester."})})}),e.jsx(Pe,{children:e.jsxs($,{className:"bg-muted/50 font-bold",children:[e.jsx(b,{colSpan:2,className:"text-right",children:"SEMESTER TOTALS"}),e.jsx(b,{className:"text-center text-lg text-primary",children:m.subjects.reduce((p,z)=>p+z.unitsTotal,0)}),e.jsx(b,{className:"text-center text-muted-foreground",children:m.subjects.reduce((p,z)=>p+z.unitsLec,0)}),e.jsx(b,{className:"text-center text-muted-foreground",children:m.subjects.reduce((p,z)=>p+z.unitsLab,0)}),e.jsx(b,{className:"text-center text-lg text-primary",children:m.subjects.reduce((p,z)=>p+z.hoursTotal,0)}),e.jsx(b,{colSpan:2})]})})]})}),e.jsx("div",{className:"p-2 border-t",children:e.jsxs(y,{onClick:()=>h(L),variant:"link",children:[e.jsx(xe,{size:16,className:"mr-1"})," Add Subject"]})})]},L))}),e.jsx(X,{className:"mt-auto p-6 bg-gray-50 border-t rounded-b-lg",children:e.jsxs(y,{onClick:o,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(ue,{size:16})," Add Year/Semester"]})})]})})}const Ns=()=>{const r=new Date().getFullYear(),j=[];for(let l=-2;l<=5;l++)j.push(String(r+l));return j.sort()},Ne=Ns();function ys({isOpen:r,onClose:j,onSave:l,initialData:o}){const[s,S]=t.useState(""),[h,u]=t.useState(""),[i,v]=t.useState(""),[T,c]=t.useState(""),[f,k]=t.useState(!1);t.useEffect(()=>{if(o){S(o.name),u(o.abbreviation);const[m="",p=""]=o.effectiveYear.split("-");v(m),c(p)}else{S(""),u("");const m=new Date().getFullYear();v(String(m)),c(String(m+1))}},[o,r]);const O=async m=>{m.preventDefault(),k(!0);const p={program_name:s,abbreviation:h,year_from:i,year_to:T},z=localStorage.getItem("accessToken");if(!z){w.error("Authentication required."),k(!1);return}const I={Authorization:`Bearer ${z}`};try{const N=!!o,F=N?`/edit-program/${o.id}`:"/add-program",x=await H["post"](F,p,{headers:I});w.success(x.data.message||"Program saved successfully!");const d=x.data.program,D={id:d.id,name:d.program_name,abbreviation:d.abbreviation,effectiveYear:`${d.year_from}-${d.year_to}`,semesters:d.semesters||o?.semesters||{},subjects:d.subjects||o?.subjects||{}};l(D),j()}catch(N){if(H.isAxiosError(N)&&N.response){if(N.response.status===401){w.error("Your session has expired. Please log in again.");return}const F=N.response.data,a=F.errors;if(a&&typeof a=="object"&&Object.keys(a).length>0){const x=Object.keys(a)[0],d=a[x]?.[0];w.error(d||"A validation error occurred.")}else F&&typeof F.message=="string"?w.error(F.message):w.error("An unknown API error occurred.")}else w.error("Failed to connect to the server. Please check your connection."),console.error("Non-Axios error:",N)}finally{k(!1)}},L=m=>{v(m),c(String(Number(m)+1))};return e.jsx(V,{open:r,onOpenChange:j,children:e.jsxs(K,{children:[e.jsx(J,{children:e.jsx(W,{children:o?"Edit Program":"Add New Program"})}),e.jsxs("form",{onSubmit:O,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"progName",children:"Program Name"}),e.jsx(C,{id:"progName",value:s,onChange:m=>S(m.target.value),placeholder:"e.g., Bachelor of Science...",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"progAbbr",children:"Abbreviation"}),e.jsx(C,{id:"progAbbr",value:h,onChange:m=>u(m.target.value),placeholder:"e.g., BSIT",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Effectivity A.Y."}),e.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr] items-center gap-2",children:[e.jsxs(Q,{value:i,onValueChange:L,required:!0,children:[e.jsx(Z,{children:e.jsx(ee,{placeholder:"Start Year"})}),e.jsx(se,{children:Ne.map(m=>e.jsx(te,{value:m,children:m},m))})]}),e.jsx("span",{className:"text-muted-foreground",children:"-"}),e.jsxs(Q,{value:T,onValueChange:c,required:!0,children:[e.jsx(Z,{children:e.jsx(ee,{placeholder:"End Year"})}),e.jsx(se,{children:Ne.map(m=>e.jsx(te,{value:m,children:m},m))})]})]})]}),e.jsxs(X,{className:"pt-4",children:[e.jsx(ae,{asChild:!0,children:e.jsx(y,{type:"button",variant:"outline",disabled:f,children:"Cancel"})}),e.jsx(y,{type:"submit",disabled:f,children:f?"Saving...":o?"Save Changes":"Save Program"})]})]})]})})}const me={code:"",name:"",unitsTotal:0,unitsLec:0,unitsLab:0,hoursTotal:0,hoursLec:0,hoursLab:0,prerequisite:""},ws=["1st Year","2nd Year","3rd Year","4th Year"],Ls=["1st Semester","2nd Semester","Summer"];function Cs({isOpen:r,onClose:j,onSave:l,programId:o}){const[s,S]=t.useState(""),[h,u]=t.useState(""),[i,v]=t.useState([me]),[T,c]=t.useState(!1);t.useEffect(()=>{const a=i.map(x=>{const d=(Number(x.unitsLec)||0)+(Number(x.unitsLab)||0),D=(Number(x.hoursLec)||0)+(Number(x.hoursLab)||0);return{...x,unitsTotal:d,hoursTotal:D}});JSON.stringify(a)!==JSON.stringify(i)&&v(a)},[i]);const{totalUnits:f,totalLecUnits:k,totalLabUnits:O,totalHours:L,totalLecHours:m,totalLabHours:p}=t.useMemo(()=>i.reduce((a,x)=>(a.totalUnits+=Number(x.unitsTotal)||0,a.totalLecUnits+=Number(x.unitsLec)||0,a.totalLabUnits+=Number(x.unitsLab)||0,a.totalHours+=Number(x.hoursTotal)||0,a.totalLecHours+=Number(x.hoursLec)||0,a.totalLabHours+=Number(x.hoursLab)||0,a),{totalUnits:0,totalLecUnits:0,totalLabUnits:0,totalHours:0,totalLecHours:0,totalLabHours:0}),[i]),z=()=>v(a=>[...a,me]),I=a=>v(x=>x.filter((d,D)=>D!==a)),N=(a,x,d)=>{v(D=>D.map((R,G)=>{if(G===a){const Y=["unitsLec","unitsLab","hoursLec","hoursLab"].includes(x);return{...R,[x]:Y?d===""?"":Number(d):d}}return R}))},F=async a=>{if(a.preventDefault(),!s||!h){w.error("Please select a year level and semester.");return}if(i.some(d=>!d.code||!d.name)){w.error("Please fill out all subject codes and titles.");return}c(!0);try{const d=localStorage.getItem("accessToken");if(!d){w.error("Authentication required. Please log in again.");return}const D=i.map(Y=>({subject_code:Y.code,des_title:Y.name,total_units:Y.unitsTotal,lec_units:Y.unitsLec,lab_units:Y.unitsLab,total_hrs:Y.hoursTotal,total_lec_hrs:Y.hoursLec,total_lab_hrs:Y.hoursLab,pre_requisite:Y.prerequisite||null})),R={program_id:o,year_level:s,semester_level:h,subjects:D};if((await H.post("/semester-with-subjects",R,{headers:{Authorization:`Bearer ${d}`}})).status===201&&(w.success("Semester and subjects added successfully!"),j(),l)){const Y=`${s}, ${h}`;l(Y,i,!0)}}catch(d){d.response?.status===401?w.error("Session expired. Please log in again."):d.response?.data?.error?w.error(d.response.data.error):w.error("Failed to save semester and subjects. Please try again."),console.error("Error saving semester:",d)}finally{c(!1)}};return t.useEffect(()=>{r&&(S(""),u(""),v([me]))},[r]),e.jsx(V,{open:r,onOpenChange:j,children:e.jsx(rs,{children:e.jsxs(K,{className:"max-w-7xl h-[95vh] flex flex-col",children:[e.jsxs(J,{children:[e.jsx(W,{children:"Add New Semester and Subjects"}),e.jsx(Te,{children:"Add subjects in bulk. Totals are calculated automatically."})]}),e.jsxs("form",{onSubmit:F,className:"flex-grow flex flex-col min-h-0 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"yearLevel",className:"text-base",children:"Year Level"}),e.jsxs(Q,{value:s,onValueChange:S,required:!0,children:[e.jsx(Z,{id:"yearLevel",children:e.jsx(ee,{placeholder:"Select a year level"})}),e.jsx(se,{children:ws.map(a=>e.jsx(te,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"semester",className:"text-base",children:"Semester"}),e.jsxs(Q,{value:h,onValueChange:u,required:!0,children:[e.jsx(Z,{id:"semester",children:e.jsx(ee,{placeholder:"Select a semester"})}),e.jsx(se,{children:Ls.map(a=>e.jsx(te,{value:a,children:a},a))})]})]})]}),e.jsx("div",{className:"flex-grow overflow-auto border rounded-lg",children:e.jsxs(ke,{className:"min-w-[1200px]",children:[e.jsxs(Ae,{className:"bg-muted/50 sticky top-0 z-10",children:[e.jsxs($,{children:[e.jsx(P,{rowSpan:2,className:"align-middle text-center border-r",children:"Course Code"}),e.jsx(P,{rowSpan:2,className:"align-middle text-center border-r w-[350px]",children:"Descriptive Title"}),e.jsx(P,{colSpan:3,className:"text-center border-r",children:"Units"}),e.jsx(P,{colSpan:3,className:"text-center border-r",children:"Hours per week"}),e.jsx(P,{rowSpan:2,className:"align-middle text-center border-r",children:"Pre-requisite"}),e.jsx(P,{rowSpan:2,className:"align-middle w-[50px]"})]}),e.jsxs($,{children:[e.jsx(P,{className:"text-center border-r",children:"Total"}),e.jsx(P,{className:"text-center border-r",children:"Lec"}),e.jsx(P,{className:"text-center border-r",children:"Lab"}),e.jsx(P,{className:"text-center border-r",children:"Total"}),e.jsx(P,{className:"text-center border-r",children:"Lec"}),e.jsx(P,{className:"text-center border-r",children:"Lab"})]})]}),e.jsx(Ee,{children:i.map((a,x)=>e.jsxs($,{children:[e.jsx(b,{className:"w-[150px]",children:e.jsx(C,{className:"uppercase",placeholder:"e.g. CS101",value:a.code,onChange:d=>N(x,"code",d.target.value)})}),e.jsx(b,{children:e.jsx(C,{placeholder:"e.g. Introduction to Programming",value:a.name,onChange:d=>N(x,"name",d.target.value)})}),e.jsx(b,{children:e.jsxs(pe,{children:[e.jsx(fe,{asChild:!0,children:e.jsx(C,{type:"number",value:a.unitsTotal||"",readOnly:!0,className:"text-center font-bold bg-muted/50 cursor-not-allowed"})}),e.jsx(ge,{children:e.jsx("p",{children:"Auto-calculated from Lec and Lab units."})})]})}),e.jsx(b,{children:e.jsx(C,{min:"0",type:"number",value:a.unitsLec||"",onChange:d=>N(x,"unitsLec",d.target.value),className:"text-center"})}),e.jsx(b,{children:e.jsx(C,{min:"0",type:"number",value:a.unitsLab||"",onChange:d=>N(x,"unitsLab",d.target.value),className:"text-center"})}),e.jsx(b,{children:e.jsxs(pe,{children:[e.jsx(fe,{asChild:!0,children:e.jsx(C,{type:"number",value:a.hoursTotal||"",readOnly:!0,className:"text-center font-bold bg-muted/50 cursor-not-allowed"})}),e.jsx(ge,{children:e.jsx("p",{children:"Auto-calculated from Lec and Lab hours."})})]})}),e.jsx(b,{children:e.jsx(C,{min:"0",type:"number",value:a.hoursLec||"",onChange:d=>N(x,"hoursLec",d.target.value),className:"text-center"})}),e.jsx(b,{children:e.jsx(C,{min:"0",type:"number",value:a.hoursLab||"",onChange:d=>N(x,"hoursLab",d.target.value),className:"text-center"})}),e.jsx(b,{className:"w-[150px]",children:e.jsx(C,{placeholder:"None",value:a.prerequisite,onChange:d=>N(x,"prerequisite",d.target.value)})}),e.jsx(b,{className:"text-center",children:e.jsx(y,{type:"button",variant:"ghost",size:"icon",onClick:()=>I(x),className:"text-destructive h-8 w-8 shrink-0",children:e.jsx(re,{size:16})})})]},x))}),e.jsx(Pe,{className:"sticky bottom-0 bg-muted/80 backdrop-blur-sm",children:e.jsxs($,{children:[e.jsx(b,{colSpan:2,className:"text-right font-bold text-lg",children:"SEMESTER TOTALS"}),e.jsx(b,{className:"text-center font-bold text-lg text-primary",children:f}),e.jsx(b,{className:"text-center font-semibold",children:k}),e.jsx(b,{className:"text-center font-semibold",children:O}),e.jsx(b,{className:"text-center font-bold text-lg text-primary",children:L}),e.jsx(b,{className:"text-center font-semibold",children:m}),e.jsx(b,{className:"text-center font-semibold",children:p}),e.jsx(b,{colSpan:2})]})})]})}),e.jsxs(y,{type:"button",variant:"outline",onClick:z,className:"mt-4 w-full sm:w-auto",children:[e.jsx(xe,{size:16,className:"mr-2"})," Add Subject Row"]}),e.jsxs(X,{className:"mt-5 pt-4 border-t",children:[e.jsx(ae,{asChild:!0,children:e.jsx(y,{type:"button",variant:"outline",disabled:T,children:"Cancel"})}),e.jsx(y,{type:"submit",disabled:T,children:T?"Saving...":"Save Curriculum"})]})]})]})})})}function Ts({isOpen:r,onClose:j,onSave:l,initialData:o}){const[s,S]=t.useState("");t.useEffect(()=>{r&&S(o||"")},[r,o]);const h=u=>{u.preventDefault(),l(s)};return e.jsx(V,{open:r,onOpenChange:j,children:e.jsxs(K,{children:[e.jsx(J,{children:e.jsx(W,{children:"Rename Semester"})}),e.jsxs("form",{onSubmit:h,className:"py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"semesterName",children:"New Semester Name"}),e.jsx(C,{id:"semesterName",value:s,onChange:u=>S(u.target.value),required:!0})]}),e.jsxs(X,{className:"pt-6",children:[e.jsx(ae,{asChild:!0,children:e.jsx(y,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(y,{type:"submit",children:"Save Changes"})]})]})]})})}function ks({isOpen:r,onClose:j,onSave:l,initialData:o}){const[s,S]=t.useState({code:"",name:"",unitsTotal:0,unitsLec:0,unitsLab:0,hoursTotal:0,hoursLec:0,hoursLab:0,prerequisite:""}),[h,u]=t.useState(null);t.useEffect(()=>{const c=s.unitsLec+s.unitsLab,f=s.hoursLec+s.hoursLab;S(k=>({...k,unitsTotal:c,hoursTotal:f}))},[s.unitsLec,s.unitsLab,s.hoursLec,s.hoursLab]),t.useEffect(()=>{const c=s.unitsLec+s.unitsLab>s.unitsTotal?"Lec + Lab units cannot exceed Total.":null,f=s.hoursLec+s.hoursLab>s.hoursTotal?"Lec + Lab hours cannot exceed Total.":null;u(c||f?{unitError:c,hourError:f}:null)},[s]),t.useEffect(()=>{r&&S(o||{code:"",name:"",unitsTotal:0,unitsLec:0,unitsLab:0,hoursTotal:0,hoursLec:0,hoursLab:0,prerequisite:""})},[r,o]);const i=(c,f)=>{S(k=>({...k,[c]:f}))},v=(c,f)=>{const k=Number(f);i(c,k>=0?k:0)},T=c=>{if(c.preventDefault(),h){w.error("Please fix the validation errors before saving.");return}l(s,!!o)};return e.jsx(V,{open:r,onOpenChange:j,children:e.jsxs(K,{children:[e.jsx(J,{children:e.jsx(W,{children:o?`Edit Subject: ${o.code}`:"Add New Subject"})}),e.jsxs("form",{onSubmit:T,className:"py-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"code",children:"Course Code"}),e.jsx(C,{id:"code",value:s.code,onChange:c=>i("code",c.target.value),disabled:!!o,required:!0}),!!o&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Course code cannot be edited."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"prerequisite",children:"Pre-requisite"}),e.jsx(C,{id:"prerequisite",value:s.prerequisite,onChange:c=>i("prerequisite",c.target.value),placeholder:"None"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"name",children:"Descriptive Title"}),e.jsx(C,{id:"name",value:s.name,onChange:c=>i("name",c.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(E,{className:"font-semibold",children:"Unit Allocation"}),e.jsxs("div",{className:`grid grid-cols-3 gap-4 p-4 border rounded-lg bg-muted/30 ${h?.unitError?"border-destructive":""}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{htmlFor:"unitsTotal",children:"Total"}),e.jsx(C,{id:"unitsTotal",type:"number",value:s.unitsTotal||"",disabled:!0,readOnly:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{htmlFor:"unitsLec",children:"Lec"}),e.jsx(C,{id:"unitsLec",type:"number",value:s.unitsLec||"",onChange:c=>v("unitsLec",c.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{htmlFor:"unitsLab",children:"Lab"}),e.jsx(C,{id:"unitsLab",type:"number",value:s.unitsLab||"",onChange:c=>v("unitsLab",c.target.value)})]})]}),h?.unitError&&e.jsxs("p",{className:"text-destructive text-sm flex items-center gap-2 mt-2",children:[e.jsx(ve,{size:16}),h.unitError]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(E,{className:"font-semibold",children:"Hour Allocation"}),e.jsxs("div",{className:`grid grid-cols-3 gap-4 p-4 border rounded-lg bg-muted/30 ${h?.hourError?"border-destructive":""}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{htmlFor:"hoursTotal",children:"Total"}),e.jsx(C,{id:"hoursTotal",type:"number",value:s.hoursTotal||"",disabled:!0,readOnly:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{htmlFor:"hoursLec",children:"Lec"}),e.jsx(C,{id:"hoursLec",type:"number",value:s.hoursLec||"",onChange:c=>v("hoursLec",c.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{htmlFor:"hoursLab",children:"Lab"}),e.jsx(C,{id:"hoursLab",type:"number",value:s.hoursLab||"",onChange:c=>v("hoursLab",c.target.value)})]})]}),h?.hourError&&e.jsxs("p",{className:"text-destructive text-sm flex items-center gap-2 mt-2",children:[e.jsx(ve,{size:16}),h.hourError]})]})]}),e.jsxs(X,{className:"mt-8 pt-4 border-t",children:[e.jsx(ae,{asChild:!0,children:e.jsx(y,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(y,{type:"submit",disabled:!!h,children:h?"Fix Errors":o?"Save Changes":"Save Subject"})]})]})]})})}function As(r,j,{checkForDefaultPrevented:l=!0}={}){return function(s){if(r?.(s),l===!1||!s.defaultPrevented)return j?.(s)}}var ce="Switch",[Es,et]=ns(ce),[Ps,_s]=Es(ce),_e=t.forwardRef((r,j)=>{const{__scopeSwitch:l,name:o,checked:s,defaultChecked:S,required:h,disabled:u,value:i="on",onCheckedChange:v,form:T,...c}=r,[f,k]=t.useState(null),O=Le(j,I=>k(I)),L=t.useRef(!1),m=f?T||!!f.closest("form"):!0,[p,z]=as({prop:s,defaultProp:S??!1,onChange:v,caller:ce});return e.jsxs(Ps,{scope:l,checked:p,disabled:u,children:[e.jsx(Ce.button,{type:"button",role:"switch","aria-checked":p,"aria-required":h,"data-state":Fe(p),"data-disabled":u?"":void 0,disabled:u,value:i,...c,ref:O,onClick:As(r.onClick,I=>{z(N=>!N),m&&(L.current=I.isPropagationStopped(),L.current||I.stopPropagation())})}),m&&e.jsx(Ye,{control:f,bubbles:!L.current,name:o,value:i,checked:p,required:h,disabled:u,form:T,style:{transform:"translateX(-100%)"}})]})});_e.displayName=ce;var ze="SwitchThumb",qe=t.forwardRef((r,j)=>{const{__scopeSwitch:l,...o}=r,s=_s(ze,l);return e.jsx(Ce.span,{"data-state":Fe(s.checked),"data-disabled":s.disabled?"":void 0,...o,ref:j})});qe.displayName=ze;var zs="SwitchBubbleInput",Ye=t.forwardRef(({__scopeSwitch:r,control:j,checked:l,bubbles:o=!0,...s},S)=>{const h=t.useRef(null),u=Le(h,S),i=is(l),v=os(j);return t.useEffect(()=>{const T=h.current;if(!T)return;const c=window.HTMLInputElement.prototype,k=Object.getOwnPropertyDescriptor(c,"checked").set;if(i!==l&&k){const O=new Event("click",{bubbles:o});k.call(T,l),T.dispatchEvent(O)}},[i,l,o]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:l,...s,tabIndex:-1,ref:u,style:{...s.style,...v,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Ye.displayName=zs;function Fe(r){return r?"checked":"unchecked"}var Me=_e,qs=qe;const Ie=t.forwardRef(({className:r,...j},l)=>e.jsx(Me,{className:be("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",r),...j,ref:l,children:e.jsx(qs,{className:be("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));Ie.displayName=Me.displayName;function Ys({isOpen:r,onClose:j,onSave:l,semesterName:o,initialData:s}){const[S,h]=t.useState(!0),[u,i]=t.useState(""),[v,T]=t.useState("");t.useEffect(()=>{r&&s?(h(s.isActive),i(s.startDate||""),T(s.endDate||"")):(h(!0),i(""),T(""))},[r,s]);const c=f=>{if(f.preventDefault(),!u||!v){w.error("Please provide both a start and an end date.");return}o&&l(o,S,u,v)};return e.jsx(V,{open:r,onOpenChange:j,children:e.jsxs(K,{children:[e.jsx(J,{children:e.jsx(W,{children:"Set Semester Status & Dates"})}),e.jsxs("form",{onSubmit:c,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Semester"}),e.jsx("p",{className:"font-semibold text-lg",children:o})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[e.jsx(Ie,{id:"semester-status",checked:S,onCheckedChange:h}),e.jsx(E,{htmlFor:"semester-status",children:S?"Active":"Inactive"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"startDate",children:"Start Date"}),e.jsx(C,{id:"startDate",type:"date",value:u,onChange:f=>i(f.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"endDate",children:"End Date"}),e.jsx(C,{id:"endDate",type:"date",value:v,onChange:f=>T(f.target.value),required:!0})]})]}),e.jsxs(X,{className:"pt-4",children:[e.jsx(ae,{asChild:!0,children:e.jsx(y,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(y,{type:"submit",children:"Save Settings"})]})]})]})})}function Fs(){const[r,j]=t.useState([]),[l,o]=t.useState(!0),[s,S]=t.useState(""),[h,u]=t.useState("All Years"),[i,v]=t.useState(null),[T,c]=t.useState(!1),[f,k]=t.useState(null),[O,L]=t.useState(!1),[m,p]=t.useState(0),[z,I]=t.useState(!1),[N,F]=t.useState(!1),[a,x]=t.useState(!1),[d,D]=t.useState(null),[R,G]=t.useState(null),[Y,Oe]=t.useState(null),ie=ls(),de=t.useCallback(async()=>{o(!0);const n=localStorage.getItem("accessToken");if(!n){w.error("Authentication required."),o(!1),ie("/facultyscheduler/user-login");return}try{const g=await H.get("/program",{headers:{Authorization:`Bearer ${n}`}}),q=(Array.isArray(g.data.programs)?g.data.programs:Object.values(g.data.programs||{})).map(A=>({id:A.id,name:A.program_name,abbreviation:A.abbreviation,effectiveYear:`${A.year_from}-${A.year_to}`,semesters:A.semesters?Object.entries(A.semesters).reduce((M,[ne,oe])=>(M[ne]={subjects:(oe.subjects||[]).map(B=>({code:B.subject_code,name:B.des_title,unitsTotal:B.total_units,unitsLec:B.lec_units,unitsLab:B.lab_units,hoursTotal:B.total_hrs,hoursLec:B.total_lec_hrs,hoursLab:B.total_lab_hrs,prerequisite:B.pre_requisite||""})),isActive:oe.isActive??!0,startDate:oe.startDate,endDate:oe.endDate},M),{}):{},subjects:A.subjects||{}}));j(q)}catch(g){H.isAxiosError(g)&&g.response?.status===401?(w.error("Unauthorized. Please log in again."),ie("/facultyscheduler/user-login")):w.error("Failed to fetch programs.")}finally{o(!1)}},[ie]);t.useEffect(()=>{de()},[de]);const De=n=>{j(!!f?_=>_.map(q=>q.id===n.id?n:q):_=>[n,..._]),c(!1)},Re=()=>{k(null),c(!0)},Be=n=>{k(n),c(!0)},$e=n=>{ds.fire({title:"Are you sure?",text:"This program will be moved to the archives.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, archive it!"}).then(async g=>{if(g.isConfirmed){const _=localStorage.getItem("accessToken");if(!_){w.error("Authentication required.");return}try{const q=await H.post(`/delete-program/${n}`,{},{headers:{Authorization:`Bearer ${_}`}});w.success(q.data.message||"Program archived successfully."),j(A=>A.filter(M=>M.id!==n))}catch(q){w.error("Failed to archive program."),console.error("Error deleting program:",q)}}})},Ue=async(n,g,_)=>{i&&(_&&(await de(),p(q=>q+1)),L(!1))},He=(n,g,_)=>{if(!i)return;const q={...i,semesters:{...i.semesters}},A={...q.semesters[n]||{subjects:[],isActive:!0}};_?A.subjects=A.subjects.map(M=>M.code===g.code?g:M):A.subjects=[...A.subjects,g],q.semesters[n]=A,j(r.map(M=>M.id===q.id?q:M)),v(q),F(!1),w.success(`Subject successfully ${_?"updated":"added"}!`)},Ve=(n,g)=>{const _=n.semesters[g];_&&(Oe({name:g,semester:_}),v(n),x(!0))},Ke=(n,g,_,q)=>{if(i){const A={...i},M={...A.semesters};M[n]&&(M[n]={...M[n],isActive:g,startDate:_,endDate:q}),A.semesters=M,j(r.map(ne=>ne.id===A.id?A:ne)),v(A),w.success(`Status for "${n}" has been updated.`)}x(!1)},Je=()=>L(!0),We=n=>{D(n),I(!0)},Xe=n=>{console.log("Deleting:",n)},Ge=n=>{console.log("Renaming to:",n)},Qe=n=>{G({semester:n,subject:null}),F(!0)},Ze=(n,g)=>{G({semester:n,subject:g}),F(!0)},es=(n,g)=>{console.log(`Deleting ${g} from ${n}`)},ss=t.useMemo(()=>{const n=new Set(r.map(g=>g.effectiveYear));return["All Years",...Array.from(n).sort((g,_)=>_.localeCompare(g))]},[r]),je=t.useMemo(()=>r.filter(n=>n.name.toLowerCase().includes(s.toLowerCase())||n.abbreviation.toLowerCase().includes(s.toLowerCase())).filter(n=>h==="All Years"||n.effectiveYear===h),[r,s,h]);return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground tracking-tight",children:"Curriculum Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage academic programs, semesters, and their subjects."})]}),e.jsx("div",{className:"bg-card p-4 md:p-6 rounded-lg shadow-sm border border-border mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-center",children:[e.jsxs("div",{className:"relative w-full md:flex-grow",children:[e.jsx(hs,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:20}),e.jsx(C,{type:"text",placeholder:"Search program...",className:"pl-10 w-full",value:s,onChange:n=>S(n.target.value)})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3 w-full md:w-auto",children:[e.jsxs(Q,{value:h,onValueChange:u,children:[e.jsxs(Z,{className:"w-full sm:w-auto md:w-[180px]",children:[e.jsx(we,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsx(ee,{placeholder:"Filter by A.Y."})]}),e.jsx(se,{children:ss.map(n=>e.jsx(te,{value:n,children:n},n))})]}),e.jsxs(y,{onClick:Re,className:"w-full sm:w-auto",children:[e.jsx(xe,{size:16,className:"mr-2"})," Add Program"]})]})]})}),l?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:3}).map((n,g)=>e.jsx(vs,{},g))}):e.jsx(cs,{children:je.length>0?e.jsx(he.div,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:je.map((n,g)=>e.jsx(bs,{program:n,index:g,onEdit:Be,onDelete:$e,onManage:()=>v(n)},n.id))}):e.jsxs(he.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-20 text-muted-foreground",children:[e.jsx(js,{size:56,className:"mx-auto mb-4"}),e.jsx("h4",{className:"font-semibold text-xl text-foreground",children:"No Programs Found"})]})}),e.jsx(ys,{isOpen:T,onClose:()=>c(!1),onSave:De,initialData:f}),i&&e.jsx(Ss,{isOpen:!!i,onClose:()=>v(null),program:i,onAddSemester:Je,onEditSemester:We,onDeleteSemester:Xe,onAddSubject:Qe,onEditSubject:Ze,onDeleteSubject:es,onSetSemesterStatus:Ve,refreshKey:m}),e.jsx(Cs,{isOpen:O,onClose:()=>L(!1),onSave:Ue,programId:i?i.id:0}),e.jsx(Ts,{isOpen:z,onClose:()=>I(!1),onSave:Ge,initialData:d}),R&&e.jsx(ks,{isOpen:N,onClose:()=>F(!1),onSave:(n,g)=>He(R.semester,n,g),initialData:R.subject,semesterName:R.semester,programId:i?.id??0}),e.jsx(Ys,{isOpen:a,onClose:()=>x(!1),onSave:Ke,semesterName:Y?.name||null,initialData:Y?.semester||null})]})}function st(){return e.jsx("main",{children:e.jsx(Fs,{})})}export{st as default};
