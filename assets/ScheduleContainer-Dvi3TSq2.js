import{c as X,j as e,C as pe,r as c,a as M,t as O,B as K,e as Ye,b as Qe,A as Ge}from"./index-BvE5JYxp.js";import{L as Ke,V as Xe,S as Ae}from"./ViewAssignedSubjectsDialog-Cv-n-xNB.js";import{I as de}from"./input-aQA31dzU.js";import{S as U}from"./skeleton-CSnJGg2W.js";import{D as Je,a as Ze,b as et,c as tt,d as st,e as at,f as rt}from"./dialog-D4SuVaWO.js";import{B as je}from"./badge-oR1Fztys.js";import{L as be}from"./label-CMIDtJvt.js";import{C as lt}from"./chevron-right-DVWl-KaW.js";import{L as Q}from"./loader-circle-Cja-lxfs.js";import{C as te}from"./check-BE3ZFJig.js";import{S as De}from"./search-D7Yw0DjG.js";import{C as nt}from"./circle-check-big-BYgPptjq.js";import{C as ot}from"./calendar-x-2-DpFs_vaM.js";import{C as it}from"./tabs-CNFJN4Zq.js";import"./Combination-Buz4Pr0H.js";import"./card-C7SSzq0A.js";import"./circle-alert-tEC0iAgP.js";import"./calendar-check-BMGlsNIP.js";import"./presentation-BEby6ztp.js";import"./map-pin-DMSizA8K.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=[["path",{d:"M4.2 4.2A2 2 0 0 0 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 1.82-1.18",key:"16swn3"}],["path",{d:"M21 15.5V6a2 2 0 0 0-2-2H9.5",key:"yhw86o"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h7",key:"1wap6i"}],["path",{d:"M21 10h-5.5",key:"quycpq"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],dt=X("calendar-off",ct);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]],ut=X("circle-arrow-down",mt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ht=X("circle-check",xt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],ft=X("info",gt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],$e=X("trending-up",bt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],G=X("triangle-alert",pt);function jt(){return e.jsxs("div",{className:"bg-white rounded-xl overflow-hidden shadow-lg border flex",children:[e.jsx("div",{className:"relative flex-shrink-0 w-1/3 bg-slate-50 flex items-center justify-center p-6",children:e.jsx(U,{className:"w-24 h-24 rounded-full"})}),e.jsxs("div",{className:"flex-grow flex flex-col p-5 w-2/3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{className:"h-6 w-4/5"}),e.jsx(U,{className:"h-4 w-3/5"})]}),e.jsx("div",{className:"flex-grow"}),e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx(U,{className:"h-3 w-1/3"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(U,{className:"h-5 w-20 rounded-full"}),e.jsx(U,{className:"h-5 w-24 rounded-full"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsx(U,{className:"h-9 w-full rounded-md"}),e.jsx(U,{className:"h-9 w-full rounded-md"})]})]})]})}const vt=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Le=t=>{if(!t||!t.includes(":"))return"Invalid Time";const[x,o]=t.split(":");let i=parseInt(x,10);const f=i>=12?"PM":"AM";return i=i%12||12,`${i}:${o} ${f}`};function Nt({schedule:t}){const x=new Date().toLocaleString("en-US",{weekday:"long"});return e.jsx("div",{className:"bg-background p-2 rounded-lg border max-h-64 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-1 lg:grid-cols-1 gap-2",children:vt.map(o=>{const i=t[o],f=i&&i.length>0,h=o===x;return e.jsxs("div",{className:`rounded-md p-3 flex flex-col min-h-[80px] transition-all duration-200 ${h?"bg-primary/10 border-2 border-primary/80":"bg-muted/50 border border-transparent"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:`font-bold text-sm ${h?"text-primary":"text-foreground"}`,children:o}),h&&e.jsx(je,{variant:"default",className:"text-[10px] h-5",children:"TODAY"})]}),f?e.jsx("div",{className:"space-y-1.5 flex-grow",children:i.map((g,d)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-3.5 w-3.5 text-muted-foreground flex-shrink-0"}),e.jsxs("p",{className:"font-mono text-xs text-foreground font-medium",children:[Le(g.start)," - ",Le(g.end)]})]},d))}):e.jsxs("div",{className:"flex flex-col items-center justify-center flex-grow text-center text-slate-400",children:[e.jsx(dt,{className:"h-5 w-5 mb-1"}),e.jsx("p",{className:"text-xs italic",children:"Not available"})]})]},o)})})})}const $=t=>{if(!t)return 0;const[x,o]=t.split(":").map(Number);return(Number.isFinite(x)?x:0)*60+(Number.isFinite(o)?o:0)},yt=t=>{const x=Math.floor(t/60),o=t%60;return`${String(x).padStart(2,"0")}:${String(o).padStart(2,"0")}`},wt=(t,x)=>{if(!t)return"";const o=$(t)+x,i=Math.max(0,Math.min(1439,o));return yt(i)},St=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],me=t=>{if(!t)return"--:--";const[x,o]=t.split(":").map(Number),i=(x??0)>=12?"PM":"AM";return`${(x??0)%12===0?12:(x??0)%12}:${String(o??0).padStart(2,"0")} ${i}`},_t=(t,x,o,i)=>{const f=$(t),h=$(x),g=$(o),d=$(i);return!f||!h||!g||!d?!1:f<d&&h>g},Me=(t,x)=>{if(!t)return!1;try{return t.toString().toLowerCase().includes(x.toString().toLowerCase())}catch{return!1}},Fe=({type:t,hours:x,schedules:o,facultySchedule:i,onScheduleChange:f,timeError:h})=>{const g=c.useMemo(()=>{const d=o[t].day;if(!d||!i[d]?.length)return{min:void 0,max:void 0};const j=i[d],a=j.reduce((y,C)=>C.start<y?C.start:y,j[0].start),L=j.reduce((y,C)=>C.end>y?C.end:y,j[0].end);return{min:a,max:L}},[o[t].day,i,t,o]);return e.jsxs("div",{className:"pt-4 border-t space-y-4",children:[e.jsxs("h4",{className:"font-semibold text-md text-foreground",children:[t==="lec"?"Lecture":"Laboratory"," Schedule (",x," hours)"]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{children:[e.jsx(be,{htmlFor:`${t}-day`,children:"Day of Class"}),e.jsxs("select",{id:`${t}-day`,value:o[t].day,onChange:d=>f(t,"day",d.target.value),className:"w-full mt-1 p-2 border rounded-md bg-background disabled:opacity-50",children:[e.jsx("option",{value:"",disabled:!0,children:"Select a day"}),St.map(d=>e.jsxs("option",{value:d,disabled:!i[d]?.length,children:[d," ",!i[d]?.length&&"(Unavailable)"]},d))]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(be,{htmlFor:`${t}-start-time`,className:"text-xs font-semibold text-muted-foreground",children:"Start Time"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(de,{id:`${t}-start-time`,type:"time",value:o[t].startTime,onChange:d=>f(t,"startTime",d.target.value),className:"pl-9",step:"1800",min:g.min,max:g.max,disabled:!o[t].day})]})]}),e.jsxs("div",{children:[e.jsx(be,{htmlFor:`${t}-end-time`,className:"text-xs font-semibold text-muted-foreground",children:"End Time"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(de,{id:`${t}-end-time`,type:"time",value:o[t].endTime,onChange:d=>f(t,"endTime",d.target.value),className:"pl-9",step:"1800",min:g.min,max:g.max,disabled:!o[t].day})]})]})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:(()=>{const d=j=>{if(!j)return"--:--";const a=j.split(":");return`${a[0]?.padStart(2,"0")}:${a[1]?.padStart(2,"0")}`};return`Window: ${d(g.min)} - ${d(g.max)}`})()}),(x??0)>0&&o[t].startTime&&e.jsxs(K,{type:"button",size:"sm",variant:"outline",onClick:()=>f(t,"endTime",wt(o[t].startTime,(x||0)*60)),children:["Auto-fill end (+",x,"h)"]})]}),h&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-destructive/10 border-destructive/30 rounded-lg text-destructive text-sm",children:[e.jsx(G,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("p",{children:h})]})]})},Ee=({type:t,schedules:x,availableRooms:o,isLoadingRooms:i,selectedRooms:f,onSelectRoom:h})=>{const g=x[t].day||"",d=x[t].startTime||"",j=x[t].endTime||"",a=t==="lec"?"Lecture":"Laboratory",L=c.useMemo(()=>{if(!g||!d||!j)return new Set;const v=o[t].filter(k=>Me(k.type,a)?(k.availabilities||[]).filter(w=>(w.day||"").toString().toLowerCase()===g.toString().toLowerCase()).some(w=>{const B=w.start_time??w.start??"",D=w.end_time??w.end??"";return!B||!D?!1:$(B)<=$(d)&&$(D)>=$(j)}):!1);return new Set(v.map(k=>k.id))},[o,t,g,d,j,a]),y=(o[t]||[]).filter(v=>Me(v.type,a)&&L.has(v.id)),C=!!g&&!!d&&!!j,P=C?`${me(d)} - ${me(j)}`:"--:-- - --:--";return e.jsx("div",{className:"pt-4 border-t space-y-3",children:i[t]?e.jsx("div",{className:"flex items-center justify-center h-24",children:e.jsx(Q,{className:"h-6 w-6 animate-spin text-primary"})}):C?y.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-24 text-center text-destructive bg-destructive/5 border border-destructive/20 rounded-lg p-3",children:[e.jsx(G,{className:"h-5 w-5 mb-1 flex-shrink-0"}),e.jsxs("p",{className:"text-sm font-semibold",children:["ALL ",a.toUpperCase()," ROOMS ARE BUSY"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["No rooms are free for the slot: (",g,", ",P,"). Please change the time or day."]})]}):e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-72 overflow-y-auto pr-2 -mr-2",children:y.map(v=>{const k=L.has(v.id),V=k?"MATCH SCHED":"BUSY",F=k?"bg-green-100 text-green-700":"bg-red-100 text-red-700",w=k?f[t]===v.id?"bg-primary/10 border-primary shadow-sm":"bg-background hover:border-primary/50":"bg-red-50 border-red-300 opacity-70 cursor-not-allowed";return e.jsxs("button",{onClick:()=>k&&h(t,v.id),disabled:!k,className:`p-2 border rounded-md text-left transition-all relative ${w}`,children:[e.jsx("div",{className:`absolute top-0 right-0 p-1 px-2 rounded-tr-md rounded-bl-md text-xs font-semibold ${F}`,children:V}),f[t]===v.id&&k&&e.jsx(te,{className:"h-4 w-4 text-primary absolute top-2 right-2 mt-2"}),e.jsx("p",{className:"font-semibold text-sm pt-2",children:v.roomNumber}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Cap: ",v.capacity??"--"]}),v.type&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-slate-100 text-slate-700 font-medium",children:v.type})]})]},v.id)})})}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Set a full valid day and time schedule to view room status."})})};function kt({isOpen:t,onClose:x,faculty:o,availableSubjects:i=[],onAssign:f}){const[h,g]=c.useState(1),[d,j]=c.useState(""),[a,L]=c.useState(null),[y,C]=c.useState(0),[P,v]=c.useState(!0),[k,V]=c.useState([]),[F,w]=c.useState([]),[B,D]=c.useState(!1),[z,J]=c.useState(null),[b,S]=c.useState({lec:{day:"",startTime:"",endTime:""},lab:{day:"",startTime:"",endTime:""}}),[p,_]=c.useState({lec:null,lab:null}),[E,R]=c.useState({lec:[],lab:[]}),[q,A]=c.useState({lec:!1,lab:!1}),[I,ve]=c.useState({lec:null,lab:null}),[H,Ne]=c.useState({}),[Oe,ue]=c.useState([]),[Be,xe]=c.useState(!0),[he,se]=c.useState(!1),[ae,ge]=c.useState(null),[re,le]=c.useState({}),ye=c.useCallback(()=>{g(1),j(""),L(null),S({lec:{day:"",startTime:"",endTime:""},lab:{day:"",startTime:"",endTime:""}}),_({lec:null,lab:null}),R({lec:[],lab:[]}),ve({lec:null,lab:null}),ge(null),se(!1),le({})},[]);c.useEffect(()=>{if(t){if(j(""),ye(),i&&Array.isArray(i)){const s=i.map(l=>{const n=l.total_lec_hrs??l.lec_units??0,r=l.total_lab_hrs??l.lab_units??0,m=l.total_hrs??n+r;return{...l,total_lec_hrs:n,total_lab_hrs:r,total_hrs:m,total_units:l.total_units??m}});J(s),w(s)}else(async()=>{D(!0);try{const l=localStorage.getItem("accessToken");let n;try{n=await M.get("get-subjects",{headers:l?{Authorization:`Bearer ${l}`}:void 0})}catch{n=await M.get("get-subjects")}const m=(n.data?.subject||n.data?.data||[]).map(u=>{const N=u.total_lec_hrs??u.lec_units??0,T=u.total_lab_hrs??u.lab_units??0,W=u.total_hrs??N+T;return{...u,total_lec_hrs:N,total_lab_hrs:T,total_hrs:W,total_units:u.total_units??W}});J(m),w(m)}catch(l){console.error("Failed to fetch subjects:",l),w([]),J([])}finally{D(!1)}})();if(o){const s=async()=>{v(!0);const r=localStorage.getItem("accessToken");if(!r){v(!1);return}try{const m=await M.get(`/faculties/${o.id}/current-load`,{headers:{Authorization:`Bearer ${r}`}});C(m.data.current_load_units??0),V(m.data.assigned_subject_ids??m.data.assigned_subjects??[])}catch(m){console.error("Error fetching current load:",m),C(0),O.error("Failed to fetch faculty's current load.")}finally{v(!1)}},l=async()=>{xe(!0);const r=localStorage.getItem("accessToken");if(!r){xe(!1);return}try{const m=await M.get(`/faculties/${o.id}/availability`,{headers:{Authorization:`Bearer ${r}`}});Ne(m.data)}catch{Ne({})}finally{xe(!1)}},n=async()=>{const r=localStorage.getItem("accessToken");if(!r){ue([]);return}try{const m=await M.get(`faculty-loading/${o.id}/schedules`,{headers:{Authorization:`Bearer ${r}`}}),u=m.data?.data||m.data||[];ue(Array.isArray(u)?u:[])}catch(m){console.error("Failed to fetch assigned schedules",m),ue([])}};s(),l(),n()}}},[t,o,i,ye]);const{maxNormalLoad:ze,maxOverload:Re,totalAllowedLoad:ne,potentialTotalLoad:fe,isLoadExceeded:Y,isOverloadApplied:we}=c.useMemo(()=>{const s=o.t_load_units??0,l=o.overload_units??0,n=s+l,r=a?.total_hrs??a?.total_units??0,m=y+r,u=n>0&&m>n,N=s>0&&m>s&&!u;return{maxNormalLoad:s,maxOverload:l,totalAllowedLoad:n,potentialTotalLoad:m,isLoadExceeded:u,isOverloadApplied:N}},[o,y,a]),Ue=a?.total_hrs??a?.total_units??0,Se=async()=>{const s=d.trim();if(!s){z&&w(z);return}D(!0);try{const l=localStorage.getItem("accessToken");let n;try{n=await M.get("filter-subjects",{params:{subject:s},headers:l?{Authorization:`Bearer ${l}`}:void 0})}catch{n=await M.get("filter-subjects",{params:{subject:s}})}const m=(n.data?.data||n.data?.subject||[]).map(u=>{const N=u.total_lec_hrs??u.lec_units??0,T=u.total_lab_hrs??u.lab_units??0,W=u.total_hrs??N+T;return{id:u.id,subject_code:u.subject_code,des_title:u.des_title,total_lec_hrs:N,total_lab_hrs:T,total_hrs:W,total_units:u.total_units??W}});w(m)}catch(l){console.error("Subject search failed:",l),O.error("Search failed"),w([])}finally{D(!1)}};c.useEffect(()=>{a&&g(2)},[a]),c.useEffect(()=>{const s=(l,n)=>{const{day:r,startTime:m,endTime:u}=b[l];if(!m||!u||!a||!r||n===0)return null;const N=$(m),T=$(u),W=n*60,He=T-N;if(N>=T)return"End time must be after start time.";if(He>W)return`Duration cannot exceed ${n} hour(s).`;const Ce=H[r];return Ce?.length?Ce.some(Te=>N>=$(Te.start)&&T<=$(Te.end))?null:"Time is outside faculty's availability.":"Faculty is not available on this day."};a&&ve({lec:s("lec",a.total_lec_hrs??0),lab:s("lab",a.total_lab_hrs??0)})},[b,a,H]);const oe=c.useCallback(async s=>{const l=b[s];if(!l.day||!l.startTime||!l.endTime||I[s]){R(r=>({...r,[s]:[]}));return}A(r=>({...r,[s]:!0}));const n=localStorage.getItem("accessToken");if(!n){A(r=>({...r,[s]:!1}));return}try{const m=(await M.get("/rooms/availabilities",{headers:{Authorization:`Bearer ${n}`},params:{day:l.day,start_time:l.startTime,end_time:l.endTime,type:s==="lec"?"Lecture":"Laboratory"}})).data.rooms||[],u=await Promise.all(m.map(async N=>{try{const T=await M.get(`/rooms/${N.id}/availabilities`,{headers:{Authorization:`Bearer ${n}`}});return{...N,availabilities:T.data.availabilities||[]}}catch{return{...N,availabilities:[]}}}));R(N=>({...N,[s]:u}))}catch{O.error(`Failed to fetch available ${s} rooms.`),R(m=>({...m,[s]:[]}))}finally{A(r=>({...r,[s]:!1}))}},[b,I]),Z=c.useMemo(()=>(a?.total_lec_hrs??0)>0?b.lec.day&&b.lec.startTime&&b.lec.endTime&&!I.lec:!0,[b.lec,I.lec,a]),ee=c.useMemo(()=>(a?.total_lab_hrs??0)>0?b.lab.day&&b.lab.startTime&&b.lab.endTime&&!I.lab:!0,[b.lab,I.lab,a]);c.useEffect(()=>{ae==="lec"&&Z&&(a?.total_lec_hrs??0)>0&&oe("lec")},[ae,Z,b.lec,a,oe]),c.useEffect(()=>{ae==="lab"&&ee&&(a?.total_lab_hrs??0)>0&&oe("lab")},[ae,ee,b.lab,a,oe]),c.useEffect(()=>{a||(g(1),ge(null))},[a]);const _e=(s,l,n)=>{S(r=>({...r,[s]:{...r[s],[l]:n}})),_(r=>({...r,[s]:null})),ge(s),le(r=>({...r,general:void 0,[s]:void 0}))},ke=(s,l)=>{_(n=>({...n,[s]:l})),le(n=>({...n,general:void 0,[s]:void 0}))},Pe=c.useMemo(()=>{try{const s=z&&z.length?z:F||[],l=new Set;return(s||[]).forEach(n=>{const r=n.id??n.subject_id??n.subjectId??null;r!=null&&l.add(r)}),l.size}catch{return 0}},[z,F]),Ve=async()=>{if(!a)return;if(Y){O.error(`Assignment blocked: Potential load of ${fe} exceeds maximum allowed load of ${ne} units.`);return}const s=[];if((a.total_lec_hrs??0)>0){const{day:l,startTime:n,endTime:r}=b.lec;if(!l||!n||!r||!p.lec){O.error("Incomplete lecture schedule or room selection.");return}s.push({type:"LEC",day:l,time:`${n}-${r}`,roomId:p.lec})}if((a.total_lab_hrs??0)>0){const{day:l,startTime:n,endTime:r}=b.lab;if(!l||!n||!r||!p.lab){O.error("Incomplete laboratory schedule or room selection.");return}s.push({type:"LAB",day:l,time:`${n}-${r}`,roomId:p.lab})}se(!0);try{for(const l of s){const[n,r]=l.time.split("-");for(const m of Oe){if(!m.day||m.day.toString().toLowerCase()!==l.day.toString().toLowerCase())continue;const u=m.start_time??m.start??"",N=m.end_time??m.end??"";if(_t(n,r,u,N)){const T=`Conflict: Faculty is already assigned a class on ${l.day} from ${me(u)} to ${me(N)}. Assignment failed.`;O.error(T),se(!1);return}}}}catch(l){console.error("Conflict check failed",l)}try{const l=localStorage.getItem("accessToken"),n={facultyId:o.id,subjectId:a.id,schedules:s},r=await M.post("faculty-loading/assign",n,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}});r.data.success&&(O.success(r.data.message||"Subject assigned successfully!"),f(o.id,a.id,s),x())}catch(l){const n=l;console.error("Assignment Error:",n);const r=n?.response?.data?.errors,m=n?.response?.data?.message||"Failed to assign subject. Please check conflicts.",u={};r?(r.LEC&&(u.lec=r.LEC),r.LAB&&(u.lab=r.LAB),!u.lec&&!u.lab&&(u.general=m)):u.general=m,O.error(m),le(u)}finally{se(!1)}},ie=(a?.total_lec_hrs??0)>0?!!p.lec:!0,ce=(a?.total_lab_hrs??0)>0?!!p.lab:!0,We=!a||!Z||!ee||!ie||!ce||he||Y||P,qe=Object.values(H).some(s=>s.length>0);return e.jsx(Je,{open:t,onOpenChange:x,children:e.jsxs(Ze,{className:"max-w-7xl w-[96%] h-[92vh] flex flex-col p-0",children:[e.jsxs(et,{className:"p-6 pb-4 border-b bg-gradient-to-r from-indigo-50 to-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(tt,{className:"text-2xl font-bold tracking-tight",children:"Assign Subject"}),e.jsxs(st,{children:["Assign a subject to ",e.jsx("span",{className:"font-semibold text-foreground",children:o.name}),"."]})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{className:`h-6 px-2 rounded-full flex items-center gap-1 ${a?"bg-green-100 text-green-700":"bg-indigo-100 text-indigo-700"}`,children:[e.jsx("span",{className:"font-semibold",children:"1"}),e.jsx("span",{children:"Select"})]}),e.jsx(lt,{className:"w-4 h-4"}),e.jsxs("div",{className:`h-6 px-2 rounded-full flex items-center gap-1 ${h>=2?ie&&ce?"bg-green-100 text-green-700":"bg-indigo-100 text-indigo-700":"bg-muted text-muted-foreground"}`,children:[e.jsx("span",{className:"font-semibold",children:"2"}),e.jsx("span",{children:"Details"})]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-white border rounded-lg shadow-sm",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Faculty Load Status"}),P?e.jsxs("div",{className:"flex items-center gap-2 text-primary text-sm",children:[e.jsx(Q,{className:"h-4 w-4 animate-spin"})," Fetching Load..."]}):e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs",children:[e.jsxs("p",{className:"font-medium",children:["Teaching Load: ",e.jsxs("span",{className:"text-foreground font-bold",children:[ze," units"]})]}),e.jsxs("p",{className:"font-medium",children:["Overload Max: ",e.jsxs("span",{className:"text-foreground font-bold",children:[Re," units"]})]}),e.jsxs("p",{className:"font-medium",children:["Total Max: ",e.jsxs("span",{className:"text-foreground font-bold",children:[ne," units"]})]}),e.jsxs("p",{className:"font-medium",children:["Total Subjects: ",e.jsx("span",{className:"text-foreground font-bold",children:Pe})]}),e.jsxs("p",{className:"col-span-4 text-sm pt-2 border-t mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Current Assigned:"}),e.jsxs("span",{className:"text-foreground font-bold ml-1",children:[y," units"]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-muted-foreground ml-2",children:["(Current + ",Ue," units)"]}),e.jsxs("span",{className:`font-bold ml-2 ${Y?"text-destructive":we?"text-yellow-700":"text-primary"}`,children:["â†’ Potential Total: ",fe," units"]})]})]})]}),!Y&&we&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 p-2 bg-yellow-100 border-yellow-300 rounded-lg text-yellow-800 text-sm",children:[e.jsx(G,{className:"h-4 w-4 flex-shrink-0"}),e.jsxs("p",{className:"font-medium",children:["Notice: This assignment will use **overload** units. Potential load is ",fe," (within max ",ne,")."]})]}),Y&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 p-2 bg-destructive/10 border-destructive/30 rounded-lg text-destructive text-sm",children:[e.jsx(G,{className:"h-4 w-4 flex-shrink-0"}),e.jsxs("p",{className:"font-medium",children:["Warning: This assignment will exceed the total allowed load of ",ne," units. Assignment is **blocked**."]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 flex-grow overflow-y-auto px-6 py-6 bg-muted/30",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border shadow-sm flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`flex-shrink-0 h-8 w-8 rounded-full flex items-center justify-center font-bold text-lg transition-colors ${a?"bg-green-500 text-white":"bg-primary text-primary-foreground"}`,children:a?e.jsx(te,{className:"h-5 w-5"}):"1"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Select Subject"})]})}),e.jsxs("div",{className:"flex flex-col flex-grow",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(De,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:18}),e.jsx(de,{placeholder:"Search by code or title...",value:d,onChange:s=>j(s.target.value),onKeyDown:s=>s.key==="Enter"&&Se(),className:"pl-10 bg-background"})]}),e.jsx(K,{variant:"default",onClick:Se,disabled:B||!d.trim(),children:B?e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}):"Search"})]}),e.jsx("div",{className:"flex-grow overflow-y-auto space-y-2 -mr-2 pr-2",children:F.length>0?F.map(s=>e.jsxs("button",{onClick:()=>L(s),className:`w-full text-left p-3 rounded-md border transition-all duration-200 relative ${a?.id===s.id?"bg-primary/10 border-primary shadow-sm":"bg-background hover:border-primary/50 hover:bg-primary/5"}`,children:[a?.id===s.id&&e.jsx(nt,{className:"h-5 w-5 text-primary absolute top-3 right-3"}),e.jsx("p",{className:"font-semibold text-foreground pr-6 uppercase",children:s.subject_code}),e.jsx("p",{className:"text-sm text-muted-foreground truncate mb-2 uppercase",children:s.des_title}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsxs("span",{className:"bg-blue-50 text-blue-700 px-2 py-0.5 rounded",children:["Lec: ",s.total_lec_hrs??0]}),e.jsxs("span",{className:"bg-amber-50 text-amber-700 px-2 py-0.5 rounded",children:["Lab: ",s.total_lab_hrs??0]}),e.jsxs("span",{className:"bg-gray-100 text-gray-700 px-2 py-0.5 rounded",children:["Units: ",s.total_hrs??s.total_units??0]})]})]},s.id)):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-muted-foreground rounded-lg bg-background border-2 border-dashed p-4",children:[e.jsx(Q,{className:"h-8 w-8 mb-2"}),e.jsx("p",{className:"text-sm",children:B?"Searching...":d?"No subjects found.":"Enter a subject to search."})]})})]})]}),e.jsxs("div",{className:`bg-white p-4 rounded-xl border shadow-sm flex flex-col transition-all ${h<2&&"opacity-50 pointer-events-none"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:`flex-shrink-0 h-8 w-8 rounded-full flex items-center justify-center font-bold text-lg transition-colors ${h>=2&&Z&&ee?"bg-green-500 text-white":h>=2?"bg-primary text-primary-foreground":"bg-muted-foreground/30 text-muted-foreground"}`,children:h>=2&&Z&&ee?e.jsx(te,{className:"h-5 w-5"}):"2"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Set Schedule"})]}),h>=2&&e.jsx("div",{className:"flex-grow overflow-y-auto -mr-2 pr-2",children:Be?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(Q,{className:"h-8 w-8 animate-spin text-primary"})}):qe?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Nt,{schedule:H}),(a?.total_lec_hrs??0)>0&&e.jsx(Fe,{type:"lec",hours:a?.total_lec_hrs??0,schedules:b,facultySchedule:H,onScheduleChange:_e,timeError:I.lec}),(a?.total_lab_hrs??0)>0&&e.jsx(Fe,{type:"lab",hours:a?.total_lab_hrs??0,schedules:b,facultySchedule:H,onScheduleChange:_e,timeError:I.lab})]}):e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-destructive/10 border-destructive/30 rounded-lg text-destructive",children:[e.jsx(ot,{className:"h-5 w-5 flex-shrink-0"}),e.jsx("p",{className:"text-sm font-medium",children:"No faculty availability found."})]})})]}),e.jsxs("div",{className:`flex flex-col gap-4 h-full ${h<2&&"opacity-50 pointer-events-none"}`,children:[(a?.total_lec_hrs??0)>0&&e.jsxs("div",{className:"bg-white p-4 rounded-xl border shadow-sm flex flex-col flex-1 min-h-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`flex-shrink-0 h-8 w-8 rounded-full flex items-center justify-center font-bold text-lg transition-colors ${h>=3&&ie?"bg-green-500 text-white":h>=3?"bg-primary text-primary-foreground":"bg-muted-foreground/30 text-muted-foreground"}`,children:h>=3&&ie?e.jsx(te,{className:"h-5 w-5"}):"3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Lecture Room"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select room"})]})]}),h>=2&&e.jsxs("div",{className:"flex-grow overflow-y-auto -mr-2 pr-2",children:[re.lec&&e.jsxs("div",{className:"mb-3 flex items-center gap-2 p-2 bg-destructive/10 border-destructive/30 rounded-lg text-destructive text-sm",children:[e.jsx(G,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("p",{className:"font-medium",children:re.lec})]}),e.jsx(Ee,{type:"lec",schedules:b,availableRooms:E,isLoadingRooms:q,selectedRooms:p,onSelectRoom:ke})]})]}),(a?.total_lab_hrs??0)>0&&e.jsxs("div",{className:"bg-white p-4 rounded-xl border shadow-sm flex flex-col flex-1 min-h-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`flex-shrink-0 h-8 w-8 rounded-full flex items-center justify-center font-bold text-lg transition-colors ${h>=3&&ce?"bg-green-500 text-white":h>=3?"bg-primary text-primary-foreground":"bg-muted-foreground/30 text-muted-foreground"}`,children:h>=3&&ce?e.jsx(te,{className:"h-5 w-5"}):"3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Laboratory Room"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select room"})]})]}),h>=2&&e.jsxs("div",{className:"flex-grow overflow-y-auto -mr-2 pr-2",children:[re.lab&&e.jsxs("div",{className:"mb-3 flex items-center gap-2 p-2 bg-destructive/10 border-destructive/30 rounded-lg text-destructive text-sm",children:[e.jsx(G,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("p",{className:"font-medium",children:re.lab})]}),e.jsx(Ee,{type:"lab",schedules:b,availableRooms:E,isLoadingRooms:q,selectedRooms:p,onSelectRoom:ke})]})]}),(a?.total_lec_hrs??0)===0&&(a?.total_lab_hrs??0)===0&&e.jsx("div",{className:"bg-white p-4 rounded-xl border shadow-sm flex flex-col items-center justify-center h-full text-muted-foreground",children:e.jsx("p",{children:"Select a subject to view room options."})})]})]}),e.jsxs(at,{className:"p-6 pt-4 border-t bg-background",children:[e.jsx(rt,{asChild:!0,children:e.jsx(K,{variant:"outline",disabled:he,children:"Cancel"})}),e.jsx(K,{onClick:Ve,disabled:We,children:he?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"})," Assigning..."]}):Y?"Load Exceeded":"Assign Subject"})]})]})})}const Ie=[{bg:"bg-blue-100",text:"text-blue-800"},{bg:"bg-emerald-100",text:"text-emerald-800"},{bg:"bg-amber-100",text:"text-amber-800"},{bg:"bg-rose-100",text:"text-rose-800"},{bg:"bg-indigo-100",text:"text-indigo-800"},{bg:"bg-cyan-100",text:"text-cyan-800"},{bg:"bg-pink-100",text:"text-pink-800"}];function Ct(t){let x=0;const o=(t||"").toLowerCase();for(let f=0;f<o.length;f++)x=(x<<5)-x+o.charCodeAt(f),x|=0;const i=Math.abs(x)%Ie.length;return Ie[i]}function Tt({data:t,onAssignClick:x,onViewSubjectsClick:o}){return t.length?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-2 gap-6",children:t.map(i=>{const f=i.profile_picture?i.profile_picture.startsWith("http")?i.profile_picture:`https://green-deer-882383.hostingersite.com/${i.profile_picture}`:null,d={overloaded:{label:"Overload",icon:$e,text:"text-red-700",bg:"bg-red-50",ring:"ring-1 ring-red-200",dot:"bg-red-500"},ok:{label:"Teaching",icon:ht,text:"text-emerald-700",bg:"bg-emerald-50",ring:"ring-1 ring-emerald-200",dot:"bg-emerald-500"}}["ok"],j=d.icon;return e.jsxs("div",{className:`relative overflow-hidden rounded-2xl border bg-white p-5 shadow-sm transition-all duration-300 hover:shadow-lg hover:-translate-y-0.5 ${d.ring}`,children:[e.jsx("div",{className:"pointer-events-none absolute -right-16 -top-16 h-40 w-40 rounded-full bg-gradient-to-br from-primary/15 to-indigo-100 blur-2xl"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"relative",children:[f?e.jsx("img",{src:f,alt:i.name,className:"h-16 w-16 rounded-full object-cover border-4 border-white shadow-md ring-2 ring-primary/20"}):e.jsx("div",{className:"h-16 w-16 rounded-full bg-gradient-to-br from-indigo-500 to-violet-500 text-white grid place-items-center text-lg font-bold border-4 border-white shadow-md ring-2 ring-primary/20",children:e.jsx(Ye,{className:"w-7 h-7 opacity-90"})}),e.jsx("span",{className:`absolute -bottom-1 -right-1 h-3.5 w-3.5 rounded-full ring-2 ring-white ${d.dot}`})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"truncate text-lg font-bold text-foreground",children:i.name}),e.jsxs("div",{className:`ml-2 inline-flex items-center gap-1.5 rounded-full px-2 py-0.5 text-[11px] font-semibold ${d.bg} ${d.text}`,children:[e.jsx(j,{size:12}),e.jsx("span",{children:d.label})]})]}),e.jsx("div",{className:"mt-1",children:e.jsx(je,{variant:"secondary",className:"text-[10px] px-2 py-0 font-normal text-muted-foreground border-slate-200",children:i.department})}),i.expertise?.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-1.5",children:i.expertise.slice(0,3).map((a,L)=>{const y=Ct(a);return e.jsx(je,{className:`text-[10px] px-2 py-0.5 ${y.bg} hover:${y.bg} ${y.text} border-0`,children:a},`${a}-${L}`)})})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center p-3 rounded-xl bg-blue-50/50 border border-blue-100 text-center",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-blue-600 mb-1",children:[e.jsx(Qe,{size:14}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wide",children:"Teaching"})]}),e.jsxs("div",{className:"mt-1",children:[e.jsx("span",{className:"text-2xl font-bold text-blue-900 leading-none",children:i.t_load_units||0}),e.jsx("span",{className:"block text-[10px] font-medium text-blue-600/70 mt-0.5",children:"Units"})]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center p-3 rounded-xl bg-amber-50/50 border border-amber-100 text-center",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-amber-600 mb-1",children:[e.jsx(ut,{size:14}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wide",children:"Deload"})]}),e.jsxs("div",{className:"mt-1",children:[e.jsx("span",{className:"text-2xl font-bold text-amber-900 leading-none",children:i.deload_units||0}),e.jsx("span",{className:"block text-[10px] font-medium text-amber-600/70 mt-0.5",children:"Units"})]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center p-3 rounded-xl bg-red-50/50 border border-red-100 text-center",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-red-600 mb-1",children:[e.jsx($e,{size:14}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wide",children:"Overload"})]}),e.jsxs("div",{className:"mt-1",children:[e.jsx("span",{className:"text-2xl font-bold text-red-900 leading-none",children:i.overload_units||0}),e.jsx("span",{className:"block text-[10px] font-medium text-red-600/70 mt-0.5",children:"Units"})]})]})]}),e.jsxs("div",{className:"mt-5 flex justify-end gap-2 border-t pt-4",children:[e.jsxs(K,{size:"sm",onClick:()=>x(i),className:"shadow-sm h-8",children:[e.jsx(it,{className:"mr-2 h-3.5 w-3.5"})," Assign"]}),e.jsxs(K,{size:"sm",variant:"outline",onClick:()=>o(i),className:"h-8",children:[e.jsx(Ke,{className:"mr-2 h-3.5 w-3.5"})," View Schedule"]})]})]},i.id)})}):e.jsx("div",{className:"flex items-center justify-center h-48 text-muted-foreground",children:"No faculty found."})}function At(){const[t,x]=c.useState([]),[o,i]=c.useState([]),[f,h]=c.useState([]),[g,d]=c.useState(""),[j,a]=c.useState(!0),[L,y]=c.useState(!1),[C,P]=c.useState(null),[v,k]=c.useState(!1),[V,F]=c.useState(null);c.useEffect(()=>{(async()=>{a(!0);try{const p=localStorage.getItem("accessToken");if(!p){Ae.fire({icon:"warning",title:"Authentication Error",text:"You must be logged in."}),a(!1);return}const _={headers:{Authorization:`Bearer ${p}`}},[E,R]=await Promise.all([M.get("/faculties",_),M.get("/get-subjects",_)]),q=E.data.faculties.map(A=>({id:A.id,name:A.user.name,department:A.department||"No Department",expertise:A.expertises?A.expertises.map(I=>I.list_of_expertise):[],profile_picture:A.profile_picture,t_load_units:A.t_load_units??0,deload_units:A.deload_units??0,overload_units:A.overload_units??0,availability:{},assignedSubjects:[]}));x(q),i(R.data.subject||[])}catch(p){console.error("Error fetching data:",p),Ae.fire({icon:"error",title:"Fetch Error",text:"Failed to retrieve data from the server."})}finally{a(!1)}})()},[]);const w=t.filter(S=>S.name.toLowerCase().includes(g.toLowerCase())||S.expertise.some(p=>p.toLowerCase().includes(g.toLowerCase()))),B=S=>{const p=S.expertise.map(_=>(_||"").toLowerCase().trim()).filter(Boolean).flatMap(_=>_.split(/\s+|[,;/]+/).map(E=>E.trim())).filter(_=>_.length>2);if(!p.length)h([]);else{const _=o.filter(E=>{const R=`${E.des_title??""} ${E.subject_code??""} ${E.pre_requisite??""}`.toLowerCase();return p.some(q=>R.includes(q))});h(_)}P(S),y(!0)},D=()=>{y(!1),P(null),h([])},z=S=>{F(S),k(!0)},J=()=>{k(!1),F(null)},b=(S,p,_)=>{console.log("Assigning Subject:",{facultyId:S,subjectId:p,schedules:_})};return e.jsxs(e.Fragment,{children:[e.jsxs(Ge,{children:[L&&C&&e.jsx(kt,{isOpen:L,onClose:D,faculty:C,availableSubjects:f,onAssign:b}),v&&V&&e.jsx(Xe,{isOpen:v,onClose:J,faculty:V})]}),e.jsxs("header",{className:"mb-8 text-start",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground tracking-tight",children:"Faculty Loading"}),e.jsx("p",{className:"text-muted-foreground mt-3 ",children:"Assign subjects to faculty based on expertise and availability."})]}),e.jsxs("div",{className:"bg-card p-4 md:p-6 rounded-xl shadow-sm border border-border",children:[e.jsx("div",{className:"flex justify-start mb-8",children:e.jsxs("div",{className:"relative w-full md:max-w-lg",children:[e.jsx(De,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-muted-foreground",size:20}),e.jsx(de,{placeholder:"Search by faculty name or expertise...",value:g,onChange:S=>d(S.target.value),className:"pl-12 h-12 rounded-full text-base"})]})}),j?e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:Array.from({length:6}).map((S,p)=>e.jsx(jt,{},p))}):w.length>0?e.jsx(Tt,{data:w,onAssignClick:B,onViewSubjectsClick:z}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center text-muted-foreground bg-muted/50 rounded-lg border-2 border-dashed",children:[e.jsx(ft,{size:40,className:"mb-4 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-foreground",children:"No Faculty Found"}),e.jsxs("p",{children:['Your search for "',g,'" did not match any faculty profiles.']})]})]})]})}function Xt(){return e.jsx("main",{children:e.jsx(At,{})})}export{Xt as default};
