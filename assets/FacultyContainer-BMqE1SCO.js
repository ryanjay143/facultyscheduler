import{c as je,j as e,B as _,r as n,t as x,a as V,X as Se,u as _e}from"./index-jewFnda3.js";import{b as re,e as v,T as Ce,a as Ae,c as R,d as Fe}from"./table-Cff0lIBG.js";import{I as E}from"./input-FCWlxxaT.js";import{S as ne,a as le,b as ie,c as oe,d as Y}from"./select-D4GS9LRo.js";import{B as me}from"./badge-Ci_bdU4p.js";import{P as ke}from"./plus-PL2mRHb3.js";import{S}from"./skeleton-C5hM8rMj.js";import{L as Le,V as Te,S as pe}from"./ViewAssignedSubjectsDialog-DNoq_2Jt.js";import{D as he,a as xe,b as ve,c as be,d as Ie,e as ye,f as Me}from"./dialog-CQlO8c5u.js";import{L as De}from"./loader-circle-CALl4o6w.js";import{C as $e}from"./tabs-DSHIKBhI.js";import{T as we}from"./trash-2-SyYYSCyG.js";import{L as B}from"./label-DxA-s2ol.js";import{S as Ee}from"./search-C2F7uf3w.js";import{F as Pe}from"./funnel-CwtRiCHc.js";import{C as ze}from"./calendar-days-CJdrh_xx.js";import{S as Be}from"./square-pen-BiFImxMp.js";import{C as Ve}from"./chevron-left-Csd809fC.js";import{C as Oe}from"./chevron-right-9ZnRADX_.js";import"./Combination-Dvpv-IvI.js";import"./check-C4K5SOAd.js";import"./card-BlnVAMST.js";import"./circle-alert-C0SYf_FR.js";import"./calendar-check-DpPk0mLw.js";import"./presentation-BuSQCffn.js";import"./map-pin-B1QSt18C.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],He=je("briefcase",qe);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Ge=je("rotate-ccw",Re);function Ze({onAdd:g}){return e.jsxs(_,{onClick:g,className:"w-full sm:w-auto",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Add Faculty"]})}const We=()=>e.jsxs(re,{children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(S,{className:"h-11 w-11 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{className:"h-4 w-40"}),e.jsx(S,{className:"h-3 w-24"})]})]})}),e.jsx(v,{children:e.jsx(S,{className:"h-4 w-48"})}),e.jsx(v,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{className:"h-5 w-20 rounded-full"}),e.jsx(S,{className:"h-5 w-20 rounded-full"})]})}),e.jsx(v,{className:"text-center",children:e.jsx(S,{className:"h-4 w-10 mx-auto"})}),e.jsx(v,{className:"text-center",children:e.jsx(S,{className:"h-4 w-10 mx-auto"})}),e.jsx(v,{className:"text-center",children:e.jsx(S,{className:"h-4 w-10 mx-auto"})}),e.jsx(v,{children:e.jsx(S,{className:"h-6 w-20 rounded-full"})}),e.jsx(v,{children:e.jsxs("div",{className:"flex justify-end items-center gap-1",children:[e.jsx(S,{className:"h-8 w-8 rounded-md"}),e.jsx(S,{className:"h-8 w-8 rounded-md"}),e.jsx(S,{className:"h-8 w-8 rounded-md"}),e.jsx(S,{className:"h-8 w-8 rounded-md"})]})})]}),Ye=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function Je({isOpen:g,onClose:m,faculty:f}){const[h,y]=n.useState({}),[u,j]=n.useState(!0),[k,w]=n.useState(!1);if(n.useEffect(()=>{g&&f&&(async()=>{j(!0);const i=localStorage.getItem("accessToken");if(!i){x.error("Authentication required."),j(!1);return}try{const o=await V.get(`/faculties/${f.id}/availability`,{headers:{Authorization:`Bearer ${i}`}});y(o.data)}catch{x.error("Could not fetch the existing schedule for this faculty."),y({})}finally{j(!1)}})()},[g,f]),!f)return null;const O=l=>{const i={id:Date.now(),start:"",end:""};y(o=>({...o,[l]:[...o[l]||[],i]}))},C=(l,i,o,z)=>{y(M=>{const N=(M[l]||[]).map(D=>D.id===i?{...D,[o]:z}:D);return{...M,[l]:N}})},P=(l,i)=>{y(o=>({...o,[l]:(o[l]||[]).filter(z=>z.id!==i)}))},L=async()=>{for(const i in h)for(const o of h[i]){if(!o.start||!o.end){x.error(`Please complete all time fields for ${i}.`);return}if(o.start>=o.end){x.error(`On ${i}, the end time must be after the start time.`);return}}w(!0);const l=localStorage.getItem("accessToken");if(!l){x.error("Authentication required. Please log in again."),w(!1);return}try{const i=await V.post(`/faculties/${f.id}/availability`,h,{headers:{Authorization:`Bearer ${l}`}});x.success(i.data.message||"Schedule updated successfully."),m()}catch(i){const o=i.response?.data?.message||"An unknown error occurred while saving.";x.error(o)}finally{w(!1)}},J=l=>{l||m()};return e.jsx(he,{open:g,onOpenChange:J,children:e.jsxs(xe,{className:"sm:max-w-2xl max-h-[90vh] flex flex-col",children:[e.jsxs(ve,{children:[e.jsxs(be,{children:["Set Availability for ",f.name]}),e.jsx(Ie,{children:"Add or update time slots for each day the faculty is available to teach."})]}),e.jsx("div",{className:"flex-grow overflow-y-auto pr-4 -mr-4 space-y-6 py-4",children:u?e.jsxs("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:[e.jsx(De,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"ml-4",children:"Loading existing schedule..."})]}):Ye.map(l=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-semibold",children:l}),e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>O(l),children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),"Add time slot"]})]}),h[l]&&h[l].length>0?e.jsx("div",{className:"space-y-2 pl-4 border-l-2",children:h[l].map(i=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{type:"time",value:i.start,onChange:o=>C(l,i.id,"start",o.target.value)}),e.jsx("span",{className:"text-muted-foreground",children:"-"}),e.jsx(E,{type:"time",value:i.end,onChange:o=>C(l,i.id,"end",o.target.value)}),e.jsx(_,{variant:"ghost",size:"icon",onClick:()=>P(l,i.id),title:"Remove slot",children:e.jsx(we,{className:"h-4 w-4 text-destructive"})})]},i.id))}):e.jsx("p",{className:"text-sm text-muted-foreground pl-4",children:"Not available on this day."})]},l))}),e.jsxs(ye,{className:"mt-4 pt-4 border-t",children:[e.jsx(_,{variant:"outline",onClick:m,disabled:k,children:"Cancel"}),e.jsx(_,{onClick:L,disabled:k||u,children:k?"Saving...":"Save Schedule"})]})]})})}const ge=[{bg:"bg-blue-100",text:"text-blue-800"},{bg:"bg-emerald-100",text:"text-emerald-800"},{bg:"bg-amber-100",text:"text-amber-800"},{bg:"bg-rose-100",text:"text-rose-800"},{bg:"bg-indigo-100",text:"text-indigo-800"},{bg:"bg-cyan-100",text:"text-cyan-800"}];function Ke(g){let m=0;for(let f=0;f<g.length;f++)m=(m<<5)-m+g.charCodeAt(f),m|=0;return Math.abs(m)}function Ue({isOpen:g,onClose:m,onSave:f,initialData:h,expertiseOptions:y}){const[u,j]=n.useState({name:"",email:"",designation:"",department:"",expertise:[],status:"Active",avatar:"",profile_picture:"",deload_units:0,teaching_load_units:0,overload_units:0,t_load_units:0}),[k,w]=n.useState(null),[O,C]=n.useState(!1),[P,L]=n.useState(y),[J,l]=n.useState([]),[i,o]=n.useState(!1),[z,M]=n.useState(!1),[N,D]=n.useState(""),[ce,K]=n.useState(!1);n.useEffect(()=>{g&&(async()=>{o(!0);const r=localStorage.getItem("accessToken");if(!r){x.error("Authentication required."),o(!1);return}try{const c=await V.get("/department-program",{headers:{Authorization:`Bearer ${r}`}}),A=Array.isArray(c.data.programs)?c.data.programs:Object.values(c.data.programs||{}),$=[...new Set(A.map(b=>b.program_name))];l($.sort())}catch{x.error("Failed to fetch departments.")}finally{o(!1)}})()},[g]),n.useEffect(()=>{if(h){const s={deload_units:h.deload_units||0,teaching_load_units:h.t_load_units||0,overload_units:h.overload_units||0,t_load_units:h.t_load_units||0};j({...h,...s}),w(h.profile_picture||null),L(y.filter(r=>!h.expertise.includes(r)))}else{const s=`https://avatar.iran.liara.run/public/${Math.floor(Math.random()*100)}`;j({name:"",designation:"",expertise:[],department:"",email:"",status:"Active",avatar:s,profile_picture:"",deload_units:0,teaching_load_units:0,overload_units:0,t_load_units:0}),w(s),L(y)}D(""),K(!1)},[h,g,y]);const G=s=>{const{name:r,value:c}=s.target;let A=c;if(["deload_units","teaching_load_units","overload_units"].includes(r)){let $=Number(c);c===""?A="":A=$<0?0:$}j($=>({...$,[r]:A,...r==="teaching_load_units"?{t_load_units:A===""?0:Number(A)}:{}}))},ee=(s,r)=>{j(c=>({...c,[s]:r}))},Z=s=>{const r=s.target.files?.[0];r&&w(URL.createObjectURL(r))},U=s=>{D(s.target.value)},W=s=>{const r=s.trim();r&&!u.expertise.includes(r)&&(j(c=>({...c,expertise:[...c.expertise,r].sort()})),P.includes(r)&&L(c=>c.filter(A=>A!==r))),D("")},se=s=>{j(r=>({...r,expertise:r.expertise.filter(c=>c!==s)})),y.includes(s)&&!P.includes(s)&&L(r=>[...r,s].sort())},ae=P.filter(s=>s.toLowerCase().includes(N.toLowerCase())).sort(),de=ce&&(N.length>0||P.length>0),ue=async s=>{s.preventDefault(),M(!0);let r;switch(u.designation){case"Dean":r=0;break;case"Program Head":r=1;break;case"Faculty":r=2;break;default:x.error("Invalid designation."),M(!1);return}const c=Number(u.deload_units)||0,A=Number(u.teaching_load_units)||0,$=Number(u.overload_units)||0,b=new FormData;b.append("name",u.name),b.append("email",u.email),b.append("role",String(r)),b.append("designation",u.designation),b.append("department",u.department),b.append("deload_units",String(c)),b.append("t_load_units",String(A)),b.append("overload_units",String($)),u.expertise.forEach(T=>b.append("expertise[]",T));const q=document.getElementById("avatar-file");q?.files?.[0]&&b.append("avatar",q.files[0]);const X=localStorage.getItem("accessToken");if(!X){x.error("Authentication required."),M(!1);return}const te={Authorization:`Bearer ${X}`,"Content-Type":"multipart/form-data"};try{const T=!!h,Q=T?`/faculties/${h.id}`:"/faculties";T&&b.append("_method","PUT");const t=await V.post(Q,b,{headers:te});x.success(t.data.message||"Faculty saved successfully!");const a=t.data.faculty,d={id:a.id,name:a.user?.name||"N/A",email:a.user?.email||"N/A",role:a.user?.role,designation:a.designation||"",department:a.department||"",status:a.status===0?"Active":"Inactive",profile_picture:a.profile_picture?`https://green-deer-882383.hostingersite.com/${a.profile_picture}`:`https://avatar.iran.liara.run/public/boy?username=${(a.user?.name||"").replace(/\s/g,"")}`,expertise:a.expertises?.map(p=>p.list_of_expertise)||[],deload_units:a.deload_units||0,t_load_units:a.t_load_units||0,overload_units:a.overload_units||0};f(d),m()}catch(T){if(V.isAxiosError(T)&&T.response){const Q=T.response.data.errors;if(Q){const t=Object.values(Q)[0][0];x.error(t)}else x.error(T.response.data.message||"An error occurred.")}else x.error("Failed to connect to the server.")}finally{M(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(he,{open:g,onOpenChange:m,children:e.jsxs(xe,{className:"sm:max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ve,{children:e.jsx(be,{className:"text-2xl font-bold text-foreground",children:h?"Edit Faculty":"Add New Faculty"})}),e.jsxs("form",{onSubmit:ue,className:"py-4 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Profile Picture"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("button",{type:"button",onClick:()=>k&&C(!0),className:"focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary rounded-full disabled:cursor-not-allowed",disabled:!k,title:"Click to preview image",children:e.jsx("img",{src:k||"https://via.placeholder.com/80",alt:"Profile Preview",className:"w-20 h-20 rounded-full object-cover border-2 border-border cursor-pointer hover:opacity-80 transition-opacity"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(E,{id:"avatar-file",type:"file",accept:"image/png, image/jpeg",onChange:Z,className:"block w-full text-sm text-muted-foreground file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20 cursor-pointer"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"PNG or JPG. Max 2MB."})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"name",children:"Full Name"}),e.jsx(E,{id:"name",name:"name",value:u.name,onChange:G,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"email",children:"Email Address"}),e.jsx(E,{id:"email",name:"email",type:"text",value:u.email,onChange:G,required:!0,pattern:"[a-zA-Z0-9._%+-ñÑ]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}",title:"Please enter a valid email address. The 'ñ' character is allowed."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"designation",children:"Designation"}),e.jsxs(ne,{value:u.designation,onValueChange:s=>ee("designation",s),required:!0,children:[e.jsx(le,{children:e.jsx(ie,{placeholder:"Select a designation"})}),e.jsxs(oe,{children:[e.jsx(Y,{value:"Dean",children:"Dean"}),e.jsx(Y,{value:"Program Head",children:"Program Head"}),e.jsx(Y,{value:"Faculty",children:"Faculty"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"department",children:"Department"}),e.jsxs(ne,{value:u.department,onValueChange:s=>ee("department",s),required:!0,children:[e.jsx(le,{disabled:i,children:e.jsx(ie,{placeholder:i?"Loading...":"Select a department"})}),e.jsx(oe,{children:J.length>0?J.map(s=>e.jsx(Y,{value:s,children:s},s)):e.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:i?"Loading...":"No departments."})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 border-t pt-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"deload_units",children:"Deload Units"}),e.jsx(E,{id:"deload_units",name:"deload_units",type:"number",value:String(u.deload_units),onChange:G,placeholder:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"teaching_load_units",children:"Teaching Load"}),e.jsx(E,{id:"teaching_load_units",name:"teaching_load_units",type:"number",value:String(u.teaching_load_units),onChange:G,placeholder:"e.g. 18"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"overload_units",children:"Overload Units"}),e.jsx(E,{id:"overload_units",name:"overload_units",type:"number",value:String(u.overload_units),onChange:G,placeholder:"0"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"expertise-input",children:"Expertise"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex flex-wrap items-center w-full rounded-md border border-input bg-background text-sm ring-offset-background focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2 min-h-10 p-1.5",children:[u.expertise.map(s=>{const r=Ke(s)%ge.length,c=ge[r];return e.jsxs(me,{className:`font-normal hover:${c.bg} ${c.bg} hover:${c.text} ${c.text} mr-1.5 mb-1.5`,children:[s,e.jsx("button",{type:"button",onClick:()=>se(s),className:"ml-1.5 rounded-full hover:bg-black/10 p-0.5","aria-label":`Remove ${s}`,children:e.jsx(Se,{size:14})})]},s)}),e.jsx(E,{id:"expertise-input",value:N,onChange:U,onKeyDown:s=>{s.key==="Enter"&&N.trim()!==""&&(s.preventDefault(),W(N))},onFocus:()=>K(!0),onBlur:()=>{setTimeout(()=>K(!1),100)},placeholder:u.expertise.length===0?"Type to add or select expertise...":"",className:"border-none focus-visible:ring-0 focus-visible:ring-offset-0 h-8 p-0 flex-1 min-w-[50px] bg-transparent shadow-none",autoComplete:"off"})]}),de&&e.jsxs("div",{className:"absolute z-10 w-full bg-popover border border-input rounded-md shadow-lg mt-1 max-h-48 overflow-y-auto",children:[!u.expertise.map(s=>s.toLowerCase()).includes(N.trim().toLowerCase())&&!P.map(s=>s.toLowerCase()).includes(N.trim().toLowerCase())&&N.trim()!==""&&e.jsxs("div",{className:"px-4 py-2 cursor-pointer bg-primary text-primary-foreground hover:bg-primary/90 text-center border-b font-medium",onClick:()=>W(N),onMouseDown:s=>s.preventDefault(),children:["Add New Expertise: **",N.trim(),"**"]}),ae.length>0?ae.map(s=>e.jsx("div",{className:"px-4 py-2 cursor-pointer hover:bg-accent hover:text-accent-foreground",onClick:()=>W(s),onMouseDown:r=>r.preventDefault(),children:s},s)):N.trim()===""&&e.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"All expertise selected."})]})]})]}),e.jsxs(ye,{className:"mt-8 pt-4 border-t border-border",children:[e.jsx(Me,{asChild:!0,children:e.jsx(_,{type:"button",variant:"outline",disabled:z,children:"Cancel"})}),e.jsx(_,{type:"submit",disabled:z,children:z?"Saving...":h?"Save Changes":"Save Faculty"})]})]})]})}),e.jsx(he,{open:O,onOpenChange:C,children:e.jsx(xe,{className:"sm:max-w-lg p-2 bg-transparent border-none shadow-none",children:e.jsx("img",{src:k||"",alt:"Profile Preview Large",className:"w-full h-auto rounded-lg object-contain max-h-[80vh]"})})})]})}const fe=[{bg:"bg-blue-100",text:"text-blue-800"},{bg:"bg-emerald-100",text:"text-emerald-800"},{bg:"bg-amber-100",text:"text-amber-800"},{bg:"bg-rose-100",text:"text-rose-800"},{bg:"bg-indigo-100",text:"text-indigo-800"},{bg:"bg-cyan-100",text:"text-cyan-800"},{bg:"bg-pink-100",text:"text-pink-800"}],Xe=g=>{let m=0;for(let f=0;f<g.length;f++)m=(m<<5)-m+g.charCodeAt(f),m|=0;return Math.abs(m)};function Qe(){const[g,m]=n.useState([]),[f,h]=n.useState(!0),[y,u]=n.useState(""),[j,k]=n.useState({department:"All",status:"Active"}),[w,O]=n.useState(1),[C]=n.useState(10),[P,L]=n.useState(!1),[J,l]=n.useState(null),[i,o]=n.useState([]),[z,M]=n.useState(!1),[N,D]=n.useState(null),[ce,K]=n.useState(!1),[G,ee]=n.useState(null),[Z,U]=n.useState(null),W=_e(),se=n.useCallback(async()=>{h(!0);const t=localStorage.getItem("accessToken");if(!t){x.error("Authentication required."),h(!1),W("/facultyscheduler/user-login");return}try{const a=await V.get("/faculties",{headers:{Authorization:`Bearer ${t}`}}),d=a.data.faculties||[],p=a.data.inactive_faculties||[],H=F=>({id:F.id,name:F.user?.name||"N/A",email:F.user?.email||"N/A",role:F.user?.role,designation:F.designation||"",department:F.department||"",status:F.status===0?"Active":"Inactive",profile_picture:F.profile_picture?`https://green-deer-882383.hostingersite.com/${F.profile_picture}`:null,expertise:F.expertises?.map(Ne=>Ne.list_of_expertise)||[],deload_units:F.deload_units||0,t_load_units:F.t_load_units||0,overload_units:F.overload_units||0}),I=[...d.map(H),...p.map(H)];m(I)}catch{x.error("Failed to fetch faculty data."),W("/facultyscheduler/user-login")}finally{h(!1)}},[W]);n.useEffect(()=>{(async()=>{const a=localStorage.getItem("accessToken");if(a)try{const d=await V.get("/department-program",{headers:{Authorization:`Bearer ${a}`}}),p=Array.isArray(d.data.programs)?d.data.programs:Object.values(d.data.programs||{}),H=[...new Set(p.map(I=>I.program_name))];o(H.sort())}catch(d){console.error("Failed to fetch departments for filter:",d)}})()},[]),n.useEffect(()=>{se()},[se]);const ae=t=>{if(L(!1),g.some(d=>d.id===t.id))m(d=>d.map(p=>p.id===t.id?t:p)),U(t.id),globalThis.setTimeout(()=>U(null),5e3);else{const d={...t,status:"Active"};m(p=>[d,...p]),O(1),U(d.id),globalThis.setTimeout(()=>U(null),5e3)}},de=t=>{pe.fire({title:"Are you sure?",text:"This faculty will be marked as inactive.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Yes, deactivate it!"}).then(async a=>{if(a.isConfirmed){const d=localStorage.getItem("accessToken");if(!d){x.error("Authentication required.");return}try{const p=await V.delete(`/faculties/${t}`,{headers:{Authorization:`Bearer ${d}`}});x.success(p.data.message||"Faculty deactivated."),m(H=>H.map(I=>I.id===t?{...I,status:"Inactive"}:I))}catch{x.error("Failed to deactivate faculty.")}}})},ue=t=>{pe.fire({title:"Activate this faculty?",text:"This will make the faculty available again.",icon:"info",showCancelButton:!0,confirmButtonColor:"#3085d6",confirmButtonText:"Yes, activate it!"}).then(async a=>{if(a.isConfirmed){const d=localStorage.getItem("accessToken");if(!d){x.error("Authentication required.");return}try{const p=await V.post(`/faculties/${t}/activate`,{},{headers:{Authorization:`Bearer ${d}`}});x.success(p.data.message||"Faculty activated."),m(H=>H.map(I=>I.id===t?{...I,status:"Active"}:I))}catch{x.error("Failed to activate faculty.")}}})},s=()=>{l(null),L(!0)},r=t=>{l(t),L(!0)},c=t=>{D(t),M(!0)},A=()=>{M(!1),D(null)},$=t=>{ee(t),K(!0)},b=()=>{K(!1),ee(null)},q=n.useMemo(()=>g.filter(t=>t.id===Z||j.status==="All"||t.status===j.status).filter(t=>t.id===Z||j.department==="All"||t.department===j.department).filter(t=>{const a=y.toLowerCase();return t.id===Z||(t.name||"").toLowerCase().includes(a)||(t.department||"").toLowerCase().includes(a)||(t.designation||"").toLowerCase().includes(a)||(t.expertise||[]).some(d=>(d||"").toLowerCase().includes(a))}),[g,y,j,Z]),X=n.useMemo(()=>{const t=(w-1)*C;return q.slice(t,t+C)},[q,w,C]),te=Math.ceil(q.length/C),T=["All","Active","Inactive"],Q=["Computer Networks","HCI","Computer Graphics & Vision","Software Engineering","Software Development","Cyber Security","Programming","Mobile App Development","Data Science","Artificial Intelligence","Information Systems","Machine Learning","Robotics"];return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"mb-6 md:mb-8",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground tracking-tight",children:"Faculty Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"A centralized hub to add, edit, and manage all faculty members."})]}),e.jsxs("div",{className:"bg-card p-4 md:p-6 rounded-lg shadow-sm border border-border",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-center mb-6",children:[e.jsxs("div",{className:"relative w-full md:max-w-xs",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:20}),e.jsx(E,{placeholder:"Search faculty...",className:"pl-10 w-full",value:y,onChange:t=>{u(t.target.value),O(1)}})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3 w-full md:w-auto",children:[e.jsxs(ne,{value:j.department,onValueChange:t=>k(a=>({...a,department:t})),children:[e.jsxs(le,{className:"w-full sm:w-auto md:w-[200px]",children:[e.jsx(He,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsx(ie,{placeholder:"All Departments"})]}),e.jsxs(oe,{children:[e.jsx(Y,{value:"All",children:"All Departments"}),i.map(t=>e.jsx(Y,{value:t,children:t},t))]})]}),e.jsxs(ne,{value:j.status,onValueChange:t=>k(a=>({...a,status:t})),children:[e.jsxs(le,{className:"w-full sm:w-auto md:w-[180px]",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsx(ie,{placeholder:"All Statuses"})]}),e.jsx(oe,{children:T.map(t=>e.jsx(Y,{value:t,children:t},t))})]}),e.jsx(Ze,{onAdd:s})]})]}),e.jsx("div",{className:"rounded-lg border border-border overflow-x-auto",children:e.jsxs(Ce,{className:"min-w-[1000px]",children:[e.jsx(Ae,{className:"bg-muted/50",children:e.jsxs(re,{children:[e.jsx(R,{className:"w-[300px]",children:"Faculty Member"}),e.jsx(R,{children:"Department"}),e.jsx(R,{children:"Expertise"}),e.jsx(R,{className:"text-center",children:"Teaching Load"}),e.jsx(R,{className:"text-center",children:"Deload"}),e.jsx(R,{className:"text-center",children:"Overload"}),e.jsx(R,{children:"Status"}),e.jsx(R,{className:"text-right w-[170px]",children:"Actions"})]})}),e.jsx(Fe,{children:f?Array.from({length:C}).map((t,a)=>e.jsx(We,{},a)):X.length===0?e.jsx(re,{children:e.jsx(v,{colSpan:8,className:"text-center h-48 text-muted-foreground",children:"No Faculty Found"})}):X.map(t=>e.jsxs(re,{className:`${Z===t.id?"ring-2 ring-yellow-400 bg-yellow-50":""}`,children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:t.profile_picture||`https://avatar.iran.liara.run/public/boy?username=${(t.name||"").replace(/\s/g,"")}`,alt:t.name,className:"w-11 h-11 rounded-full object-cover ring-2 ring-offset-2 ring-border"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground whitespace-nowrap",children:t.name}),e.jsx("p",{className:"text-sm text-muted-foreground whitespace-nowrap",children:t.designation})]})]})}),e.jsx(v,{className:"text-muted-foreground max-w-[200px] truncate",children:t.department}),e.jsx(v,{children:e.jsx("div",{className:"flex flex-wrap items-center gap-1.5 max-w-xs",children:t.expertise.map(a=>{const d=Xe(a)%fe.length,p=fe[d];return e.jsx(me,{className:`font-normal hover:${p.bg} ${p.bg} hover:${p.text} ${p.text}`,children:a},a)})})}),e.jsx(v,{className:"text-center font-medium",children:t.t_load_units}),e.jsx(v,{className:"text-center text-muted-foreground",children:t.deload_units}),e.jsx(v,{className:"text-center text-destructive",children:t.overload_units}),e.jsx(v,{children:e.jsx(me,{variant:t.status==="Active"?"default":"destructive",children:t.status})}),e.jsx(v,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end items-center gap-1",children:[e.jsx(_,{variant:"ghost",size:"icon",title:"View faculty load",onClick:()=>c(t),className:"h-8 w-8 text-muted-foreground hover:text-primary",children:e.jsx(Le,{className:"h-4 w-4 text-purple-500"})}),e.jsx(_,{variant:"ghost",size:"icon",title:"Set Availability",onClick:()=>$(t),className:"h-8 w-8 text-muted-foreground hover:text-primary",children:e.jsx(ze,{className:"h-4 w-4 text-green-500"})}),e.jsx(_,{variant:"ghost",size:"icon",title:"Edit Faculty",onClick:()=>r(t),className:"h-8 w-8 text-muted-foreground hover:text-primary",children:e.jsx(Be,{className:"h-4 w-4 text-blue-500"})}),t.status==="Active"?e.jsx(_,{variant:"ghost",size:"icon",title:"Deactivate Faculty",onClick:()=>de(t.id),className:"h-8 w-8 text-muted-foreground hover:text-destructive",children:e.jsx(we,{className:"h-4 w-4 text-red-500"})}):e.jsx(_,{variant:"ghost",size:"icon",title:"Activate Faculty",onClick:()=>ue(t.id),className:"h-8 w-8 text-muted-foreground hover:text-green-600",children:e.jsx(Ge,{className:"h-4 w-4 text-green-500"})})]})})]},t.id))})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mt-6 text-sm gap-4",children:[e.jsxs("p",{className:"text-muted-foreground",children:["Showing ",e.jsx("strong",{children:X.length>0?(w-1)*C+1:0})," to ",e.jsx("strong",{children:Math.min(w*C,q.length)})," of ",e.jsx("strong",{children:q.length})," entries"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>O(t=>Math.max(1,t-1)),disabled:w===1,children:[e.jsx(Ve,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsxs("span",{className:"font-medium text-foreground px-2",children:["Page ",w," of ",te||1]}),e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>O(t=>Math.min(te,t+1)),disabled:w>=te,children:["Next",e.jsx(Oe,{className:"h-4 w-4 ml-1"})]})]})]})]}),e.jsx(Ue,{isOpen:P,onClose:()=>L(!1),onSave:ae,initialData:J,expertiseOptions:Q}),e.jsx(Te,{isOpen:z,onClose:A,faculty:N}),e.jsx(Je,{isOpen:ce,onClose:b,faculty:G})]})}function Ct(){return e.jsx(Qe,{})}export{Ct as default};
