import{c as se,j as e,r as d,a as F,t as O,B as G,C as Ae,f as Ye,b as He,A as Ge}from"./index-BiZF5-_8.js";import{L as Xe,V as Ke,S as Le}from"./ViewAssignedSubjectsDialog-CBpN_0SW.js";import{I as ue}from"./input-C9DVN1V0.js";import{S as V}from"./skeleton-Dm8kTf-U.js";import{D as Je,a as Ze,b as et,c as tt,d as st,e as at,f as rt}from"./dialog-BxWNuS1V.js";import{L as me}from"./label-CWg0J593.js";import{C as lt}from"./chevron-right-BnYtUPGh.js";import{L as Y}from"./loader-circle-DY2qL71r.js";import{C as te}from"./check-DeQzikYm.js";import{S as Be}from"./search-DVBdozst.js";import{C as nt}from"./circle-check-big-HGwHBsqv.js";import{C as ot}from"./calendar-x-2-CZ87klr-.js";import{B as $e}from"./badge-CXa66bhS.js";import{C as it}from"./tabs-C54ATRBL.js";import"./Combination-D0cHCAeX.js";import"./card-CsOiJvYf.js";import"./circle-alert-D5-j4IWJ.js";import"./calendar-check-Dvnj-nu8.js";import"./presentation-Dg5WROy_.js";import"./map-pin-Djt6tT8F.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]],dt=se("circle-arrow-down",ct);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ut=se("circle-check",mt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],ht=se("info",xt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],De=se("trending-up",gt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],H=se("triangle-alert",ft);function bt(){return e.jsxs("div",{className:"bg-white rounded-xl overflow-hidden shadow-lg border flex",children:[e.jsx("div",{className:"relative flex-shrink-0 w-1/3 bg-slate-50 flex items-center justify-center p-6",children:e.jsx(V,{className:"w-24 h-24 rounded-full"})}),e.jsxs("div",{className:"flex-grow flex flex-col p-5 w-2/3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"h-6 w-4/5"}),e.jsx(V,{className:"h-4 w-3/5"})]}),e.jsx("div",{className:"flex-grow"}),e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx(V,{className:"h-3 w-1/3"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(V,{className:"h-5 w-20 rounded-full"}),e.jsx(V,{className:"h-5 w-24 rounded-full"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsx(V,{className:"h-9 w-full rounded-md"}),e.jsx(V,{className:"h-9 w-full rounded-md"})]})]})]})}const D=a=>{if(!a)return 0;const[u,i]=a.split(":").map(Number);return(Number.isFinite(u)?u:0)*60+(Number.isFinite(i)?i:0)},pt=a=>{const u=Math.floor(a/60),i=a%60;return`${String(u).padStart(2,"0")}:${String(i).padStart(2,"0")}`},jt=(a,u)=>{if(!a)return"";const i=D(a)+u,m=Math.max(0,Math.min(1439,i));return pt(m)},vt=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],xe=a=>{if(!a)return"--:--";const[u,i]=a.split(":").map(Number),m=(u??0)>=12?"PM":"AM";return`${(u??0)%12===0?12:(u??0)%12}:${String(i??0).padStart(2,"0")} ${m}`},Nt=(a,u,i,m)=>{const b=D(a),h=D(u),N=D(i),x=D(m);return!b||!h||!N||!x?!1:b<x&&h>N},Fe=(a,u)=>{if(!a)return!1;try{return a.toString().toLowerCase().includes(u.toString().toLowerCase())}catch{return!1}},Me=({type:a,hours:u,schedules:i,facultySchedule:m,onScheduleChange:b,onTogglePairedDay:h,timeError:N})=>{const x=d.useMemo(()=>{const t=i[a].day;if(!t||!m[t]?.length)return{min:void 0,max:void 0};const y=m[t],p=y.reduce((C,g)=>g.start<C?g.start:C,y[0].start),L=y.reduce((C,g)=>g.end>C?g.end:C,y[0].end);return{min:p,max:L}},[i[a].day,m,a,i]),_=i[a].day;return e.jsxs("div",{className:"pt-4 border-t space-y-4",children:[e.jsxs("h4",{className:"font-semibold text-md text-foreground",children:[a==="lec"?"Lecture":"Laboratory"," Schedule (",u," hours)"]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{children:[e.jsx(me,{htmlFor:`${a}-day`,children:"Day of Class"}),e.jsxs("select",{id:`${a}-day`,value:i[a].day,onChange:t=>b(a,"day",t.target.value),className:"w-full mt-1 p-2 border rounded-md bg-background disabled:opacity-50",children:[e.jsx("option",{value:"",disabled:!0,children:"Select a day"}),vt.map(t=>e.jsxs("option",{value:t,disabled:!m[t]?.length,children:[t," ",!m[t]?.length&&"(Unavailable)"]},t))]}),_&&e.jsxs("div",{className:"mt-2",children:[e.jsx(me,{className:"text-sm",children:"Pair With (weekdays)"}),e.jsx("div",{className:"grid grid-cols-6 gap-2 mt-2",children:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"].map(t=>{const y=Array.isArray(i[a].pairedDays)&&i[a].pairedDays.includes(t),p=t===_,L=!m[t]?.length,C=L||p;return e.jsxs("label",{className:"inline-flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:()=>h(a,t),disabled:C,className:"h-4 w-4"}),e.jsx("span",{className:"truncate",children:t.slice(0,3)}),p&&e.jsx("span",{className:"text-[10px] text-primary/70",children:"(Main)"}),L&&!p&&e.jsx("span",{className:"text-[10px] text-destructive/70",children:"(X)"})]},t)})})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(me,{htmlFor:`${a}-start-time`,className:"text-xs font-semibold text-muted-foreground",children:"Start Time"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(Ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ue,{id:`${a}-start-time`,type:"time",value:i[a].startTime,onChange:t=>b(a,"startTime",t.target.value),className:"pl-9",step:"1800",min:x.min,max:x.max,disabled:!i[a].day})]})]}),e.jsxs("div",{children:[e.jsx(me,{htmlFor:`${a}-end-time`,className:"text-xs font-semibold text-muted-foreground",children:"End Time"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(Ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ue,{id:`${a}-end-time`,type:"time",value:i[a].endTime,onChange:t=>b(a,"endTime",t.target.value),className:"pl-9",step:"1800",min:x.min,max:x.max,disabled:!i[a].day})]})]})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:(()=>{const t=y=>{if(!y)return"--:--";const p=y.split(":");return`${p[0]?.padStart(2,"0")}:${p[1]?.padStart(2,"0")}`};return`Window: ${t(x.min)} - ${t(x.max)}`})()}),(u??0)>0&&i[a].startTime&&e.jsxs(G,{type:"button",size:"sm",variant:"outline",onClick:()=>b(a,"endTime",jt(i[a].startTime,(u||0)*60)),children:["Auto-fill end (+",u,"h)"]})]}),N&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-destructive/10 border-destructive/30 rounded-lg text-destructive text-sm",children:[e.jsx(H,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("p",{children:N})]})]})},Ee=({type:a,schedules:u,availableRooms:i,isLoadingRooms:m,selectedRooms:b,onSelectRoom:h})=>{const N=u[a].day||"",x=u[a].startTime||"",_=u[a].endTime||"",t=a==="lec"?"Lecture":"Laboratory",y=d.useMemo(()=>{if(!N||!x||!_)return new Set;const g=i[a].filter(T=>Fe(T.type,t)?(T.availabilities||[]).filter(w=>(w.day||"").toString().toLowerCase()===N.toString().toLowerCase()).some(w=>{const R=w.start_time??w.start??"",z=w.end_time??w.end??"";return!R||!z?!1:D(R)<=D(x)&&D(z)>=D(_)}):!1);return new Set(g.map(T=>T.id))},[i,a,N,x,_,t]),p=(i[a]||[]).filter(g=>Fe(g.type,t)&&y.has(g.id)),L=!!N&&!!x&&!!_,C=L?`${xe(x)} - ${xe(_)}`:"--:-- - --:--";return e.jsx("div",{className:"pt-4 border-t space-y-3",children:m[a]?e.jsx("div",{className:"flex items-center justify-center h-24",children:e.jsx(Y,{className:"h-6 w-6 animate-spin text-primary"})}):L?p.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-24 text-center text-destructive bg-destructive/5 border border-destructive/20 rounded-lg p-3",children:[e.jsx(H,{className:"h-5 w-5 mb-1 flex-shrink-0"}),e.jsxs("p",{className:"text-sm font-semibold",children:["ALL ",t.toUpperCase()," ROOMS ARE BUSY"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["No rooms are free for the slot: (",N,", ",C,"). Please change the time or day."]})]}):e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-72 overflow-y-auto pr-2 -mr-2",children:p.map(g=>{const T=y.has(g.id),W=T?"MATCH SCHED":"BUSY",M=T?"bg-green-100 text-green-700":"bg-red-100 text-red-700",w=T?b[a]===g.id?"bg-primary/10 border-primary shadow-sm":"bg-background hover:border-primary/50":"bg-red-50 border-red-300 opacity-70 cursor-not-allowed";return e.jsxs("button",{onClick:()=>T&&h(a,g.id),disabled:!T,className:`p-2 border rounded-md text-left transition-all relative ${w}`,children:[e.jsx("div",{className:`absolute top-0 right-0 p-1 px-2 rounded-tr-md rounded-bl-md text-xs font-semibold ${M}`,children:W}),b[a]===g.id&&T&&e.jsx(te,{className:"h-4 w-4 text-primary absolute top-2 right-2 mt-2"}),e.jsx("p",{className:"font-semibold text-sm pt-2",children:g.roomNumber}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Cap: ",g.capacity??"--"]}),g.type&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-slate-100 text-slate-700 font-medium",children:g.type})]})]},g.id)})})}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Set a full valid day and time schedule to view room status."})})};function yt({isOpen:a,onClose:u,faculty:i,availableSubjects:m=[],onAssign:b}){const[h,N]=d.useState(1),[x,_]=d.useState(""),[t,y]=d.useState(null),[p,L]=d.useState(0),[C,g]=d.useState(!0),[T,W]=d.useState([]),[M,w]=d.useState([]),[R,z]=d.useState(!1),[P,X]=d.useState(null),[j,S]=d.useState({lec:{day:"",startTime:"",endTime:"",pairedDays:[]},lab:{day:"",startTime:"",endTime:"",pairedDays:[]}}),[v,k]=d.useState({lec:null,lab:null}),[E,U]=d.useState({lec:[],lab:[]}),[q,$]=d.useState({lec:!1,lab:!1}),[I,je]=d.useState({lec:null,lab:null}),[K,ve]=d.useState({}),[ze,he]=d.useState([]),[Oe,ge]=d.useState(!0),[fe,ae]=d.useState(!1),[re,le]=d.useState(null),[ne,J]=d.useState({}),Ne=d.useCallback(()=>{N(1),_(""),y(null),S({lec:{day:"",startTime:"",endTime:"",pairedDays:[]},lab:{day:"",startTime:"",endTime:"",pairedDays:[]}}),k({lec:null,lab:null}),U({lec:[],lab:[]}),je({lec:null,lab:null}),le(null),ae(!1),J({})},[]);d.useEffect(()=>{if(a){if(_(""),Ne(),m&&Array.isArray(m)){const s=m.map(n=>{const r=n.total_lec_hrs??n.lec_units??0,l=n.total_lab_hrs??n.lab_units??0,o=n.total_hrs??r+l;return{...n,total_lec_hrs:r,total_lab_hrs:l,total_hrs:o,total_units:n.total_units??o}});X(s),w(s)}else(async()=>{z(!0);try{const n=localStorage.getItem("accessToken");let r;try{r=await F.get("get-subjects",{headers:n?{Authorization:`Bearer ${n}`}:void 0})}catch{r=await F.get("get-subjects")}const o=(r.data?.subject||r.data?.data||[]).map(c=>{const f=c.total_lec_hrs??c.lec_units??0,A=c.total_lab_hrs??c.lab_units??0,B=c.total_hrs??f+A;return{...c,total_lec_hrs:f,total_lab_hrs:A,total_hrs:B,total_units:c.total_units??B}});X(o),w(o)}catch(n){console.error("Failed to fetch subjects:",n),w([]),X([])}finally{z(!1)}})();if(i){const s=async()=>{g(!0);const l=localStorage.getItem("accessToken");if(!l){g(!1);return}try{const o=await F.get(`/faculties/${i.id}/current-load`,{headers:{Authorization:`Bearer ${l}`}});L(o.data.current_load_units??0),W(o.data.assigned_subject_ids??o.data.assigned_subjects??[])}catch(o){console.error("Error fetching current load:",o),L(0),O.error("Failed to fetch faculty's current load.")}finally{g(!1)}},n=async()=>{ge(!0);const l=localStorage.getItem("accessToken");if(!l){ge(!1);return}try{const o=await F.get(`/faculties/${i.id}/availability`,{headers:{Authorization:`Bearer ${l}`}});ve(o.data)}catch{ve({})}finally{ge(!1)}},r=async()=>{const l=localStorage.getItem("accessToken");if(!l){he([]);return}try{const o=await F.get(`faculty-loading/${i.id}/schedules`,{headers:{Authorization:`Bearer ${l}`}}),c=o.data?.data||o.data||[];he(Array.isArray(c)?c:[])}catch(o){console.error("Failed to fetch assigned schedules",o),he([])}};s(),n(),r()}}},[a,i,m,Ne]);const{maxNormalLoad:Re,maxOverload:Pe,totalAllowedLoad:oe,potentialTotalLoad:be,isLoadExceeded:Q,isOverloadApplied:ye}=d.useMemo(()=>{const s=i.t_load_units??0,n=i.overload_units??0,r=s+n,l=t?.total_hrs??t?.total_units??0,o=p+l,c=r>0&&o>r,f=s>0&&o>s&&!c;return{maxNormalLoad:s,maxOverload:n,totalAllowedLoad:r,potentialTotalLoad:o,isLoadExceeded:c,isOverloadApplied:f}},[i,p,t]),Ue=t?.total_hrs??t?.total_units??0,we=async()=>{const s=x.trim();if(!s){P&&w(P);return}z(!0);try{const n=localStorage.getItem("accessToken");let r;try{r=await F.get("filter-subjects",{params:{subject:s},headers:n?{Authorization:`Bearer ${n}`}:void 0})}catch{r=await F.get("filter-subjects",{params:{subject:s}})}const o=(r.data?.data||r.data?.subject||[]).map(c=>{const f=c.total_lec_hrs??c.lec_units??0,A=c.total_lab_hrs??c.lab_units??0,B=c.total_hrs??f+A;return{id:c.id,subject_code:c.subject_code,des_title:c.des_title,total_lec_hrs:f,total_lab_hrs:A,total_hrs:B,total_units:c.total_units??B}});w(o)}catch(n){console.error("Subject search failed:",n),O.error("Search failed"),w([])}finally{z(!1)}};d.useEffect(()=>{t&&N(2)},[t]),d.useEffect(()=>{const s=(n,r)=>{const{day:l,startTime:o,endTime:c}=j[n];if(!o||!c||!t||!l||r===0)return null;const f=D(o),A=D(c),B=r*60,pe=A-f;if(f>=A)return"End time must be after start time.";if(pe>B)return`Duration cannot exceed ${r} hour(s).`;const Ce=K[l];return Ce?.length?Ce.some(Te=>f>=D(Te.start)&&A<=D(Te.end))?null:"Time is outside faculty's availability.":"Faculty is not available on this day."};t&&je({lec:s("lec",t.total_lec_hrs??0),lab:s("lab",t.total_lab_hrs??0)})},[j,t,K]);const ie=d.useCallback(async s=>{const n=j[s];if(!n.day||!n.startTime||!n.endTime||I[s]){U(l=>({...l,[s]:[]}));return}$(l=>({...l,[s]:!0}));const r=localStorage.getItem("accessToken");if(!r){$(l=>({...l,[s]:!1}));return}try{const o=(await F.get("/rooms/availabilities",{headers:{Authorization:`Bearer ${r}`},params:{day:n.day,start_time:n.startTime,end_time:n.endTime,type:s==="lec"?"Lecture":"Laboratory"}})).data.rooms||[],c=await Promise.all(o.map(async f=>{try{const A=await F.get(`/rooms/${f.id}/availabilities`,{headers:{Authorization:`Bearer ${r}`}});return{...f,availabilities:A.data.availabilities||[]}}catch{return{...f,availabilities:[]}}}));U(f=>({...f,[s]:c}))}catch{O.error(`Failed to fetch available ${s} rooms.`),U(o=>({...o,[s]:[]}))}finally{$(l=>({...l,[s]:!1}))}},[j,I]),Z=d.useMemo(()=>(t?.total_lec_hrs??0)>0?j.lec.day&&j.lec.startTime&&j.lec.endTime&&!I.lec:!0,[j.lec,I.lec,t]),ee=d.useMemo(()=>(t?.total_lab_hrs??0)>0?j.lab.day&&j.lab.startTime&&j.lab.endTime&&!I.lab:!0,[j.lab,I.lab,t]);d.useEffect(()=>{re==="lec"&&Z&&(t?.total_lec_hrs??0)>0&&ie("lec")},[re,Z,j.lec,t,ie]),d.useEffect(()=>{re==="lab"&&ee&&(t?.total_lab_hrs??0)>0&&ie("lab")},[re,ee,j.lab,t,ie]),d.useEffect(()=>{t||(N(1),le(null))},[t]);const Se=(s,n,r)=>{S(l=>({...l,[s]:{...l[s],[n]:r}})),k(l=>({...l,[s]:null})),le(s),J(l=>({...l,general:void 0,[s]:void 0}))},_e=(s,n)=>{k(r=>({...r,[s]:n})),J(r=>({...r,general:void 0,[s]:void 0}))},ke=(s,n)=>{S(r=>{const l=r[s].pairedDays??[],o=l.includes(n)?l.filter(c=>c!==n):[...l,n];return{...r,[s]:{...r[s],pairedDays:o}}}),le(s),J(r=>({...r,general:void 0,[s]:void 0}))},Ve=d.useMemo(()=>{try{const s=P&&P.length?P:M||[],n=new Set;return(s||[]).forEach(r=>{const l=r.id??r.subject_id??r.subjectId??null;l!=null&&n.add(l)}),n.size}catch{return 0}},[P,M]),We=async()=>{if(!t)return;if(Q){O.error(`Assignment blocked: Potential load of ${be} exceeds maximum allowed load of ${oe} units.`);return}const s=[];if((t.total_lec_hrs??0)>0){const{day:n,startTime:r,endTime:l,pairedDays:o}=j.lec;if(!n||!r||!l||!v.lec){O.error("Incomplete lecture schedule or room selection.");return}s.push({type:"LEC",day:n,time:`${r}-${l}`,roomId:v.lec,pairedDays:o})}if((t.total_lab_hrs??0)>0){const{day:n,startTime:r,endTime:l,pairedDays:o}=j.lab;if(!n||!r||!l||!v.lab){O.error("Incomplete laboratory schedule or room selection.");return}s.push({type:"LAB",day:n,time:`${r}-${l}`,roomId:v.lab,pairedDays:o})}ae(!0);try{for(const n of s){const[r,l]=n.time.split("-"),o=[n.day,...n.pairedDays||[]];for(const c of o)for(const f of ze){if(!f.day||f.day.toString().toLowerCase()!==c.toString().toLowerCase())continue;const A=f.start_time??f.start??"",B=f.end_time??f.end??"";if(Nt(r,l,A,B)){const pe=`Conflict: Faculty is already assigned a class on ${c} from ${xe(A)} to ${xe(B)}. Assignment failed.`;O.error(pe),ae(!1);return}}}}catch(n){console.error("Conflict check failed",n)}try{const n=localStorage.getItem("accessToken"),r={facultyId:i.id,subjectId:t.id,schedules:s},l=await F.post("faculty-loading/assign",r,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});l.data.success&&(O.success(l.data.message||"Subject assigned successfully!"),b(i.id,t.id,s.map(o=>({type:o.type,day:o.day,time:o.time,roomId:o.roomId}))),u())}catch(n){const r=n;console.error("Assignment Error:",r);const l=r?.response?.data?.errors,o=r?.response?.data?.message||"Failed to assign subject. Please check conflicts.",c={};l?(l.LEC&&(c.lec=l.LEC),l.LAB&&(c.lab=l.LAB),!c.lec&&!c.lab&&(c.general=o)):c.general=o,O.error(o),J(c)}finally{ae(!1)}},ce=(t?.total_lec_hrs??0)>0?!!v.lec:!0,de=(t?.total_lab_hrs??0)>0?!!v.lab:!0,qe=!t||!Z||!ee||!ce||!de||fe||Q||C,Qe=Object.values(K).some(s=>s.length>0);return e.jsx(Je,{open:a,onOpenChange:u,children:e.jsxs(Ze,{className:"max-w-7xl w-[96%] h-[92vh] flex flex-col p-0",children:[e.jsxs(et,{className:"p-6 pb-4 border-b bg-gradient-to-r from-indigo-50 to-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(tt,{className:"text-2xl font-bold tracking-tight",children:"Assign Subject"}),e.jsxs(st,{children:["Assign a subject to ",e.jsx("span",{className:"font-semibold text-foreground",children:i.name}),"."]})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{className:`h-6 px-2 rounded-full flex items-center gap-1 ${t?"bg-green-100 text-green-700":"bg-indigo-100 text-indigo-700"}`,children:[e.jsx("span",{className:"font-semibold",children:"1"}),e.jsx("span",{children:"Select"})]}),e.jsx(lt,{className:"w-4 h-4"}),e.jsxs("div",{className:`h-6 px-2 rounded-full flex items-center gap-1 ${h>=2?ce&&de?"bg-green-100 text-green-700":"bg-indigo-100 text-indigo-700":"bg-muted text-muted-foreground"}`,children:[e.jsx("span",{className:"font-semibold",children:"2"}),e.jsx("span",{children:"Details"})]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-white border rounded-lg shadow-sm",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Faculty Load Status"}),C?e.jsxs("div",{className:"flex items-center gap-2 text-primary text-sm",children:[e.jsx(Y,{className:"h-4 w-4 animate-spin"})," Fetching Load..."]}):e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs",children:[e.jsxs("p",{className:"font-medium",children:["Teaching Load: ",e.jsxs("span",{className:"text-foreground font-bold",children:[Re," units"]})]}),e.jsxs("p",{className:"font-medium",children:["Overload Max: ",e.jsxs("span",{className:"text-foreground font-bold",children:[Pe," units"]})]}),e.jsxs("p",{className:"font-medium",children:["Total Max: ",e.jsxs("span",{className:"text-foreground font-bold",children:[oe," units"]})]}),e.jsxs("p",{className:"font-medium",children:["Total Subjects: ",e.jsx("span",{className:"text-foreground font-bold",children:Ve})]}),e.jsxs("p",{className:"col-span-4 text-sm pt-2 border-t mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Current Assigned:"}),e.jsxs("span",{className:"text-foreground font-bold ml-1",children:[p," units"]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-muted-foreground ml-2",children:["(Current + ",Ue," units)"]}),e.jsxs("span",{className:`font-bold ml-2 ${Q?"text-destructive":ye?"text-yellow-700":"text-primary"}`,children:["â†’ Potential Total: ",be," units"]})]})]})]}),!Q&&ye&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 p-2 bg-yellow-100 border-yellow-300 rounded-lg text-yellow-800 text-sm",children:[e.jsx(H,{className:"h-4 w-4 flex-shrink-0"}),e.jsxs("p",{className:"font-medium",children:["Notice: This assignment will use **overload** units. Potential load is ",be," (within max ",oe,")."]})]}),Q&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 p-2 bg-destructive/10 border-destructive/30 rounded-lg text-destructive text-sm",children:[e.jsx(H,{className:"h-4 w-4 flex-shrink-0"}),e.jsxs("p",{className:"font-medium",children:["Warning: This assignment will exceed the total allowed load of ",oe," units. Assignment is **blocked**."]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 flex-grow overflow-y-auto px-6 py-6 bg-muted/30",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border shadow-sm flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`flex-shrink-0 h-8 w-8 rounded-full flex items-center justify-center font-bold text-lg transition-colors ${t?"bg-green-500 text-white":"bg-primary text-primary-foreground"}`,children:t?e.jsx(te,{className:"h-5 w-5"}):"1"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Select Subject"})]})}),e.jsxs("div",{className:"flex flex-col flex-grow",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(Be,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:18}),e.jsx(ue,{placeholder:"Search by code or title...",value:x,onChange:s=>_(s.target.value),onKeyDown:s=>s.key==="Enter"&&we(),className:"pl-10 bg-background"})]}),e.jsx(G,{variant:"default",onClick:we,disabled:R||!x.trim(),children:R?e.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}):"Search"})]}),e.jsx("div",{className:"flex-grow overflow-y-auto space-y-2 -mr-2 pr-2",children:M.length>0?M.map(s=>e.jsxs("button",{onClick:()=>y(s),className:`w-full text-left p-3 rounded-md border transition-all duration-200 relative ${t?.id===s.id?"bg-primary/10 border-primary shadow-sm":"bg-background hover:border-primary/50 hover:bg-primary/5"}`,children:[t?.id===s.id&&e.jsx(nt,{className:"h-5 w-5 text-primary absolute top-3 right-3"}),e.jsx("p",{className:"font-semibold text-foreground pr-6 uppercase",children:s.subject_code}),e.jsx("p",{className:"text-sm text-muted-foreground truncate mb-2 uppercase",children:s.des_title}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsxs("span",{className:"bg-blue-50 text-blue-700 px-2 py-0.5 rounded",children:["Lec: ",s.total_lec_hrs??0]}),e.jsxs("span",{className:"bg-amber-50 text-amber-700 px-2 py-0.5 rounded",children:["Lab: ",s.total_lab_hrs??0]}),e.jsxs("span",{className:"bg-gray-100 text-gray-700 px-2 py-0.5 rounded",children:["Units: ",s.total_hrs??s.total_units??0]})]})]},s.id)):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-muted-foreground rounded-lg bg-background border-2 border-dashed p-4",children:[e.jsx(Y,{className:"h-8 w-8 mb-2"}),e.jsx("p",{className:"text-sm",children:R?"Searching...":x?"No subjects found.":"Enter a subject to search."})]})})]})]}),e.jsxs("div",{className:`bg-white p-4 rounded-xl border shadow-sm flex flex-col transition-all ${h<2&&"opacity-50 pointer-events-none"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:`flex-shrink-0 h-8 w-8 rounded-full flex items-center justify-center font-bold text-lg transition-colors ${h>=2&&Z&&ee?"bg-green-500 text-white":h>=2?"bg-primary text-primary-foreground":"bg-muted-foreground/30 text-muted-foreground"}`,children:h>=2&&Z&&ee?e.jsx(te,{className:"h-5 w-5"}):"2"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Set Schedule"})]}),h>=2&&e.jsx("div",{className:"flex-grow overflow-y-auto -mr-2 pr-2",children:Oe?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(Y,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsx("div",{className:"space-y-4",children:Qe?e.jsxs("div",{className:"space-y-4 pt-2",children:[(t?.total_lec_hrs??0)>0&&e.jsx(Me,{type:"lec",hours:t?.total_lec_hrs??0,schedules:j,facultySchedule:K,onScheduleChange:Se,onTogglePairedDay:ke,timeError:I.lec}),(t?.total_lab_hrs??0)>0&&e.jsx(Me,{type:"lab",hours:t?.total_lab_hrs??0,schedules:j,facultySchedule:K,onScheduleChange:Se,onTogglePairedDay:ke,timeError:I.lab})]}):e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-destructive/10 border-destructive/30 rounded-lg text-destructive",children:[e.jsx(ot,{className:"h-5 w-5 flex-shrink-0"}),e.jsx("p",{className:"text-sm font-medium",children:"No faculty availability found. Schedules may not be valid."})]})})})]}),e.jsxs("div",{className:`flex flex-col gap-4 h-full ${h<2&&"opacity-50 pointer-events-none"}`,children:[(t?.total_lec_hrs??0)>0&&e.jsxs("div",{className:"bg-white p-4 rounded-xl border shadow-sm flex flex-col flex-1 min-h-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`flex-shrink-0 h-8 w-8 rounded-full flex items-center justify-center font-bold text-lg transition-colors ${h>=3&&ce?"bg-green-500 text-white":h>=3?"bg-primary text-primary-foreground":"bg-muted-foreground/30 text-muted-foreground"}`,children:h>=3&&ce?e.jsx(te,{className:"h-5 w-5"}):"3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Lecture Room"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select room"})]})]}),h>=2&&e.jsxs("div",{className:"flex-grow overflow-y-auto -mr-2 pr-2",children:[ne.lec&&e.jsxs("div",{className:"mb-3 flex items-center gap-2 p-2 bg-destructive/10 border-destructive/30 rounded-lg text-destructive text-sm",children:[e.jsx(H,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("p",{className:"font-medium",children:ne.lec})]}),e.jsx(Ee,{type:"lec",schedules:j,availableRooms:E,isLoadingRooms:q,selectedRooms:v,onSelectRoom:_e})]})]}),(t?.total_lab_hrs??0)>0&&e.jsxs("div",{className:"bg-white p-4 rounded-xl border shadow-sm flex flex-col flex-1 min-h-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`flex-shrink-0 h-8 w-8 rounded-full flex items-center justify-center font-bold text-lg transition-colors ${h>=3&&de?"bg-green-500 text-white":h>=3?"bg-primary text-primary-foreground":"bg-muted-foreground/30 text-muted-foreground"}`,children:h>=3&&de?e.jsx(te,{className:"h-5 w-5"}):"3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Laboratory Room"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select room"})]})]}),h>=2&&e.jsxs("div",{className:"flex-grow overflow-y-auto -mr-2 pr-2",children:[ne.lab&&e.jsxs("div",{className:"mb-3 flex items-center gap-2 p-2 bg-destructive/10 border-destructive/30 rounded-lg text-destructive text-sm",children:[e.jsx(H,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("p",{className:"font-medium",children:ne.lab})]}),e.jsx(Ee,{type:"lab",schedules:j,availableRooms:E,isLoadingRooms:q,selectedRooms:v,onSelectRoom:_e})]})]}),(t?.total_lec_hrs??0)===0&&(t?.total_lab_hrs??0)===0&&e.jsx("div",{className:"bg-white p-4 rounded-xl border shadow-sm flex flex-col items-center justify-center h-full text-muted-foreground",children:e.jsx("p",{children:"Select a subject to view room options."})})]})]}),e.jsxs(at,{className:"p-6 pt-4 border-t bg-background",children:[e.jsx(rt,{asChild:!0,children:e.jsx(G,{variant:"outline",disabled:fe,children:"Cancel"})}),e.jsx(G,{onClick:We,disabled:qe,children:fe?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"})," Assigning..."]}):Q?"Load Exceeded":"Assign Subject"})]})]})})}const Ie=[{bg:"bg-blue-100",text:"text-blue-800"},{bg:"bg-emerald-100",text:"text-emerald-800"},{bg:"bg-amber-100",text:"text-amber-800"},{bg:"bg-rose-100",text:"text-rose-800"},{bg:"bg-indigo-100",text:"text-indigo-800"},{bg:"bg-cyan-100",text:"text-cyan-800"},{bg:"bg-pink-100",text:"text-pink-800"}];function wt(a){let u=0;const i=(a||"").toLowerCase();for(let b=0;b<i.length;b++)u=(u<<5)-u+i.charCodeAt(b),u|=0;const m=Math.abs(u)%Ie.length;return Ie[m]}function St({data:a,onAssignClick:u,onViewSubjectsClick:i}){return a.length?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-2 gap-6",children:a.map(m=>{const b=m.profile_picture?m.profile_picture.startsWith("http")?m.profile_picture:`https://green-deer-882383.hostingersite.com/${m.profile_picture}`:null,x={overloaded:{label:"Overload",icon:De,text:"text-red-700",bg:"bg-red-50",ring:"ring-1 ring-red-200",dot:"bg-red-500"},ok:{label:"Teaching",icon:ut,text:"text-emerald-700",bg:"bg-emerald-50",ring:"ring-1 ring-emerald-200",dot:"bg-emerald-500"}}["ok"],_=x.icon;return e.jsxs("div",{className:`relative overflow-hidden rounded-2xl border bg-white p-5 shadow-sm transition-all duration-300 hover:shadow-lg hover:-translate-y-0.5 ${x.ring}`,children:[e.jsx("div",{className:"pointer-events-none absolute -right-16 -top-16 h-40 w-40 rounded-full bg-gradient-to-br from-primary/15 to-indigo-100 blur-2xl"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"relative",children:[b?e.jsx("img",{src:b,alt:m.name,className:"h-16 w-16 rounded-full object-cover border-4 border-white shadow-md ring-2 ring-primary/20"}):e.jsx("div",{className:"h-16 w-16 rounded-full bg-gradient-to-br from-indigo-500 to-violet-500 text-white grid place-items-center text-lg font-bold border-4 border-white shadow-md ring-2 ring-primary/20",children:e.jsx(Ye,{className:"w-7 h-7 opacity-90"})}),e.jsx("span",{className:`absolute -bottom-1 -right-1 h-3.5 w-3.5 rounded-full ring-2 ring-white ${x.dot}`})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"truncate text-lg font-bold text-foreground",children:m.name}),e.jsxs("div",{className:`ml-2 inline-flex items-center gap-1.5 rounded-full px-2 py-0.5 text-[11px] font-semibold ${x.bg} ${x.text}`,children:[e.jsx(_,{size:12}),e.jsx("span",{children:x.label})]})]}),e.jsx("div",{className:"mt-1",children:e.jsx($e,{variant:"secondary",className:"text-[10px] px-2 py-0 font-normal text-muted-foreground border-slate-200",children:m.department})}),m.expertise?.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-1.5",children:m.expertise.slice(0,3).map((t,y)=>{const p=wt(t);return e.jsx($e,{className:`text-[10px] px-2 py-0.5 ${p.bg} hover:${p.bg} ${p.text} border-0`,children:t},`${t}-${y}`)})})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center p-3 rounded-xl bg-blue-50/50 border border-blue-100 text-center",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-blue-600 mb-1",children:[e.jsx(He,{size:14}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wide",children:"Teaching"})]}),e.jsxs("div",{className:"mt-1",children:[e.jsx("span",{className:"text-2xl font-bold text-blue-900 leading-none",children:m.t_load_units||0}),e.jsx("span",{className:"block text-[10px] font-medium text-blue-600/70 mt-0.5",children:"Units"})]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center p-3 rounded-xl bg-amber-50/50 border border-amber-100 text-center",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-amber-600 mb-1",children:[e.jsx(dt,{size:14}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wide",children:"Deload"})]}),e.jsxs("div",{className:"mt-1",children:[e.jsx("span",{className:"text-2xl font-bold text-amber-900 leading-none",children:m.deload_units||0}),e.jsx("span",{className:"block text-[10px] font-medium text-amber-600/70 mt-0.5",children:"Units"})]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center p-3 rounded-xl bg-red-50/50 border border-red-100 text-center",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-red-600 mb-1",children:[e.jsx(De,{size:14}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wide",children:"Overload"})]}),e.jsxs("div",{className:"mt-1",children:[e.jsx("span",{className:"text-2xl font-bold text-red-900 leading-none",children:m.overload_units||0}),e.jsx("span",{className:"block text-[10px] font-medium text-red-600/70 mt-0.5",children:"Units"})]})]})]}),e.jsxs("div",{className:"mt-5 flex justify-end gap-2 border-t pt-4",children:[e.jsxs(G,{size:"sm",onClick:()=>u(m),className:"shadow-sm h-8",children:[e.jsx(it,{className:"mr-2 h-3.5 w-3.5"})," Assign"]}),e.jsxs(G,{size:"sm",variant:"outline",onClick:()=>i(m),className:"h-8",children:[e.jsx(Xe,{className:"mr-2 h-3.5 w-3.5"})," View Schedule"]})]})]},m.id)})}):e.jsx("div",{className:"flex items-center justify-center h-48 text-muted-foreground",children:"No faculty found."})}function _t(){const[a,u]=d.useState([]),[i,m]=d.useState([]),[b,h]=d.useState([]),[N,x]=d.useState(""),[_,t]=d.useState(!0),[y,p]=d.useState(!1),[L,C]=d.useState(null),[g,T]=d.useState(!1),[W,M]=d.useState(null);d.useEffect(()=>{(async()=>{t(!0);try{const v=localStorage.getItem("accessToken");if(!v){Le.fire({icon:"warning",title:"Authentication Error",text:"You must be logged in."}),t(!1);return}const k={headers:{Authorization:`Bearer ${v}`}},[E,U]=await Promise.all([F.get("/faculties",k),F.get("/get-subjects",k)]),q=E.data.faculties.map($=>({id:$.id,name:$.user.name,department:$.department||"No Department",expertise:$.expertises?$.expertises.map(I=>I.list_of_expertise):[],profile_picture:$.profile_picture,t_load_units:$.t_load_units??0,deload_units:$.deload_units??0,overload_units:$.overload_units??0,availability:{},assignedSubjects:[]}));u(q),m(U.data.subject||[])}catch(v){console.error("Error fetching data:",v),Le.fire({icon:"error",title:"Fetch Error",text:"Failed to retrieve data from the server."})}finally{t(!1)}})()},[]);const w=a.filter(S=>S.name.toLowerCase().includes(N.toLowerCase())||S.expertise.some(v=>v.toLowerCase().includes(N.toLowerCase()))),R=S=>{const v=S.expertise.map(k=>(k||"").toLowerCase().trim()).filter(Boolean).flatMap(k=>k.split(/\s+|[,;/]+/).map(E=>E.trim())).filter(k=>k.length>2);if(!v.length)h([]);else{const k=i.filter(E=>{const U=`${E.des_title??""} ${E.subject_code??""} ${E.pre_requisite??""}`.toLowerCase();return v.some(q=>U.includes(q))});h(k)}C(S),p(!0)},z=()=>{p(!1),C(null),h([])},P=S=>{M(S),T(!0)},X=()=>{T(!1),M(null)},j=(S,v,k)=>{console.log("Assigning Subject:",{facultyId:S,subjectId:v,schedules:k})};return e.jsxs(e.Fragment,{children:[e.jsxs(Ge,{children:[y&&L&&e.jsx(yt,{isOpen:y,onClose:z,faculty:L,availableSubjects:b,onAssign:j}),g&&W&&e.jsx(Ke,{isOpen:g,onClose:X,faculty:W})]}),e.jsxs("header",{className:"mb-8 text-start",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground tracking-tight",children:"Faculty Loading"}),e.jsx("p",{className:"text-muted-foreground mt-3 ",children:"Assign subjects to faculty based on expertise and availability."})]}),e.jsxs("div",{className:"bg-card p-4 md:p-6 rounded-xl shadow-sm border border-border",children:[e.jsx("div",{className:"flex justify-start mb-8",children:e.jsxs("div",{className:"relative w-full md:max-w-lg",children:[e.jsx(Be,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-muted-foreground",size:20}),e.jsx(ue,{placeholder:"Search by faculty name or expertise...",value:N,onChange:S=>x(S.target.value),className:"pl-12 h-12 rounded-full text-base"})]})}),_?e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:Array.from({length:6}).map((S,v)=>e.jsx(bt,{},v))}):w.length>0?e.jsx(St,{data:w,onAssignClick:R,onViewSubjectsClick:P}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center text-muted-foreground bg-muted/50 rounded-lg border-2 border-dashed",children:[e.jsx(ht,{size:40,className:"mb-4 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-foreground",children:"No Faculty Found"}),e.jsxs("p",{children:['Your search for "',N,'" did not match any faculty profiles.']})]})]})]})}function Yt(){return e.jsx("main",{children:e.jsx(_t,{})})}export{Yt as default};
