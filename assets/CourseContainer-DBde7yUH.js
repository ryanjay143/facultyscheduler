import{c as ue,j as e,m as be,b as Oe,f as js,B as P,r as s,t as m,a as $,T as ps,l as ke,n as Pe,o as Ee,p as $e,q as fs,h as bs,P as Me,s as gs,i as Ie,u as vs,A as Ss}from"./index-BOqvhcGh.js";import{I as q}from"./input-Dk6mHJ0T.js";import{S as V,a as K,b as J,c as W,d as R,u as ys}from"./select-xZGCzVsk.js";import{D as G,a as Q,b as Z,c as ee,d as ve,e as se,f as te}from"./dialog-BWiOnvjI.js";import{B as Ns}from"./book-copy-BaitupVQ.js";import{S as ge}from"./square-pen-B60srKnl.js";import{T as Se,P as ye}from"./trash-2-DPRDF33c.js";import{S as X,L as Ne}from"./skeleton-_U1ZTU_Y.js";import{T as Re,a as Be,b as H,c as I,d as Ue,e as N,f as He}from"./table-CX8_Xmrc.js";import{B as ws}from"./badge-Cte671QL.js";import{L as qe}from"./layers-ChsqWpd2.js";import{L as F}from"./label-DzdbUins.js";import{C as Fe}from"./circle-alert-BOqsUroW.js";import{S as Ls}from"./search-CJtxVjuk.js";import"./Combination-BkPjAfnR.js";import"./check-_FMUAeMp.js";import"./chevron-up-BpSCUVdu.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],_s=ue("activity",Cs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h2",key:"tvwodi"}],["path",{d:"M20 8v11a2 2 0 0 1-2 2h-2",key:"1gkqxj"}],["path",{d:"m9 15 3-3 3 3",key:"1pd0qc"}],["path",{d:"M12 12v9",key:"192myk"}]],Ts=ue("archive-restore",As);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],Ps=ue("archive",ks);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]],Is=ue("sliders-horizontal",Es),Ye=["from-purple-600 to-indigo-600","from-blue-500 to-teal-400","from-pink-500 to-rose-500","from-orange-500 to-amber-500","from-green-500 to-lime-500","from-cyan-500 to-sky-500"],qs={hidden:{opacity:0,y:20},visible:l=>({opacity:1,y:0,transition:{delay:l*.05}})};function Fs({program:l,index:w,onEdit:v,onArchive:h,onRestore:d,onManage:o}){const b=l.total_subjects,f=l.total_units,g=()=>e.jsxs(e.Fragment,{children:[e.jsx(P,{size:"icon",variant:"ghost",title:"Edit Program",onClick:y=>{y.stopPropagation(),v(l)},className:"h-8 w-8 bg-black/20 hover:bg-green-500",children:e.jsx(ge,{size:16})}),l.isActive?e.jsx(P,{size:"icon",variant:"ghost",title:"Archive Program",onClick:y=>{y.stopPropagation(),h(l.id)},className:"h-8 w-8 bg-black/20 hover:bg-destructive/80",children:e.jsx(Se,{size:16})}):e.jsx(P,{size:"icon",variant:"ghost",title:"Restore Program",onClick:y=>{y.stopPropagation(),d(l.id)},className:"h-8 w-8 bg-black/20 hover:bg-green-500",children:e.jsx(Ts,{size:16})})]});return e.jsxs(be.div,{variants:qs,custom:w,initial:"hidden",animate:"visible",exit:"hidden",className:"bg-card rounded-xl border border-border shadow-sm overflow-hidden group flex flex-col transition-all duration-300 hover:shadow-md hover:-translate-y-1",children:[e.jsxs("div",{className:`p-5 bg-gradient-to-br text-white relative ${Ye[w%Ye.length]} ${!l.isActive&&"opacity-60"}`,children:[e.jsx("h2",{className:"text-xl font-bold pr-20",children:l.abbreviation}),e.jsx("p",{className:"opacity-80 truncate text-sm pr-20",children:l.name}),!l.isActive&&e.jsx("div",{className:"absolute bottom-2 left-5 px-2.5 py-1 bg-red-600/90 text-white text-[10px] font-bold rounded-full uppercase tracking-wider",children:"Inactive"}),e.jsx("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(g,{})})]}),e.jsxs("div",{className:"p-5 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-4",children:[e.jsx(Oe,{size:15}),e.jsxs("span",{children:["A.Y. ",l.effectiveYear]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center text-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx(Ns,{size:15,className:"text-muted-foreground"}),e.jsx("span",{children:"Total Subjects"})]}),e.jsx("span",{className:"px-2.5 py-0.5 bg-muted text-muted-foreground rounded-full font-semibold",children:b})]}),e.jsxs("div",{className:"flex justify-between items-center text-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx(js,{size:15,className:"text-muted-foreground"}),e.jsx("span",{children:"Total Units"})]}),e.jsx("span",{className:"px-2.5 py-0.5 bg-muted text-muted-foreground rounded-full font-semibold",children:f})]})]})]}),e.jsx(P,{onClick:o,className:"w-full mt-5",variant:"secondary",disabled:!l.isActive,children:"Manage Curriculum"})]})]})}function Ys(){return e.jsxs("div",{className:"bg-card rounded-xl border border-border shadow-sm p-5 space-y-4",children:[e.jsx(X,{className:"h-8 w-1/4"}),e.jsx(X,{className:"h-5 w-3/4"}),e.jsxs("div",{className:"pt-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(X,{className:"h-5 w-1/2"}),e.jsx(X,{className:"h-6 w-10 rounded-full"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(X,{className:"h-5 w-1/2"}),e.jsx(X,{className:"h-6 w-10 rounded-full"})]})]}),e.jsx(X,{className:"h-10 w-full mt-5"})]})}const zs=(l,w)=>{const[v,h]=l.split(", "),[d,o]=w.split(", "),b=parseInt(v),f=parseInt(d);return b!==f?b-f:h?.includes("Summer")?1:o?.includes("Summer")?-1:parseInt(h)-parseInt(o)};function Os({isOpen:l,onClose:w,program:v,onAddSemester:h,onEditSemester:d,onAddSubject:o,onEditSubject:b,onDeleteSubject:f,onSetSemesterStatus:g,refreshKey:y,updatedSubjectData:j,newSemesterData:_,updatedSemesterData:p}){const[T,x]=s.useState({}),[S,u]=s.useState(!1);s.useEffect(()=>{if(!l)return;(async()=>{u(!0);const r=localStorage.getItem("accessToken");if(!r){m.error("Authentication required."),u(!1);return}try{const a=await $.get("/semester-with-subjects",{params:{program_id:v.id},headers:{Authorization:`Bearer ${r}`}}),i=Array.isArray(a.data.semesters)?a.data.semesters:[],k={};i.forEach(E=>{const C=`${E.year_level}, ${E.semester_level}`;k[C]={id:E.id,subjects:(E.subjects||[]).map(Y=>({id:Y.id,code:Y.subject_code,name:Y.des_title,unitsTotal:Y.total_units,unitsLec:Y.lec_units,unitsLab:Y.lab_units,hoursTotal:Y.total_hrs,hoursLec:Y.total_lec_hrs,hoursLab:Y.total_lab_hrs,prerequisite:Y.pre_requisite||"None"})),isActive:E.status===1,startDate:E.start_date,endDate:E.end_date}}),x(k)}catch{m.error("Failed to load semester data.")}finally{u(!1)}})()},[l,v.id,y]),s.useEffect(()=>{if(j){const{semesterName:t,subject:r}=j;x(a=>{const i=JSON.parse(JSON.stringify(a)),k=i[t];if(k){const E=k.subjects.findIndex(C=>C.id===r.id);E!==-1?k.subjects[E]=r:k.subjects.push(r)}return i})}},[j]),s.useEffect(()=>{if(_){const{name:t,semester:r}=_;x(a=>({...a,[t]:r}))}},[_]),s.useEffect(()=>{if(p){const{name:t,semester:r,newName:a}=p;x(i=>{const k={...i},E=k[t];return E?(a&&a!==t?(k[a]={...E,...r},delete k[t]):k[t]={...E,...r},k):i})}},[p]);const n=s.useMemo(()=>Object.entries(T).sort(([t],[r])=>zs(t,r)),[T]);return e.jsx(G,{open:l,onOpenChange:w,children:e.jsxs(Q,{className:"max-w-7xl h-[95vh] flex flex-col p-0",children:[e.jsxs(Z,{className:"p-6 pb-4 bg-muted/50 border-b rounded-t-lg",children:[e.jsxs(ee,{className:"text-2xl md:text-3xl font-bold text-foreground flex items-center gap-3",children:[v.name,e.jsx("span",{className:"text-sm font-semibold text-primary bg-primary/10 px-3 py-1 rounded-full",children:v.abbreviation})]}),e.jsxs(ve,{children:["Academic Year of Effectivity: ",v.effectiveYear]})]}),e.jsx("div",{className:"flex-grow overflow-y-auto px-6 py-4 space-y-8",children:S?e.jsx("div",{className:"space-y-6",children:[1,2].map(t=>e.jsxs("div",{className:"bg-card border rounded-xl p-4 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-muted/60 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-48 bg-muted/30 rounded"})]},t))}):n.length===0?e.jsxs("div",{className:"text-center py-20 text-muted-foreground flex flex-col items-center justify-center h-full",children:[e.jsx(qe,{size:56,className:"mx-auto mb-4"}),e.jsx("h4",{className:"font-semibold text-xl text-foreground",children:"No Semesters Found"}),e.jsx("p",{className:"max-w-md mx-auto mt-2 text-sm",children:"This curriculum is empty."})]}):n.map(([t,r])=>e.jsxs("div",{className:`group/semester border rounded-xl overflow-hidden shadow-sm transition-opacity ${r.isActive?"bg-card":"opacity-70 bg-muted/20"}`,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-muted/30 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"text-lg font-semibold text-foreground",children:t}),e.jsx(ws,{variant:r.isActive?"default":"destructive",children:r.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover/semester:opacity-100 transition-opacity",children:[e.jsx(P,{variant:"ghost",size:"icon",title:"Set Status & Dates",className:"h-8 w-8 text-muted-foreground",onClick:()=>g(t,r),children:e.jsx(Is,{size:16})}),e.jsx(P,{variant:"ghost",size:"icon",title:"Rename Semester",className:"h-8 w-8 text-green-500 hover:text-green-500",onClick:()=>d(r.id,t),children:e.jsx(ge,{size:16})})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Re,{className:"min-w-[1200px]",children:[e.jsxs(Be,{className:"bg-muted/50 sticky top-0 z-10",children:[e.jsxs(H,{children:[e.jsx(I,{rowSpan:2,className:"align-middle text-center border-r",children:"Course Code"}),e.jsx(I,{rowSpan:2,className:"align-middle text-center border-r w-[350px]",children:"Descriptive Title"}),e.jsx(I,{colSpan:3,className:"text-center border-r",children:"Units"}),e.jsx(I,{colSpan:3,className:"text-center border-r",children:"Hours per week"}),e.jsx(I,{rowSpan:2,className:"align-middle text-center border-r",children:"Pre-requisite"}),e.jsx(I,{rowSpan:2,className:"align-middle w-[50px]"})]}),e.jsxs(H,{children:[e.jsx(I,{className:"text-center border-r",children:"Total"}),e.jsx(I,{className:"text-center border-r",children:"Lec"}),e.jsx(I,{className:"text-center border-r",children:"Lab"}),e.jsx(I,{className:"text-center border-r",children:"Total"}),e.jsx(I,{className:"text-center border-r",children:"Lec"}),e.jsx(I,{className:"text-center border-r",children:"Lab"})]})]}),e.jsx(Ue,{children:r.subjects.length>0?r.subjects.map(a=>e.jsxs(H,{children:[e.jsx(N,{className:"w-[150px] font-semibold uppercase text-center",children:a.code}),e.jsx(N,{children:a.name}),e.jsx(N,{className:"text-center font-bold text-primary",children:a.unitsTotal}),e.jsx(N,{className:"text-center",children:a.unitsLec}),e.jsx(N,{className:"text-center",children:a.unitsLab}),e.jsx(N,{className:"text-center font-bold text-primary",children:a.hoursTotal}),e.jsx(N,{className:"text-center",children:a.hoursLec}),e.jsx(N,{className:"text-center",children:a.hoursLab}),e.jsx(N,{className:"w-[150px] text-center",children:a.prerequisite}),e.jsx(N,{className:"text-center",children:e.jsxs("div",{className:"flex justify-end",children:[e.jsx(P,{variant:"ghost",size:"icon",className:"h-8 w-8 text-green-500 hover:text-green-500",onClick:()=>b(t,a),disabled:!r.isActive,children:e.jsx(ge,{size:16})}),e.jsx(P,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>f(t,a.id),disabled:!r.isActive,children:e.jsx(Se,{size:16})})]})})]},a.id||a.code)):e.jsx(H,{children:e.jsx(N,{colSpan:10,className:"text-center h-24 text-muted-foreground",children:"No subjects added for this semester."})})}),e.jsx(He,{className:"sticky bottom-0 bg-muted/80 backdrop-blur-sm",children:e.jsxs(H,{children:[e.jsx(N,{colSpan:2,className:"text-right font-bold text-lg",children:"SEMESTER TOTALS"}),e.jsx(N,{className:"text-center font-bold text-lg text-primary",children:r.subjects.reduce((a,i)=>a+(Number(i.unitsTotal)||0),0)}),e.jsx(N,{className:"text-center font-semibold",children:r.subjects.reduce((a,i)=>a+(Number(i.unitsLec)||0),0)}),e.jsx(N,{className:"text-center font-semibold",children:r.subjects.reduce((a,i)=>a+(Number(i.unitsLab)||0),0)}),e.jsx(N,{className:"text-center font-bold text-lg text-primary",children:r.subjects.reduce((a,i)=>a+(Number(i.hoursTotal)||0),0)}),e.jsx(N,{className:"text-center font-semibold",children:r.subjects.reduce((a,i)=>a+(Number(i.hoursLec)||0),0)}),e.jsx(N,{className:"text-center font-semibold",children:r.subjects.reduce((a,i)=>a+(Number(i.hoursLab)||0),0)}),e.jsx(N,{colSpan:2})]})})]})}),e.jsx("div",{className:"p-2 border-t",children:e.jsxs(P,{onClick:()=>o(t,r.id),variant:"link",disabled:!r.isActive,children:[e.jsx(ye,{size:16,className:"mr-1"})," Add Subject"]})})]},t))}),e.jsxs(se,{className:"mt-auto p-6 bg-gray-50 border-t rounded-b-lg flex flex-col md:flex-row md:justify-end gap-2",children:[e.jsx(te,{asChild:!0,children:e.jsx(P,{type:"button",variant:"outline",children:"Cancel"})}),e.jsxs(P,{onClick:h,className:"flex items-center gap-2",children:[e.jsx(qe,{size:16})," Add Year/Semester"]})]})]})})}const $s=()=>{const v=new Date().getFullYear()+5,h=[];for(let d=2015;d<=v;d++)h.push(String(d));return h},ze=$s();function Ms({isOpen:l,onClose:w,onSave:v,initialData:h}){const[d,o]=s.useState(""),[b,f]=s.useState(""),[g,y]=s.useState(""),[j,_]=s.useState(""),[p,T]=s.useState(!1);s.useEffect(()=>{if(h){o(h.name),f(h.abbreviation);const[u="",n=""]=h.effectiveYear.split("-");y(u),_(n)}else{o(""),f("");const u=new Date().getFullYear();y(String(u)),_(String(u+1))}},[h,l]);const x=async u=>{u.preventDefault(),T(!0);const n={program_name:d,abbreviation:b,year_from:g,year_to:j},t=localStorage.getItem("accessToken");if(!t){m.error("Authentication required."),T(!1);return}const r={Authorization:`Bearer ${t}`};try{const a=!!h,i=a?`/edit-program/${h.id}`:"/add-program",E=await $["post"](i,n,{headers:r});m.success(E.data.message||"Program saved successfully!");const C=E.data.program,Y=C.subjects||h?.subjects||{},ne=typeof C.total_subjects=="number"?C.total_subjects:Object.keys(Y).length,de=typeof C.total_units=="number"?C.total_units:h?.total_units??0,le={id:C.id,name:C.program_name,abbreviation:C.abbreviation,effectiveYear:`${C.year_from}-${C.year_to}`,semesters:C.semesters||h?.semesters||{},subjects:Y,total_subjects:ne,total_units:de,isActive:C.isActive??C.is_active??h?.isActive??!0};v(le),w()}catch(a){if($.isAxiosError(a)&&a.response){if(a.response.status===401){m.error("Your session has expired. Please log in again.");return}const i=a.response.data,k=i.errors;if(k&&typeof k=="object"&&Object.keys(k).length>0){const E=Object.keys(k)[0],C=k[E]?.[0];m.error(C||"A validation error occurred.")}else i&&typeof i.message=="string"?m.error(i.message):m.error("An unknown API error occurred.")}else m.error("Failed to connect to the server. Please check your connection."),console.error("Non-Axios error:",a)}finally{T(!1)}},S=u=>{y(u),_(String(Number(u)+1))};return e.jsx(G,{open:l,onOpenChange:w,children:e.jsxs(Q,{children:[e.jsx(Z,{children:e.jsx(ee,{children:h?"Edit Program":"Add New Program"})}),e.jsxs("form",{onSubmit:x,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"progName",children:"Program Name"}),e.jsx(q,{id:"progName",value:d,onChange:u=>o(u.target.value),placeholder:"e.g., Bachelor of Science...",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"progAbbr",children:"Abbreviation"}),e.jsx(q,{id:"progAbbr",value:b,onChange:u=>f(u.target.value),placeholder:"e.g., BSIT",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Effectivity A.Y."}),e.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr] items-center gap-2",children:[e.jsxs(V,{value:g,onValueChange:S,required:!0,children:[e.jsx(K,{children:e.jsx(J,{placeholder:"Start Year"})}),e.jsx(W,{children:ze.map(u=>e.jsx(R,{value:u,children:u},u))})]}),e.jsx("span",{className:"text-muted-foreground",children:"-"}),e.jsxs(V,{value:j,onValueChange:_,required:!0,children:[e.jsx(K,{children:e.jsx(J,{placeholder:"End Year"})}),e.jsx(W,{children:ze.map(u=>e.jsx(R,{value:u,children:u},u))})]})]})]}),e.jsxs(se,{className:"pt-4",children:[e.jsx(te,{asChild:!0,children:e.jsx(P,{type:"button",variant:"outline",disabled:p,children:"Cancel"})}),e.jsx(P,{type:"submit",disabled:p,children:p?"Saving...":h?"Save Changes":"Save Program"})]})]})]})})}const fe={id:0,code:"",name:"",unitsTotal:0,unitsLec:"",unitsLab:"",hoursTotal:0,hoursLec:"",hoursLab:"",prerequisite:""},Rs=["1st Year","2nd Year","3rd Year","4th Year"],Bs=["1st Semester","2nd Semester","Summer"];function Us({isOpen:l,onClose:w,onSave:v,programId:h}){const[d,o]=s.useState(""),[b,f]=s.useState(""),[g,y]=s.useState([fe]),[j,_]=s.useState(!1);s.useEffect(()=>{const n=g.map(t=>({...t,unitsTotal:(Number(t.unitsLec)||0)+(Number(t.unitsLab)||0),hoursTotal:(Number(t.hoursLec)||0)+(Number(t.hoursLab)||0)}));JSON.stringify(n)!==JSON.stringify(g)&&y(n)},[g]);const p=s.useMemo(()=>g.reduce((n,t)=>(n.totalUnits+=Number(t.unitsTotal)||0,n.totalLecUnits+=Number(t.unitsLec)||0,n.totalLabUnits+=Number(t.unitsLab)||0,n.totalHours+=Number(t.hoursTotal)||0,n.totalLecHours+=Number(t.hoursLec)||0,n.totalLabHours+=Number(t.hoursLab)||0,n),{totalUnits:0,totalLecUnits:0,totalLabUnits:0,totalHours:0,totalLecHours:0,totalLabHours:0}),[g]),T=()=>y(n=>[...n,{...fe}]),x=n=>y(t=>t.length>1?t.filter((r,a)=>a!==n):t),S=(n,t,r)=>y(a=>a.map((i,k)=>k===n?{...i,[t]:r}:i)),u=async n=>{if(n.preventDefault(),!d||!b){m.error("Please select a year level and semester.");return}if(g.some(t=>!t.code.trim()||!t.name.trim())){m.error("Please fill out all subject codes and titles.");return}_(!0);try{const t=localStorage.getItem("accessToken");if(!t){m.error("Authentication required."),_(!1);return}const r={program_id:h,year_level:d,semester_level:b,subjects:g.map(i=>({subject_code:i.code,des_title:i.name,total_units:i.unitsTotal,lec_units:Number(i.unitsLec)||0,lab_units:Number(i.unitsLab)||0,total_hrs:i.hoursTotal,total_lec_hrs:Number(i.hoursLec)||0,total_lab_hrs:Number(i.hoursLab)||0,pre_requisite:i.prerequisite||null}))},a=await $.post("/semester-with-subjects",r,{headers:{Authorization:`Bearer ${t}`}});if(a.status===201&&a.data.semester){m.success("Semester and subjects added successfully!");const i=a.data.semester,k=`${i.year_level}, ${i.semester_level}`,E={id:i.id,isActive:i.status===1,startDate:i.start_date,endDate:i.end_date,subjects:(i.subjects||[]).map(C=>({id:C.id,code:C.subject_code,name:C.des_title,unitsTotal:C.total_units,unitsLec:C.lec_units,unitsLab:C.lab_units,hoursTotal:C.total_hrs,hoursLec:C.total_lec_hrs,hoursLab:C.total_lab_hrs,prerequisite:C.pre_requisite||"None"}))};v&&v({name:k,semester:E}),w()}}catch(t){m.error(t.response?.data?.error||"Failed to save. Please try again.")}finally{_(!1)}};return s.useEffect(()=>{l&&(o(""),f(""),y([fe]))},[l]),e.jsx(G,{open:l,onOpenChange:w,children:e.jsx(ps,{children:e.jsxs(Q,{className:"max-w-7xl h-[95vh] flex flex-col",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Add New Semester and Subjects"}),e.jsx(ve,{children:"Add subjects in bulk for a new semester. Totals are calculated automatically."})]}),e.jsxs("form",{onSubmit:u,className:"flex-grow flex flex-col min-h-0 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"yearLevel",className:"text-base",children:"Year Level"}),e.jsxs(V,{value:d,onValueChange:o,required:!0,children:[e.jsx(K,{id:"yearLevel",children:e.jsx(J,{placeholder:"Select a year level"})}),e.jsx(W,{children:Rs.map(n=>e.jsx(R,{value:n,children:n},n))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"semester",className:"text-base",children:"Semester"}),e.jsxs(V,{value:b,onValueChange:f,required:!0,children:[e.jsx(K,{id:"semester",children:e.jsx(J,{placeholder:"Select a semester"})}),e.jsx(W,{children:Bs.map(n=>e.jsx(R,{value:n,children:n},n))})]})]})]}),e.jsx("div",{className:"flex-grow overflow-auto border rounded-lg",children:e.jsxs(Re,{className:"min-w-[1200px]",children:[e.jsxs(Be,{className:"bg-muted/50 sticky top-0 z-10",children:[e.jsxs(H,{children:[e.jsx(I,{rowSpan:2,className:"align-middle text-center border-r",children:"Course Code"}),e.jsx(I,{rowSpan:2,className:"align-middle text-center border-r w-[350px]",children:"Descriptive Title"}),e.jsx(I,{colSpan:3,className:"text-center border-r",children:"Units"}),e.jsx(I,{colSpan:3,className:"text-center border-r",children:"Hours per week"}),e.jsx(I,{rowSpan:2,className:"align-middle text-center border-r",children:"Pre-requisite"}),e.jsx(I,{rowSpan:2,className:"align-middle w-[50px]"})]}),e.jsxs(H,{children:[e.jsx(I,{className:"text-center border-r",children:"Total"}),e.jsx(I,{className:"text-center border-r",children:"Lec"}),e.jsx(I,{className:"text-center border-r",children:"Lab"}),e.jsx(I,{className:"text-center border-r",children:"Total"}),e.jsx(I,{className:"text-center border-r",children:"Lec"}),e.jsx(I,{className:"text-center border-r",children:"Lab"})]})]}),e.jsx(Ue,{children:g.map((n,t)=>e.jsxs(H,{children:[e.jsx(N,{className:"w-[150px]",children:e.jsx(q,{required:!0,className:"uppercase",placeholder:"e.g. CS101",value:n.code,onChange:r=>S(t,"code",r.target.value)})}),e.jsx(N,{children:e.jsx(q,{required:!0,placeholder:"e.g. Intro to Programming",value:n.name,onChange:r=>S(t,"name",r.target.value)})}),e.jsx(N,{children:e.jsxs(ke,{children:[e.jsx(Pe,{asChild:!0,children:e.jsx(q,{value:n.unitsTotal||"",readOnly:!0,className:"text-center font-bold bg-muted/50 cursor-not-allowed"})}),e.jsx(Ee,{children:"Auto-calculated"})]})}),e.jsx(N,{children:e.jsx(q,{min:"0",type:"number",value:n.unitsLec,onChange:r=>S(t,"unitsLec",r.target.value),className:"text-center"})}),e.jsx(N,{children:e.jsx(q,{min:"0",type:"number",value:n.unitsLab,onChange:r=>S(t,"unitsLab",r.target.value),className:"text-center"})}),e.jsx(N,{children:e.jsxs(ke,{children:[e.jsx(Pe,{asChild:!0,children:e.jsx(q,{value:n.hoursTotal||"",readOnly:!0,className:"text-center font-bold bg-muted/50 cursor-not-allowed"})}),e.jsx(Ee,{children:"Auto-calculated"})]})}),e.jsx(N,{children:e.jsx(q,{min:"0",type:"number",value:n.hoursLec,onChange:r=>S(t,"hoursLec",r.target.value),className:"text-center"})}),e.jsx(N,{children:e.jsx(q,{min:"0",type:"number",value:n.hoursLab,onChange:r=>S(t,"hoursLab",r.target.value),className:"text-center"})}),e.jsx(N,{className:"w-[150px]",children:e.jsx(q,{placeholder:"None",value:n.prerequisite,onChange:r=>S(t,"prerequisite",r.target.value)})}),e.jsx(N,{className:"text-center",children:e.jsx(P,{type:"button",variant:"ghost",size:"icon",onClick:()=>x(t),disabled:g.length<=1,className:"text-destructive h-8 w-8 shrink-0 disabled:opacity-50",children:e.jsx(Se,{size:16})})})]},t))}),e.jsx(He,{className:"sticky bottom-0 bg-muted/80 backdrop-blur-sm",children:e.jsxs(H,{children:[e.jsx(N,{colSpan:2,className:"text-right font-bold text-lg",children:"SEMESTER TOTALS"}),e.jsx(N,{className:"text-center font-bold text-lg text-primary",children:p.totalUnits}),e.jsx(N,{className:"text-center font-semibold",children:p.totalLecUnits}),e.jsx(N,{className:"text-center font-semibold",children:p.totalLabUnits}),e.jsx(N,{className:"text-center font-bold text-lg text-primary",children:p.totalHours}),e.jsx(N,{className:"text-center font-semibold",children:p.totalLecHours}),e.jsx(N,{className:"text-center font-semibold",children:p.totalLabHours}),e.jsx(N,{colSpan:2})]})})]})}),e.jsxs(P,{type:"button",variant:"outline",onClick:T,className:"mt-4 w-full sm:w-auto",children:[e.jsx(ye,{size:16,className:"mr-2"})," Add Subject Row"]}),e.jsxs(se,{className:"mt-5 pt-4 border-t",children:[e.jsx(te,{asChild:!0,children:e.jsx(P,{type:"button",variant:"outline",disabled:j,children:"Cancel"})}),e.jsx(P,{type:"submit",disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"mr-2 h-4 w-4 animate-spin"})," Saving..."]}):"Save Curriculum"})]})]})]})})})}const Hs=["1st Year","2nd Year","3rd Year","4th Year"],Ds=["1st Semester","2nd Semester","Summer"];function Vs({isOpen:l,onClose:w,onSaveSuccess:v,semesterId:h,initialData:d}){const[o,b]=s.useState(!1),[f,g]=s.useState(""),[y,j]=s.useState("");s.useEffect(()=>{if(l&&d){const p=d.split(", ");p.length===2&&(g(p[0]),j(p[1]))}},[l,d]);const _=async p=>{p.preventDefault();const T=`${f}, ${y}`;if(!f||!y){m.error("Please select both a year level and a semester.");return}if(T===d){m.info("No changes were made."),w();return}if(!h){m.error("Semester ID is missing.");return}b(!0);try{const x=localStorage.getItem("accessToken");if(!x){m.error("Authentication required."),b(!1);return}const S={year_level:f,semester_level:y};await $.put(`/semesters/${h}/rename`,S,{headers:{Authorization:`Bearer ${x}`}}),m.success("Semester renamed successfully!"),v(d,T),w()}catch(x){m.error(x.response?.data?.message||"Failed to rename semester.")}finally{b(!1)}};return e.jsx(G,{open:l,onOpenChange:w,children:e.jsxs(Q,{children:[e.jsx(Z,{children:e.jsx(ee,{children:"Rename Semester"})}),e.jsxs("form",{onSubmit:_,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"yearPart",children:"Year Level"}),e.jsxs(V,{value:f,onValueChange:g,children:[e.jsx(K,{id:"yearPart",children:e.jsx(J,{placeholder:"Select a year level"})}),e.jsx(W,{children:Hs.map(p=>e.jsx(R,{value:p,children:p},p))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"semesterPart",children:"Semester"}),e.jsxs(V,{value:y,onValueChange:j,children:[e.jsx(K,{id:"semesterPart",children:e.jsx(J,{placeholder:"Select a semester"})}),e.jsx(W,{children:Ds.map(p=>e.jsx(R,{value:p,children:p},p))})]})]}),e.jsxs(se,{className:"pt-4",children:[e.jsx(te,{asChild:!0,children:e.jsx(P,{type:"button",variant:"outline",disabled:o,children:"Cancel"})}),e.jsx(P,{type:"submit",disabled:o||!f||!y,children:o?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"mr-2 h-4 w-4 animate-spin"})," Renaming..."]}):"Rename"})]})]})]})})}function Ks(l){const{isOpen:w,onClose:v,onSave:h,initialData:d}=l,[o,b]=s.useState({id:0,code:"",name:"",unitsTotal:0,unitsLec:0,unitsLab:0,hoursTotal:0,hoursLec:0,hoursLab:0,prerequisite:""}),[f,g]=s.useState(null);s.useEffect(()=>{const x=(Number(o.unitsLec)||0)+(Number(o.unitsLab)||0),S=(Number(o.hoursLec)||0)+(Number(o.hoursLab)||0);b(u=>({...u,unitsTotal:x,hoursTotal:S}))},[o.unitsLec,o.unitsLab,o.hoursLec,o.hoursLab]),s.useEffect(()=>{const x=Number(o.unitsLec)||0,S=Number(o.unitsLab)||0,u=Number(o.unitsTotal)||0,n=x+S>u?"Lec + Lab units cannot exceed Total.":null,t=Number(o.hoursLec)||0,r=Number(o.hoursLab)||0,a=Number(o.hoursTotal)||0,i=t+r>a?"Lec + Lab hours cannot exceed Total.":null;g(n||i?{unitError:n,hourError:i}:null)},[o]),s.useEffect(()=>{w&&b(d||{id:0,code:"",name:"",unitsTotal:0,unitsLec:0,unitsLab:0,hoursTotal:0,hoursLec:0,hoursLab:0,prerequisite:""})},[w,d]);const y=(x,S)=>{b(u=>({...u,[x]:S}))},j=(x,S)=>{const u=Number(S);y(x,u>=0?u:0)},[_,p]=s.useState(!1),T=async x=>{if(x.preventDefault(),f){m.error("Please fix the validation errors before saving.");return}const S=!!d;p(!0);try{await h(o,S),v()}catch(u){console.error("Subject save failed:",u),m.error("Failed to save subject.")}finally{p(!1)}};return e.jsx(G,{open:w,onOpenChange:v,children:e.jsxs(Q,{children:[e.jsx(Z,{children:e.jsx(ee,{children:d?`Edit Subject: ${d.code}`:"Add New Subject"})}),e.jsxs("form",{onSubmit:T,className:"py-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"code",children:"Course Code"}),e.jsx(q,{id:"code",value:o.code,onChange:x=>y("code",x.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"prerequisite",children:"Pre-requisite"}),e.jsx(q,{id:"prerequisite",value:o.prerequisite,onChange:x=>y("prerequisite",x.target.value),placeholder:"None"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"name",children:"Descriptive Title"}),e.jsx(q,{id:"name",value:o.name,onChange:x=>y("name",x.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(F,{className:"font-semibold",children:"Unit Allocation"}),e.jsxs("div",{className:`grid grid-cols-3 gap-4 p-4 border rounded-lg bg-muted/30 ${f?.unitError?"border-destructive":""}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(F,{htmlFor:"unitsTotal",children:"Total"}),e.jsx(q,{id:"unitsTotal",type:"number",value:o.unitsTotal||"",disabled:!0,readOnly:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(F,{htmlFor:"unitsLec",children:"Lec"}),e.jsx(q,{id:"unitsLec",type:"number",value:o.unitsLec||"",onChange:x=>j("unitsLec",x.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(F,{htmlFor:"unitsLab",children:"Lab"}),e.jsx(q,{id:"unitsLab",type:"number",value:o.unitsLab||"",onChange:x=>j("unitsLab",x.target.value)})]})]}),f?.unitError&&e.jsxs("p",{className:"text-destructive text-sm flex items-center gap-2 mt-2",children:[e.jsx(Fe,{size:16}),f.unitError]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(F,{className:"font-semibold",children:"Hour Allocation"}),e.jsxs("div",{className:`grid grid-cols-3 gap-4 p-4 border rounded-lg bg-muted/30 ${f?.hourError?"border-destructive":""}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(F,{htmlFor:"hoursTotal",children:"Total"}),e.jsx(q,{id:"hoursTotal",type:"number",value:o.hoursTotal||"",disabled:!0,readOnly:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(F,{htmlFor:"hoursLec",children:"Lec"}),e.jsx(q,{id:"hoursLec",type:"number",value:o.hoursLec||"",onChange:x=>j("hoursLec",x.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(F,{htmlFor:"hoursLab",children:"Lab"}),e.jsx(q,{id:"hoursLab",type:"number",value:o.hoursLab||"",onChange:x=>j("hoursLab",x.target.value)})]})]}),f?.hourError&&e.jsxs("p",{className:"text-destructive text-sm flex items-center gap-2 mt-2",children:[e.jsx(Fe,{size:16}),f.hourError]})]})]}),e.jsxs(se,{className:"mt-8 pt-4 border-t",children:[e.jsx(te,{asChild:!0,children:e.jsx(P,{type:"button",variant:"outline",disabled:_,children:"Cancel"})}),e.jsx(P,{type:"submit",disabled:!!f||_,children:_?"Saving...":d?"Save Changes":"Save Subject"})]})]})]})})}function Js(l,w,{checkForDefaultPrevented:v=!0}={}){return function(d){if(l?.(d),v===!1||!d.defaultPrevented)return w?.(d)}}var me="Switch",[Ws,gt]=bs(me),[Xs,Gs]=Ws(me),De=s.forwardRef((l,w)=>{const{__scopeSwitch:v,name:h,checked:d,defaultChecked:o,required:b,disabled:f,value:g="on",onCheckedChange:y,form:j,..._}=l,[p,T]=s.useState(null),x=$e(w,r=>T(r)),S=s.useRef(!1),u=p?j||!!p.closest("form"):!0,[n,t]=fs({prop:d,defaultProp:o??!1,onChange:y,caller:me});return e.jsxs(Xs,{scope:v,checked:n,disabled:f,children:[e.jsx(Me.button,{type:"button",role:"switch","aria-checked":n,"aria-required":b,"data-state":We(n),"data-disabled":f?"":void 0,disabled:f,value:g,..._,ref:x,onClick:Js(l.onClick,r=>{t(a=>!a),u&&(S.current=r.isPropagationStopped(),S.current||r.stopPropagation())})}),u&&e.jsx(Je,{control:p,bubbles:!S.current,name:h,value:g,checked:n,required:b,disabled:f,form:j,style:{transform:"translateX(-100%)"}})]})});De.displayName=me;var Ve="SwitchThumb",Ke=s.forwardRef((l,w)=>{const{__scopeSwitch:v,...h}=l,d=Gs(Ve,v);return e.jsx(Me.span,{"data-state":We(d.checked),"data-disabled":d.disabled?"":void 0,...h,ref:w})});Ke.displayName=Ve;var Qs="SwitchBubbleInput",Je=s.forwardRef(({__scopeSwitch:l,control:w,checked:v,bubbles:h=!0,...d},o)=>{const b=s.useRef(null),f=$e(b,o),g=ys(v),y=gs(w);return s.useEffect(()=>{const j=b.current;if(!j)return;const _=window.HTMLInputElement.prototype,T=Object.getOwnPropertyDescriptor(_,"checked").set;if(g!==v&&T){const x=new Event("click",{bubbles:h});T.call(j,v),j.dispatchEvent(x)}},[g,v,h]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:v,...d,tabIndex:-1,ref:f,style:{...d.style,...y,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Je.displayName=Qs;function We(l){return l?"checked":"unchecked"}var Xe=De,Zs=Ke;const Ge=s.forwardRef(({className:l,...w},v)=>e.jsx(Xe,{className:Ie("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",l),...w,ref:v,children:e.jsx(Zs,{className:Ie("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));Ge.displayName=Xe.displayName;function et({isOpen:l,onClose:w,onSaveSuccess:v,semesterId:h,semesterName:d,initialData:o}){const[b,f]=s.useState(!1),[g,y]=s.useState(""),[j,_]=s.useState(""),[p,T]=s.useState(!1);s.useEffect(()=>{if(l)if(o){f(o.isActive);const S=u=>u?new Date(u).toISOString().split("T")[0]:"";y(S(o.startDate)),_(S(o.endDate))}else f(!1),y(""),_("")},[l,o]);const x=async S=>{if(S.preventDefault(),!h){m.error("Semester ID is missing.");return}if(b&&(!g||!j)){m.error("Start and end dates are required when semester is Active.");return}if(g&&j&&new Date(g)>new Date(j)){m.error("Start date cannot be after the end date.");return}const u=localStorage.getItem("accessToken");if(!u){m.error("Authentication required.");return}T(!0);try{const n=`/semesters/${h}/status`,t={status:b?1:0,start_date:g||null,end_date:j||null},r=await $.put(n,t,{headers:{Authorization:`Bearer ${u}`}});m.success(r.data.message||"Semester status updated!"),v(d,{isActive:b,startDate:g||void 0,endDate:j||void 0}),w()}catch(n){m.error(n.response?.data?.message||"Failed to update semester.")}finally{T(!1)}};return e.jsx(G,{open:l,onOpenChange:w,children:e.jsxs(Q,{children:[e.jsx(Z,{children:e.jsx(ee,{children:"Set Semester Status & Dates"})}),e.jsxs("form",{onSubmit:x,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Semester"}),e.jsx("p",{className:"font-semibold text-lg",children:d})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[e.jsx(Ge,{id:"semester-status",checked:b,onCheckedChange:f}),e.jsx(F,{htmlFor:"semester-status",className:"cursor-pointer",children:b?"Active":"Inactive"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"startDate",children:"Start Date"}),e.jsx(q,{id:"startDate",type:"date",value:g,onChange:S=>y(S.target.value),required:b})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"endDate",children:"End Date"}),e.jsx(q,{id:"endDate",type:"date",value:j,onChange:S=>_(S.target.value),required:b})]})]}),e.jsxs(se,{className:"pt-4",children:[e.jsx(te,{asChild:!0,children:e.jsx(P,{type:"button",variant:"outline",disabled:p,children:"Cancel"})}),e.jsx(P,{type:"submit",disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"mr-2 h-4 w-4 animate-spin"})," Saving..."]}):"Save Settings"})]})]})]})})}function st(){const[l,w]=s.useState([]),[v,h]=s.useState(!0),[d,o]=s.useState(""),[b,f]=s.useState("All Years"),[g,y]=s.useState("Active"),[j,_]=s.useState(null),[p,T]=s.useState(!1),[x,S]=s.useState(null),[u,n]=s.useState(!1),[t,r]=s.useState(!1),[a,i]=s.useState(!1),[k,E]=s.useState(!1),[C,Y]=s.useState(0),[ne,de]=s.useState(null),[le,we]=s.useState(null),[he,xe]=s.useState(null),[re,Le]=s.useState(null),[je,Qe]=s.useState({name:null,semester:null}),[Ce,Ze]=s.useState({id:null,name:null}),_e=vs(),D=s.useCallback(async(c=!0)=>{c&&h(!0);const L=localStorage.getItem("accessToken");if(!L){m.error("Authentication required."),h(!1),_e("/facultyscheduler/user-login");return}try{const A=await $.get("/program",{headers:{Authorization:`Bearer ${L}`}}),ie=(Array.isArray(A.data.programs)?A.data.programs:Object.values(A.data.programs||{})).map(z=>({id:z.id,name:z.program_name,abbreviation:z.abbreviation,effectiveYear:`${z.year_from}-${z.year_to}`,total_subjects:z.total_subjects||0,total_units:z.total_units||0,isActive:z.status===0,semesters:z.semesters?Object.entries(z.semesters).reduce((ce,[O,U])=>(ce[O]={id:U.id,subjects:(U.subjects||[]).map(M=>({id:M.id,code:M.subject_code,name:M.des_title,unitsTotal:M.total_units,unitsLec:M.lec_units,unitsLab:M.lab_units,hoursTotal:M.total_hrs,hoursLec:M.total_lec_hrs,hoursLab:M.total_lab_hrs,prerequisite:M.pre_requisite||""})),isActive:U.status===1,startDate:U.start_date,endDate:U.end_date},ce),{}):{},subjects:z.subjects||{}}));w(ie)}catch{m.error("Failed to fetch programs.")}finally{c&&h(!1)}},[_e]);s.useEffect(()=>{D(!0)},[D]),s.useEffect(()=>{ne&&de(null)},[ne]),s.useEffect(()=>{le&&we(null)},[le]),s.useEffect(()=>{he&&xe(null)},[he]);const es=(c,L)=>{Qe({name:c,semester:L}),E(!0)},ss=(c,L)=>{Ze({id:c,name:L}),r(!0)},ts=()=>{D(!1),T(!1)},rs=()=>{S(null),T(!0)},as=c=>{S(c),T(!0)},[B,oe]=s.useState(null),[pe,Ae]=s.useState(!1),ns=c=>{oe({open:!0,title:"Archive Program",description:"This will move the program to the archives and make it inactive.",confirmText:"Yes, archive it!",confirmVariant:"destructive",onConfirm:async()=>{const L=localStorage.getItem("accessToken");if(!L){m.error("Authentication required.");return}try{const A=await $.post(`/archive-program/${c}`,{},{headers:{Authorization:`Bearer ${L}`}});m.success(A.data?.message||"Program archived successfully."),await D(!1)}catch{m.error("Failed to archive program.")}}})},ls=c=>{oe({open:!0,title:"Restore Program",description:"This will make the program active again.",confirmText:"Yes, restore it!",confirmVariant:"default",onConfirm:async()=>{const L=localStorage.getItem("accessToken");if(!L){m.error("Authentication required.");return}try{await $.post(`/restore-program/${c}`,{},{headers:{Authorization:`Bearer ${L}`}}),m.success("Program restored successfully."),await D(!1)}catch{m.error("Failed to restore program.")}}})},os=(c,L)=>{Le({semester:c,semesterId:L,subject:null}),i(!0)},is=(c,L)=>{const A=j?.semesters?.[c]?.id;Le({semester:c,semesterId:A,subject:L}),i(!0)},cs=(c,L)=>{if(!L){m.error("Could not find subject ID to delete.");return}oe({open:!0,title:"Delete Subject",description:"This will permanently delete this subject. This action cannot be reverted.",confirmText:"Yes, delete it!",confirmVariant:"destructive",onConfirm:async()=>{const A=localStorage.getItem("accessToken");if(!A){m.error("Authentication required.");return}try{await $.delete(`/subjects/${L}`,{headers:{Authorization:`Bearer ${A}`}}),m.success("Subject deleted successfully!"),Y(ae=>ae+1),await D(!1)}catch{m.error("Failed to delete subject.")}}})},ds=async(c,L,A,ae)=>{if(!j){m.error("No program selected.");return}const ie=localStorage.getItem("accessToken");if(!ie){m.error("Authentication required.");return}try{const z=L??j?.semesters?.[c]?.id;if(!ae&&!z){m.error("Semester ID not found.");return}const ce={subject_code:A.code,des_title:A.name,total_units:A.unitsTotal,lec_units:A.unitsLec,lab_units:A.unitsLab,total_hrs:A.hoursTotal,total_lec_hrs:A.hoursLec,total_lab_hrs:A.hoursLab,pre_requisite:A.prerequisite||null};let O;if(ae){if(!A.id){m.error("Subject ID missing for update.");return}O=await $.put(`/subjects/${A.id}`,ce,{headers:{Authorization:`Bearer ${ie}`}}),m.success("Subject updated successfully.")}else O=await $.post(`/semesters/${z}/subjects`,ce,{headers:{Authorization:`Bearer ${ie}`}}),m.success("Subject added successfully.");if(O.data?.subject){const U={id:O.data.subject.id,code:O.data.subject.subject_code,name:O.data.subject.des_title,unitsTotal:O.data.subject.total_units,unitsLec:O.data.subject.lec_units,unitsLab:O.data.subject.lab_units,hoursTotal:O.data.subject.total_hrs,hoursLec:O.data.subject.total_lec_hrs,hoursLab:O.data.subject.total_lab_hrs,prerequisite:O.data.subject.pre_requisite||"None"};de({semesterName:c,subject:U})}else Y(U=>U+1);await D(!1)}catch{m.error("Failed to save subject.")}},us=c=>{we(c),D(!1)},ms=(c,L)=>{xe({name:c,semester:L})},hs=(c,L)=>{xe({name:c,semester:{},newName:L})},xs=s.useMemo(()=>{const c=new Set(l.map(L=>L.effectiveYear));return["All Years",...Array.from(c).sort((L,A)=>A.localeCompare(L))]},[l]),Te=s.useMemo(()=>l.filter(c=>c.name.toLowerCase().includes(d.toLowerCase())||c.abbreviation.toLowerCase().includes(d.toLowerCase())).filter(c=>b==="All Years"||c.effectiveYear===b).filter(c=>g==="All"?!0:g==="Active"?c.isActive:!c.isActive),[l,d,b,g]);return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground tracking-tight",children:"Curriculum Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage academic programs, semesters, and their subjects."})]}),e.jsx("div",{className:"bg-card p-4 md:p-6 rounded-lg shadow-sm border border-border mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-center",children:[e.jsxs("div",{className:"relative w-full md:flex-grow",children:[e.jsx(Ls,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:20}),e.jsx(q,{type:"text",placeholder:"Search program...",className:"pl-10 w-full",value:d,onChange:c=>o(c.target.value)})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3 w-full md:w-auto",children:[e.jsxs(V,{value:b,onValueChange:f,children:[e.jsxs(K,{className:"w-full sm:w-auto md:w-[180px]",children:[e.jsx(Oe,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsx(J,{placeholder:"Filter by A.Y."})]}),e.jsx(W,{children:xs.map(c=>e.jsx(R,{value:c,children:c},c))})]}),e.jsxs(V,{value:g,onValueChange:y,children:[e.jsxs(K,{className:"w-full sm:w-auto md:w-[180px]",children:[e.jsx(_s,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsx(J,{placeholder:"Filter by Status"})]}),e.jsxs(W,{children:[e.jsx(R,{value:"All",children:"All"}),e.jsx(R,{value:"Active",children:"Active"}),e.jsx(R,{value:"Inactive",children:"Inactive"})]})]}),e.jsxs(P,{onClick:rs,className:"w-full sm:w-auto",children:[e.jsx(ye,{size:16,className:"mr-2"})," Add Program"]})]})]})}),v?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:3}).map((c,L)=>e.jsx(Ys,{},L))}):e.jsx(Ss,{children:Te.length>0?e.jsx(be.div,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Te.map((c,L)=>e.jsx(Fs,{program:c,index:L,onEdit:as,onArchive:ns,onRestore:ls,onManage:()=>_(c)},c.id))}):e.jsxs(be.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-20 text-muted-foreground",children:[e.jsx(Ps,{size:56,className:"mx-auto mb-4"}),e.jsx("h4",{className:"font-semibold text-xl text-foreground",children:"No Programs Found"}),e.jsx("p",{children:"Try adjusting your filters or add a new program."})]})}),e.jsx(Ms,{isOpen:p,onClose:()=>T(!1),onSave:ts,initialData:x}),B&&e.jsx(G,{open:B.open,onOpenChange:c=>!c&&oe(null),children:e.jsxs(Q,{children:[e.jsxs(Z,{children:[e.jsx(ee,{children:B.title}),B.description&&e.jsx(ve,{children:B.description})]}),e.jsxs(se,{children:[e.jsx(te,{asChild:!0,children:e.jsx(P,{variant:"outline",disabled:pe,children:"Cancel"})}),e.jsx(P,{onClick:async()=>{if(B?.onConfirm){Ae(!0);try{await B.onConfirm()}finally{Ae(!1),oe(null)}}},disabled:pe,variant:B.confirmVariant,children:pe?"Processing...":B.confirmText||"Confirm"})]})]})}),j&&e.jsx(Os,{isOpen:!!j,onClose:()=>_(null),program:j,onAddSemester:()=>n(!0),onEditSemester:ss,onDeleteSemester:()=>{},onAddSubject:os,onEditSubject:is,onDeleteSubject:cs,onSetSemesterStatus:es,refreshKey:C,updatedSubjectData:ne,newSemesterData:le,updatedSemesterData:he}),e.jsx(Us,{isOpen:u,onClose:()=>n(!1),onSave:us,programId:j?j.id:0}),e.jsx(Vs,{isOpen:t,onClose:()=>r(!1),onSaveSuccess:hs,semesterId:Ce.id,initialData:Ce.name||""}),re&&e.jsx(Ks,{isOpen:a,onClose:()=>i(!1),onSave:(c,L)=>ds(re.semester,re.semesterId,c,L),initialData:re.subject,programId:j?.id??0,semesterName:re.semester||"",semesterId:re.semesterId}),e.jsx(et,{isOpen:k,onClose:()=>E(!1),onSaveSuccess:ms,semesterId:je?.semester?.id||null,semesterName:je?.name||"",initialData:je?.semester||null})]})}function vt(){return e.jsx("main",{children:e.jsx(st,{})})}export{vt as default};
